added in remote
  their  100644 796fcffcd129e9594b5d578f18893807a5dfd4e8 .babelrc
@@ -0,0 +1,3 @@
+{
+  "plugins": ["syntax-dynamic-import"]
+}
merged
  result 100644 1ec8067f831c1ed1de768f65d3f2df91c43b29ae .eslintrc.yml
  our    100644 f724d1b1129c863e41f4e78d2b1a200c0aea07e7 .eslintrc.yml
@@ -66,6 +66,9 @@
   eqeqeq:
     - error
     - smart
+  strict:
+    - error
+    - global

   ###########
   # SPECIAL #
@@ -79,7 +82,15 @@
     - selector: ExportDefaultDeclaration
       message: Use of default exports is forbidden

+overrides:
+  - files: '*.d.ts'
+    rules:
+      strict:
+        - error
+        - never
+
 parserOptions:
   sourceType: module
   ecmaFeatures:
     jsx: true
+
merged
  result 100644 59072918c96565e2427754f755ca662d7b067423 .github/CONTRIBUTING.md
  our    100644 9d5b8dd9584adfcadfca0e70c747b3519a315309 .github/CONTRIBUTING.md
@@ -72,15 +72,15 @@

 Bugs are tracked as [GitHub issues](https://guides.github.com/features/issues/).

-Simply create an issue on the [GitHub Desktop issue tracker](https://github.com/desktop/desktop/issues)
-and fill out the provided [issue template](ISSUE_TEMPLATE.md).
+Simply create an issue on the [GitHub Desktop issue tracker](https://github.com/desktop/desktop/issues/new?template=bug_report.md)
+and fill out the provided issue template.

 The information we are interested in includes:

  - details about your environment - which build, which operating system
  - details about reproducing the issue - what steps to take, what happens, how
    often it happens
- - other relevant information - log files, screenshots, etc.
+ - other relevant information - log files, screenshots, etc

 ### Suggesting Enhancements

@@ -107,20 +107,21 @@

 Enhancement suggestions are tracked as [GitHub issues](https://guides.github.com/features/issues/).

-Simply create an issue on the [GitHub Desktop issue tracker](https://github.com/desktop/desktop/issues)
-and provide the following information:
+Simply create an issue on the [GitHub Desktop issue tracker](https://github.com/desktop/desktop/issues/new?template=feature_request.md)
+and fill out the provided issue template.

-* **Use a clear and descriptive title** for the issue to identify the
-  suggestion.
-* **Provide a step-by-step description of the suggested enhancement** in as
-  much detail as possible. This additional context helps the maintainers to
-  understand the enhancement from your perspective
-* **Explain why this enhancement would be useful** to GitHub Desktop users.
+Some additional advice:
+
+* **Use a clear and descriptive title** for the feature request
+* **Provide a step-by-step description of the suggested enhancement**
+  This additional context helps the maintainers understand the enhancement from
+  your perspective
+* **Explain why this enhancement would be useful** to GitHub Desktop users
 * **Include screenshots and animated GIFs** if relevant to help you demonstrate
   the steps or point out the part of GitHub Desktop which the suggestion is
   related to. You can use [this tool](http://www.cockos.com/licecap/) to record
-  GIFs on macOS and Windows.
-* **List some other applications where this enhancement exists, if applicable.**
+  GIFs on macOS and Windows
+* **List some other applications where this enhancement exists, if applicable**

 ### Help Wanted

@@ -148,27 +149,30 @@

 | Label name | :mag_right: | Description |
 | --- | --- | --- |
-| `enhancement` | [search](https://github.com/desktop/desktop/labels/enhancement) | Feature requests. |
-| `bug` | [search](https://github.com/desktop/desktop/labels/bug)  | Confirmed bugs or reports that are very likely to be bugs. |
-| `more-information-needed` | [search](https://github.com/desktop/desktop/labels/more-information-needed) | More information needs to be collected about these problems or feature requests (e.g. steps to reproduce). |
-| `reviewer-needs-to-reproduce` | [search](https://github.com/desktop/desktop/labels/reviewer-needs-to-reproduce)  | Likely bugs, but haven't been reliably reproduced by a reviewer. |
-| `stale` | [search](https://github.com/desktop/desktop/labels/stale) | Issues that are inactive and marked to be closed. |
-| `macOS` | [search](https://github.com/desktop/desktop/labels/macOS)  | Issues specific to macOS users. |
-| `Windows` | [search](https://github.com/desktop/desktop/labels/Windows)  | Issues specific to Windows users. |
-| `codemirror` | [search](https://github.com/desktop/desktop/labels/codemirror)  | Issues related to our use of [CodeMirror](https://codemirror.net/) that may require upstream fixes. |
-| `electron` | [search](https://github.com/desktop/desktop/labels/electron) | Issues related to our use of [Electron](https://electron.atom.io) that may require upstream fixes. |
+| `enhancement` | [search](https://github.com/desktop/desktop/labels/enhancement) | Feature requests |
+| `bug` | [search](https://github.com/desktop/desktop/labels/bug)  | Confirmed bugs or reports that are very likely to be bugs |
+| `more-information-needed` | [search](https://github.com/desktop/desktop/labels/more-information-needed) | More information needs to be collected about these problems or feature requests (e.g. steps to reproduce) |
+| `reviewer-needs-to-reproduce` | [search](https://github.com/desktop/desktop/labels/reviewer-needs-to-reproduce)  | Potential bugs that still need to be reliably reproduced by a reviewer |
+| `stale` | [search](https://github.com/desktop/desktop/labels/stale) | Issues that are inactive and marked to be closed |
+| `macOS` | [search](https://github.com/desktop/desktop/labels/macOS)  | Issues specific to macOS users |
+| `Windows` | [search](https://github.com/desktop/desktop/labels/Windows)  | Issues specific to Windows users |
+| `codemirror` | [search](https://github.com/desktop/desktop/labels/codemirror)  | Issues related to our use of [CodeMirror](https://codemirror.net/) that may require upstream fixes |
+| `electron` | [search](https://github.com/desktop/desktop/labels/electron) | Issues related to our use of [Electron](https://electron.atom.io) that may require upstream fixes |
+| `themes` | [search](https://github.com/desktop/desktop/labels/themes) | Issues related the light or dark themes that ship in Desktop |
+| `user-research` | [search](https://github.com/desktop/desktop/labels/user-research) | Issues that might benefit from user interviews, validations, and/or usability testing |
+| `integrations` | [search](https://github.com/desktop/desktop/labels/integrations) | Issues related to editor and shell integrations that ship in Desktop |

 #### Topics

 | Label name | :mag_right: | Description |
 | --- | --- | --- |
-| `help wanted` | [search](https://github.com/desktop/desktop/labels/help%20wanted)  | Issues marked as ideal for external contributors. |
-| `tech-debt` | [search](https://github.com/desktop/desktop/labels/tech-debt) | Issues related to code or architecture decisions. |
-| `needs-design-input` | [search](https://github.com/desktop/desktop/labels/needs-design-input)  | Issues that require design input from the core team before the work can be started. |
+| `help wanted` | [search](https://github.com/desktop/desktop/labels/help%20wanted)  | Issues marked as ideal for external contributors |
+| `tech-debt` | [search](https://github.com/desktop/desktop/labels/tech-debt) | Issues related to code or architecture decisions |
+| `needs-design-input` | [search](https://github.com/desktop/desktop/labels/needs-design-input)  | Issues that require design input from the core team before the work can be started |

 #### Workflow

 | Label name | :mag_right: | Description |
 | --- | --- | --- |
-| `infrastructure` | [search](https://github.com/desktop/desktop/labels/infrastructure) | Pull requests not related to the core application - documentation, dependencies, tooling, etc. |
-| `ready-for-review` | [search](https://github.com/desktop/desktop/labels/ready-for-review)  | Pull Requests that are ready to be reviewed by the maintainers. |
+| `infrastructure` | [search](https://github.com/desktop/desktop/labels/infrastructure) | Pull requests not related to the core application - documentation, dependencies, tooling, etc |
+| `ready-for-review` | [search](https://github.com/desktop/desktop/labels/ready-for-review)  | Pull Requests that are ready to be reviewed by the maintainers |
added in remote
  their  100644 56219510678c2797ba48167a1e1d912ccf843eac .github/ISSUE_TEMPLATE/bug_report.md
@@ -0,0 +1,71 @@
+---
+name: üêõ Bug report
+about: Report a problem encountered while using GitHub Desktop
+
+---
+
+<!--
+First and foremost, we‚Äôd like to thank you for taking the time to contribute to our project. Before submitting your issue, please follow these steps:
+
+1. Familiarize yourself with our contributing guide:
+	* https://github.com/desktop/desktop/blob/master/.github/CONTRIBUTING.md#contributing-to-github-desktop
+2. Check if your issue (and sometimes workaround) is in the known-issues doc:
+	* https://github.com/desktop/desktop/blob/master/docs/known-issues.md
+3. Make sure your issue isn‚Äôt a duplicate of another issue
+4. If you have made it to this step, go ahead and fill out the template below
+-->
+
+## Description
+<!--
+Provide a detailed description of the behavior you're seeing or the behavior you'd like to see **below** this comment.
+-->
+
+
+## Version
+<!--
+Place the version of GitHub Desktop you have installed **below** this comment. This is displayed under the 'About GitHub Desktop' menu item. If you are running from source, include the commit by running `git rev-parse HEAD` from the local repository.
+-->
+* GitHub Desktop:
+<!--
+Place the version of your operating system **below** this comment. The operating system you are running on may also help with reproducing the issue. If you are on macOS, launch 'About This Mac' and write down the OS version listed. If you are on Windows, open 'Command Prompt' and attach the output of this command: 'cmd /c ver'
+-->
+* Operating system:
+
+
+## Steps to Reproduce
+<!--
+List the steps to reproduce your issue **below** this comment
+ex,
+1. `step 1`
+2. `step 2`
+3. `and so on‚Ä¶`
+-->
+
+### Expected Behavior
+<!-- What you expected to happen -->
+
+### Actual Behavior
+<!-- What actually happens -->
+
+
+## Additional Information
+<!--
+Place any additional information, configuration, or data that might be necessary to reproduce the issue **below** this comment.
+
+If you have screen shots or gifs that demonstrate the issue, please include them.
+
+If the issue involves a specific public repository, including the information about it will make it easier to recreate the issue.
+
+If you are dealing with a performance issue or regression, attaching a Timeline profile of the task will help the developers understand the runtime behavior of the application on your machine.
+https://github.com/desktop/desktop/blob/master/docs/contributing/timeline-profile.md
+-->
+
+### Logs
+<!--
+Attach your log file (You can simply drag your file here to insert it) to this issue. Please make sure the generated link to your log file is **below** this comment section otherwise it will not appear when you submit your issue.
+
+macOS logs location: `~/Library/Application Support/GitHub Desktop/logs/*.desktop.production.log`
+Windows logs location: `%APPDATA%\GitHub Desktop\logs\*.desktop.production.log`
+
+The log files are organized by date, so see if anything was generated for today's date.
+-->
added in remote
  their  100644 7c297531a2dd774e2b066ddc50384a12f5e8e034 .github/ISSUE_TEMPLATE/feature_request.md
@@ -0,0 +1,17 @@
+---
+name: üéâ Feature request
+about: Suggest an idea to improve GitHub Desktop
+---
+
+**Is your feature request related to a problem? Please describe.**
+A clear and concise description of what the problem is. Ex. I have an issue when [...]
+
+**Describe the solution you'd like**
+A clear and concise description of what you want to happen. Add any considered drawbacks.
+
+**Describe alternatives you've considered**
+A clear and concise description of any alternative solutions or features you've considered.
+
+**Teachability, Documentation, Adoption, Migration Strategy**
+If you can, explain how users will be able to use this. This will help the core team understand how the feature would work, and assist with future work like documentation.
+Screenshots or mockups here are a great help!
\ No newline at end of file
removed in remote
  base   100644 65c8c0a5f5c37299d369ce4811128ae829368d2d .github/ISSUE_TEMPLATE.md
  our    100644 65c8c0a5f5c37299d369ce4811128ae829368d2d .github/ISSUE_TEMPLATE.md
@@ -1,65 +0,0 @@
-<!--
-First and foremost, we‚Äôd like to thank you for taking the time to contribute to our project. Before submitting your issue, please follow these steps:
-
-1. Familiarize yourself with our contributing guide:
-	* https://github.com/desktop/desktop/blob/master/CONTRIBUTING.md#contributing-to-github-desktop
-2. Check if your issue (and sometimes workaround) is in the known-issues doc:
-	* https://github.com/desktop/desktop/blob/master/docs/known-issues.md
-3. Make sure your issue isn‚Äôt a duplicate of another issue
-4. If you have made it to this step, go ahead and fill out the template below
--->
-
-## Description
-<!--
-Provide a detailed description of the behavior you're seeing or the behavior you'd like to see **below** this comment.
--->
-
-
-## Version
-<!--
-Place the version of GitHub Desktop you have installed **below** this comment. This is displayed under the 'About GitHub Desktop' menu item. If you are running from source, include the commit by running `git rev-parse HEAD` from the local repository.
--->
-* GitHub Desktop:
-<!--
-Place the version of your operating system **below** this comment. The operating system you are running on may also help with reproducing the issue. If you are on macOS, launch 'About This Mac' and write down the OS version listed. If you are on Windows, open 'Command Prompt' and attach the output of this command: 'cmd /c ver'
--->
-* Operating system:
-
-
-## Steps to Reproduce
-<!--
-List the steps to reproduce your issue **below** this comment
-ex,
-1. `step 1`
-2. `step 2`
-3. `and so on‚Ä¶`
--->
-
-### Expected Behavior
-<!-- What you expected to happen -->
-
-### Actual Behavior
-<!-- What actually happens -->
-
-
-## Additional Information
-<!--
-Place any additional information, configuration, or data that might be necessary to reproduce the issue **below** this comment.
-
-If you have screen shots or gifs that demonstrate the issue, please include them.
-
-If the issue involves a specific public repository, including the information about it will make it easier to recreate the issue.
-
-If you are dealing with a performance issue or regression, attaching a Timeline profile of the task will help the developers understand the runtime behavior of the application on your machine.
-https://github.com/desktop/desktop/blob/master/docs/contributing/timeline-profile.md
--->
-
-### Logs
-<!--
-Attach your log file (You can simply drag your file here to insert it) to this issue. Please make sure the generated link to your log file is **below** this comment section otherwise it will not appear when you submit your issue.
-
-macOS logs location: `~/Library/Application Support/GitHub Desktop/logs/*.desktop.production.log`
-Windows logs location: `%APPDATA%\GitHub Desktop\logs\*.desktop.production.log`
-
-The log files are organized by date, so see if anything was generated for today's date.
--->
merged
  result 100644 63a2cc1a341c354faf7c4979d2fffb86d5e93501 .gitignore
  our    100644 de84018cf2395164cee116bb3a01759e6cf3c41a .gitignore
@@ -9,3 +9,4 @@
 .idea/
 .vs/
 .eslintcache
+*.iml
merged
  result 100644 dba04c1e1786b2c5f953ebf2c24c6fcc615c2d9a .node-version
  our    100644 32c861f970d80180ef7668a04d5e3ce61bbd706e .node-version
@@ -1 +1 @@
-8.9.2
+8.11.3
merged
  result 100644 ab983e8df0a9388373270ef9d669c8806ec4ccf9 .prettierrc.yml
  our    100644 a99d2fbed4d8d42c708293ed1a1d310b3ff27c5a .prettierrc.yml
@@ -2,3 +2,8 @@
 trailingComma: es5
 semi: false
 proseWrap: always
+
+overrides:
+- files: "*.scss"
+  options:
+    printWidth: 200
\ No newline at end of file
merged
  result 100644 fde223649b6eef6edf60d8726f22ddd799873819 .travis.yml
  our    100644 15b264ab77bd3f42b71b4f5f9072b455a964ca95 .travis.yml
@@ -38,7 +38,7 @@

 language: node_js
 node_js:
-  - "8.9.0"
+  - "8.11.0"

 cache:
   yarn: true
@@ -50,7 +50,7 @@
     - $HOME/.cache/electron-builder

 before_install:
-  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.3.2
+  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.5.1
   - export PATH=$HOME/.yarn/bin:$PATH

 install:
merged
  result 100644 2de5029d6613dc9f507cd891b707d66e78b68851 README.md
  our    100644 574e4d56ae5ca7982571359a903164b85027cf81 README.md
@@ -3,6 +3,7 @@
 [![Travis](https://img.shields.io/travis/desktop/desktop.svg?style=flat-square&label=Travis+CI)](https://travis-ci.org/desktop/desktop)
 [![CircleCI](https://img.shields.io/circleci/project/github/desktop/desktop.svg?style=flat-square&label=CircleCI)](https://circleci.com/gh/desktop/desktop)
 [![AppVeyor Build Status](https://img.shields.io/appveyor/ci/github-windows/desktop/master.svg?style=flat-square&label=AppVeyor&logo=appveyor)](https://ci.appveyor.com/project/github-windows/desktop/branch/master)
+[![VSTS Build Status](https://github.visualstudio.com/_apis/public/build/definitions/845028c2-21f3-4eb1-80b9-215d3e9b1d08/3/badge)](https://github.visualstudio.com/Desktop/_build/index?definitionId=3)
 [![license](https://img.shields.io/github/license/desktop/desktop.svg?style=flat-square)](https://github.com/desktop/desktop/blob/master/LICENSE)
 ![90+% TypeScript](https://img.shields.io/github/languages/top/desktop/desktop.svg?style=flat-square&colorB=green)

@@ -51,8 +52,8 @@
 There is also a list of [known issues](https://github.com/desktop/desktop/blob/master/docs/known-issues.md)
 that are being tracked against Desktop, and some of these issues have workarounds.

-If you can't find an issue that matches what you're seeing, open a [new issue](https://github.com/desktop/desktop/issues/new)
-and fill out the template to provide us with enough information to investigate
+If you can't find an issue that matches what you're seeing, open a [new issue](https://github.com/desktop/desktop/issues/new/choose),
+choose the right template and provide us with enough information to investigate
 further.

 ## How can I contribute to GitHub Desktop?
merged
  result 100644 f7a365459e5cee710b2f3156119a6a2b2ff65a7d app/.npmrc
  our    100644 3b80cccbdce21610474a65dcdc28c309d819e278 app/.npmrc
@@ -1,4 +1,4 @@
 runtime = electron
 disturl = https://atom.io/download/electron
-target = 1.8.3
+target = 1.8.7
 arch = x64
removed in remote
  base   100644 996444dc72a75f727b5f5e62cac72e4fe4a21302 app/app-info.d.ts
  our    100644 996444dc72a75f727b5f5e62cac72e4fe4a21302 app/app-info.d.ts
@@ -1,2 +0,0 @@
-export function getReplacements(): {}
-export function getCLICommands(): string[]
removed in remote
  base   100644 53ac0bb5d571c6f678ac4794df6004fed9c17cd7 app/app-info.js
  our    100644 53ac0bb5d571c6f678ac4794df6004fed9c17cd7 app/app-info.js
@@ -1,50 +0,0 @@
-'use strict'
-
-const fs = require('fs')
-const path = require('path')
-
-const gitInfo = require('./git-info')
-const distInfo = require('../script/dist-info')
-
-const projectRoot = path.join(__dirname, '..')
-
-const devClientId = '3a723b10ac5575cc5bb9'
-const devClientSecret = '22c34d87789a365981ed921352a7b9a8c3f69d54'
-
-const channel = distInfo.getReleaseChannel()
-
-function getCLICommands() {
-  return (
-    // eslint-disable-next-line no-sync
-    fs
-      .readdirSync(path.resolve(projectRoot, 'app', 'src', 'cli', 'commands'))
-      .filter(name => name.endsWith('.ts'))
-      .map(name => name.replace(/\.ts$/, ''))
-  )
-}
-
-function s(text) {
-  return JSON.stringify(text)
-}
-
-function getReplacements() {
-  return {
-    __OAUTH_CLIENT_ID__: s(process.env.DESKTOP_OAUTH_CLIENT_ID || devClientId),
-    __OAUTH_SECRET__: s(
-      process.env.DESKTOP_OAUTH_CLIENT_SECRET || devClientSecret
-    ),
-    __DARWIN__: process.platform === 'darwin',
-    __WIN32__: process.platform === 'win32',
-    __LINUX__: process.platform === 'linux',
-    __DEV__: channel === 'development',
-    __RELEASE_CHANNEL__: s(channel),
-    __UPDATES_URL__: s(distInfo.getUpdatesURL()),
-    __SHA__: s(gitInfo.getSHA()),
-    __CLI_COMMANDS__: s(getCLICommands()),
-    'process.platform': s(process.platform),
-    'process.env.NODE_ENV': s(process.env.NODE_ENV || 'development'),
-    'process.env.TEST_ENV': s(process.env.TEST_ENV),
-  }
-}
-
-module.exports = { getReplacements, getCLICommands }
added in remote
  their  100644 bb6679dfc6714a548b27c030dd653216c7e19833 app/app-info.ts
@@ -0,0 +1,44 @@
+import * as fs from 'fs'
+import * as Path from 'path'
+
+import { getSHA } from './git-info'
+import { getUpdatesURL, getReleaseChannel } from '../script/dist-info'
+
+const projectRoot = Path.dirname(__dirname)
+
+const devClientId = '3a723b10ac5575cc5bb9'
+const devClientSecret = '22c34d87789a365981ed921352a7b9a8c3f69d54'
+
+const channel = getReleaseChannel()
+
+export function getCLICommands() {
+  return (
+    // eslint-disable-next-line no-sync
+    fs
+      .readdirSync(Path.resolve(projectRoot, 'app', 'src', 'cli', 'commands'))
+      .filter(name => name.endsWith('.ts'))
+      .map(name => name.replace(/\.ts$/, ''))
+  )
+}
+
+const s = JSON.stringify
+
+export function getReplacements() {
+  return {
+    __OAUTH_CLIENT_ID__: s(process.env.DESKTOP_OAUTH_CLIENT_ID || devClientId),
+    __OAUTH_SECRET__: s(
+      process.env.DESKTOP_OAUTH_CLIENT_SECRET || devClientSecret
+    ),
+    __DARWIN__: process.platform === 'darwin',
+    __WIN32__: process.platform === 'win32',
+    __LINUX__: process.platform === 'linux',
+    __DEV__: channel === 'development',
+    __RELEASE_CHANNEL__: s(channel),
+    __UPDATES_URL__: s(getUpdatesURL()),
+    __SHA__: s(getSHA()),
+    __CLI_COMMANDS__: s(getCLICommands()),
+    'process.platform': s(process.platform),
+    'process.env.NODE_ENV': s(process.env.NODE_ENV || 'development'),
+    'process.env.TEST_ENV': s(process.env.TEST_ENV),
+  }
+}
removed in remote
  base   100644 db784cfd0f0a6592eb885f2049f8afc835d6e910 app/git-info.d.ts
  our    100644 db784cfd0f0a6592eb885f2049f8afc835d6e910 app/git-info.d.ts
@@ -1 +0,0 @@
-export function getSHA(): string
removed in remote
  base   100644 4e9e8240c199c8ad4b02c7453d746c07e9e77502 app/git-info.js
  our    100644 4e9e8240c199c8ad4b02c7453d746c07e9e77502 app/git-info.js
@@ -1,93 +0,0 @@
-'use strict'
-
-const fs = require('fs')
-const path = require('path')
-
-/**
- * Attempt to find a ref in the .git/packed-refs file, which is often
- * created by Git as part of cleaning up loose refs in the repository.
- *
- * Will return null if the packed-refs file is missing.
- * Will throw an error if the entry is not found in the packed-refs file
- *
- * @param {string} gitDir The path to the Git repository's .git directory
- * @param {string} ref    A qualified git ref such as 'refs/heads/master'
- */
-function readPackedRefsFile(gitDir, ref) {
-  const packedRefsPath = path.join(gitDir, 'packed-refs')
-
-  try {
-    // eslint-disable-next-line no-sync
-    fs.statSync(packedRefsPath)
-  } catch (err) {
-    // fail quietly if packed-refs not found
-    return null
-  }
-
-  // eslint-disable-next-line no-sync
-  const packedRefsContents = fs.readFileSync(packedRefsPath)
-
-  // we need to build up the regex on the fly using the ref
-  const refRe = new RegExp('([a-f0-9]{40}) ' + ref)
-  const packedRefMatch = refRe.exec(packedRefsContents)
-
-  if (!packedRefMatch) {
-    throw new Error(`Could not find ref entry in .git/packed-refs file: ${ref}`)
-  }
-  return packedRefMatch[1]
-}
-
-/**
- * Attempt to dereference the given ref without requiring a Git environment
- * to be present. Note that this method will not be able to dereference packed
- * refs but should suffice for simple refs like 'HEAD'.
- *
- * Will throw an error for unborn HEAD.
- *
- * @param {string} gitDir The path to the Git repository's .git directory
- * @param {string} ref    A qualified git ref such as 'HEAD' or 'refs/heads/master'
- */
-function revParse(gitDir, ref) {
-  const refPath = path.join(gitDir, ref)
-
-  try {
-    // eslint-disable-next-line no-sync
-    fs.statSync(refPath)
-  } catch (err) {
-    const packedRefMatch = readPackedRefsFile(gitDir, ref)
-    if (packedRefMatch) {
-      return packedRefMatch
-    }
-
-    throw new Error(
-      `Could not de-reference HEAD to SHA, ref does not exist on disk: ${refPath}`
-    )
-  }
-  // eslint-disable-next-line no-sync
-  const refContents = fs.readFileSync(refPath)
-  const refRe = /^([a-f0-9]{40})|(?:ref: (refs\/.*))$/m
-  const refMatch = refRe.exec(refContents)
-
-  if (!refMatch) {
-    throw new Error(
-      `Could not de-reference HEAD to SHA, invalid ref in ${refPath}: ${refContents}`
-    )
-  }
-
-  return refMatch[1] || revParse(gitDir, refMatch[2])
-}
-
-function getSHA() {
-  // CircleCI does some funny stuff where HEAD points to an packed ref, but
-  // luckily it gives us the SHA we want in the environment.
-  const circleSHA = process.env.CIRCLE_SHA1
-  if (circleSHA) {
-    return circleSHA
-  }
-
-  return revParse(path.resolve(__dirname, '../.git'), 'HEAD')
-}
-
-module.exports = {
-  getSHA,
-}
added in remote
  their  100644 1bf399b381dab7c260c1dc4126025c7ab1a437af app/git-info.ts
@@ -0,0 +1,88 @@
+import * as Fs from 'fs'
+import * as Path from 'path'
+
+/**
+ * Attempt to find a ref in the .git/packed-refs file, which is often
+ * created by Git as part of cleaning up loose refs in the repository.
+ *
+ * Will return null if the packed-refs file is missing.
+ * Will throw an error if the entry is not found in the packed-refs file
+ *
+ * @param gitDir The path to the Git repository's .git directory
+ * @param ref    A qualified git ref such as 'refs/heads/master'
+ */
+function readPackedRefsFile(gitDir: string, ref: string) {
+  const packedRefsPath = Path.join(gitDir, 'packed-refs')
+
+  try {
+    // eslint-disable-next-line no-sync
+    Fs.statSync(packedRefsPath)
+  } catch (err) {
+    // fail quietly if packed-refs not found
+    return null
+  }
+
+  // eslint-disable-next-line no-sync
+  const packedRefsContents = Fs.readFileSync(packedRefsPath, 'utf8')
+
+  // we need to build up the regex on the fly using the ref
+  const refRe = new RegExp('([a-f0-9]{40}) ' + ref)
+  const packedRefMatch = refRe.exec(packedRefsContents)
+
+  if (!packedRefMatch) {
+    throw new Error(`Could not find ref entry in .git/packed-refs file: ${ref}`)
+  }
+  return packedRefMatch[1]
+}
+
+/**
+ * Attempt to dereference the given ref without requiring a Git environment
+ * to be present. Note that this method will not be able to dereference packed
+ * refs but should suffice for simple refs like 'HEAD'.
+ *
+ * Will throw an error for unborn HEAD.
+ *
+ * @param   gitDir The path to the Git repository's .git directory
+ * @param   ref    A qualified git ref such as 'HEAD' or 'refs/heads/master'
+ * @returns        The ref SHA
+ */
+function revParse(gitDir: string, ref: string): string {
+  const refPath = Path.join(gitDir, ref)
+
+  try {
+    // eslint-disable-next-line no-sync
+    Fs.statSync(refPath)
+  } catch (err) {
+    const packedRefMatch = readPackedRefsFile(gitDir, ref)
+    if (packedRefMatch) {
+      return packedRefMatch
+    }
+
+    throw new Error(
+      `Could not de-reference HEAD to SHA, ref does not exist on disk: ${refPath}`
+    )
+  }
+  // eslint-disable-next-line no-sync
+  const refContents = Fs.readFileSync(refPath, 'utf8')
+  const refRe = /^([a-f0-9]{40})|(?:ref: (refs\/.*))$/m
+  const refMatch = refRe.exec(refContents)
+
+  if (!refMatch) {
+    throw new Error(
+      `Could not de-reference HEAD to SHA, invalid ref in ${refPath}: ${refContents}`
+    )
+  }
+
+  return refMatch[1] || revParse(gitDir, refMatch[2])
+}
+
+export function getSHA() {
+  // CircleCI does some funny stuff where HEAD points to an packed ref, but
+  // luckily it gives us the SHA we want in the environment.
+  const circleSHA = process.env.CIRCLE_SHA1
+  if (circleSHA != null) {
+    return circleSHA
+  }
+
+  return revParse(Path.resolve(__dirname, '../.git'), 'HEAD')
+}
removed in remote
  base   100644 5f169d7f8e0a82168c2c13ea3ba71b5b101f0c73 app/package-info.d.ts
  our    100644 5f169d7f8e0a82168c2c13ea3ba71b5b101f0c73 app/package-info.d.ts
@@ -1,4 +0,0 @@
-export function getProductName(): string
-export function getCompanyName(): string
-export function getVersion(): string
-export function getBundleID(): string
removed in remote
  base   100644 b63ebe090392d9f6829519ac340cbba3901300cb app/package-info.js
  our    100644 b63ebe090392d9f6829519ac340cbba3901300cb app/package-info.js
@@ -1,33 +0,0 @@
-'use strict'
-
-const path = require('path')
-
-const projectRoot = __dirname
-// eslint-disable-next-line import/no-dynamic-require
-const appPackage = require(path.join(projectRoot, 'package.json'))
-
-function getProductName() {
-  const productName = appPackage.productName
-  return process.env.NODE_ENV === 'development'
-    ? `${productName}-dev`
-    : productName
-}
-
-function getCompanyName() {
-  return appPackage.companyName
-}
-
-function getVersion() {
-  return appPackage.version
-}
-
-function getBundleID() {
-  return appPackage.bundleID
-}
-
-module.exports = {
-  getProductName,
-  getCompanyName,
-  getVersion,
-  getBundleID,
-}
added in remote
  their  100644 ec6e40fb46f6554d62823e5f27a8743de594acff app/package-info.ts
@@ -0,0 +1,20 @@
+const appPackage: Record<string, string> = require('./package.json')
+
+export function getProductName() {
+  const productName = appPackage.productName
+  return process.env.NODE_ENV === 'development'
+    ? `${productName}-dev`
+    : productName
+}
+
+export function getCompanyName() {
+  return appPackage.companyName
+}
+
+export function getVersion() {
+  return appPackage.version
+}
+
+export function getBundleID() {
+  return appPackage.bundleID
+}
merged
  result 100644 8a1178e723ae9609c53f3bcc8b0d06771b3de809 app/package.json
  our    100644 0ec1aae7a11244ccf59f08de5e97e1824f63fc85 app/package.json
@@ -3,7 +3,7 @@
   "productName": "GitHub Desktop",
   "bundleID": "com.github.GitHubClient",
   "companyName": "GitHub, Inc.",
-  "version": "1.1.2-beta1",
+  "version": "1.2.7-test1",
   "main": "./main.js",
   "repository": {
     "type": "git",
@@ -25,23 +25,23 @@
     "codemirror-mode-elixir": "1.1.1",
     "deep-equal": "^1.0.1",
     "dexie": "^2.0.0",
-    "dugite": "1.61.0",
+    "dugite": "^1.67.0",
     "electron-window-state": "^4.0.2",
     "event-kit": "^2.0.0",
     "file-uri-to-path": "0.0.2",
     "file-url": "^2.0.2",
-    "front-matter": "^2.1.2",
-    "fs-extra": "^2.1.2",
+    "fs-extra": "^6.0.0",
     "fuzzaldrin-plus": "^0.6.0",
     "keytar": "^4.0.4",
     "moment": "^2.17.1",
     "mri": "^1.1.0",
     "primer-support": "^4.0.0",
-    "react": "^16.2.0",
+    "queue": "^4.4.2",
+    "react": "^16.3.2",
     "react-addons-shallow-compare": "^15.6.2",
-    "react-dom": "^16.2.0",
+    "react-dom": "^16.3.2",
     "react-transition-group": "^1.2.0",
-    "react-virtualized": "^9.18.5",
+    "react-virtualized": "^9.20.0",
     "registry-js": "^1.0.7",
     "runas": "^3.1.1",
     "source-map-support": "^0.4.15",
@@ -59,7 +59,6 @@
     "devtron": "^1.4.0",
     "electron-debug": "^1.1.0",
     "electron-devtools-installer": "^2.2.3",
-    "style-loader": "^0.13.2",
     "temp": "^0.8.3",
     "webpack-hot-middleware": "^2.10.0"
   }
merged
  result 100644 e427588f02a3f1fd3d89705d05dedc0fe2ccfbfb app/src/ask-pass/ask-pass.ts
  our    100644 537e5a421b8fac3f1bc529212cd0bd1ad86330b6 app/src/ask-pass/ask-pass.ts
@@ -5,16 +5,16 @@
 export async function responseForPrompt(
   prompt: string
 ): Promise<string | null> {
-  const username: string | null = process.env.DESKTOP_USERNAME
-  if (!username || !username.length) {
+  const username = process.env.DESKTOP_USERNAME
+  if (username == null || username.length === 0) {
     return null
   }

   if (prompt.startsWith('Username')) {
     return username
   } else if (prompt.startsWith('Password')) {
-    const endpoint: string | null = process.env.DESKTOP_ENDPOINT
-    if (!endpoint || !endpoint.length) {
+    const endpoint = process.env.DESKTOP_ENDPOINT
+    if (endpoint == null || endpoint.length === 0) {
       return null
     }

removed in remote
  base   100644 66965ffb5ca93dbeaa3562652443adc8c8dd4715 app/src/cli/dev-commands-global.js
  our    100644 66965ffb5ca93dbeaa3562652443adc8c8dd4715 app/src/cli/dev-commands-global.js
@@ -1,3 +0,0 @@
-const appInfo = require('../../../app/app-info')
-
-global.__CLI_COMMANDS__ = appInfo.getCLICommands()
added in remote
  their  100644 2199e5e0c456edb57048a02298f9925eb4953327 app/src/cli/dev-commands-global.ts
@@ -0,0 +1,4 @@
+import { getCLICommands } from '../../../app/app-info'
+
+const g: any = global
+g.__CLI_COMMANDS__ = getCLICommands()
merged
  result 100644 d6887c4c182d239a574563f5a552b6c44bab229d app/src/highlighter/globals.d.ts
  our    100644 a639311f88f661769bc71af8d6a36e20b314709d app/src/highlighter/globals.d.ts
@@ -251,3 +251,128 @@
 declare module 'codemirror/addon/runmode/runmode.node.js' {
   export = CodeMirror
 }
+
+declare module 'codemirror-mode-elixir'
+
+// find app/node_modules/codemirror/mode -iname *.js | cut -d '/' -f 3- | cut -d '.' -f 1 | sed -e "s/^/declare module '/" | sed -e "s/$/'/"
+declare module 'codemirror/mode/scheme/scheme'
+declare module 'codemirror/mode/modelica/modelica'
+declare module 'codemirror/mode/idl/idl'
+declare module 'codemirror/mode/pascal/pascal'
+declare module 'codemirror/mode/nsis/nsis'
+declare module 'codemirror/mode/haml/haml'
+declare module 'codemirror/mode/toml/toml'
+declare module 'codemirror/mode/pig/pig'
+declare module 'codemirror/mode/gas/gas'
+declare module 'codemirror/mode/go/go'
+declare module 'codemirror/mode/apl/apl'
+declare module 'codemirror/mode/textile/textile'
+declare module 'codemirror/mode/turtle/turtle'
+declare module 'codemirror/mode/sparql/sparql'
+declare module 'codemirror/mode/troff/troff'
+declare module 'codemirror/mode/cmake/cmake'
+declare module 'codemirror/mode/htmlembedded/htmlembedded'
+declare module 'codemirror/mode/xquery/xquery'
+declare module 'codemirror/mode/python/python'
+declare module 'codemirror/mode/css/css'
+declare module 'codemirror/mode/clojure/clojure'
+declare module 'codemirror/mode/spreadsheet/spreadsheet'
+declare module 'codemirror/mode/asn.1/asn.1'
+declare module 'codemirror/mode/z80/z80'
+declare module 'codemirror/mode/jinja2/jinja2'
+declare module 'codemirror/mode/gherkin/gherkin'
+declare module 'codemirror/mode/asterisk/asterisk'
+declare module 'codemirror/mode/dockerfile/dockerfile'
+declare module 'codemirror/mode/dart/dart'
+declare module 'codemirror/mode/shell/shell'
+declare module 'codemirror/mode/yacas/yacas'
+declare module 'codemirror/mode/markdown/markdown'
+declare module 'codemirror/mode/haxe/haxe'
+declare module 'codemirror/mode/soy/soy'
+declare module 'codemirror/mode/perl/perl'
+declare module 'codemirror/mode/smalltalk/smalltalk'
+declare module 'codemirror/mode/dylan/dylan'
+declare module 'codemirror/mode/stylus/stylus'
+declare module 'codemirror/mode/vue/vue'
+declare module 'codemirror/mode/rust/rust'
+declare module 'codemirror/mode/rst/rst'
+declare module 'codemirror/mode/tiddlywiki/tiddlywiki'
+declare module 'codemirror/mode/pug/pug'
+declare module 'codemirror/mode/erlang/erlang'
+declare module 'codemirror/mode/r/r'
+declare module 'codemirror/mode/mathematica/mathematica'
+declare module 'codemirror/mode/yaml-frontmatter/yaml-frontmatter'
+declare module 'codemirror/mode/diff/diff'
+declare module 'codemirror/mode/elm/elm'
+declare module 'codemirror/mode/crystal/crystal'
+declare module 'codemirror/mode/cypher/cypher'
+declare module 'codemirror/mode/htmlmixed/htmlmixed'
+declare module 'codemirror/mode/ebnf/ebnf'
+declare module 'codemirror/mode/webidl/webidl'
+declare module 'codemirror/mode/smarty/smarty'
+declare module 'codemirror/mode/stex/stex'
+declare module 'codemirror/mode/haskell/haskell'
+declare module 'codemirror/mode/factor/factor'
+declare module 'codemirror/mode/php/php'
+declare module 'codemirror/mode/pegjs/pegjs'
+declare module 'codemirror/mode/lua/lua'
+declare module 'codemirror/mode/velocity/velocity'
+declare module 'codemirror/mode/xml/xml'
+declare module 'codemirror/mode/solr/solr'
+declare module 'codemirror/mode/mbox/mbox'
+declare module 'codemirror/mode/mllike/mllike'
+declare module 'codemirror/mode/vb/vb'
+declare module 'codemirror/mode/powershell/powershell'
+declare module 'codemirror/mode/tornado/tornado'
+declare module 'codemirror/mode/vhdl/vhdl'
+declare module 'codemirror/mode/tiki/tiki'
+declare module 'codemirror/mode/clike/clike'
+declare module 'codemirror/mode/tcl/tcl'
+declare module 'codemirror/mode/brainfuck/brainfuck'
+declare module 'codemirror/mode/ttcn/ttcn'
+declare module 'codemirror/mode/dtd/dtd'
+declare module 'codemirror/mode/octave/octave'
+declare module 'codemirror/mode/properties/properties'
+declare module 'codemirror/mode/verilog/verilog'
+declare module 'codemirror/mode/handlebars/handlebars'
+declare module 'codemirror/mode/nginx/nginx'
+declare module 'codemirror/mode/http/http'
+declare module 'codemirror/mode/asciiarmor/asciiarmor'
+declare module 'codemirror/mode/swift/swift'
+declare module 'codemirror/mode/meta'
+declare module 'codemirror/mode/sas/sas'
+declare module 'codemirror/mode/sieve/sieve'
+declare module 'codemirror/mode/livescript/livescript'
+declare module 'codemirror/mode/commonlisp/commonlisp'
+declare module 'codemirror/mode/fcl/fcl'
+declare module 'codemirror/mode/yaml/yaml'
+declare module 'codemirror/mode/fortran/fortran'
+declare module 'codemirror/mode/julia/julia'
+declare module 'codemirror/mode/oz/oz'
+declare module 'codemirror/mode/groovy/groovy'
+declare module 'codemirror/mode/coffeescript/coffeescript'
+declare module 'codemirror/mode/slim/slim'
+declare module 'codemirror/mode/javascript/javascript'
+declare module 'codemirror/mode/mscgen/mscgen'
+declare module 'codemirror/mode/twig/twig'
+declare module 'codemirror/mode/eiffel/eiffel'
+declare module 'codemirror/mode/cobol/cobol'
+declare module 'codemirror/mode/sass/sass'
+declare module 'codemirror/mode/rpm/rpm'
+declare module 'codemirror/mode/mumps/mumps'
+declare module 'codemirror/mode/vbscript/vbscript'
+declare module 'codemirror/mode/ttcn-cfg/ttcn-cfg'
+declare module 'codemirror/mode/forth/forth'
+declare module 'codemirror/mode/puppet/puppet'
+declare module 'codemirror/mode/django/django'
+declare module 'codemirror/mode/d/d'
+declare module 'codemirror/mode/q/q'
+declare module 'codemirror/mode/jsx/jsx'
+declare module 'codemirror/mode/protobuf/protobuf'
+declare module 'codemirror/mode/gfm/gfm'
+declare module 'codemirror/mode/ecl/ecl'
+declare module 'codemirror/mode/ruby/ruby'
+declare module 'codemirror/mode/mirc/mirc'
+declare module 'codemirror/mode/haskell-literate/haskell-literate'
+declare module 'codemirror/mode/ntriples/ntriples'
+declare module 'codemirror/mode/sql/sql'
merged
  result 100644 cb77ca464e7d706ddd17c526debdac45e670cf4f app/src/highlighter/index.ts
  our    100644 998448323560f91d6522bad31da1dc4317501f5d app/src/highlighter/index.ts
@@ -11,106 +11,250 @@

 import { ITokens, IHighlightRequest } from '../lib/highlighter/types'

+/**
+ * A mode definition object is used to map a certain file
+ * extension to a mode loader (see the documentation for
+ * the install property).
+ */
+interface IModeDefinition {
+  /**
+   * A function that, when called, will attempt to asynchronously
+   * load the required modules for a particular mode. This function
+   * is idempotent and can be called multiple times with no adverse
+   * effect.
+   */
+  readonly install: () => Promise<void>
+
+  /**
+   * A map between file extensions (including the leading dot, i.e.
+   * ".jpeg") and the selected mime type to use when highlighting
+   * that extension as specified in the CodeMirror mode itself.
+   */
+  readonly extensions: {
+    readonly [key: string]: string
+  }
+}
+
+/**
+ * Array describing all currently supported modes and the file extensions
+ * that they cover.
+ */
+const modes: ReadonlyArray<IModeDefinition> = [
+  {
+    install: () => import('codemirror/mode/javascript/javascript'),
+    extensions: {
+      '.ts': 'text/typescript',
+      '.js': 'text/javascript',
+      '.json': 'application/json',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/coffeescript/coffeescript'),
+    extensions: {
+      '.coffee': 'text/x-coffeescript',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/jsx/jsx'),
+    extensions: {
+      '.tsx': 'text/typescript-jsx',
+      '.jsx': 'text/jsx',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/htmlmixed/htmlmixed'),
+    extensions: {
+      '.html': 'text/html',
+      '.htm': 'text/html',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/htmlembedded/htmlembedded'),
+    extensions: {
+      '.jsp': 'application/x-jsp',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/css/css'),
+    extensions: {
+      '.css': 'text/css',
+      '.scss': 'text/x-scss',
+      '.less': 'text/x-less',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/vue/vue'),
+    extensions: {
+      '.vue': 'text/x-vue',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/markdown/markdown'),
+    extensions: {
+      '.markdown': 'text/x-markdown',
+      '.md': 'text/x-markdown',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/yaml/yaml'),
+    extensions: {
+      '.yaml': 'text/yaml',
+      '.yml': 'text/yaml',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/xml/xml'),
+    extensions: {
+      '.xml': 'text/xml',
+      '.xaml': 'text/xml',
+      '.csproj': 'text/xml',
+      '.fsproj': 'text/xml',
+      '.vcxproj': 'text/xml',
+      '.vbproj': 'text/xml',
+      '.svg': 'text/xml',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/clike/clike'),
+    extensions: {
+      '.m': 'text/x-objectivec',
+      '.scala': 'text/x-scala',
+      '.sc': 'text/x-scala',
+      '.cs': 'text/x-csharp',
+      '.cake': 'text/x-csharp',
+      '.java': 'text/x-java',
+      '.c': 'text/x-c',
+      '.h': 'text/x-c',
+      '.cpp': 'text/x-c++src',
+      '.hpp': 'text/x-c++src',
+      '.kt': 'text/x-kotlin',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/mllike/mllike'),
+    extensions: {
+      '.ml': 'text/x-ocaml',
+      '.fs': 'text/x-fsharp',
+      '.fsx': 'text/x-fsharp',
+      '.fsi': 'text/x-fsharp',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/swift/swift'),
+    extensions: {
+      '.swift': 'text/x-swift',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/shell/shell'),
+    extensions: {
+      '.sh': 'text/x-sh',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/sql/sql'),
+    extensions: {
+      '.sql': 'text/x-sql',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/cypher/cypher'),
+    extensions: {
+      '.cql': 'application/x-cypher-query',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/go/go'),
+    extensions: {
+      '.go': 'text/x-go',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/perl/perl'),
+    extensions: {
+      '.pl': 'text/x-perl',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/php/php'),
+    extensions: {
+      '.php': 'application/x-httpd-php',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/python/python'),
+    extensions: {
+      '.py': 'text/x-python',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/ruby/ruby'),
+    extensions: {
+      '.rb': 'text/x-ruby',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/clojure/clojure'),
+    extensions: {
+      '.clj': 'text/x-clojure',
+      '.cljc': 'text/x-clojure',
+      '.cljs': 'text/x-clojure',
+      '.edn': 'text/x-clojure',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/rust/rust'),
+    extensions: {
+      '.rs': 'text/x-rustsrc',
+    },
+  },
+  {
+    install: () => import('codemirror-mode-elixir'),
+    extensions: {
+      '.ex': 'text/x-elixir',
+      '.exs': 'text/x-elixir',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/haxe/haxe'),
+    extensions: {
+      '.hx': 'text/x-haxe',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/r/r'),
+    extensions: {
+      '.r': 'text/x-rsrc',
+    },
+  },
+  {
+    install: () => import('codemirror/mode/powershell/powershell'),
+    extensions: {
+      '.ps1': 'application/x-powershell',
+    },
+  },
+]
+
+/**
+ * A map between file extensions and mime types, see
+ * the 'extensions' property on the IModeDefinition interface
+ * for more information
+ */
 const extensionMIMEMap = new Map<string, string>()

-import 'codemirror/mode/javascript/javascript'
-extensionMIMEMap.set('.ts', 'text/typescript')
-extensionMIMEMap.set('.js', 'text/javascript')
-extensionMIMEMap.set('.json', 'application/json')
-
-import 'codemirror/mode/coffeescript/coffeescript'
-extensionMIMEMap.set('.coffee', 'text/x-coffeescript')
-
-import 'codemirror/mode/jsx/jsx'
-extensionMIMEMap.set('.tsx', 'text/typescript-jsx')
-extensionMIMEMap.set('.jsx', 'text/jsx')
-
-import 'codemirror/mode/htmlmixed/htmlmixed'
-extensionMIMEMap.set('.html', 'text/html')
-extensionMIMEMap.set('.htm', 'text/html')
-
-import 'codemirror/mode/css/css'
-extensionMIMEMap.set('.css', 'text/css')
-extensionMIMEMap.set('.scss', 'text/x-scss')
-extensionMIMEMap.set('.less', 'text/x-less')
-
-import 'codemirror/mode/vue/vue'
-extensionMIMEMap.set('.vue', 'text/x-vue')
-
-import 'codemirror/mode/markdown/markdown'
-extensionMIMEMap.set('.markdown', 'text/x-markdown')
-extensionMIMEMap.set('.md', 'text/x-markdown')
-
-import 'codemirror/mode/yaml/yaml'
-extensionMIMEMap.set('.yaml', 'text/yaml')
-extensionMIMEMap.set('.yml', 'text/yaml')
-
-import 'codemirror/mode/xml/xml'
-extensionMIMEMap.set('.xml', 'text/xml')
-extensionMIMEMap.set('.xaml', 'text/xml')
-extensionMIMEMap.set('.csproj', 'text/xml')
-extensionMIMEMap.set('.fsproj', 'text/xml')
-extensionMIMEMap.set('.vcxproj', 'text/xml')
-extensionMIMEMap.set('.vbproj', 'text/xml')
-extensionMIMEMap.set('.svg', 'text/xml')
-
-import 'codemirror/mode/clike/clike'
-extensionMIMEMap.set('.m', 'text/x-objectivec')
-extensionMIMEMap.set('.scala', 'text/x-scala')
-extensionMIMEMap.set('.sc', 'text/x-scala')
-extensionMIMEMap.set('.cs', 'text/x-csharp')
-extensionMIMEMap.set('.java', 'text/x-java')
-extensionMIMEMap.set('.c', 'text/x-c')
-extensionMIMEMap.set('.h', 'text/x-c')
-extensionMIMEMap.set('.cpp', 'text/x-c++src')
-extensionMIMEMap.set('.hpp', 'text/x-c++src')
-extensionMIMEMap.set('.kt', 'text/x-kotlin')
-
-import 'codemirror/mode/mllike/mllike'
-extensionMIMEMap.set('.ml', 'text/x-ocaml')
-extensionMIMEMap.set('.fs', 'text/x-fsharp')
-extensionMIMEMap.set('.fsx', 'text/x-fsharp')
-extensionMIMEMap.set('.fsi', 'text/x-fsharp')
-
-import 'codemirror/mode/swift/swift'
-extensionMIMEMap.set('.swift', 'text/x-swift')
-
-import 'codemirror/mode/shell/shell'
-extensionMIMEMap.set('.sh', 'text/x-sh')
-
-import 'codemirror/mode/sql/sql'
-extensionMIMEMap.set('.sql', 'text/x-sql')
-
-import 'codemirror/mode/cypher/cypher'
-extensionMIMEMap.set('.cql', 'application/x-cypher-query')
-
-import 'codemirror/mode/go/go'
-extensionMIMEMap.set('.go', 'text/x-go')
-
-import 'codemirror/mode/perl/perl'
-extensionMIMEMap.set('.pl', 'text/x-perl')
-
-import 'codemirror/mode/php/php'
-extensionMIMEMap.set('.php', 'application/x-httpd-php')
-
-import 'codemirror/mode/python/python'
-extensionMIMEMap.set('.py', 'text/x-python')
-
-import 'codemirror/mode/ruby/ruby'
-extensionMIMEMap.set('.rb', 'text/x-ruby')
-
-import 'codemirror/mode/clojure/clojure'
-extensionMIMEMap.set('.clj', 'text/x-clojure')
-extensionMIMEMap.set('.cljc', 'text/x-clojure')
-extensionMIMEMap.set('.cljs', 'text/x-clojure')
-extensionMIMEMap.set('.edn', 'text/x-clojure')
-
-import 'codemirror/mode/rust/rust'
-extensionMIMEMap.set('.rs', 'text/x-rustsrc')
-
-import 'codemirror-mode-elixir'
-extensionMIMEMap.set('.ex', 'text/x-elixir')
-extensionMIMEMap.set('.exs', 'text/x-elixir')
+/**
+ * A map between mime types and mode definitions. See the
+ * documentation for the IModeDefinition interface
+ * for more information
+ */
+const mimeModeMap = new Map<string, IModeDefinition>()
+
+for (const mode of modes) {
+  for (const [extension, mimeType] of Object.entries(mode.extensions)) {
+    extensionMIMEMap.set(extension, mimeType)
+    mimeModeMap.set(mimeType, mode)
+  }
+}

 function guessMimeType(contents: string) {
   if (contents.startsWith('<?xml')) {
@@ -144,14 +288,25 @@
   return null
 }

-function detectMode(request: IHighlightRequest): CodeMirror.Mode<{}> | null {
+async function detectMode(
+  request: IHighlightRequest
+): Promise<CodeMirror.Mode<{}> | null> {
   const mimeType =
-    extensionMIMEMap.get(request.extension) || guessMimeType(request.contents)
+    extensionMIMEMap.get(request.extension.toLowerCase()) ||
+    guessMimeType(request.contents)

   if (!mimeType) {
     return null
   }

+  const modeDefinition = mimeModeMap.get(mimeType)
+
+  if (modeDefinition === undefined) {
+    return null
+  }
+
+  await modeDefinition.install()
+
   return getMode({}, mimeType) || null
 }

@@ -213,14 +368,14 @@
   throw new Error(`Mode ${getModeName(mode)} failed to advance stream.`)
 }

-onmessage = (ev: MessageEvent) => {
+onmessage = async (ev: MessageEvent) => {
   const request = ev.data as IHighlightRequest

   const tabSize = request.tabSize || 4
   const contents = request.contents
   const addModeClass = request.addModeClass === true

-  const mode = detectMode(request)
+  const mode = await detectMode(request)

   if (!mode) {
     postMessage({})
merged
  result 100644 28bceee1eb85ee67e5615f600cd692fd1286c44b app/src/highlighter/tsconfig.json
  our    100644 ac72a2f6877ed0b4f8a01b2e6cdf721c2ad59ccf app/src/highlighter/tsconfig.json
@@ -1,6 +1,6 @@
 {
   "compilerOptions": {
-    "module": "commonjs",
+    "module": "esnext",
     "moduleResolution": "node",
     "target": "es2017",
     "noImplicitReturns": true,
merged
  result 100644 e315e51baf72a2f8735ae86ea485b0e6d5bebeed app/src/lib/app-shell.ts
  our    100644 1fd1d56b84996afc63dce165e2dda4f5b8e20d94 app/src/lib/app-shell.ts
@@ -1,4 +1,7 @@
 import { shell as electronShell, ipcRenderer } from 'electron'
+import * as Path from 'path'
+
+import { Repository } from '../models/repository'

 export interface IAppShell {
   readonly moveItemToTrash: (path: string) => boolean
@@ -28,3 +31,14 @@
   },
   openItem: electronShell.openItem,
 }
+
+/**
+ * Reveals a file from a repository in the native file manager.
+ *
+ * @param repository The currently active repository instance
+ * @param path The path of the file relative to the root of the repository
+ */
+export function revealInFileManager(repository: Repository, path: string) {
+  const fullyQualifiedFilePath = Path.join(repository.path, path)
+  return shell.showItemInFolder(fullyQualifiedFilePath)
+}
merged
  result 100644 711a4f16bab17ee49c4dd510d5a575cf149f5a5c app/src/lib/app-state.ts
  our    100644 c329944f04e7a0db1cdd5851028416024f3c5c16 app/src/lib/app-state.ts
@@ -1,9 +1,9 @@
 import { Account } from '../models/account'
 import { CommitIdentity } from '../models/commit-identity'
 import { IDiff } from '../models/diff'
-import { Repository } from '../models/repository'
-import { IAheadBehind } from './git'
-import { Branch } from '../models/branch'
+import { Repository, ILocalRepositoryState } from '../models/repository'
+
+import { Branch, IAheadBehind } from '../models/branch'
 import { Tip } from '../models/tip'
 import { Commit } from '../models/commit'
 import {
@@ -26,9 +26,10 @@
 import { BranchesTab } from '../models/branches-tab'
 import { PullRequest } from '../models/pull-request'
 import { IAuthor } from '../models/author'
+import { ComparisonCache } from './comparison-cache'
+import { ApplicationTheme } from '../ui/lib/application-theme'

 export { ICommitMessage }
-export { IAheadBehind }

 export enum SelectionType {
   Repository,
@@ -67,8 +68,16 @@
 /** All of the shared app state. */
 export interface IAppState {
   readonly accounts: ReadonlyArray<Account>
+  /**
+   * The current list of repositories tracked in the application
+   */
   readonly repositories: ReadonlyArray<Repository | CloningRepository>

+  /**
+   * A cache of the latest repository state values, keyed by the repository id
+   */
+  readonly localRepositoryStateLookup: Map<number, ILocalRepositoryState>
+
   readonly selectedState: PossibleSelections | null

   /**
@@ -178,6 +187,11 @@

   /** The currently selected tab for the Branches foldout. */
   readonly selectedBranchesTab: BranchesTab
+
+  /** Show the diverging notification banner */
+  readonly isDivergingBranchBannerVisible: boolean
+  /** The currently selected appearance (aka theme) */
+  readonly selectedTheme: ApplicationTheme
 }

 export enum PopupType {
@@ -208,6 +222,7 @@
   LFSAttributeMismatch,
   UpstreamAlreadyExists,
   DeletePullRequest,
+  MergeConflicts,
 }

 export type Popup =
@@ -222,9 +237,14 @@
       type: PopupType.ConfirmDiscardChanges
       repository: Repository
       files: ReadonlyArray<WorkingDirectoryFileChange>
+      showDiscardChangesSetting?: boolean
     }
   | { type: PopupType.Preferences; initialSelectedTab?: PreferencesTab }
-  | { type: PopupType.MergeBranch; repository: Repository }
+  | {
+      type: PopupType.MergeBranch
+      repository: Repository
+      branch?: Branch
+    }
   | { type: PopupType.RepositorySettings; repository: Repository }
   | { type: PopupType.AddRepository; path?: string }
   | { type: PopupType.CreateRepository; path?: string }
@@ -281,6 +301,7 @@
       branch: Branch
       pullRequest: PullRequest
     }
+  | { type: PopupType.MergeConflicts; repository: Repository }

 export enum FoldoutType {
   Repository,
@@ -315,7 +336,7 @@
   | { type: FoldoutType.AddMenu }
   | AppMenuFoldout

-export enum RepositorySection {
+export enum RepositorySectionTab {
   Changes,
   History,
 }
@@ -323,7 +344,8 @@
 export interface IRepositoryState {
   readonly historyState: IHistoryState
   readonly changesState: IChangesState
-  readonly selectedSection: RepositorySection
+  readonly compareState: ICompareState
+  readonly selectedSection: RepositorySectionTab

   /**
    * The name and email that will be used for the author info
@@ -559,10 +581,10 @@
   readonly workingDirectory: WorkingDirectoryStatus

   /**
-   * The ID of the selected file. The file itself can be looked up in
+   * The ID of the selected files. The files themselves can be looked up in
    * `workingDirectory`.
    */
-  readonly selectedFileID: string | null
+  readonly selectedFileIDs: string[]

   readonly diff: IDiff | null

@@ -590,3 +612,105 @@
    */
   readonly coAuthors: ReadonlyArray<IAuthor>
 }
+
+export enum ComparisonView {
+  None = 'none',
+  Ahead = 'ahead',
+  Behind = 'behind',
+}
+
+/**
+ * The default comparison state is to display the history for the current
+ * branch.
+ */
+export interface IDisplayHistory {
+  readonly kind: ComparisonView.None
+}
+
+/**
+ * When the user has chosen another branch to compare, using their current
+ * branch as the base branch.
+ */
+export interface ICompareBranch {
+  /** The chosen comparison mode determines which commits to show */
+  readonly kind: ComparisonView.Ahead | ComparisonView.Behind
+
+  /** The branch to compare against the base branch */
+  readonly comparisonBranch: Branch
+
+  /** The number of commits the selected branch is ahead/behind the current branch */
+  readonly aheadBehind: IAheadBehind
+}
+
+export interface ICompareState {
+  /** The current state of the compare form, based on user input */
+  readonly formState: IDisplayHistory | ICompareBranch
+
+  /** Whether the branch list should be expanded or hidden */
+  readonly showBranchList: boolean
+
+  /** The text entered into the compare branch filter text box */
+  readonly filterText: string
+
+  /** The SHAs of commits to render in the compare list */
+  readonly commitSHAs: ReadonlyArray<string>
+
+  /** A list of all branches (remote and local) currently in the repository. */
+  readonly allBranches: ReadonlyArray<Branch>
+
+  /**
+   * A list of zero to a few (at time of writing 5 but check loadRecentBranches
+   * in git-store for definitive answer) branches that have been checked out
+   * recently. This list is compiled by reading the reflog and tracking branch
+   * switches over the last couple of thousand reflog entries.
+   */
+  readonly recentBranches: ReadonlyArray<Branch>
+
+  /**
+   * The default branch for a given repository. Most commonly this
+   * will be the 'master' branch but GitHub users are able to change
+   * their default branch in the web UI.
+   */
+  readonly defaultBranch: Branch | null
+
+  /**
+   * A local cache of ahead/behind computations to compare other refs to the current branch
+   */
+  readonly aheadBehindCache: ComparisonCache
+
+  /**
+   * The best candidate branch to compare the current branch to.
+   * Also includes the ahead/behind info for the inferred branch
+   * relative to the current branch.
+   */
+  readonly inferredComparisonBranch: {
+    branch: Branch | null
+    aheadBehind: IAheadBehind | null
+  }
+}
+
+export interface ICompareFormUpdate {
+  /** The updated filter text to set */
+  readonly filterText: string
+
+  /** Thew new state of the branches list */
+  readonly showBranchList: boolean
+}
+
+export enum CompareActionKind {
+  History = 'History',
+  Branch = 'Branch',
+}
+
+/**
+ * An action to send to the application store to update the compare state
+ */
+export type CompareAction =
+  | {
+      readonly kind: CompareActionKind.History
+    }
+  | {
+      readonly kind: CompareActionKind.Branch
+      readonly branch: Branch
+      readonly mode: ComparisonView.Ahead | ComparisonView.Behind
+    }
added in remote
  their  100644 9745def3e5a5e6046e8f8ea32a90a530172dd312 app/src/lib/comparison-cache.ts
@@ -0,0 +1,29 @@
+import { IAheadBehind } from '../models/branch'
+import { revSymmetricDifference } from '../lib/git'
+
+export class ComparisonCache {
+  private backingStore = new Map<string, IAheadBehind>()
+
+  public set(from: string, to: string, value: IAheadBehind) {
+    const key = revSymmetricDifference(from, to)
+    this.backingStore.set(key, value)
+  }
+
+  public get(from: string, to: string) {
+    const key = revSymmetricDifference(from, to)
+    return this.backingStore.get(key) || null
+  }
+
+  public has(from: string, to: string) {
+    const key = revSymmetricDifference(from, to)
+    return this.backingStore.has(key)
+  }
+
+  public get size() {
+    return this.backingStore.size
+  }
+
+  public clear() {
+    this.backingStore.clear()
+  }
+}
merged
  result 100644 6989ac27cc613156ffcb3cf61e2e33863a75d3cd app/src/lib/dispatcher/dispatcher.ts
  our    100644 bd55d7427357a36ac24db03b82d32fa9cebe5ac7 app/src/lib/dispatcher/dispatcher.ts
@@ -11,12 +11,14 @@
 } from '../../models/status'
 import { DiffSelection } from '../../models/diff'
 import {
-  RepositorySection,
+  RepositorySectionTab,
   Popup,
   PopupType,
   Foldout,
   FoldoutType,
   ImageDiffType,
+  CompareAction,
+  ICompareFormUpdate,
 } from '../app-state'
 import { AppStore } from '../stores/app-store'
 import { CloningRepository } from '../../models/cloning-repository'
@@ -54,6 +56,8 @@
 import { PullRequest } from '../../models/pull-request'
 import { IAuthor } from '../../models/author'
 import { ITrailer } from '../git/interpret-trailers'
+import { isGitRepository } from '../git'
+import { ApplicationTheme } from '../../ui/lib/application-theme'

 /**
  * An error handler function.
@@ -109,11 +113,6 @@
     return this.appStore._updateRepositoryMissing(repository, missing)
   }

-  /** Load the history for the repository. */
-  public loadHistory(repository: Repository): Promise<void> {
-    return this.appStore._loadHistory(repository)
-  }
-
   /** Load the next batch of history for the repository. */
   public loadNextHistoryBatch(repository: Repository): Promise<void> {
     return this.appStore._loadNextHistoryBatch(repository)
@@ -177,7 +176,7 @@
   /** Change the selected section in the repository. */
   public changeRepositorySection(
     repository: Repository,
-    section: RepositorySection
+    section: RepositorySectionTab
   ): Promise<void> {
     return this.appStore._changeRepositorySection(repository, section)
   }
@@ -185,9 +184,9 @@
   /** Change the currently selected file in Changes. */
   public changeChangesSelection(
     repository: Repository,
-    selectedFile: WorkingDirectoryFileChange
+    selectedFiles: WorkingDirectoryFileChange[]
   ): Promise<void> {
-    return this.appStore._changeChangesSelection(repository, selectedFile)
+    return this.appStore._changeChangesSelection(repository, selectedFiles)
   }

   /**
@@ -460,6 +459,13 @@
   }

   /**
+   * Set the divering branch notification banner's visibility
+   */
+  public setDivergingBranchBannerVisibility(isVisible: boolean) {
+    return this.appStore._setDivergingBranchBannerVisibility(isVisible)
+  }
+
+  /**
    * Reset the width of the repository sidebar to its default
    * value. This affects the changes and history sidebar
    * as well as the first toolbar section which contains
@@ -585,7 +591,10 @@
   }

   /** Add the pattern to the repository's gitignore. */
-  public ignore(repository: Repository, pattern: string): Promise<void> {
+  public ignore(
+    repository: Repository,
+    pattern: string | string[]
+  ): Promise<void> {
     return this.appStore._ignore(repository, pattern)
   }

@@ -602,9 +611,11 @@
     }
   }

-  /** Opens a Git repository in the user provided program */
-  public async openInExternalEditor(path: string): Promise<void> {
-    return this.appStore._openInExternalEditor(path)
+  /**
+   * Opens a path in the external editor selected by the user.
+   */
+  public async openInExternalEditor(fullPath: string): Promise<void> {
+    return this.appStore._openInExternalEditor(fullPath)
   }

   /**
@@ -843,13 +854,22 @@
         // this ensures we use the repository root, if it is actually a repository
         // otherwise we consider it an untracked repository
         const path = (await validatedRepositoryPath(action.path)) || action.path
-
         const state = this.appStore.getState()
-        const existingRepository = matchExistingRepository(
+        let existingRepository = matchExistingRepository(
           state.repositories,
           path
         )

+        // in case this is valid git repository, there is no need to ask
+        // user for confirmation and it can be added automatically
+        if (existingRepository == null) {
+          const isRepository = await isGitRepository(path)
+          if (isRepository) {
+            const addedRepositories = await this.addRepositories([path])
+            existingRepository = addedRepositories[0]
+          }
+        }
+
         if (existingRepository) {
           await this.selectRepository(existingRepository)
         } else {
@@ -879,10 +899,6 @@

   /**
    * Sets the user's preference so that confirmation to discard changes is not asked
-   *
-   * @param {boolean} value
-   * @returns {Promise<void>}
-   * @memberof Dispatcher
    */
   public setConfirmDiscardChangesSetting(value: boolean): Promise<void> {
     return this.appStore._setConfirmDiscardChangesSetting(value)
@@ -902,32 +918,38 @@
     return this.appStore._setShell(shell)
   }

-  /**
-   * Reveals a file from a repository in the native file manager.
-   * @param repository The currently active repository instance
-   * @param path The path of the file relative to the root of the repository
-   */
-  public revealInFileManager(repository: Repository, path: string) {
-    const normalized = Path.join(repository.path, path)
-    return shell.showItemInFolder(normalized)
-  }
-
   private async handleCloneInDesktopOptions(
     repository: Repository,
     action: IOpenRepositoryFromURLAction
   ): Promise<void> {
     const { filepath, pr, branch } = action

-    if (pr && branch) {
+    if (pr != null && branch != null) {
       // we need to refetch for a forked PR and check that out
       await this.fetchRefspec(repository, `pull/${pr}/head:${branch}`)
     }

-    if (branch) {
+    if (pr == null && branch != null) {
+      const state = this.appStore.getRepositoryState(repository)
+      const branches = state.branchesState.allBranches
+
+      // I don't want to invoke Git functionality from the dispatcher, which
+      // would help by using getDefaultRemote here to get the definitive ref,
+      // so this falls back to finding any remote branch matching the name
+      // received from the "Clone in Desktop" action
+      const localBranch =
+        branches.find(b => b.upstreamWithoutRemote === branch) || null
+
+      if (localBranch == null) {
+        await this.fetch(repository, FetchType.BackgroundTask)
+      }
+    }
+
+    if (branch != null) {
       await this.checkoutBranch(repository, branch)
     }

-    if (filepath) {
+    if (filepath != null) {
       const fullPath = Path.join(repository.path, filepath)
       // because Windows uses different path separators here
       const normalized = Path.normalize(fullPath)
@@ -1148,4 +1170,93 @@
   ) {
     return this.appStore._setCoAuthors(repository, coAuthors)
   }
+
+  /**
+   * Initialze the compare state for the current repository.
+   */
+  public initializeCompare(
+    repository: Repository,
+    initialAction?: CompareAction
+  ) {
+    return this.appStore._initializeCompare(repository, initialAction)
+  }
+
+  /**
+   * Update the compare state for the current repository
+   */
+  public executeCompare(repository: Repository, action: CompareAction) {
+    return this.appStore._executeCompare(repository, action)
+  }
+
+  /** Update the compare form state for the current repository */
+  public updateCompareForm<K extends keyof ICompareFormUpdate>(
+    repository: Repository,
+    newState: Pick<ICompareFormUpdate, K>
+  ) {
+    return this.appStore._updateCompareForm(repository, newState)
+  }
+
+  /**
+   * Increments the `mergeIntoCurrentBranchMenuCount` metric
+   */
+  public recordMenuInitiatedMerge() {
+    return this.appStore._recordMenuInitiatedMerge()
+  }
+
+  /**
+   * Increments the `updateFromDefaultBranchMenuCount` metric
+   */
+  public recordMenuInitiatedUpdate() {
+    return this.appStore._recordMenuInitiatedUpdate()
+  }
+
+  /**
+   * Increments the `mergesInitiatedFromComparison` metric
+   */
+  public recordCompareInitiatedMerge() {
+    return this.appStore._recordCompareInitiatedMerge()
+  }
+
+  /**
+   * Set the application-wide theme
+   */
+  public setSelectedTheme(theme: ApplicationTheme) {
+    return this.appStore._setSelectedTheme(theme)
+  }
+
+  /**
+   * Increments either the `repoWithIndicatorClicked` or
+   * the `repoWithoutIndicatorClicked` metric
+   */
+  public recordRepoClicked(repoHasIndicator: boolean) {
+    return this.appStore._recordRepoClicked(repoHasIndicator)
+  }
+
+  /** The number of times the user dismisses the diverged branch notification
+   * Increments the `divergingBranchBannerDismissal` metric
+   */
+  public recordDivergingBranchBannerDismissal() {
+    return this.appStore._recordDivergingBranchBannerDismissal()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInitiatedCompare` metric
+   */
+  public recordDivergingBranchBannerInitiatedCompare() {
+    return this.appStore._recordDivergingBranchBannerInitiatedCompare()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInfluencedMerge` metric
+   */
+  public recordDivergingBranchBannerInfluencedMerge() {
+    return this.appStore._recordDivergingBranchBannerInfluencedMerge()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInitatedMerge` metric
+   */
+  public recordDivergingBranchBannerInitatedMerge() {
+    return this.appStore._recordDivergingBranchBannerInitatedMerge()
+  }
 }
merged
  result 100644 ad71f6491a65fc7927e53f0b9d61a0e8c53ed070 app/src/lib/dispatcher/error-handlers.ts
  our    100644 e4bcde44c63c77e4be9175742b2312202cb79018 app/src/lib/dispatcher/error-handlers.ts
@@ -246,6 +246,50 @@
 }

 /**
+ * Handler for detecting when a merge conflict is reported to direct the user
+ * to a different dialog than the generic Git error dialog.
+ */
+export async function mergeConflictHandler(
+  error: Error,
+  dispatcher: Dispatcher
+): Promise<Error | null> {
+  const e = asErrorWithMetadata(error)
+  if (!e) {
+    return error
+  }
+
+  const gitError = asGitError(e.underlyingError)
+  if (!gitError) {
+    return error
+  }
+
+  const dugiteError = gitError.result.gitError
+  if (!dugiteError) {
+    return error
+  }
+
+  if (dugiteError !== DugiteError.MergeConflicts) {
+    return error
+  }
+
+  const repository = e.metadata.repository
+  if (!repository) {
+    return error
+  }
+
+  if (!(repository instanceof Repository)) {
+    return error
+  }
+
+  dispatcher.showPopup({
+    type: PopupType.MergeConflicts,
+    repository,
+  })
+
+  return null
+}
+
+/**
  * Handler for when we attempt to install the global LFS filters and LFS throws
  * an error.
  */
merged
  result 100644 396f15cea083d101fb676c2b851376917b67b1a8 app/src/lib/editors/darwin.ts
  our    100644 830d42cfa11aea16cec5fa79dbc8b87e4ffb56aa app/src/lib/editors/darwin.ts
@@ -1,10 +1,11 @@
 import * as Path from 'path'
-import { pathExists } from '../file-system'
+import { pathExists } from 'fs-extra'
 import { IFoundEditor } from './found-editor'
 import { assertNever } from '../fatal-error'

 export enum ExternalEditor {
   Atom = 'Atom',
+  MacVim = 'MacVim',
   VisualStudioCode = 'Visual Studio Code',
   VisualStudioCodeInsiders = 'Visual Studio Code (Insiders)',
   SublimeText = 'Sublime Text',
@@ -12,12 +13,17 @@
   PhpStorm = 'PhpStorm',
   RubyMine = 'RubyMine',
   TextMate = 'TextMate',
+  Brackets = 'Brackets',
+  WebStorm = 'WebStorm',
 }

 export function parse(label: string): ExternalEditor | null {
   if (label === ExternalEditor.Atom) {
     return ExternalEditor.Atom
   }
+  if (label === ExternalEditor.MacVim) {
+    return ExternalEditor.MacVim
+  }
   if (label === ExternalEditor.VisualStudioCode) {
     return ExternalEditor.VisualStudioCode
   }
@@ -39,6 +45,12 @@
   if (label === ExternalEditor.TextMate) {
     return ExternalEditor.TextMate
   }
+  if (label === ExternalEditor.Brackets) {
+    return ExternalEditor.Brackets
+  }
+  if (label === ExternalEditor.WebStorm) {
+    return ExternalEditor.WebStorm
+  }
   return null
 }

@@ -51,6 +63,8 @@
   switch (editor) {
     case ExternalEditor.Atom:
       return ['com.github.atom']
+    case ExternalEditor.MacVim:
+      return ['org.vim.MacVim']
     case ExternalEditor.VisualStudioCode:
       return ['com.microsoft.VSCode']
     case ExternalEditor.VisualStudioCodeInsiders:
@@ -65,6 +79,10 @@
       return ['com.jetbrains.RubyMine']
     case ExternalEditor.TextMate:
       return ['com.macromates.TextMate']
+    case ExternalEditor.Brackets:
+      return ['io.brackets.appshell']
+    case ExternalEditor.WebStorm:
+      return ['com.jetbrains.WebStorm']
     default:
       return assertNever(editor, `Unknown external editor: ${editor}`)
   }
@@ -87,6 +105,8 @@
         'bin',
         'code'
       )
+    case ExternalEditor.MacVim:
+      return Path.join(installPath, 'Contents', 'MacOS', 'MacVim')
     case ExternalEditor.SublimeText:
       return Path.join(installPath, 'Contents', 'SharedSupport', 'bin', 'subl')
     case ExternalEditor.BBEdit:
@@ -97,6 +117,10 @@
       return Path.join(installPath, 'Contents', 'MacOS', 'rubymine')
     case ExternalEditor.TextMate:
       return Path.join(installPath, 'Contents', 'Resources', 'mate')
+    case ExternalEditor.Brackets:
+      return Path.join(installPath, 'Contents', 'MacOS', 'Brackets')
+    case ExternalEditor.WebStorm:
+      return Path.join(installPath, 'Contents', 'MacOS', 'WebStorm')
     default:
       return assertNever(editor, `Unknown external editor: ${editor}`)
   }
@@ -133,6 +157,7 @@

   const [
     atomPath,
+    macVimPath,
     codePath,
     codeInsidersPath,
     sublimePath,
@@ -140,8 +165,11 @@
     phpStormPath,
     rubyMinePath,
     textMatePath,
+    bracketsPath,
+    webStormPath,
   ] = await Promise.all([
     findApplication(ExternalEditor.Atom),
+    findApplication(ExternalEditor.MacVim),
     findApplication(ExternalEditor.VisualStudioCode),
     findApplication(ExternalEditor.VisualStudioCodeInsiders),
     findApplication(ExternalEditor.SublimeText),
@@ -149,12 +177,18 @@
     findApplication(ExternalEditor.PhpStorm),
     findApplication(ExternalEditor.RubyMine),
     findApplication(ExternalEditor.TextMate),
+    findApplication(ExternalEditor.Brackets),
+    findApplication(ExternalEditor.WebStorm),
   ])

   if (atomPath) {
     results.push({ editor: ExternalEditor.Atom, path: atomPath })
   }

+  if (macVimPath) {
+    results.push({ editor: ExternalEditor.MacVim, path: macVimPath })
+  }
+
   if (codePath) {
     results.push({ editor: ExternalEditor.VisualStudioCode, path: codePath })
   }
@@ -186,5 +220,13 @@
     results.push({ editor: ExternalEditor.TextMate, path: textMatePath })
   }

+  if (bracketsPath) {
+    results.push({ editor: ExternalEditor.Brackets, path: bracketsPath })
+  }
+
+  if (webStormPath) {
+    results.push({ editor: ExternalEditor.WebStorm, path: webStormPath })
+  }
+
   return results
 }
merged
  result 100644 14fcc4b0ea50c3d49e60a2f61796f87d9edaaec4 app/src/lib/editors/launch.ts
  our    100644 71e53504e0c9701cec78d2c5fd6dbefed636537e app/src/lib/editors/launch.ts
@@ -1,15 +1,15 @@
 import { spawn } from 'child_process'
-import { pathExists } from '../file-system'
+import { pathExists } from 'fs-extra'
 import { ExternalEditorError, FoundEditor } from './shared'

 /**
- * Open a given folder in the desired external editor.
+ * Open a given file or folder in the desired external editor.
  *
- * @param path The folder to pass as an argument when launching the editor.
+ * @param fullPath A folder or file path to pass as an argument when launching the editor.
  * @param editor The external editor to launch.
  */
 export async function launchExternalEditor(
-  path: string,
+  fullPath: string,
   editor: FoundEditor
 ): Promise<void> {
   const editorPath = editor.path
@@ -24,5 +24,5 @@
     )
   }

-  spawn(editorPath, [path])
+  spawn(editorPath, [fullPath])
 }
merged
  result 100644 61446be3534a72d03d35e5f535726b1d369508ed app/src/lib/editors/linux.ts
  our    100644 a338bd034876cad8e313ca505f0764220e4b3600 app/src/lib/editors/linux.ts
@@ -1,5 +1,6 @@
+import { pathExists } from 'fs-extra'
+
 import { IFoundEditor } from './found-editor'
-import { pathExists } from '../file-system'
 import { assertNever } from '../fatal-error'

 export enum ExternalEditor {
merged
  result 100644 fbc6a4cc3563a6085b030129507ee04749354b37 app/src/lib/editors/win32.ts
  our    100644 06c6ea78811e4a48e1f82201e7b7826ea48dd564 app/src/lib/editors/win32.ts
@@ -7,7 +7,7 @@
   RegistryValueType,
 } from 'registry-js'

-import { pathExists } from '../file-system'
+import { pathExists } from 'fs-extra'
 import { IFoundEditor } from './found-editor'

 import { assertNever } from '../fatal-error'
merged
  result 100644 be95c011127ed3931f5b6fe25a4afe37f46c593e app/src/lib/fatal-error.ts
  our    100644 a54e675b9e3ce44b64e2a17668c095e9d903770e app/src/lib/fatal-error.ts
@@ -9,11 +9,11 @@
  * If the type system is bypassed or this method will throw an exception
  * using the second parameter as the message.
  *
- * @param {x}       Placeholder parameter in order to leverage the type
+ * @param x         Placeholder parameter in order to leverage the type
  *                  system. Pass the variable which has been type narrowed
  *                  in an exhaustive check.
  *
- * @param {message} The message to be used in the runtime exception.
+ * @param message   The message to be used in the runtime exception.
  *
  */
 export function assertNever(x: never, message: string): never {
merged
  result 100644 a709cc9f974b35dc9a357b3b8ca94677b01d1092 app/src/lib/feature-flag.ts
  our    100644 64f061a69053457ba9ad6ca62c78bc534f3b6d57 app/src/lib/feature-flag.ts
@@ -14,7 +14,7 @@
     return true
   }

-  if (process.env.GITHUB_DESKTOP_PREVIEW_FEATURES) {
+  if (process.env.GITHUB_DESKTOP_PREVIEW_FEATURES === '1') {
     return true
   }

@@ -22,16 +22,22 @@
 }

 /** Should the app enable beta features? */
+//@ts-ignore: this will be used again in the future
 function enableBetaFeatures(): boolean {
   return enableDevelopmentFeatures() || __RELEASE_CHANNEL__ === 'beta'
 }

-/** Should the new Compare view be enabled? */
-export function enableCompareBranch(): boolean {
+/** Should merge tool integration be enabled? */
+export function enableMergeTool(): boolean {
+  return enableDevelopmentFeatures()
+}
+
+/** Should the Notification of Diverging From Default Branch (NDDB) feature be enabled? */
+export function enableNotificationOfBranchUpdates(): boolean {
   return enableBetaFeatures()
 }

-/** Should merge tool integration be enabled? */
-export function enableMergeTool(): boolean {
+/** Should the repository list display info indicators? */
+export function enableRepoInfoIndicators(): boolean {
   return enableDevelopmentFeatures()
 }
merged
  result 100644 a696107c681c84a8da5190495b8d23ee51f935e9 app/src/lib/file-system.ts
  our    100644 185776306e2fc257862b11ad55f92cadb113eb66 app/src/lib/file-system.ts
@@ -1,4 +1,4 @@
-import * as Fs from 'fs-extra'
+import * as FSE from 'fs-extra'
 import * as Os from 'os'
 import * as Path from 'path'
 import { Disposable } from 'event-kit'
@@ -6,63 +6,14 @@

 const byline = require('byline')

-/** Create directory using basic Fs.mkdir but ignores
- * the error thrown when directory already exists.
- * All other errors must be handled by caller.
- *
- * @param directoryPath the path of the directory the caller wants to create.
- */
-export function mkdirIfNeeded(directoryPath: string): Promise<void> {
-  return new Promise<void>((resolve, reject) => {
-    Fs.mkdir(directoryPath, err => {
-      if (err && err.code !== 'EEXIST') {
-        reject(err)
-        return
-      }
-      resolve()
-    })
-  })
-}
-
-/*
- * Write a file using the standard fs.writeFile API, but wrapped in a promise.
- *
- * @param path the path to the file on disk
- * @param data the contents of the file to write
- * @param options the default Fs.writeFile options
- */
-export function writeFile(
-  path: string,
-  data: any,
-  options: { encoding?: string; mode?: number; flag?: string } = {}
-): Promise<void> {
-  return new Promise<void>((resolve, reject) => {
-    Fs.writeFile(path, data, options, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
-}
-
 /**
  * Get a path to a temp file using the given name. Note that the file itself
  * will not be created.
  */
-export function getTempFilePath(name: string): Promise<string> {
-  return new Promise<string>((resolve, reject) => {
-    const tempDir = Path.join(Os.tmpdir(), `${name}-`)
-    Fs.mkdtemp(tempDir, (err, directory) => {
-      if (err) {
-        reject(err)
-      } else {
-        const fullPath = Path.join(directory, name)
-        resolve(fullPath)
-      }
-    })
-  })
+export async function getTempFilePath(name: string): Promise<string> {
+  const tempDir = Path.join(Os.tmpdir(), `${name}-`)
+  const directory = await FSE.mkdtemp(tempDir)
+  return Path.join(directory, name)
 }

 /**
@@ -101,23 +52,6 @@
   })
 }

-/*
- * Helper function to promisify and simplify fs.stat.
- *
- * @param path Path to check for existence.
- */
-export function pathExists(path: string): Promise<boolean> {
-  return new Promise<boolean>((resolve, reject) => {
-    Fs.stat(path, (error, stats) => {
-      if (error) {
-        resolve(false)
-      } else {
-        resolve(true)
-      }
-    })
-  })
-}
-
 /**
  * Asynchronous readFile - Asynchronously reads the entire contents of a file.
  *
@@ -141,7 +75,7 @@
 ): Promise<Buffer | string> {
   return new Promise<string | Buffer>((resolve, reject) => {
     options = options || { flag: 'r' }
-    Fs.readFile(filename, options, (err, data) => {
+    FSE.readFile(filename, options, (err, data) => {
       if (err) {
         reject(err)
       } else {
@@ -169,7 +103,7 @@
     const chunks = new Array<Buffer>()
     let total = 0

-    Fs.createReadStream(path, { start, end })
+    FSE.createReadStream(path, { start, end })
       .on('data', (chunk: Buffer) => {
         chunks.push(chunk)
         total += chunk.length
merged
  result 100644 7ade1dfc6be6bbfd8149dfb41a77caded99e26c0 app/src/lib/fuzzy-find.ts
  our    100644 0eaf1391d7ca722e5bc57bd57cccecc35f68e126 app/src/lib/fuzzy-find.ts
@@ -12,36 +12,48 @@
   return fuzzAldrin.score(str, query, undefined, options) / maxScore
 }

+export interface IMatches {
+  readonly title: ReadonlyArray<number>
+  readonly subtitle: ReadonlyArray<number>
+}
+
 export interface IMatch<T> {
   /** `0 <= score <= 1` */
   score: number
   item: T
-  matches: ReadonlyArray<number>
+  matches: IMatches
 }

-export type KeyFunction<T> = (item: T) => string
+export type KeyFunction<T> = (item: T) => ReadonlyArray<string>

 export function match<T, _K extends keyof T>(
   query: string,
   items: ReadonlyArray<T>,
-  getKey: _K | KeyFunction<T>
+  getKey: KeyFunction<T>
 ): ReadonlyArray<IMatch<T>> {
   // matching `query` against itself is a perfect match.
   const maxScore = score(query, query, 1)
   const result = items
     .map((item): IMatch<T> => {
-      const key: string =
-        typeof getKey === 'function'
-          ? (getKey as KeyFunction<T>)(item)
-          : String(item[getKey])
+      const matches: Array<ReadonlyArray<number>> = []
+      const itemTextArray = getKey(item)
+      itemTextArray.forEach(text => {
+        matches.push(fuzzAldrin.match(text, query, undefined, options))
+      })

       return {
-        score: score(key, query, maxScore),
+        score: score(itemTextArray.join(''), query, maxScore),
         item,
-        matches: fuzzAldrin.match(key, query, undefined, options),
+        matches: {
+          title: matches[0],
+          subtitle: matches.length > 1 ? matches[1] : [],
+        },
       }
     })
-    .filter(({ matches }) => matches.length > 0)
+    .filter(
+      ({ matches }) => matches.title.length > 0 || matches.subtitle.length > 0
+    )
     .sort(({ score: left }, { score: right }) => compareDescending(left, right))
+
   return result
 }
merged
  result 100644 35f7c40e561385a93aea0741a57c129bf257a68d app/src/lib/git/core.ts
  our    100644 37970522f470e82f498549b87c8d69c886bf8675 app/src/lib/git/core.ts
@@ -81,17 +81,17 @@
 /**
  * Shell out to git with the given arguments, at the given path.
  *
- * @param {args}             The arguments to pass to `git`.
+ * @param args             The arguments to pass to `git`.
  *
- * @param {path}             The working directory path for the execution of the
- *                           command.
+ * @param path             The working directory path for the execution of the
+ *                         command.
  *
- * @param {name}             The name for the command based on its caller's
- *                           context. This will be used for performance
- *                           measurements and debugging.
+ * @param name             The name for the command based on its caller's
+ *                         context. This will be used for performance
+ *                         measurements and debugging.
  *
- * @param {options}          Configuration options for the execution of git,
- *                           see IGitExecutionOptions for more information.
+ * @param options          Configuration options for the execution of git,
+ *                         see IGitExecutionOptions for more information.
  *
  * Returns the result. If the command exits with a code not in
  * `successExitCodes` or an error not in `expectedErrors`, a `GitError` will be
@@ -247,6 +247,14 @@
       return 'The push was rejected by the remote server because a required status check has not been satisfied.'
     case DugiteError.BranchRenameFailed:
       return 'The branch could not be renamed.'
+    case DugiteError.PathDoesNotExist:
+      return 'The path does not exist on disk.'
+    case DugiteError.InvalidObjectName:
+      return 'The object was not found in the Git repository.'
+    case DugiteError.OutsideRepository:
+      return 'This path is not a valid path inside the repository.'
+    case DugiteError.LockFileAlreadyExists:
+      return 'A lock file already exists in the repository, which blocks this operation from completing.'
     default:
       return assertNever(error, `Unknown error: ${error}`)
   }
merged
  result 100644 9f960230f3855e6a05f0ae2024a119e6bf720a88 app/src/lib/git/description.ts
  our    100644 0468f171d5553c74bc9196bbd89c240ac253b3d1 app/src/lib/git/description.ts
@@ -1,5 +1,5 @@
 import * as Path from 'path'
-import * as Fs from 'fs'
+import * as FSE from 'fs-extra'

 const GitDescriptionPath = '.git/description'

@@ -12,22 +12,15 @@
 ): Promise<string> {
   const path = Path.join(repositoryPath, GitDescriptionPath)

-  return new Promise<string>((resolve, reject) => {
-    Fs.readFile(path, 'utf8', (err, data) => {
-      if (err) {
-        /** No .git/description file existed, just return an empty one. */
-        resolve('')
-        return
-      }
-
-      if (data === DefaultGitDescription) {
-        resolve('')
-        return
-      }
-
-      resolve(data)
-    })
-  })
+  try {
+    const data = await FSE.readFile(path, 'utf8')
+    if (data === DefaultGitDescription) {
+      return ''
+    }
+    return data
+  } catch (err) {
+    return ''
+  }
 }

 /** Write a .git/description file to the repository. */
@@ -36,14 +29,5 @@
   description: string
 ): Promise<void> {
   const fullPath = Path.join(repositoryPath, GitDescriptionPath)
-
-  return new Promise<void>((resolve, reject) => {
-    Fs.writeFile(fullPath, description, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
+  await FSE.writeFile(fullPath, description)
 }
merged
  result 100644 c7b70925514f334e2076ddb67f208c2f3f12672f app/src/lib/git/diff.ts
  our    100644 be540d047988bd54344edfed49aa5e5ad2a4ae52 app/src/lib/git/diff.ts
@@ -44,7 +44,7 @@
  * The longest line length we should try to display. If a diff has a line longer
  * than this, we probably shouldn't attempt it
  */
-const MaxLineLength = 500000
+const MaxCharactersPerLine = 5000

 /**
  * Utility function to check whether parsing this buffer is going to cause
@@ -65,7 +65,7 @@
 function isDiffTooLarge(diff: IRawDiff) {
   for (const hunk of diff.hunks) {
     for (const line of hunk.lines) {
-      if (line.text.length > MaxLineLength) {
+      if (line.text.length > MaxCharactersPerLine) {
         return true
       }
     }
@@ -84,6 +84,7 @@
   '.gif',
   '.ico',
   '.webp',
+  '.bmp',
 ])

 /**
@@ -267,9 +268,9 @@
   commitish: string,
   lineEndingsChange?: LineEndingsChange
 ): Promise<IDiff> {
-  if (diff.isBinary) {
-    const extension = Path.extname(file.path)
+  const extension = Path.extname(file.path).toLowerCase()

+  if (diff.isBinary) {
     // some extension we don't know how to parse, never mind
     if (!imageFileExtensions.has(extension)) {
       return {
@@ -307,6 +308,9 @@
   if (extension === '.webp') {
     return 'image/webp'
   }
+  if (extension === '.bmp') {
+    return 'image/bmp'
+  }

   // fallback value as per the spec
   return 'text/plain'
@@ -405,7 +409,11 @@
 ): Promise<Image> {
   const extension = Path.extname(path)
   const contents = await getBlobContents(repository, commitish, path)
-  return new Image(contents.toString('base64'), getMediaType(extension))
+  return new Image(
+    contents.toString('base64'),
+    getMediaType(extension),
+    contents.length
+  )
 }
 /**
  * Retrieve the binary contents of a blob from the working directory
@@ -425,6 +433,7 @@
   )
   return new Image(
     contents.toString('base64'),
-    getMediaType(Path.extname(file.path))
+    getMediaType(Path.extname(file.path)),
+    contents.length
   )
 }
merged
  result 100644 fe76c1c138388cc995fcb26283c9619d2c47cdf2 app/src/lib/git/index.ts
  our    100644 e5cb2e11f5be7e44292fa768f1971cca56b88440 app/src/lib/git/index.ts
@@ -5,6 +5,7 @@
 export * from './commit'
 export * from './config'
 export * from './core'
+export * from './description'
 export * from './diff'
 export * from './fetch'
 export * from './for-each-ref'
merged
  result 100644 b5ff0aa56eda967e9740dce0effc2d759c248634 app/src/lib/git/refs.ts
  our    100644 4227634cb2503fed378f64d1e28ff7f41216f944 app/src/lib/git/refs.ts
@@ -1,3 +1,6 @@
+import { git } from './core'
+import { Repository } from '../../models/repository'
+
 /**
  * Format a local branch in the ref syntax, ensuring situations when the branch
  * is ambiguous are handled.
@@ -19,3 +22,37 @@
     return `refs/heads/${name}`
   }
 }
+
+/**
+ * Read a symbolic ref from the repository.
+ *
+ * Symbolic refs are used to point to other refs, similar to how symlinks work
+ * for files. Because refs can be removed easily from a Git repository,
+ * symbolic refs should only be used when absolutely necessary.
+ *
+ * @param repository The repository to lookup
+ * @param ref The symbolic ref to resolve
+ *
+ * @returns the canonical ref, if found, or `null` if `ref` cannot be found or
+ *          is not a symbolic ref
+ */
+export async function getSymbolicRef(
+  repository: Repository,
+  ref: string
+): Promise<string | null> {
+  const result = await git(
+    ['symbolic-ref', '-q', ref],
+    repository.path,
+    'getSymbolicRef',
+    {
+      successExitCodes: new Set([0, 128]),
+    }
+  )
+
+  if (result.exitCode === 128) {
+    // ref was not a symbolic ref or ref does not exist
+    return null
+  }
+
+  return result.stdout.trim()
+}
merged
  result 100644 3f1e4abe01f964c4aa4b46ec41185ef132ec2c8a app/src/lib/git/rev-list.ts
  our    100644 ce2b9ab3f38d37bcf3a74d6bb159ef3ab0257083 app/src/lib/git/rev-list.ts
@@ -1,12 +1,36 @@
 import { GitError } from 'dugite'
 import { git } from './core'
 import { Repository } from '../../models/repository'
-import { Branch, BranchType } from '../../models/branch'
+import { Branch, BranchType, IAheadBehind } from '../../models/branch'

-/** The number of commits a revision range is ahead/behind. */
-export interface IAheadBehind {
-  readonly ahead: number
-  readonly behind: number
+/**
+ * Convert two refs into the Git range syntax representing the set of commits
+ * that are reachable from `to` but excluding those that are reachable from
+ * `from`.
+ *
+ * Each parameter can be the commit SHA or a ref name, or specify an empty
+ * string to represent HEAD.
+ *
+ * @param from The start of the range
+ * @param to The end of the range
+ */
+export function revRange(from: string, to: string) {
+  return `${from}..${to}`
+}
+
+/**
+ * Convert two refs into the Git symmetric difference syntax, which represents
+ * the set of commits that are reachable from either `from` or `to` but not
+ * from both.
+ *
+ * Each parameter can be the commit SHA or a ref name, or you can use an empty
+ * string to represent HEAD.
+ *
+ * @param from The start of the range
+ * @param to The end of the range
+ */
+export function revSymmetricDifference(from: string, to: string) {
+  return `${from}...${to}`
 }

 /** Calculate the number of commits the range is ahead and behind. */
@@ -64,6 +88,6 @@
   // NB: The three dot form means we'll go all the way back to the merge base
   // of the branch and its upstream. Practically this is important for seeing
   // "through" merges.
-  const range = `${branch.name}...${upstream}`
+  const range = revSymmetricDifference(branch.name, upstream)
   return getAheadBehind(repository, range)
 }
merged
  result 100644 bc5a94f3cc8efd6c3f497b96d1379064021f0ced app/src/lib/git/status.ts
  our    100644 886824ef09bccde31746939b3ad97e2d993918d7 app/src/lib/git/status.ts
@@ -9,7 +9,7 @@
 import { parsePorcelainStatus, mapStatus } from '../status-parser'
 import { DiffSelectionType, DiffSelection } from '../../models/diff'
 import { Repository } from '../../models/repository'
-import { IAheadBehind } from './rev-list'
+import { IAheadBehind } from '../../models/branch'
 import { fatalError } from '../../lib/fatal-error'

 /** The encapsulation of the result from 'git status' */
@@ -62,7 +62,9 @@
     'getStatus'
   )

-  const files = new Array<WorkingDirectoryFileChange>()
+  // Map of files keyed on their paths.
+  // Note, map maintains insertion order
+  const files = new Map<string, WorkingDirectoryFileChange>()

   let currentBranch: string | undefined = undefined
   let currentUpstreamBranch: string | undefined = undefined
@@ -90,10 +92,7 @@
         // same path, we should ensure that we only draw one entry in the
         // changes list - see if an entry already exists for this path and
         // remove it if found
-        const existingEntry = files.findIndex(p => p.path === entry.path)
-        if (existingEntry > -1) {
-          files.splice(existingEntry, 1)
-        }
+        files.delete(entry.path)
       }

       // for now we just poke at the existing summary
@@ -102,7 +101,8 @@
         DiffSelectionType.All
       )

-      files.push(
+      files.set(
+        entry.path,
         new WorkingDirectoryFileChange(
           entry.path,
           summary,
@@ -134,7 +134,7 @@
     }
   }

-  const workingDirectory = WorkingDirectoryStatus.fromFiles(files)
+  const workingDirectory = WorkingDirectoryStatus.fromFiles([...files.values()])

   return {
     currentBranch,
merged
  result 100644 497889aae05c2de60409b2354678563f32994314 app/src/lib/git/submodule.ts
  our    100644 964fa04fb165bbe2e1bd2628840922ade9b86fd6 app/src/lib/git/submodule.ts
@@ -1,8 +1,9 @@
+import * as Path from 'path'
+import { pathExists } from 'fs-extra'
+
 import { git } from './core'
 import { Repository } from '../../models/repository'
 import { SubmoduleEntry } from '../../models/submodule'
-import { pathExists } from '../file-system'
-import * as Path from 'path'

 export async function listSubmodules(
   repository: Repository
merged
  result 100644 efb13fb0c1c8db7af2da3feffa6157cdfcffc386 app/src/lib/is-git-on-path.ts
  our    100644 25f5e58c8ceb7199146a603c42fbb7d88e6c431c app/src/lib/is-git-on-path.ts
@@ -5,14 +5,13 @@
   // Modern versions of macOS ship with a Git shim that guides you through
   // the process of setting everything up. We trust this is available, so
   // don't worry about looking for it here.
-  // I decide linux user have git too :)
-  if (__DARWIN__ || __LINUX__) {
+  if (__DARWIN__) {
     return Promise.resolve(true)
   }

   // adapted from http://stackoverflow.com/a/34953561/1363815
-  return new Promise<boolean>((resolve, reject) => {
-    if (__WIN32__) {
+  if (__WIN32__) {
+    return new Promise<boolean>((resolve, reject) => {
       const windowsRoot = process.env.SystemRoot || 'C:\\Windows'
       const wherePath = Path.join(windowsRoot, 'System32', 'where.exe')

@@ -29,9 +28,20 @@
         resolve(code === 0)
       })
       return
-    }
+    })
+  }
+
+  if (__LINUX__) {
+    return new Promise<boolean>((resolve, reject) => {
+      const process = spawn('which', ['git'])
+
+      // `which` will return 0 when the executable
+      // is found under PATH, or 1 if it cannot be found
+      process.on('close', function(code) {
+        resolve(code === 0)
+      })
+    })
+  }

-    // in case you're on a non-Windows/non-macOS platform
-    resolve(false)
-  })
+  return Promise.resolve(false)
 }
merged
  result 100644 d50be352ff1adc2c799a3f53fd983a2cdcbaa735 app/src/lib/menu-update.ts
  our    100644 a12e7bdd46fd140f6b2b7ad6b947c9f93f2450b8 app/src/lib/menu-update.ts
@@ -104,7 +104,7 @@
   'update-branch',
   'merge-branch',
   'view-repository-on-github',
-  'compare-branch',
+  'compare-on-github',
   'open-in-shell',
   'push',
   'pull',
@@ -200,6 +200,7 @@
     'show-history',
     'show-branches-list',
     'open-external-editor',
+    'compare-to-branch',
   ]

   const menuStateBuilder = new MenuStateBuilder()
@@ -227,7 +228,7 @@
     )
     menuStateBuilder.setEnabled('merge-branch', onBranch)
     menuStateBuilder.setEnabled(
-      'compare-branch',
+      'compare-on-github',
       isHostedOnGitHub && hasPublishedBranch
     )

@@ -278,10 +279,10 @@
     menuStateBuilder.disable('delete-branch')
     menuStateBuilder.disable('update-branch')
     menuStateBuilder.disable('merge-branch')
-    menuStateBuilder.disable('compare-branch')

     menuStateBuilder.disable('push')
     menuStateBuilder.disable('pull')
+    menuStateBuilder.disable('compare-to-branch')
   }
   return menuStateBuilder
 }
merged
  result 100644 b9e38022ccb3b75ba35fc496a1e77a8857d825f6 app/src/lib/parse-app-url.ts
  our    100644 e01d63715d1d361dacd2f6a1fa3c1ff44ff12eb4 app/src/lib/parse-app-url.ts
@@ -13,13 +13,13 @@
   readonly url: string

   /** the optional branch name which should be checked out. use the default branch otherwise. */
-  readonly branch?: string
+  readonly branch: string | null

   /** the pull request number, if pull request originates from a fork of the repository */
-  readonly pr?: string
+  readonly pr: string | null

   /** the file to open after cloning the repository */
-  readonly filepath?: string
+  readonly filepath: string | null
 }

 export interface IOpenRepositoryFromPathAction {
@@ -40,6 +40,36 @@
   | IOpenRepositoryFromPathAction
   | IUnknownAction

+// eslint-disable-next-line typescript/interface-name-prefix
+interface ParsedUrlQueryWithUndefined {
+  // `undefined` is added here to ensure we handle the missing querystring key
+  // See https://github.com/Microsoft/TypeScript/issues/13778 for discussion about
+  // why this isn't supported natively in TypeScript
+  [key: string]: string | string[] | undefined
+}
+
+/**
+ * Parse the URL to find a given key in the querystring text.
+ *
+ * @param url The source URL containing querystring key-value pairs
+ * @param key The key to look for in the querystring
+ */
+function getQueryStringValue(
+  query: ParsedUrlQueryWithUndefined,
+  key: string
+): string | null {
+  const value = query[key]
+  if (value == null) {
+    return null
+  }
+
+  if (Array.isArray(value)) {
+    return value[0]
+  }
+
+  return value
+}
+
 export function parseAppURL(url: string): URLActionType {
   const parsedURL = URL.parse(url, true)
   const hostname = parsedURL.hostname
@@ -48,9 +78,16 @@
     return unknown
   }

+  const query = parsedURL.query
+
   const actionName = hostname.toLowerCase()
   if (actionName === 'oauth') {
-    return { name: 'oauth', code: parsedURL.query.code }
+    const code = getQueryStringValue(query, 'code')
+    if (code != null) {
+      return { name: 'oauth', code }
+    } else {
+      return unknown
+    }
   }

   // we require something resembling a URL first
@@ -70,28 +107,23 @@
     // suffix the remote URL with `.git`, for backwards compatibility
     const url = `${probablyAURL}.git`

-    const queryString = parsedURL.query
+    const pr = getQueryStringValue(query, 'pr')
+    const branch = getQueryStringValue(query, 'branch')
+    const filepath = getQueryStringValue(query, 'filepath')

-    const pr = queryString.pr
-    const branch = queryString.branch
-    const filepath = queryString.filepath
-
-    if (pr) {
-      // if anything other than a number is used for the PR value, exit
+    if (pr != null) {
       if (!/^\d+$/.test(pr)) {
         return unknown
       }

       // we also expect the branch for a forked PR to be a given ref format
-      if (!/^pr\/\d+$/.test(branch)) {
+      if (branch != null && !/^pr\/\d+$/.test(branch)) {
         return unknown
       }
     }

-    if (branch) {
-      if (testForInvalidChars(branch)) {
-        return unknown
-      }
+    if (branch != null && testForInvalidChars(branch)) {
+      return unknown
     }

     return {
added in remote
  their  100644 e53daf16a90439aa5a1aa9c6a1c5736f39274eda app/src/lib/process/win32.ts
@@ -0,0 +1,90 @@
+import { spawn as spawnInternal } from 'child_process'
+import * as Path from 'path'
+
+/** Get the path segments in the user's `Path`. */
+export async function getPathSegments(): Promise<ReadonlyArray<string>> {
+  let powershellPath: string
+  const systemRoot = process.env.SystemRoot
+  if (systemRoot != null) {
+    const system32Path = Path.join(systemRoot, 'System32')
+    powershellPath = Path.join(
+      system32Path,
+      'WindowsPowerShell',
+      'v1.0',
+      'powershell.exe'
+    )
+  } else {
+    powershellPath = 'powershell.exe'
+  }
+
+  const args = [
+    '-noprofile',
+    '-ExecutionPolicy',
+    'RemoteSigned',
+    '-command',
+    // Set encoding and execute the command, capture the output, and return it
+    // via .NET's console in order to have consistent UTF-8 encoding.
+    // See http://stackoverflow.com/questions/22349139/utf-8-output-from-powershell
+    // to address https://github.com/atom/atom/issues/5063
+    `
+      [Console]::OutputEncoding=[System.Text.Encoding]::UTF8
+      $output=[environment]::GetEnvironmentVariable('Path', 'User')
+      [Console]::WriteLine($output)
+    `,
+  ]
+
+  const stdout = await spawn(powershellPath, args)
+  const pathOutput = stdout.replace(/^\s+|\s+$/g, '')
+  return pathOutput.split(/;+/).filter(segment => segment.length)
+}
+
+/** Set the user's `Path`. */
+export async function setPathSegments(
+  paths: ReadonlyArray<string>
+): Promise<void> {
+  let setxPath: string
+  const systemRoot = process.env['SystemRoot']
+  if (systemRoot) {
+    const system32Path = Path.join(systemRoot, 'System32')
+    setxPath = Path.join(system32Path, 'setx.exe')
+  } else {
+    setxPath = 'setx.exe'
+  }
+
+  await spawn(setxPath, ['Path', paths.join(';')])
+}
+
+/** Spawn a command with arguments and capture its output. */
+export function spawn(
+  command: string,
+  args: ReadonlyArray<string>
+): Promise<string> {
+  try {
+    const child = spawnInternal(command, args as string[])
+    return new Promise<string>((resolve, reject) => {
+      let stdout = ''
+      child.stdout.on('data', data => {
+        stdout += data
+      })
+
+      child.on('close', code => {
+        if (code === 0) {
+          resolve(stdout)
+        } else {
+          reject(new Error(`Command "${command} ${args}" failed: "${stdout}"`))
+        }
+      })
+
+      child.on('error', (err: Error) => {
+        reject(err)
+      })
+
+      // This is necessary if using Powershell 2 on Windows 7 to get the events
+      // to raise.
+      // See http://stackoverflow.com/questions/9155289/calling-powershell-from-nodejs
+      child.stdin.end()
+    })
+  } catch (error) {
+    return Promise.reject(error)
+  }
+}
merged
  result 100644 f3e30a75fd83483f4729f3239ffd2bf3b780a7fd app/src/lib/progress/from-process.ts
  our    100644 574666eff35b9d7681971fbb405c2bac00c106a0 app/src/lib/progress/from-process.ts
@@ -1,5 +1,6 @@
 import { ChildProcess } from 'child_process'
 import * as Fs from 'fs'
+import * as Path from 'path'
 import * as byline from 'byline'

 import { GitProgressParser, IGitProgress, IGitOutput } from './git'
@@ -23,8 +24,13 @@
   let lfsProgressPath = null
   let env = {}
   if (options.trackLFSProgress) {
-    lfsProgressPath = await createLFSProgressFile()
-    env = { GIT_LFS_PROGRESS: lfsProgressPath }
+    try {
+      lfsProgressPath = await createLFSProgressFile()
+      env = { GIT_LFS_PROGRESS: lfsProgressPath }
+    } catch (e) {
+      log.error('Error writing LFS progress file', e)
+      env = { GIT_LFS_PROGRESS: null }
+    }
   }

   return merge(options, {
@@ -57,9 +63,17 @@

       process.on('close', () => {
         disposable.dispose()
-        // NB: We don't really care about errors deleting the file, but Node
-        // gets kinda bothered if we don't provide a callback.
-        Fs.unlink(lfsProgressPath, () => {})
+        // the order of these callbacks is important because
+        //  - unlink can only be done on files
+        //  - rmdir can only be done when the directory is empty
+        //  - we don't want to surface errors to the user if something goes
+        //    wrong (these files can stay in TEMP and be cleaned up eventually)
+        Fs.unlink(lfsProgressPath, err => {
+          if (err == null) {
+            const directory = Path.dirname(lfsProgressPath)
+            Fs.rmdir(directory, () => {})
+          }
+        })
       })
     }

merged
  result 100644 466a25723137239fd49be2906d25e300ad5fa913 app/src/lib/progress/lfs.ts
  our    100644 3b054c35fb65185af0628abc0d445ae6a1296b30 app/src/lib/progress/lfs.ts
@@ -1,19 +1,12 @@
-import * as Fs from 'fs'
+import * as FSE from 'fs-extra'
 import { getTempFilePath } from '../file-system'
 import { IGitProgress, IGitProgressInfo, IGitOutput } from './git'

 /** Create the Git LFS progress reporting file and return the path. */
 export async function createLFSProgressFile(): Promise<string> {
   const path = await getTempFilePath('GitHubDesktop-lfs-progress')
-  return new Promise<string>((resolve, reject) => {
-    Fs.writeFile(path, '', err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve(path)
-      }
-    })
-  })
+  await FSE.ensureFile(path)
+  return path
 }

 // The regex for parsing LFS progress lines. See
merged
  result 100644 df0a7f7ff234a7c89d0b2480c70661b30e5d90bd app/src/lib/remote-parsing.ts
  our    100644 21114f701d33070680ccedbfcbd4b563dd3117cc app/src/lib/remote-parsing.ts
@@ -1,4 +1,8 @@
+type Protocol = 'ssh' | 'https'
+
 interface IGitRemoteURL {
+  readonly protocol: Protocol
+
   /** The hostname of the remote. */
   readonly hostname: string

@@ -15,21 +19,33 @@
   readonly name: string | null
 }

+// Examples:
+// https://github.com/octocat/Hello-World.git
+// https://github.com/octocat/Hello-World.git/
+// git@github.com:octocat/Hello-World.git
+// git:github.com/octocat/Hello-World.git
+const remoteRegexes: ReadonlyArray<{ protocol: Protocol; regex: RegExp }> = [
+  {
+    protocol: 'https',
+    regex: new RegExp('^https?://(?:.+@)?(.+)/(.+)/(.+?)(?:/|.git/?)?$'),
+  },
+  {
+    protocol: 'ssh',
+    regex: new RegExp('^git@(.+):(.+)/(.+?)(?:/|.git)?$'),
+  },
+  {
+    protocol: 'ssh',
+    regex: new RegExp('^git:(.+)/(.+)/(.+?)(?:/|.git)?$'),
+  },
+  {
+    protocol: 'ssh',
+    regex: new RegExp('^ssh://git@(.+)/(.+)/(.+?)(?:/|.git)?$'),
+  },
+]
+
 /** Parse the remote information from URL. */
 export function parseRemote(url: string): IGitRemoteURL | null {
-  // Examples:
-  // https://github.com/octocat/Hello-World.git
-  // https://github.com/octocat/Hello-World.git/
-  // git@github.com:octocat/Hello-World.git
-  // git:github.com/octocat/Hello-World.git
-  const regexes = [
-    new RegExp('^https?://(?:.+@)?(.+)/(.+)/(.+?)(?:/|.git/?)?$'),
-    new RegExp('^git@(.+):(.+)/(.+?)(?:/|.git)?$'),
-    new RegExp('^git:(.+)/(.+)/(.+?)(?:/|.git)?$'),
-    new RegExp('^ssh://git@(.+)/(.+)/(.+?)(?:/|.git)?$'),
-  ]
-
-  for (const regex of regexes) {
+  for (const { protocol, regex } of remoteRegexes) {
     const result = url.match(regex)
     if (!result) {
       continue
@@ -39,7 +55,7 @@
     const owner = result[2]
     const name = result[3]
     if (hostname) {
-      return { hostname, owner, name }
+      return { protocol, hostname, owner, name }
     }
   }

merged
  result 100644 63d2fe120af3eaaafc7fe69f833f40cd5e6b477e app/src/lib/shells/darwin.ts
  our    100644 00a9aa293632a29b5bd02d296907bf9cdb3ffde5 app/src/lib/shells/darwin.ts
@@ -8,6 +8,7 @@
   Terminal = 'Terminal',
   Hyper = 'Hyper',
   iTerm2 = 'iTerm2',
+  PowerShellCore = 'PowerShell Core',
 }

 export const Default = Shell.Terminal
@@ -25,6 +26,10 @@
     return Shell.iTerm2
   }

+  if (label === Shell.PowerShellCore) {
+    return Shell.PowerShellCore
+  }
+
   return Default
 }

@@ -36,6 +41,8 @@
       return 'com.googlecode.iterm2'
     case Shell.Hyper:
       return 'co.zeit.hyper'
+    case Shell.PowerShellCore:
+      return 'com.microsoft.powershell'
     default:
       return assertNever(shell, `Unknown shell: ${shell}`)
   }
@@ -54,10 +61,16 @@
 export async function getAvailableShells(): Promise<
   ReadonlyArray<IFoundShell<Shell>>
 > {
-  const [terminalPath, hyperPath, iTermPath] = await Promise.all([
+  const [
+    terminalPath,
+    hyperPath,
+    iTermPath,
+    powerShellCorePath,
+  ] = await Promise.all([
     getShellPath(Shell.Terminal),
     getShellPath(Shell.Hyper),
     getShellPath(Shell.iTerm2),
+    getShellPath(Shell.PowerShellCore),
   ])

   const shells: Array<IFoundShell<Shell>> = []
@@ -73,6 +86,10 @@
     shells.push({ shell: Shell.iTerm2, path: iTermPath })
   }

+  if (powerShellCorePath) {
+    shells.push({ shell: Shell.PowerShellCore, path: powerShellCorePath })
+  }
+
   return shells
 }

merged
  result 100644 afc28e5ff68afd9388d5e17690d30eccc4ac1b75 app/src/lib/shells/linux.ts
  our    100644 d1effa798ba21a6f706771f25cd9dfb957f0c7d0 app/src/lib/shells/linux.ts
@@ -1,5 +1,5 @@
 import { spawn, ChildProcess } from 'child_process'
-import { pathExists } from '../file-system'
+import { pathExists } from 'fs-extra'
 import { assertNever } from '../fatal-error'
 import { IFoundShell } from './found-shell'

merged
  result 100644 0fef473ed40b7b043f025d9677ebb724939d0a8f app/src/lib/shells/shared.ts
  our    100644 bc82735e7a7928d8280b488af550e97acbe8ab65 app/src/lib/shells/shared.ts
@@ -1,9 +1,9 @@
 import { ChildProcess } from 'child_process'
+import { pathExists } from 'fs-extra'

 import * as Darwin from './darwin'
 import * as Win32 from './win32'
 import * as Linux from './linux'
-import { pathExists } from '../file-system'
 import { IFoundShell } from './found-shell'
 import { ShellError } from './error'

merged
  result 100644 9bfcb28a39ebb3d774a2995d510e3a4ece676b3a app/src/lib/shells/win32.ts
  our    100644 94056bbd3c70887c371b620f95e77efeafb04518 app/src/lib/shells/win32.ts
@@ -1,14 +1,15 @@
 import { spawn, ChildProcess } from 'child_process'
 import * as Path from 'path'
 import { enumerateValues, HKEY, RegistryValueType } from 'registry-js'
+import { pathExists } from 'fs-extra'

-import { pathExists } from '../file-system'
 import { assertNever } from '../fatal-error'
 import { IFoundShell } from './found-shell'

 export enum Shell {
   Cmd = 'Command Prompt',
   PowerShell = 'PowerShell',
+  PowerShellCore = 'PowerShell Core',
   Hyper = 'Hyper',
   GitBash = 'Git Bash',
 }
@@ -24,6 +25,10 @@
     return Shell.PowerShell
   }

+  if (label === Shell.PowerShellCore) {
+    return Shell.PowerShellCore
+  }
+
   if (label === Shell.Hyper) {
     return Shell.Hyper
   }
@@ -53,6 +58,14 @@
     })
   }

+  const powerShellCorePath = await findPowerShellCore()
+  if (powerShellCorePath != null) {
+    shells.push({
+      shell: Shell.PowerShellCore,
+      path: powerShellCorePath,
+    })
+  }
+
   const hyperPath = await findHyper()
   if (hyperPath != null) {
     shells.push({
@@ -111,6 +124,32 @@
   return null
 }

+async function findPowerShellCore(): Promise<string | null> {
+  const powerShellCore = enumerateValues(
+    HKEY.HKEY_LOCAL_MACHINE,
+    'Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\pwsh.exe'
+  )
+
+  if (powerShellCore.length === 0) {
+    return null
+  }
+
+  const first = powerShellCore[0]
+  if (first.type === RegistryValueType.REG_SZ) {
+    const path = first.data
+
+    if (await pathExists(path)) {
+      return path
+    } else {
+      log.debug(
+        `[PowerShellCore] registry entry found but does not exist at '${path}'`
+      )
+    }
+  }
+
+  return null
+}
+
 async function findHyper(): Promise<string | null> {
   const hyper = enumerateValues(
     HKEY.HKEY_CURRENT_USER,
@@ -128,11 +167,19 @@
     // This regex is designed to get the path to the version-specific Hyper.
     // commandPieces = ['"{installationPath}\app-x.x.x\Hyper.exe"', '"', '{installationPath}\app-x.x.x\Hyper.exe', ...]
     const commandPieces = first.data.match(/(["'])(.*?)\1/)
+    const localAppData = process.env.LocalAppData
+
     const path = commandPieces
       ? commandPieces[2]
-      : process.env.LocalAppData.concat('\\hyper\\Hyper.exe') // fall back to the launcher in install root
+      : localAppData != null
+        ? localAppData.concat('\\hyper\\Hyper.exe')
+        : null // fall back to the launcher in install root

-    if (await pathExists(path)) {
+    if (path == null) {
+      log.debug(
+        `[Hyper] LOCALAPPDATA environment variable is unset, aborting fallback behavior`
+      )
+    } else if (await pathExists(path)) {
       return path
     } else {
       log.debug(`[Hyper] registry entry found but does not exist at '${path}'`)
@@ -181,6 +228,12 @@
         shell: true,
         cwd: path,
       })
+    case Shell.PowerShellCore:
+      const psCoreCommand = `"Set-Location -LiteralPath '${path}'"`
+      return spawn('START', ['pwsh', '-NoExit', '-Command', psCoreCommand], {
+        shell: true,
+        cwd: path,
+      })
     case Shell.Hyper:
       const hyperPath = `"${foundShell.path}"`
       log.info(`launching ${shell} at path: ${hyperPath}`)
merged
  result 100644 1a92eadda10120ed9ba6bec97c2fc0a752509fc2 app/src/lib/stats/stats-database.ts
  our    100644 7911de79718900503165ac9ef13670da8c71cdc5 app/src/lib/stats/stats-database.ts
@@ -40,6 +40,47 @@

   /** The number of commits created with one or more co-authors. */
   readonly coAuthoredCommits: number
+
+  /** The number of times a branch is compared to an arbitrary branch */
+  readonly branchComparisons: number
+
+  /** The number of times a branch is compared to `master` */
+  readonly defaultBranchComparisons: number
+
+  /** The number of times a merge is initiated in the `compare` sidebar */
+  readonly mergesInitiatedFromComparison: number
+
+  /** The number of times the `Branch -> Update From Default Branch` menu item is used */
+  readonly updateFromDefaultBranchMenuCount: number
+
+  /** The number of times the `Branch -> Merge Into Current Branch` menu item is used */
+  readonly mergeIntoCurrentBranchMenuCount: number
+
+  /** The number of times the user checks out a branch using the PR menu */
+  readonly prBranchCheckouts: number
+
+  /** The numbers of times a repo with indicators is clicked on repo list view */
+  readonly repoWithIndicatorClicked: number
+  /** The numbers of times a repo without indicators is clicked on repo list view */
+  readonly repoWithoutIndicatorClicked: number
+
+  /** The number of times the user dismisses the diverged branch notification */
+  readonly divergingBranchBannerDismissal: number
+
+  /** The number of times the user merges from the diverged branch notification merge CTA button */
+  readonly divergingBranchBannerInitatedMerge: number
+
+  /** The number of times the user compares from the diverged branch notification compare CTA button */
+  readonly divergingBranchBannerInitiatedCompare: number
+
+  /**
+   * The number of times the user merges from the compare view after getting to that state
+   * from the diverged branch notification compare CTA button
+   */
+  readonly divergingBranchBannerInfluencedMerge: number
+
+  /** The number of times the diverged branch notification is displayed */
+  readonly divergingBranchBannerDisplayed: number
 }

 export class StatsDatabase extends Dexie {
merged
  result 100644 3866dcb7f85658b385e8d34e610a3f2321d9fbd8 app/src/lib/stats/stats-store.ts
  our    100644 10e9a39560a0f09260217f2d9e598e9bbaf63613 app/src/lib/stats/stats-store.ts
@@ -7,6 +7,7 @@
 import { getGUID } from './get-guid'
 import { Repository } from '../../models/repository'
 import { merge } from '../../lib/merge'
+import { getPersistedThemeName } from '../../ui/lib/application-theme'

 const StatsEndpoint = 'https://central.github.com/api/usage/desktop'

@@ -29,6 +30,19 @@
   partialCommits: 0,
   openShellCount: 0,
   coAuthoredCommits: 0,
+  branchComparisons: 0,
+  defaultBranchComparisons: 0,
+  mergesInitiatedFromComparison: 0,
+  updateFromDefaultBranchMenuCount: 0,
+  mergeIntoCurrentBranchMenuCount: 0,
+  prBranchCheckouts: 0,
+  repoWithIndicatorClicked: 0,
+  repoWithoutIndicatorClicked: 0,
+  divergingBranchBannerDismissal: 0,
+  divergingBranchBannerInitatedMerge: 0,
+  divergingBranchBannerInitiatedCompare: 0,
+  divergingBranchBannerInfluencedMerge: 0,
+  divergingBranchBannerDisplayed: 0,
 }

 interface ICalculatedStats {
@@ -56,6 +70,12 @@
   /** Is the user logged in with an Enterprise account? */
   readonly enterpriseAccount: boolean

+  /**
+   * The name of the currently selected theme/application
+   * appearance as set at time of stats submission.
+   */
+  readonly theme: string
+
   readonly eventType: 'usage'
 }

@@ -171,6 +191,7 @@
       version: getVersion(),
       osVersion: getOS(),
       platform: process.platform,
+      theme: getPersistedThemeName(),
       ...launchStats,
       ...dailyMeasures,
       ...userType,
@@ -294,6 +315,59 @@
     }))
   }

+  /** Record that a branch comparison has been made */
+  public recordBranchComparison(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      branchComparisons: m.branchComparisons + 1,
+    }))
+  }
+
+  /** Record that a branch comparison has been made to the `master` branch */
+  public recordDefaultBranchComparison(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      defaultBranchComparisons: m.defaultBranchComparisons + 1,
+    }))
+  }
+
+  /** Record that a merge has been initiated from the `compare` sidebar */
+  public recordCompareInitiatedMerge(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      mergesInitiatedFromComparison: m.mergesInitiatedFromComparison + 1,
+    }))
+  }
+
+  /** Record that a merge has been initiated from the `Branch -> Update From Default Branch` menu item */
+  public recordMenuInitiatedUpdate(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      updateFromDefaultBranchMenuCount: m.updateFromDefaultBranchMenuCount + 1,
+    }))
+  }
+
+  /** Record that a merge has been initiated from the `Branch -> Merge Into Current Branch` menu item */
+  public recordMenuInitiatedMerge(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      mergeIntoCurrentBranchMenuCount: m.mergeIntoCurrentBranchMenuCount + 1,
+    }))
+  }
+
+  /** Record that the user checked out a PR branch */
+  public recordPRBranchCheckout(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      prBranchCheckouts: m.prBranchCheckouts + 1,
+    }))
+  }
+
+  public recordRepoClicked(repoHasIndicator: boolean): Promise<void> {
+    if (repoHasIndicator) {
+      return this.updateDailyMeasures(m => ({
+        repoWithIndicatorClicked: m.repoWithIndicatorClicked + 1,
+      }))
+    }
+    return this.updateDailyMeasures(m => ({
+      repoWithoutIndicatorClicked: m.repoWithoutIndicatorClicked + 1,
+    }))
+  }
+
   /** Set whether the user has opted out of stats reporting. */
   public async setOptOut(optOut: boolean): Promise<void> {
     const changed = this.optOut !== optOut
@@ -312,6 +386,47 @@
     return this.optOut
   }

+  /** Record that user dismissed diverging branch notification */
+  public async recordDivergingBranchBannerDismissal(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      divergingBranchBannerDismissal: m.divergingBranchBannerDismissal + 1,
+    }))
+  }
+
+  /** Record that user initiated a merge from within the notification banner */
+  public async recordDivergingBranchBannerInitatedMerge(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      divergingBranchBannerInitatedMerge:
+        m.divergingBranchBannerInitatedMerge + 1,
+    }))
+  }
+
+  /** Record that user initiated a compare from within the notification banner */
+  public async recordDivergingBranchBannerInitiatedCompare(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      divergingBranchBannerInitiatedCompare:
+        m.divergingBranchBannerInitiatedCompare + 1,
+    }))
+  }
+
+  /**
+   * Record that user initiated a merge after getting to compare view
+   * from within notificatio banner
+   */
+  public async recordDivergingBranchBannerInfluencedMerge(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      divergingBranchBannerInfluencedMerge:
+        m.divergingBranchBannerInfluencedMerge + 1,
+    }))
+  }
+
+  /** Record that the user was shown the notification banner */
+  public async recordDivergingBranchBannerDisplayed(): Promise<void> {
+    return this.updateDailyMeasures(m => ({
+      divergingBranchBannerDisplayed: m.divergingBranchBannerDisplayed + 1,
+    }))
+  }
+
   /** Post some data to our stats endpoint. */
   private post(body: object): Promise<Response> {
     const options: RequestInit = {
merged
  result 100644 f11d691b980015ca4a257c25f28433f4a7514376 app/src/lib/stores/accounts-store.ts
  our    100644 7b2bcf64296d13ab933c90d71368479c79c92e69 app/src/lib/stores/accounts-store.ts
@@ -213,7 +213,7 @@
 async function updatedAccount(account: Account): Promise<Account> {
   if (!account.token) {
     return fatalError(
-      `Cannot update an account which doesn't have a token: ${account}`
+      `Cannot update an account which doesn't have a token: ${account.login}`
     )
   }

merged
  result 100644 ee571b467f678151f67ef1ea677ecd440ff28df8 app/src/lib/stores/app-store.ts
  our    100644 9f98922eb0685739d0e3a1ca94059e260529c827 app/src/lib/stores/app-store.ts
@@ -3,7 +3,7 @@
   IRepositoryState,
   IHistoryState,
   IAppState,
-  RepositorySection,
+  RepositorySectionTab,
   IChangesState,
   Popup,
   PopupType,
@@ -17,9 +17,16 @@
   ImageDiffType,
   IRevertProgress,
   IFetchProgress,
+  ICompareState,
+  ComparisonView,
+  CompareAction,
+  CompareActionKind,
+  IDisplayHistory,
+  ICompareBranch,
+  ICompareFormUpdate,
 } from '../app-state'
 import { Account } from '../../models/account'
-import { Repository } from '../../models/repository'
+import { Repository, ILocalRepositoryState } from '../../models/repository'
 import { GitHubRepository } from '../../models/github-repository'
 import {
   CommittedFileChange,
@@ -34,7 +41,11 @@
 } from '../../lib/repository-matching'
 import { API, getAccountForEndpoint, IAPIUser } from '../../lib/api'
 import { caseInsensitiveCompare } from '../compare'
-import { Branch, BranchType } from '../../models/branch'
+import {
+  Branch,
+  eligibleForFastForward,
+  IAheadBehind,
+} from '../../models/branch'
 import { TipState } from '../../models/tip'
 import { CloningRepository } from '../../models/cloning-repository'
 import { Commit } from '../../models/commit'
@@ -121,6 +132,15 @@
 import * as QueryString from 'querystring'
 import { IRemote, ForkedRemotePrefix } from '../../models/remote'
 import { IAuthor } from '../../models/author'
+import { ComparisonCache } from '../comparison-cache'
+import { AheadBehindUpdater } from './helpers/ahead-behind-updater'
+import { enableRepoInfoIndicators } from '../feature-flag'
+import { inferComparisonBranch } from './helpers/infer-comparison-branch'
+import {
+  ApplicationTheme,
+  getPersistedTheme,
+  setPersistedTheme,
+} from '../../ui/lib/application-theme'

 /**
  * Enum used by fetch to determine if
@@ -131,6 +151,13 @@
   UserInitiatedTask,
 }

+/**
+ * As fast-forwarding local branches is proportional to the number of local
+ * branches, and is run after every fetch/push/pull, this is skipped when the
+ * number of eligible branches is greater than a given threshold.
+ */
+const FastForwardBranchesThreshold = 20
+
 const LastSelectedRepositoryIDKey = 'last-selected-repository-id'

 const defaultSidebarWidth: number = 250
@@ -166,6 +193,9 @@
   /** The pull request updater for the currently selected repository */
   private currentPullRequestUpdater: PullRequestUpdater | null = null

+  /** The ahead/behind updater or the currently selected repository */
+  private currentAheadBehindUpdater: AheadBehindUpdater | null = null
+
   private repositoryState = new Map<string, IRepositoryState>()
   private showWelcomeFlow = false
   private currentPopup: Popup | null = null
@@ -179,6 +209,11 @@
     string,
     RepositorySettingsStore
   >()
+
+  private readonly localRepositoryStateLookup = new Map<
+    number,
+    ILocalRepositoryState
+  >()
   public readonly gitHubUserStore: GitHubUserStore
   private readonly cloningRepositoriesStore: CloningRepositoriesStore
   private readonly emojiStore: EmojiStore
@@ -235,9 +270,11 @@
     | ((repository: Repository | null) => void)
     | null = null

-  private selectedCloneRepositoryTab: CloneRepositoryTab = CloneRepositoryTab.DotCom
+  private selectedCloneRepositoryTab = CloneRepositoryTab.DotCom

   private selectedBranchesTab = BranchesTab.Branches
+  private selectedTheme = ApplicationTheme.Light
+  private isDivergingBranchBannerVisible = false

   public constructor(
     gitHubUserStore: GitHubUserStore,
@@ -319,8 +356,7 @@
     this.accountsStore.onDidError(error => this.emitError(error))

     this.repositoriesStore.onDidUpdate(async () => {
-      const repositories = await this.repositoriesStore.getAll()
-      this.repositories = repositories
+      this.repositories = await this.repositoriesStore.getAll()
       this.updateRepositorySelectionAfterRepositoriesChanged()
       this.emitUpdate()
     })
@@ -395,14 +431,14 @@
         workingDirectory: WorkingDirectoryStatus.fromFiles(
           new Array<WorkingDirectoryFileChange>()
         ),
-        selectedFileID: null,
+        selectedFileIDs: [],
         diff: null,
         contextualCommitMessage: null,
         commitMessage: null,
         coAuthors: [],
         showCoAuthoredBy: false,
       },
-      selectedSection: RepositorySection.Changes,
+      selectedSection: RepositorySectionTab.Changes,
       branchesState: {
         tip: { kind: TipState.Unknown },
         defaultBranch: null,
@@ -412,6 +448,17 @@
         currentPullRequest: null,
         isLoadingPullRequests: false,
       },
+      compareState: {
+        formState: { kind: ComparisonView.None },
+        showBranchList: false,
+        filterText: '',
+        commitSHAs: [],
+        aheadBehindCache: new ComparisonCache(),
+        allBranches: new Array<Branch>(),
+        recentBranches: new Array<Branch>(),
+        defaultBranch: null,
+        inferredComparisonBranch: { branch: null, aheadBehind: null },
+      },
       commitAuthor: null,
       gitHubUsers: new Map<string, IGitHubUser>(),
       commitLookup: new Map<string, Commit>(),
@@ -462,6 +509,18 @@
     })
   }

+  private updateCompareState<K extends keyof ICompareState>(
+    repository: Repository,
+    fn: (state: ICompareState) => Pick<ICompareState, K>
+  ) {
+    this.updateRepositoryState(repository, state => {
+      const compareState = state.compareState
+      const newValues = fn(compareState)
+
+      return { compareState: merge(compareState, newValues) }
+    })
+  }
+
   private updateChangesState<K extends keyof IChangesState>(
     repository: Repository,
     fn: (changesState: IChangesState) => Pick<IChangesState, K>
@@ -526,6 +585,7 @@
         ...this.repositories,
         ...this.cloningRepositoriesStore.repositories,
       ],
+      localRepositoryStateLookup: this.localRepositoryStateLookup,
       windowState: this.windowState,
       windowZoomFactor: this.windowZoomFactor,
       appIsFocused: this.appIsFocused,
@@ -550,6 +610,8 @@
       repositoryFilterText: this.repositoryFilterText,
       selectedCloneRepositoryTab: this.selectedCloneRepositoryTab,
       selectedBranchesTab: this.selectedBranchesTab,
+      isDivergingBranchBannerVisible: this.isDivergingBranchBannerVisible,
+      selectedTheme: this.selectedTheme,
     }
   }

@@ -629,8 +691,12 @@
     return store
   }

-  /** This shouldn't be called directly. See `Dispatcher`. */
-  public async _loadHistory(repository: Repository): Promise<void> {
+  /**
+   * TODO:
+   * This is some legacy code that no longer works with the new Compare tab.
+   * Need to investigate porting this to "refresh" the Compare tab state.
+   */
+  private async _loadHistory(repository: Repository): Promise<void> {
     const gitStore = this.getGitStore(repository)
     await gitStore.loadHistory()

@@ -657,10 +723,247 @@
     this.emitUpdate()
   }

+  private startAheadBehindUpdater(repository: Repository) {
+    if (this.currentAheadBehindUpdater != null) {
+      fatalError(
+        `An ahead/behind updater is already active and cannot start updating on ${
+          repository.name
+        }`
+      )
+
+      return
+    }
+
+    const updater = new AheadBehindUpdater(repository, aheadBehindCache => {
+      this.updateCompareState(repository, state => ({
+        aheadBehindCache,
+      }))
+      this.emitUpdate()
+    })
+
+    this.currentAheadBehindUpdater = updater
+
+    this.currentAheadBehindUpdater.start()
+  }
+
+  private stopAheadBehindUpdate() {
+    const updater = this.currentAheadBehindUpdater
+
+    if (updater != null) {
+      updater.stop()
+      this.currentAheadBehindUpdater = null
+    }
+  }
+
+  /** This shouldn't be called directly. See `Dispatcher`. */
+  public async _initializeCompare(
+    repository: Repository,
+    initialAction?: CompareAction
+  ) {
+    log.debug('[AppStore] initializing compare state')
+
+    const state = this.getRepositoryState(repository)
+
+    const { branchesState, compareState } = state
+    const { tip, currentPullRequest } = branchesState
+    const currentBranch = tip.kind === TipState.Valid ? tip.branch : null
+
+    const allBranches =
+      currentBranch != null
+        ? branchesState.allBranches.filter(b => b.name !== currentBranch.name)
+        : branchesState.allBranches
+    const recentBranches = currentBranch
+      ? branchesState.recentBranches.filter(b => b.name !== currentBranch.name)
+      : branchesState.recentBranches
+
+    const cachedDefaultBranch = branchesState.defaultBranch
+
+    // only include the default branch when comparing if the user is not on the default branch
+    // and it also exists in the repository
+    const defaultBranch =
+      currentBranch != null &&
+      cachedDefaultBranch != null &&
+      currentBranch.name !== cachedDefaultBranch.name
+        ? cachedDefaultBranch
+        : null
+
+    let inferredBranch: Branch | null = null
+    let aheadBehindOfInferredBranch: IAheadBehind | null = null
+    if (tip.kind === TipState.Valid && compareState.aheadBehindCache !== null) {
+      inferredBranch = await inferComparisonBranch(
+        repository,
+        allBranches,
+        currentPullRequest,
+        tip.branch,
+        getRemotes,
+        compareState.aheadBehindCache
+      )
+
+      if (inferredBranch !== null) {
+        aheadBehindOfInferredBranch = compareState.aheadBehindCache.get(
+          tip.branch.tip.sha,
+          inferredBranch.tip.sha
+        )
+      }
+    }
+
+    this.updateCompareState(repository, state => ({
+      allBranches,
+      recentBranches,
+      defaultBranch,
+      inferredComparisonBranch: {
+        branch: inferredBranch,
+        aheadBehind: aheadBehindOfInferredBranch,
+      },
+    }))
+
+    // we only want to show the banner when the the number
+    // commits behind has changed since the last it was visible
+    if (
+      inferredBranch !== null &&
+      aheadBehindOfInferredBranch !== null &&
+      aheadBehindOfInferredBranch.behind > 0
+    ) {
+      const prevInferredBranchState =
+        state.compareState.inferredComparisonBranch
+      if (
+        prevInferredBranchState.aheadBehind === null ||
+        prevInferredBranchState.aheadBehind.behind !==
+          aheadBehindOfInferredBranch.behind
+      ) {
+        this._setDivergingBranchBannerVisibility(true)
+      }
+    } else if (
+      inferComparisonBranch !== null ||
+      aheadBehindOfInferredBranch === null
+    ) {
+      this._setDivergingBranchBannerVisibility(false)
+    }
+
+    const cachedState = compareState.formState
+    const action =
+      initialAction != null ? initialAction : getInitialAction(cachedState)
+    this._executeCompare(repository, action)
+
+    if (currentBranch != null && this.currentAheadBehindUpdater != null) {
+      this.currentAheadBehindUpdater.schedule(currentBranch, allBranches)
+    }
+  }
+
+  /** This shouldn't be called directly. See `Dispatcher`. */
+  public async _executeCompare(
+    repository: Repository,
+    action: CompareAction
+  ): Promise<void> {
+    const gitStore = this.getGitStore(repository)
+    const kind = action.kind
+
+    if (action.kind === CompareActionKind.History) {
+      await gitStore.loadHistory()
+
+      const repoState = this.getRepositoryState(repository).historyState
+      const commits = repoState.history
+
+      this.updateCompareState(repository, state => ({
+        formState: {
+          kind: ComparisonView.None,
+        },
+        commitSHAs: commits,
+      }))
+      return this.emitUpdate()
+    } else if (action.kind === CompareActionKind.Branch) {
+      const comparisonBranch = action.branch
+      const compare = await gitStore.getCompareCommits(
+        comparisonBranch,
+        action.mode
+      )
+
+      this.statsStore.recordBranchComparison()
+      const { branchesState } = this.getRepositoryState(repository)
+
+      if (
+        branchesState.defaultBranch !== null &&
+        comparisonBranch.name === branchesState.defaultBranch.name
+      ) {
+        this.statsStore.recordDefaultBranchComparison()
+      }
+
+      if (compare !== null) {
+        const { ahead, behind } = compare
+        const aheadBehind = { ahead, behind }
+
+        this.updateCompareState(repository, s => ({
+          formState: {
+            comparisonBranch,
+            kind: action.mode,
+            aheadBehind,
+          },
+          commitSHAs: compare.commits.map(commit => commit.sha),
+          filterText: comparisonBranch.name,
+        }))
+
+        const tip = gitStore.tip
+
+        let currentSha: string | null = null
+
+        if (tip.kind === TipState.Valid) {
+          currentSha = tip.branch.tip.sha
+        } else if (tip.kind === TipState.Detached) {
+          currentSha = tip.currentSha
+        }
+
+        if (this.currentAheadBehindUpdater != null && currentSha != null) {
+          const from =
+            action.mode === ComparisonView.Ahead
+              ? comparisonBranch.tip.sha
+              : currentSha
+          const to =
+            action.mode === ComparisonView.Ahead
+              ? currentSha
+              : comparisonBranch.tip.sha
+
+          this.currentAheadBehindUpdater.insert(from, to, aheadBehind)
+        }
+
+        return this.emitUpdate()
+      }
+    } else {
+      return assertNever(action, `Unknown action: ${kind}`)
+    }
+  }
+
+  /** This shouldn't be called directly. See `Dispatcher`. */
+  public _updateCompareForm<K extends keyof ICompareFormUpdate>(
+    repository: Repository,
+    newState: Pick<ICompareFormUpdate, K>
+  ) {
+    this.updateCompareState(repository, state => {
+      return merge(state, newState)
+    })
+
+    this.emitUpdate()
+  }
+
   /** This shouldn't be called directly. See `Dispatcher`. */
-  public _loadNextHistoryBatch(repository: Repository): Promise<void> {
+  public async _loadNextHistoryBatch(repository: Repository): Promise<void> {
     const gitStore = this.getGitStore(repository)
-    return gitStore.loadNextHistoryBatch()
+
+    const state = this.getRepositoryState(repository)
+    const { formState } = state.compareState
+    if (formState.kind === ComparisonView.None) {
+      const commits = state.compareState.commitSHAs
+      const lastCommitSha = commits[commits.length - 1]
+
+      const newCommits = await gitStore.loadCommitBatch(lastCommitSha)
+      if (newCommits == null) {
+        return
+      }
+
+      this.updateCompareState(repository, state => ({
+        commitSHAs: commits.concat(newCommits),
+      }))
+      this.emitUpdate()
+    }
   }

   /** This shouldn't be called directly. See `Dispatcher`. */
@@ -860,10 +1163,12 @@
     // ensures we clean up the existing background fetcher correctly (if set)
     this.stopBackgroundFetching()
     this.stopPullRequestUpdater()
+    this.stopAheadBehindUpdate()

     this.startBackgroundFetching(repository, !previouslySelectedRepository)
     this.startPullRequestUpdater(repository)

+    this.startAheadBehindUpdater(repository)
     this.refreshMentionables(repository)

     this.addUpstreamRemoteIfNeeded(repository)
@@ -1081,9 +1386,12 @@
         ? imageDiffTypeDefault
         : parseInt(imageDiffTypeValue)

+    this.selectedTheme = getPersistedTheme()
+
     this.emitUpdateNow()

     this.accountsStore.refresh()
+    this.refreshAllRepositories()
   }

   private async getSelectedExternalEditor(): Promise<ExternalEditor | null> {
@@ -1231,24 +1539,39 @@
         })
         .sort((x, y) => caseInsensitiveCompare(x.path, y.path))

-      const workingDirectory = WorkingDirectoryStatus.fromFiles(mergedFiles)
+      // Collect all the currently available file ids into a set to avoid O(N)
+      // lookups using .find on the mergedFiles array.
+      const mergedFileIds = new Set(mergedFiles.map(x => x.id))

-      let selectedFileID = state.selectedFileID
-      const matchedFile = mergedFiles.find(x => x.id === selectedFileID)
+      // The previously selected files might not be available in the working
+      // directory any more due to having been committed or discarded so we'll
+      // do a pass over and filter out any selected files that aren't available.
+      let selectedFileIDs = state.selectedFileIDs.filter(id =>
+        mergedFileIds.has(id)
+      )

-      // Select the first file if we don't have anything selected.
-      if ((!selectedFileID || !matchedFile) && mergedFiles.length) {
-        selectedFileID = mergedFiles[0].id || null
+      // Select the first file if we don't have anything selected and we
+      // have something to select.
+      if (selectedFileIDs.length === 0 && mergedFiles.length > 0) {
+        selectedFileIDs = [mergedFiles[0].id]
       }

-      // The file selection could have changed if the previously selected file
-      // is no longer selectable (it was reverted or committed) but if it hasn't
-      // changed we can reuse the diff.
-      const sameSelectedFileExists = state.selectedFileID
-        ? workingDirectory.findFileWithID(state.selectedFileID)
-        : null
-      const diff = sameSelectedFileExists ? state.diff : null
-      return { workingDirectory, selectedFileID, diff }
+      // The file selection could have changed if the previously selected files
+      // are no longer selectable (they were discarded or committed) but if they
+      // were not changed we can reuse the diff. Note, however that we only render
+      // a diff when a single file is selected. If the previous selection was
+      // a single file with the same id as the current selection we can keep the
+      // diff we had, if not we'll clear it.
+      const workingDirectory = WorkingDirectoryStatus.fromFiles(mergedFiles)
+
+      const diff =
+        selectedFileIDs.length === 1 &&
+        state.selectedFileIDs.length === 1 &&
+        state.selectedFileIDs[0] === selectedFileIDs[0]
+          ? state.diff
+          : null
+
+      return { workingDirectory, selectedFileIDs, diff }
     })
     this.emitUpdate()

@@ -1258,14 +1581,14 @@
   /** This shouldn't be called directly. See `Dispatcher`. */
   public async _changeRepositorySection(
     repository: Repository,
-    selectedSection: RepositorySection
+    selectedSection: RepositorySectionTab
   ): Promise<void> {
     this.updateRepositoryState(repository, state => ({ selectedSection }))
     this.emitUpdate()

-    if (selectedSection === RepositorySection.History) {
+    if (selectedSection === RepositorySectionTab.History) {
       return this.refreshHistorySection(repository)
-    } else if (selectedSection === RepositorySection.Changes) {
+    } else if (selectedSection === RepositorySectionTab.Changes) {
       return this.refreshChangesSection(repository, {
         includingStatus: true,
         clearPartialState: false,
@@ -1276,10 +1599,10 @@
   /** This shouldn't be called directly. See `Dispatcher`. */
   public async _changeChangesSelection(
     repository: Repository,
-    selectedFile: WorkingDirectoryFileChange | null
+    selectedFiles: WorkingDirectoryFileChange[]
   ): Promise<void> {
     this.updateChangesState(repository, state => ({
-      selectedFileID: selectedFile ? selectedFile.id : null,
+      selectedFileIDs: selectedFiles.map(file => file.id),
       diff: null,
     }))
     this.emitUpdate()
@@ -1297,15 +1620,23 @@
   ): Promise<void> {
     const stateBeforeLoad = this.getRepositoryState(repository)
     const changesStateBeforeLoad = stateBeforeLoad.changesState
-    const selectedFileIDBeforeLoad = changesStateBeforeLoad.selectedFileID
-    if (!selectedFileIDBeforeLoad) {
+    const selectedFileIDsBeforeLoad = changesStateBeforeLoad.selectedFileIDs
+
+    // We only render diffs when a single file is selected.
+    if (selectedFileIDsBeforeLoad.length !== 1) {
+      if (changesStateBeforeLoad.diff !== null) {
+        this.updateChangesState(repository, state => ({ diff: null }))
+        this.emitUpdate()
+      }
       return
     }

+    const selectedFileIdBeforeLoad = selectedFileIDsBeforeLoad[0]
     const selectedFileBeforeLoad = changesStateBeforeLoad.workingDirectory.findFileWithID(
-      selectedFileIDBeforeLoad
+      selectedFileIdBeforeLoad
     )
-    if (!selectedFileBeforeLoad) {
+
+    if (selectedFileBeforeLoad === null) {
       return
     }

@@ -1316,21 +1647,24 @@

     const stateAfterLoad = this.getRepositoryState(repository)
     const changesState = stateAfterLoad.changesState
-    const selectedFileID = changesState.selectedFileID

-    // A different file could have been selected while we were loading the diff
-    // in which case we no longer care about the diff we just loaded.
-    if (!selectedFileID) {
+    // A different file (or files) could have been selected while we were
+    // loading the diff in which case we no longer care about the diff we
+    // just loaded.
+    if (changesState.selectedFileIDs.length !== 1) {
       return
     }
-    if (selectedFileID !== selectedFileIDBeforeLoad) {
+
+    const selectedFileID = changesState.selectedFileIDs[0]
+
+    if (selectedFileID !== selectedFileIdBeforeLoad) {
       return
     }

     const currentlySelectedFile = changesState.workingDirectory.findFileWithID(
       selectedFileID
     )
-    if (!currentlySelectedFile) {
+    if (currentlySelectedFile === null) {
       return
     }

@@ -1453,8 +1787,8 @@
       )

       const workingDirectory = WorkingDirectoryStatus.fromFiles(newFiles)
-      const diff = state.selectedFileID ? state.diff : null
-      return { workingDirectory, diff }
+
+      return { workingDirectory }
     })

     this.emitUpdate()
@@ -1494,9 +1828,9 @@
     const section = state.selectedSection
     let refreshSectionPromise: Promise<void>

-    if (section === RepositorySection.History) {
+    if (section === RepositorySectionTab.History) {
       refreshSectionPromise = this.refreshHistorySection(repository)
-    } else if (section === RepositorySection.Changes) {
+    } else if (section === RepositorySectionTab.Changes) {
       refreshSectionPromise = this.refreshChangesSection(repository, {
         includingStatus: false,
         clearPartialState: false,
@@ -1515,6 +1849,46 @@

     this._updateCurrentPullRequest(repository)
     this.updateMenuItemLabels(repository)
+    this._initializeCompare(repository)
+    this.refreshRepositoryState([repository])
+  }
+
+  public refreshAllRepositories() {
+    return this.refreshRepositoryState(this.repositories)
+  }
+
+  private async refreshRepositoryState(
+    repositories: ReadonlyArray<Repository>
+  ): Promise<void> {
+    if (!enableRepoInfoIndicators()) {
+      return
+    }
+
+    const promises = []
+
+    for (const repo of repositories) {
+      promises.push(
+        this.withAuthenticatingUser(repo, async (repo, account) => {
+          const gitStore = this.getGitStore(repo)
+          const lookup = this.localRepositoryStateLookup
+          if (this.shouldBackgroundFetch(repo)) {
+            await gitStore.fetch(account, true)
+          }
+
+          const status = await gitStore.loadStatus()
+          if (status !== null) {
+            lookup.set(repo.id, {
+              aheadBehind: gitStore.aheadBehind,
+              changedFilesCount: status.workingDirectory.files.length,
+            })
+          }
+        })
+      )
+    }
+
+    await Promise.all(promises)
+
+    this.emitUpdate()
   }

   /**
@@ -1703,6 +2077,7 @@
       await this._refreshRepository(repository)
     } finally {
       this.updateCheckoutProgress(repository, null)
+      this._initializeCompare(repository, { kind: CompareActionKind.History })
     }

     return repository
@@ -1919,7 +2294,7 @@
         const refreshWeight = 0.1

         // Scale pull and fetch weights to be between 0 and 0.9.
-        const scale = 1 / (pushWeight + fetchWeight) * (1 - refreshWeight)
+        const scale = (1 / (pushWeight + fetchWeight)) * (1 - refreshWeight)

         pushWeight *= scale
         fetchWeight *= scale
@@ -2103,7 +2478,7 @@
           const refreshWeight = 0.1

           // Scale pull and fetch weights to be between 0 and 0.9.
-          const scale = 1 / (pullWeight + fetchWeight) * (1 - refreshWeight)
+          const scale = (1 / (pullWeight + fetchWeight)) * (1 - refreshWeight)

           pullWeight *= scale
           fetchWeight *= scale
@@ -2163,18 +2538,24 @@
     const currentBranchName =
       tip.kind === TipState.Valid ? tip.branch.name : null

-    // A branch is only eligible for being fast forwarded if:
-    //  1. It's local.
-    //  2. It's not the current branch.
-    //  3. It has an upstream.
-    //  4. It's not ahead of its upstream.
-    const eligibleBranches = branches.filter(b => {
-      return (
-        b.type === BranchType.Local &&
-        b.name !== currentBranchName &&
-        b.upstream
+    let eligibleBranches = branches.filter(b =>
+      eligibleForFastForward(b, currentBranchName)
+    )
+
+    if (eligibleBranches.length >= FastForwardBranchesThreshold) {
+      log.info(
+        `skipping fast-forward for all branches as there are ${
+          eligibleBranches.length
+        } local branches - this will run again when there are less than ${FastForwardBranchesThreshold} local branches tracking remotes`
       )
-    })
+
+      const defaultBranch = state.branchesState.defaultBranch
+      eligibleBranches =
+        defaultBranch != null &&
+        eligibleForFastForward(defaultBranch, currentBranchName)
+          ? [defaultBranch]
+          : []
+    }

     for (const branch of eligibleBranches) {
       const aheadBehind = await getBranchAheadBehind(repository, branch)
@@ -2183,6 +2564,8 @@
       }

       const { ahead, behind } = aheadBehind
+      // Only perform the fast forward if the branch is behind it's upstream
+      // branch and has no local commits.
       if (ahead === 0 && behind > 0) {
         // At this point we're guaranteed this is non-null since we've filtered
         // out any branches will null upstreams above when creating
@@ -2575,14 +2958,14 @@
     return shell.openExternal(url)
   }

-  /** Takes a repository path and opens it using the user's configured editor */
-  public async _openInExternalEditor(path: string): Promise<void> {
+  /** Open a path to a repository or file using the user's configured editor */
+  public async _openInExternalEditor(fullPath: string): Promise<void> {
     const selectedExternalEditor =
       this.getState().selectedExternalEditor || null

     try {
       const match = await findEditorOrDefault(selectedExternalEditor)
-      await launchExternalEditor(path, match)
+      await launchExternalEditor(fullPath, match)
     } catch (error) {
       this.emitError(error)
     }
@@ -2668,6 +3051,18 @@
     this.emitUpdate()
   }

+  public _setDivergingBranchBannerVisibility(visible: boolean) {
+    if (this.isDivergingBranchBannerVisible !== visible) {
+      this.isDivergingBranchBannerVisible = visible
+
+      if (visible) {
+        this._recordDivergingBranchBannerDisplayed()
+      }
+
+      this.emitUpdate()
+    }
+  }
+
   public _reportStats() {
     return this.statsStore.reportStats(this.accounts, this.repositories)
   }
@@ -2676,7 +3071,10 @@
     return this.statsStore.recordLaunchStats(stats)
   }

-  public async _ignore(repository: Repository, pattern: string): Promise<void> {
+  public async _ignore(
+    repository: Repository,
+    pattern: string | string[]
+  ): Promise<void> {
     const repoSettingsStore = this.getRepositorySettingsStore(repository)

     await repoSettingsStore.ignore(pattern)
@@ -3283,16 +3681,25 @@
       head.gitHubRepository.cloneURL === gitHubRepository.cloneURL

     if (isRefInThisRepo) {
-      // We need to fetch FIRST because someone may have created a PR since the last fetch
       const defaultRemote = await getDefaultRemote(repository)
-      // TODO: I think we could skip this fetch if we know that we have the branch locally
-      // already. That way we'd match the behavior of checking out a branch.
-      if (defaultRemote) {
-        await this._fetchRemote(
-          repository,
-          defaultRemote,
-          FetchType.UserInitiatedTask
-        )
+      // if we don't have a default remote here, it's probably going
+      // to just crash and burn on checkout, but that's okay
+      if (defaultRemote != null) {
+        // the remote ref will be something like `origin/my-cool-branch`
+        const remoteRef = `${defaultRemote.name}/${head.ref}`
+        const gitStore = this.getGitStore(repository)
+
+        const remoteRefExists =
+          gitStore.allBranches.find(branch => branch.name === remoteRef) != null
+
+        // only try a fetch here if we can't find the ref
+        if (!remoteRefExists) {
+          await this._fetchRemote(
+            repository,
+            defaultRemote,
+            FetchType.UserInitiatedTask
+          )
+        }
       }
       await this._checkoutBranch(repository, head.ref)
     } else if (head.gitHubRepository != null) {
@@ -3316,7 +3723,7 @@
         )

         log.error(error.message)
-        this.emitError(error)
+        return this.emitError(error)
       }

       await this._fetchRemote(repository, remote, FetchType.UserInitiatedTask)
@@ -3338,6 +3745,8 @@

       await this._checkoutBranch(repository, localBranchName)
     }
+
+    this.statsStore.recordPRBranchCheckout()
   }

   /**
@@ -3365,8 +3774,104 @@
     this.getGitStore(repository).setCoAuthors(coAuthors)
     return Promise.resolve()
   }
+
+  /**
+   * Increments the `mergeIntoCurrentBranchMenuCount` metric
+   */
+  public _recordMenuInitiatedMerge() {
+    this.statsStore.recordMenuInitiatedMerge()
+  }
+
+  /**
+   * Increments the `updateFromDefaultBranchMenuCount` metric
+   */
+  public _recordMenuInitiatedUpdate() {
+    this.statsStore.recordMenuInitiatedUpdate()
+  }
+
+  /**
+   * Increments the `mergesInitiatedFromComparison` metric
+   */
+  public _recordCompareInitiatedMerge() {
+    this.statsStore.recordCompareInitiatedMerge()
+  }
+
+  /**
+   * Set the application-wide theme
+   */
+  public _setSelectedTheme(theme: ApplicationTheme) {
+    setPersistedTheme(theme)
+    this.selectedTheme = theme
+    this.emitUpdate()
+
+    return Promise.resolve()
+  }
+
+  /**
+   * Increments either the `repoWithIndicatorClicked` or
+   * the `repoWithoutIndicatorClicked` metric
+   */
+  public _recordRepoClicked(repoHasIndicator: boolean) {
+    this.statsStore.recordRepoClicked(repoHasIndicator)
+  }
+
+  /** The number of times the user dismisses the diverged branch notification
+   * Increments the `divergingBranchBannerDismissal` metric
+   */
+  public _recordDivergingBranchBannerDismissal() {
+    this.statsStore.recordDivergingBranchBannerDismissal()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerDisplayed` metric
+   */
+  public _recordDivergingBranchBannerDisplayed() {
+    this.statsStore.recordDivergingBranchBannerDisplayed()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInitiatedCompare` metric
+   */
+  public _recordDivergingBranchBannerInitiatedCompare() {
+    this.statsStore.recordDivergingBranchBannerInitiatedCompare()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInfluencedMerge` metric
+   */
+  public _recordDivergingBranchBannerInfluencedMerge() {
+    this.statsStore.recordDivergingBranchBannerInfluencedMerge()
+  }
+
+  /**
+   * Increments the `divergingBranchBannerInitatedMerge` metric
+   */
+  public _recordDivergingBranchBannerInitatedMerge() {
+    this.statsStore.recordDivergingBranchBannerInitatedMerge()
+  }
 }

 function forkPullRequestRemoteName(remoteName: string) {
   return `${ForkedRemotePrefix}${remoteName}`
 }
+
+/**
+ * Map the cached state of the compare view to an action
+ * to perform which is then used to compute the compare
+ * view contents.
+ */
+function getInitialAction(
+  cachedState: IDisplayHistory | ICompareBranch
+): CompareAction {
+  if (cachedState.kind === ComparisonView.None) {
+    return {
+      kind: CompareActionKind.History,
+    }
+  }
+
+  return {
+    kind: CompareActionKind.Branch,
+    branch: cachedState.comparisonBranch,
+    mode: cachedState.kind,
+  }
+}
merged
  result 100644 f448ce132d5fa114bc19fbf191a3c0026b4e202a app/src/lib/stores/git-store.ts
  our    100644 d3b2a0b254bf08c1768c0f56d4b7602873766d56 app/src/lib/stores/git-store.ts
@@ -3,11 +3,16 @@
 import { Disposable } from 'event-kit'
 import { Repository } from '../../models/repository'
 import { WorkingDirectoryFileChange, AppFileStatus } from '../../models/status'
-import { Branch, BranchType } from '../../models/branch'
+import {
+  Branch,
+  BranchType,
+  IAheadBehind,
+  ICompareResult,
+} from '../../models/branch'
 import { Tip, TipState } from '../../models/tip'
 import { Commit } from '../../models/commit'
 import { IRemote } from '../../models/remote'
-import { IFetchProgress, IRevertProgress } from '../app-state'
+import { IFetchProgress, IRevertProgress, ComparisonView } from '../app-state'

 import { IAppShell } from '../app-shell'
 import { ErrorWithMetadata, IErrorMetadata } from '../error-with-metadata'
@@ -24,7 +29,6 @@
   getRecentBranches,
   getBranches,
   deleteRef,
-  IAheadBehind,
   getCommits,
   merge,
   setRemoteURL,
@@ -47,6 +51,10 @@
   getTrailerSeparatorCharacters,
   parseSingleUnfoldedTrailer,
   isCoAuthoredByTrailer,
+  getAheadBehind,
+  revRange,
+  revSymmetricDifference,
+  getSymbolicRef,
 } from '../git'
 import { IGitAccount } from '../git/authentication'
 import { RetryAction, RetryActionType } from '../retry-actions'
@@ -150,8 +158,10 @@

     this.requestsInFight.add(LoadingHistoryRequestKey)

+    const range = revRange('HEAD', mergeBase)
+
     const commits = await this.performFailableOperation(() =>
-      getCommits(this.repository, `HEAD..${mergeBase}`, CommitBatchSize)
+      getCommits(this.repository, range, CommitBatchSize)
     )
     if (commits == null) {
       return
@@ -173,11 +183,8 @@
       this._history = [...commits.map(c => c.sha), ...remainingHistory]
     }

-    this.storeCommits(commits)
-
+    this.storeCommits(commits, true)
     this.requestsInFight.delete(LoadingHistoryRequestKey)
-
-    this.emitNewCommitsLoaded(commits)
     this.emitUpdate()
   }

@@ -214,11 +221,8 @@
     }

     this._history = [...commits.map(c => c.sha), ...existingHistory]
-    this.storeCommits(commits)
-
+    this.storeCommits(commits, true)
     this.requestsInFight.delete(LoadingHistoryRequestKey)
-
-    this.emitNewCommitsLoaded(commits)
     this.emitUpdate()
   }

@@ -248,12 +252,35 @@
     }

     this._history = this._history.concat(commits.map(c => c.sha))
-    this.storeCommits(commits)
+    this.storeCommits(commits, true)
+    this.requestsInFight.delete(requestKey)
+    this.emitUpdate()
+  }
+
+  /** Load a batch of commits from the repository, using the last known commit in the list. */
+  public async loadCommitBatch(lastSHA: string) {
+    if (this.requestsInFight.has(LoadingHistoryRequestKey)) {
+      return null
+    }
+
+    const requestKey = `history/compare/${lastSHA}`
+    if (this.requestsInFight.has(requestKey)) {
+      return null
+    }
+
+    this.requestsInFight.add(requestKey)
+
+    const commits = await this.performFailableOperation(() =>
+      getCommits(this.repository, `${lastSHA}^`, CommitBatchSize)
+    )

     this.requestsInFight.delete(requestKey)
+    if (!commits) {
+      return null
+    }

-    this.emitNewCommitsLoaded(commits)
-    this.emitUpdate()
+    this.storeCommits(commits, false)
+    return commits.map(c => c.sha)
   }

   /** The list of ordered SHAs. */
@@ -332,24 +359,51 @@
     return allBranchesWithUpstream
   }

-  private refreshDefaultBranch() {
-    let defaultBranchName: string | null = 'master'
-    const gitHubRepository = this.repository.gitHubRepository
-    if (gitHubRepository && gitHubRepository.defaultBranch) {
-      defaultBranchName = gitHubRepository.defaultBranch
+  private async refreshDefaultBranch() {
+    const defaultBranchName = await this.resolveDefaultBranch()
+
+    // Find the default branch among all of our branches, giving
+    // priority to local branches by sorting them before remotes
+    this._defaultBranch =
+      this._allBranches
+        .filter(b => b.name === defaultBranchName)
+        .sort((x, y) => compare(x.type, y.type))
+        .shift() || null
+  }
+
+  /**
+   * Resolve the default branch name for the current repository,
+   * using the available API data, remote information or branch
+   * name conventionns.
+   */
+  private async resolveDefaultBranch(): Promise<string> {
+    const { gitHubRepository } = this.repository
+    if (gitHubRepository && gitHubRepository.defaultBranch != null) {
+      return gitHubRepository.defaultBranch
     }

-    if (defaultBranchName) {
-      // Find the default branch among all of our branches, giving
-      // priority to local branches by sorting them before remotes
-      this._defaultBranch =
-        this._allBranches
-          .filter(b => b.name === defaultBranchName)
-          .sort((x, y) => compare(x.type, y.type))
-          .shift() || null
-    } else {
-      this._defaultBranch = null
+    if (this.remote != null) {
+      // the Git server should use [remote]/HEAD to advertise
+      // it's default branch, so see if it exists and matches
+      // a valid branch on the remote and attempt to use that
+      const remoteNamespace = `refs/remotes/${this.remote.name}/`
+      const match = await getSymbolicRef(
+        this.repository,
+        `${remoteNamespace}HEAD`
+      )
+      if (
+        match != null &&
+        match.length > remoteNamespace.length &&
+        match.startsWith(remoteNamespace)
+      ) {
+        // strip out everything related to the remote because this
+        // is likely to be a tracked branch locally
+        // e.g. `master`, `develop`, etc
+        return match.substr(remoteNamespace.length)
+      }
     }
+
+    return 'master'
   }

   private refreshRecentBranches(
@@ -416,9 +470,9 @@

     let localCommits: ReadonlyArray<Commit> | undefined
     if (branch.upstream) {
-      const revRange = `${branch.upstream}..${branch.name}`
+      const range = revRange(branch.upstream, branch.name)
       localCommits = await this.performFailableOperation(() =>
-        getCommits(this.repository, revRange, CommitBatchSize)
+        getCommits(this.repository, range, CommitBatchSize)
       )
     } else {
       localCommits = await this.performFailableOperation(() =>
@@ -447,10 +501,17 @@
   }

   /** Store the given commits. */
-  private storeCommits(commits: ReadonlyArray<Commit>) {
+  private storeCommits(
+    commits: ReadonlyArray<Commit>,
+    emitUpdate: boolean = false
+  ) {
     for (const commit of commits) {
       this.commitLookup.set(commit.sha, commit)
     }
+
+    if (emitUpdate) {
+      this.emitNewCommitsLoaded(commits)
+    }
   }

   private async undoFirstCommit(
@@ -1238,4 +1299,50 @@
       setRemoteURL(this.repository, UpstreamRemoteName, url)
     )
   }
+
+  /**
+   * Returns the commits associated with `branch` and ahead/behind info;
+   */
+  public async getCompareCommits(
+    branch: Branch,
+    compareType: ComparisonView.Ahead | ComparisonView.Behind
+  ): Promise<ICompareResult | null> {
+    if (this.tip.kind !== TipState.Valid) {
+      return null
+    }
+
+    const base = this.tip.branch
+    const aheadBehind = await getAheadBehind(
+      this.repository,
+      revSymmetricDifference(base.name, branch.name)
+    )
+
+    if (aheadBehind == null) {
+      return null
+    }
+
+    const revisionRange =
+      compareType === ComparisonView.Ahead
+        ? revRange(branch.name, base.name)
+        : revRange(base.name, branch.name)
+    const commitsToLoad =
+      compareType === ComparisonView.Ahead
+        ? aheadBehind.ahead
+        : aheadBehind.behind
+    const commits = await getCommits(
+      this.repository,
+      revisionRange,
+      commitsToLoad
+    )
+
+    if (commits.length > 0) {
+      this.storeCommits(commits, true)
+    }
+
+    return {
+      commits,
+      ahead: aheadBehind.ahead,
+      behind: aheadBehind.behind,
+    }
+  }
 }
added in remote
  their  100644 2f4ef7dade5922f6825e9c4d3b0dd19216a44bb3 app/src/lib/stores/helpers/ahead-behind-updater.ts
@@ -0,0 +1,125 @@
+const queue: (config: QueueConfig) => Queue = require('queue')
+import { revSymmetricDifference } from '../../../lib/git'
+
+// eslint-disable-next-line typescript/interface-name-prefix
+interface QueueConfig {
+  // Max number of jobs the queue should process concurrently, defaults to Infinity.
+  readonly concurrency: number
+  // Ensures the queue is always running if jobs are available.
+  // Useful in situations where you are using a queue only for concurrency control.
+  readonly autostart: boolean
+}
+
+// eslint-disable-next-line typescript/interface-name-prefix
+interface Queue extends NodeJS.EventEmitter {
+  readonly length: number
+
+  start(): void
+  end(): void
+  push<T>(
+    func: (callback: (error: Error | null, result: T) => void) => void
+  ): void
+}
+
+import { Repository } from '../../../models/repository'
+import { getAheadBehind } from '../../../lib/git'
+import { Branch, IAheadBehind } from '../../../models/branch'
+import { ComparisonCache } from '../../comparison-cache'
+
+export class AheadBehindUpdater {
+  private comparisonCache = new ComparisonCache()
+
+  private aheadBehindQueue = queue({
+    concurrency: 1,
+    autostart: true,
+  })
+
+  public constructor(
+    private repository: Repository,
+    private onCacheUpdate: (cache: ComparisonCache) => void
+  ) {}
+
+  public start() {
+    this.aheadBehindQueue.on('success', (result: IAheadBehind | null) => {
+      if (result != null) {
+        this.onCacheUpdate(this.comparisonCache)
+      }
+    })
+
+    this.aheadBehindQueue.on('error', (err: Error) => {
+      log.debug(
+        '[AheadBehindUpdater] an error with the queue was reported',
+        err
+      )
+    })
+
+    this.aheadBehindQueue.on('end', (err?: Error) => {
+      if (err != null) {
+        log.debug(`[AheadBehindUpdater] ended with an error`, err)
+      }
+    })
+
+    this.aheadBehindQueue.start()
+  }
+
+  public stop() {
+    this.aheadBehindQueue.end()
+  }
+
+  private executeTask = (
+    from: string,
+    to: string,
+    callback: (error: Error | null, result: IAheadBehind | null) => void
+  ) => {
+    if (this.comparisonCache.has(from, to)) {
+      return
+    }
+
+    const range = revSymmetricDifference(from, to)
+    getAheadBehind(this.repository, range).then(result => {
+      if (result != null) {
+        this.comparisonCache.set(from, to, result)
+      } else {
+        log.debug(
+          `[AheadBehindUpdater] unable to cache '${range}' as no result returned`
+        )
+      }
+      callback(null, result)
+    })
+  }
+
+  public insert(from: string, to: string, value: IAheadBehind) {
+    if (this.comparisonCache.has(from, to)) {
+      return
+    }
+
+    this.comparisonCache.set(from, to, value)
+  }
+
+  public schedule(currentBranch: Branch, branches: ReadonlyArray<Branch>) {
+    // remove any queued work to prioritize this new set of tasks
+    this.aheadBehindQueue.end()
+
+    const from = currentBranch.tip.sha
+
+    const branchesNotInCache = branches
+      .map(b => b.tip.sha)
+      .filter(to => !this.comparisonCache.has(from, to))
+
+    const newRefsToCompare = new Set<string>(branchesNotInCache)
+
+    log.debug(
+      `[AheadBehindUpdater] - found ${
+        newRefsToCompare.size
+      } comparisons to perform`
+    )
+
+    for (const sha of newRefsToCompare) {
+      this.aheadBehindQueue.push<IAheadBehind | null>(callback =>
+        requestIdleCallback(() => {
+          this.executeTask(from, sha, callback)
+        })
+      )
+    }
+  }
+}
added in remote
  their  100644 6209dbef0a2ebc954b665597db7311541fdd197c app/src/lib/stores/helpers/infer-comparison-branch.ts
@@ -0,0 +1,149 @@
+import { Branch } from '../../../models/branch'
+import { PullRequest } from '../../../models/pull-request'
+import { GitHubRepository } from '../../../models/github-repository'
+import { IRemote } from '../../../models/remote'
+import { Repository } from '../../../models/repository'
+import { ComparisonCache } from '../../comparison-cache'
+
+type RemotesGetter = (repository: Repository) => Promise<ReadonlyArray<IRemote>>
+
+/**
+ * Infers which branch to use as the comparison branch
+ *
+ * The branch returned is determined by the following conditions:
+ * 1. Given a pull request -> target branch of PR
+ * 2. Given a forked repository -> default branch on `upstream`
+ * 3. Given a hosted repository -> default branch on `origin`
+ * 4. Fallback -> `master` branch
+ *
+ * @param repository The repository the branch belongs to
+ * @param branches The list of all branches for the repository
+ * @param currentPullRequest The pull request to use for finding the branch
+ * @param currentBranch The branch we want the parent of
+ * @param getRemotes callback used to get all remotes for the current repository
+ * @param comparisonCache cache used to get the number of commits ahead/behind the current branch is from another branch
+ */
+export async function inferComparisonBranch(
+  repository: Repository,
+  branches: ReadonlyArray<Branch>,
+  currentPullRequest: PullRequest | null,
+  currentBranch: Branch | null,
+  getRemotes: RemotesGetter,
+  comparisonCache: ComparisonCache
+): Promise<Branch | null> {
+  if (currentPullRequest !== null) {
+    return getTargetBranchOfPullRequest(branches, currentPullRequest)
+  }
+
+  const ghRepo = repository.gitHubRepository
+  if (ghRepo !== null) {
+    return ghRepo.fork === true && currentBranch !== null
+      ? getDefaultBranchOfFork(
+          repository,
+          branches,
+          currentBranch,
+          getRemotes,
+          comparisonCache
+        )
+      : getDefaultBranchOfGitHubRepo(branches, ghRepo)
+  }
+
+  return getMasterBranch(branches)
+}
+
+function getMasterBranch(branches: ReadonlyArray<Branch>): Branch | null {
+  return findBranch(branches, 'master')
+}
+
+function getDefaultBranchOfGitHubRepo(
+  branches: ReadonlyArray<Branch>,
+  ghRepository: GitHubRepository
+): Branch | null {
+  if (ghRepository.defaultBranch === null) {
+    return null
+  }
+
+  return findBranch(branches, ghRepository.defaultBranch)
+}
+
+function getTargetBranchOfPullRequest(
+  branches: ReadonlyArray<Branch>,
+  pr: PullRequest
+): Branch | null {
+  return findBranch(branches, pr.base.ref)
+}
+
+/**
+ * For `inferComparisonBranch` case where inferring for a forked repository
+ *
+ * Returns the default branch of the fork if it's ahead of `currentBranch`.
+ * Otherwise, the default branch of the parent is returned.
+ */
+async function getDefaultBranchOfFork(
+  repository: Repository,
+  branches: ReadonlyArray<Branch>,
+  currentBranch: Branch,
+  getRemotes: RemotesGetter,
+  comparisonCache: ComparisonCache
+): Promise<Branch | null> {
+  // this is guaranteed to exist since this function
+  // is only called if the ghRepo is not null
+  const ghRepo = repository.gitHubRepository!
+  const defaultBranch = getDefaultBranchOfGitHubRepo(branches, ghRepo)
+  if (defaultBranch === null) {
+    return getMasterBranch(branches)
+  }
+
+  const aheadBehind = comparisonCache.get(
+    currentBranch.tip.sha,
+    defaultBranch.tip.sha
+  )
+
+  // we want to return the default branch of the fork if it's ahead
+  // of the current branch; see https://github.com/desktop/desktop/issues/4766#issue-325764371
+  if (aheadBehind !== null && aheadBehind.ahead > 0) {
+    return defaultBranch
+  }
+
+  const potentialDefault = await getDefaultBranchOfForkedGitHubRepo(
+    repository,
+    branches,
+    getRemotes
+  )
+
+  return potentialDefault
+}
+
+async function getDefaultBranchOfForkedGitHubRepo(
+  repository: Repository,
+  branches: ReadonlyArray<Branch>,
+  getRemotes: RemotesGetter
+): Promise<Branch | null> {
+  const parentRepo =
+    repository.gitHubRepository !== null
+      ? repository.gitHubRepository.parent
+      : null
+
+  if (parentRepo === null) {
+    return null
+  }
+
+  const remotes = await getRemotes(repository)
+  const remote = remotes.find(r => r.url === parentRepo.cloneURL)
+
+  if (remote === undefined) {
+    log.warn(`Could not find remote with URL ${parentRepo.cloneURL}.`)
+    return null
+  }
+
+  const branchToFind = `${remote.name}/${parentRepo.defaultBranch}`
+
+  return findBranch(branches, branchToFind)
+}
+
+function findBranch(
+  branches: ReadonlyArray<Branch>,
+  name: string
+): Branch | null {
+  return branches.find(b => b.name === name) || null
+}
merged
  result 100644 d9edf0247ea7c33ae2b508f876aa977d8a81d6d4 app/src/lib/stores/pull-request-store.ts
  our    100644 1feeeb2600084a5b31ad70f91d96038d1c405539 app/src/lib/stores/pull-request-store.ts
@@ -67,7 +67,6 @@
       this.emitUpdate(githubRepo)
     } catch (error) {
       log.warn(`Error refreshing pull requests for '${repository.name}'`, error)
-      this.emitError(error)
     } finally {
       this.updateActiveFetchCount(githubRepo, Decrement)
     }
@@ -104,7 +103,11 @@
   ): Promise<void> {
     const prs = await this.fetchPullRequestsFromCache(repository)

-    await this.fetchAndCachePullRequestStatus(prs, repository, account)
+    try {
+      await this.fetchAndCachePullRequestStatus(prs, repository, account)
+    } catch (e) {
+      log.warn('Error updating pull request statuses', e)
+    }
   }

   /** Gets the pull requests against the given repository. */
@@ -293,6 +296,7 @@
       return {
         id: x.id,
         state: x.state,
+        description: x.description,
       }
     })

merged
  result 100644 9eb2eaebe8b63f5219a301f0c68eb2d0a96d2fea app/src/lib/stores/repository-settings-store.ts
  our    100644 ce2118f6066face1e430be4ad265a220a669fcf8 app/src/lib/stores/repository-settings-store.ts
@@ -75,12 +75,15 @@
   }

   /** Ignore the given path or pattern. */
-  public async ignore(pattern: string): Promise<void> {
+  public async ignore(patterns: string | string[]): Promise<void> {
     const text = (await this.readGitIgnore()) || ''
     const repository = this._repository
     const currentContents = await formatGitIgnoreContents(text, repository)
+
+    const newPatternText =
+      patterns instanceof Array ? patterns.join('\n') : patterns
     const newText = await formatGitIgnoreContents(
-      `${currentContents}${pattern}`,
+      `${currentContents}${newPatternText}`,
       repository
     )

merged
  result 100644 f05a774461b4caac6f3ad908b6090078f0de8419 app/src/lib/tailer.ts
  our    100644 08d5dbe9e54073674bb101a4c8c7c331eb5d1105 app/src/lib/tailer.ts
@@ -1,4 +1,4 @@
-import * as Fs from 'fs-extra'
+import * as Fs from 'fs'
 import { Emitter, Disposable } from 'event-kit'

 interface ICurrentFileTailState {
merged
  result 100644 d2fd1a247c9132a86ae1a23a948c51adff797eca app/src/main-process/log.ts
  our    100644 74719f439d29c061cd698d7b7dc9b46127a6b326 app/src/main-process/log.ts
@@ -3,7 +3,7 @@

 import { getLogDirectoryPath } from '../lib/logging/get-log-path'
 import { LogLevel } from '../lib/logging/log-level'
-import { mkdirIfNeeded } from '../lib/file-system'
+import { ensureDir } from 'fs-extra'

 require('winston-daily-rotate-file')

@@ -73,7 +73,7 @@
   loggerPromise = new Promise<winston.LogMethod>((resolve, reject) => {
     const logDirectory = getLogDirectoryPath()

-    mkdirIfNeeded(logDirectory)
+    ensureDir(logDirectory)
       .then(() => {
         try {
           const logger = initializeWinston(getLogFilePath(logDirectory))
merged
  result 100644 946271baeebe98fdf6b79d970b68d6255fc40289 app/src/main-process/main.ts
  our    100644 c5def55874da156c018edb81e03c9fc2e1ddbe90 app/src/main-process/main.ts
@@ -170,6 +170,13 @@
   }
 }

+if (process.env.GITHUB_DESKTOP_DISABLE_HARDWARE_ACCELERATION) {
+  log.info(
+    `GITHUB_DESKTOP_DISABLE_HARDWARE_ACCELERATION environment variable set, disabling hardware acceleration`
+  )
+  app.disableHardwareAcceleration()
+}
+
 app.on('ready', () => {
   if (isDuplicateInstance || handlingSquirrelEvent) {
     return
@@ -400,14 +407,24 @@
   const window = new AppWindow()

   if (__DEV__) {
-    const installer = require('electron-devtools-installer')
+    const {
+      default: installExtension,
+      REACT_DEVELOPER_TOOLS,
+      REACT_PERF,
+    } = require('electron-devtools-installer')
+
     require('electron-debug')({ showDevTools: true })

-    const extensions = ['REACT_DEVELOPER_TOOLS', 'REACT_PERF']
+    const ChromeLens = {
+      id: 'idikgljglpfilbhaboonnpnnincjhjkd',
+      electron: '>=1.2.1',
+    }
+
+    const extensions = [REACT_DEVELOPER_TOOLS, REACT_PERF, ChromeLens]

-    for (const name of extensions) {
+    for (const extension of extensions) {
       try {
-        installer.default(installer[name])
+        installExtension(extension)
       } catch (e) {}
     }
   }
merged
  result 100644 7ec8c001136d655a2ecce3d56b9a6804762172fa app/src/main-process/menu/build-default-menu.ts
  our    100644 e23a8e9a3b6cd377b7be7cc89ec15dae2d4c6da2 app/src/main-process/menu/build-default-menu.ts
@@ -2,7 +2,7 @@
 import { ensureItemIds } from './ensure-item-ids'
 import { MenuEvent } from './menu-event'
 import { getLogDirectoryPath } from '../../lib/logging/get-log-path'
-import { mkdirIfNeeded } from '../../lib/file-system'
+import { ensureDir } from 'fs-extra'

 import { log } from '../log'
 import { openDirectorySafe } from '../shell'
@@ -114,7 +114,11 @@
       { role: 'cut', label: __DARWIN__ ? 'Cut' : 'Cu&t' },
       { role: 'copy', label: __DARWIN__ ? 'Copy' : '&Copy' },
       { role: 'paste', label: __DARWIN__ ? 'Paste' : '&Paste' },
-      { role: 'selectall', label: __DARWIN__ ? 'Select All' : 'Select &all' },
+      {
+        label: __DARWIN__ ? 'Select All' : 'Select &all',
+        accelerator: 'CmdOrCtrl+A',
+        click: emit('select-all'),
+      },
     ],
   })

@@ -125,13 +129,13 @@
         label: __DARWIN__ ? 'Show Changes' : '&Changes',
         id: 'show-changes',
         accelerator: 'CmdOrCtrl+1',
-        click: emit('select-changes'),
+        click: emit('show-changes'),
       },
       {
         label: __DARWIN__ ? 'Show History' : '&History',
         id: 'show-history',
         accelerator: 'CmdOrCtrl+2',
-        click: emit('select-history'),
+        click: emit('show-history'),
       },
       {
         label: __DARWIN__ ? 'Show Repository List' : 'Repository &list',
@@ -285,6 +289,12 @@
         click: emit('update-branch'),
       },
       {
+        label: __DARWIN__ ? 'Compare to Branch' : '&Compare to branch',
+        id: 'compare-to-branch',
+        accelerator: 'CmdOrCtrl+Shift+B',
+        click: emit('compare-to-branch'),
+      },
+      {
         label: __DARWIN__
           ? 'Merge Into Current Branch‚Ä¶'
           : '&Merge into current branch‚Ä¶',
@@ -294,10 +304,10 @@
       },
       separator,
       {
-        label: __DARWIN__ ? 'Compare on GitHub' : '&Compare on GitHub',
-        id: 'compare-branch',
+        label: __DARWIN__ ? 'Compare on GitHub' : 'Compare on &GitHub',
+        id: 'compare-on-github',
         accelerator: 'CmdOrCtrl+Shift+C',
-        click: emit('compare-branch'),
+        click: emit('compare-on-github'),
       },
       {
         label: pullRequestLabel,
@@ -324,7 +334,7 @@
   const submitIssueItem: Electron.MenuItemConstructorOptions = {
     label: __DARWIN__ ? 'Report Issue‚Ä¶' : 'Report issue‚Ä¶',
     click() {
-      shell.openExternal('https://github.com/desktop/desktop/issues/new')
+      shell.openExternal('https://github.com/desktop/desktop/issues/new/choose')
     },
   }

@@ -346,13 +356,15 @@

   const showLogsLabel = __DARWIN__
     ? 'Show Logs in Finder'
-    : __WIN32__ ? 'S&how logs in Explorer' : 'S&how logs in your File Manager'
+    : __WIN32__
+      ? 'S&how logs in Explorer'
+      : 'S&how logs in your File Manager'

   const showLogsItem: Electron.MenuItemConstructorOptions = {
     label: showLogsLabel,
     click() {
       const logPath = getLogDirectoryPath()
-      mkdirIfNeeded(logPath)
+      ensureDir(logPath)
         .then(() => {
           openDirectorySafe(logPath)
         })
merged
  result 100644 a0568e66362057b90a91743f0aa68d083d286744 app/src/main-process/menu/menu-event.ts
  our    100644 530863955062bb7a426d8f4cb55b7ba2890f4294 app/src/main-process/menu/menu-event.ts
@@ -1,8 +1,8 @@
 export type MenuEvent =
   | 'push'
   | 'pull'
-  | 'select-changes'
-  | 'select-history'
+  | 'show-changes'
+  | 'show-history'
   | 'add-local-repository'
   | 'create-branch'
   | 'show-branches'
@@ -14,10 +14,11 @@
   | 'choose-repository'
   | 'open-working-directory'
   | 'update-branch'
+  | 'compare-to-branch'
   | 'merge-branch'
   | 'show-repository-settings'
   | 'open-in-shell'
-  | 'compare-branch'
+  | 'compare-on-github'
   | 'view-repository-on-github'
   | 'clone-repository'
   | 'show-about'
@@ -25,3 +26,4 @@
   | 'open-pull-request'
   | 'install-cli'
   | 'open-external-editor'
+  | 'select-all'
merged
  result 100644 3435bb2d1a982289132aabf4d0bbfea55730c644 app/src/main-process/menu/menu-ids.ts
  our    100644 016034d30cd14a867effcf1b5142c320e786aab6 app/src/main-process/menu/menu-ids.ts
@@ -5,7 +5,7 @@
   | 'update-branch'
   | 'merge-branch'
   | 'view-repository-on-github'
-  | 'compare-branch'
+  | 'compare-on-github'
   | 'open-in-shell'
   | 'push'
   | 'pull'
@@ -25,3 +25,4 @@
   | 'clone-repository'
   | 'about'
   | 'create-pull-request'
+  | 'compare-to-branch'
merged
  result 100644 5f8bcfd5aa2b2f30f81fe1cd9a2973bcc9b9f14f app/src/main-process/squirrel-updater.ts
  our    100644 d91124b5c21b55938e5e07f48cbf194bf6ba5df6 app/src/main-process/squirrel-updater.ts
@@ -1,7 +1,8 @@
-import * as ChildProcess from 'child_process'
 import * as Path from 'path'
 import * as Os from 'os'
-import { pathExists, mkdirIfNeeded, writeFile } from '../lib/file-system'
+
+import { pathExists, ensureDir, writeFile } from 'fs-extra'
+import { spawn, getPathSegments, setPathSegments } from '../lib/process/win32'

 const appFolder = Path.resolve(process.execPath, '..')
 const rootAppDir = Path.resolve(appFolder, '..')
@@ -46,7 +47,7 @@

 async function installCLI(): Promise<void> {
   const binPath = getBinPath()
-  await mkdirIfNeeded(binPath)
+  await ensureDir(binPath)
   await writeBatchScriptCLITrampoline(binPath)
   await writeShellScriptCLITrampoline(binPath)
   const paths = await getPathSegments()
@@ -79,7 +80,7 @@
  * rewrite the trampoline to point to the new, version-specific path. Bingo
  * bango Bob's your uncle.
  */
-async function writeBatchScriptCLITrampoline(binPath: string): Promise<void> {
+function writeBatchScriptCLITrampoline(binPath: string): Promise<void> {
   const versionedPath = resolveVersionedPath(
     binPath,
     'resources/app/static/github.bat'
@@ -91,7 +92,7 @@
   return writeFile(trampolinePath, trampoline)
 }

-async function writeShellScriptCLITrampoline(binPath: string): Promise<void> {
+function writeShellScriptCLITrampoline(binPath: string): Promise<void> {
   const versionedPath = resolveVersionedPath(
     binPath,
     'resources/app/static/github.sh'
@@ -153,86 +154,3 @@
     return createShortcut(['StartMenu', 'Desktop'])
   }
 }
-
-/** Get the path segments in the user's `Path`. */
-async function getPathSegments(): Promise<ReadonlyArray<string>> {
-  let powershellPath: string
-  const systemRoot = process.env['SystemRoot']
-  if (systemRoot) {
-    const system32Path = Path.join(process.env.SystemRoot, 'System32')
-    powershellPath = Path.join(
-      system32Path,
-      'WindowsPowerShell',
-      'v1.0',
-      'powershell.exe'
-    )
-  } else {
-    powershellPath = 'powershell.exe'
-  }
-
-  const args = [
-    '-noprofile',
-    '-ExecutionPolicy',
-    'RemoteSigned',
-    '-command',
-    // Set encoding and execute the command, capture the output, and return it
-    // via .NET's console in order to have consistent UTF-8 encoding.
-    // See http://stackoverflow.com/questions/22349139/utf-8-output-from-powershell
-    // to address https://github.com/atom/atom/issues/5063
-    `
-      [Console]::OutputEncoding=[System.Text.Encoding]::UTF8
-      $output=[environment]::GetEnvironmentVariable('Path', 'User')
-      [Console]::WriteLine($output)
-    `,
-  ]
-
-  const stdout = await spawn(powershellPath, args)
-  const pathOutput = stdout.replace(/^\s+|\s+$/g, '')
-  return pathOutput.split(/;+/).filter(segment => segment.length)
-}
-
-/** Set the user's `Path`. */
-async function setPathSegments(paths: ReadonlyArray<string>): Promise<void> {
-  let setxPath: string
-  const systemRoot = process.env['SystemRoot']
-  if (systemRoot) {
-    const system32Path = Path.join(systemRoot, 'System32')
-    setxPath = Path.join(system32Path, 'setx.exe')
-  } else {
-    setxPath = 'setx.exe'
-  }
-
-  await spawn(setxPath, ['Path', paths.join(';')])
-}
-
-/** Spawn a command with arguments and capture its output. */
-function spawn(command: string, args: ReadonlyArray<string>): Promise<string> {
-  try {
-    const child = ChildProcess.spawn(command, args as string[])
-    return new Promise<string>((resolve, reject) => {
-      let stdout = ''
-      child.stdout.on('data', data => {
-        stdout += data
-      })
-
-      child.on('close', code => {
-        if (code === 0) {
-          resolve(stdout)
-        } else {
-          reject(new Error(`Command "${command} ${args}" failed: "${stdout}"`))
-        }
-      })
-
-      child.on('error', (err: Error) => {
-        reject(err)
-      })
-
-      // This is necessary if using Powershell 2 on Windows 7 to get the events
-      // to raise.
-      // See http://stackoverflow.com/questions/9155289/calling-powershell-from-nodejs
-      child.stdin.end()
-    })
-  } catch (error) {
-    return Promise.reject(error)
-  }
-}
merged
  result 100644 f7e88ccf95c03ecb3df22ba8bbcd817652a83fe0 app/src/models/branch.ts
  our    100644 1a16bdd23db314c080802efa3f454878ac0eae63 app/src/models/branch.ts
@@ -8,6 +8,39 @@
   Remote = 1,
 }

+/** The number of commits a revision range is ahead/behind. */
+export interface IAheadBehind {
+  readonly ahead: number
+  readonly behind: number
+}
+
+/** The result of comparing two refs in a repository. */
+export interface ICompareResult extends IAheadBehind {
+  readonly commits: ReadonlyArray<Commit>
+}
+
+/**
+ * Check if a branch is eligible for beign fast forarded.
+ *
+ * Requirements:
+ *   1. It's local.
+ *   2. It's not the current branch.
+ *   3. It has an upstream.
+ *
+ * @param branch The branch to validate
+ * @param currentBranchName The current branch in the repository
+ */
+export function eligibleForFastForward(
+  branch: Branch,
+  currentBranchName: string | null
+): boolean {
+  return (
+    branch.type === BranchType.Local &&
+    branch.name !== currentBranchName &&
+    branch.upstream != null
+  )
+}
+
 /** A branch as loaded from Git. */
 export class Branch {
   /** The short name of the branch. E.g., `master`. */
merged
  result 100644 09b508aa3d46107e1f7bfdb7d23ec7e572146082 app/src/models/commit.ts
  our    100644 a6eb444fb8650f5e8e351782b02aced729e4933b app/src/models/commit.ts
@@ -118,7 +118,7 @@

     if (this.committer.name === 'GitHub Enterprise') {
       const host = new URL(endpoint).host.toLowerCase()
-      return email === `noreply@${host}`
+      return email.endsWith(`@${host}`)
     }

     return false
added in remote
  their  100644 25149364d06e0118a724af12a46e1d9e39fa94d6 app/src/models/diff/diff-data.ts
@@ -0,0 +1,100 @@
+import { DiffHunk } from './raw-diff'
+import { Image } from './image'
+/**
+ * V8 has a limit on the size of string it can create, and unless we want to
+ * trigger an unhandled exception we need to do the encoding conversion by hand
+ */
+export const maximumDiffStringSize = 268435441
+
+export enum DiffType {
+  /** Changes to a text file, which may be partially selected for commit */
+  Text,
+  /** Changes to a file with a known extension, which can be viewed in the app */
+  Image,
+  /** Changes to an unknown file format, which Git is unable to present in a human-friendly format */
+  Binary,
+  /** Change to a repository which is included as a submodule of this repository */
+  Submodule,
+  /** Diff is large enough to degrade ux if rendered */
+  LargeText,
+  /** Diff that will not be rendered */
+  Unrenderable,
+}
+
+type LineEnding = 'CR' | 'LF' | 'CRLF'
+
+export type LineEndingsChange = {
+  from: LineEnding
+  to: LineEnding
+}
+
+/** Parse the line ending string into an enum value (or `null` if unknown) */
+export function parseLineEndingText(text: string): LineEnding | null {
+  const input = text.trim()
+  switch (input) {
+    case 'CR':
+      return 'CR'
+    case 'LF':
+      return 'LF'
+    case 'CRLF':
+      return 'CRLF'
+    default:
+      return null
+  }
+}
+
+/**
+ * Data returned as part of a textual diff from Desktop
+ */
+interface ITextDiffData {
+  /** The unified text diff - including headers and context */
+  readonly text: string
+  /** The diff contents organized by hunk - how the git CLI outputs to the caller */
+  readonly hunks: ReadonlyArray<DiffHunk>
+  /** A warning from Git that the line endings have changed in this file and will affect the commit */
+  readonly lineEndingsChange?: LineEndingsChange
+}
+
+export interface ITextDiff extends ITextDiffData {
+  readonly kind: DiffType.Text
+}
+
+/**
+ * Data returned as part of an image diff in Desktop
+ */
+export interface IImageDiff {
+  readonly kind: DiffType.Image
+
+  /**
+   * The previous image, if the file was modified or deleted
+   *
+   * Will be undefined for an added image
+   */
+  readonly previous?: Image
+  /**
+   * The current image, if the file was added or modified
+   *
+   * Will be undefined for a deleted image
+   */
+  readonly current?: Image
+}
+
+export interface IBinaryDiff {
+  readonly kind: DiffType.Binary
+}
+
+export interface ILargeTextDiff extends ITextDiffData {
+  readonly kind: DiffType.LargeText
+}
+
+export interface IUnrenderableDiff {
+  readonly kind: DiffType.Unrenderable
+}
+
+/** The union of diff types that can be rendered in Desktop */
+export type IDiff =
+  | ITextDiff
+  | IImageDiff
+  | IBinaryDiff
+  | ILargeTextDiff
+  | IUnrenderableDiff
added in remote
  their  100644 c67a37739d99c6a375e9f4e5675a3b48eb8031ea app/src/models/diff/diff-line.ts
@@ -0,0 +1,49 @@
+/** indicate what a line in the diff represents */
+export enum DiffLineType {
+  Context,
+  Add,
+  Delete,
+  Hunk,
+}
+
+/** track details related to each line in the diff */
+export class DiffLine {
+  public readonly text: string
+  public readonly type: DiffLineType
+  public readonly oldLineNumber: number | null
+  public readonly newLineNumber: number | null
+  public readonly noTrailingNewLine: boolean
+
+  public constructor(
+    text: string,
+    type: DiffLineType,
+    oldLineNumber: number | null,
+    newLineNuber: number | null,
+    noTrailingNewLine: boolean = false
+  ) {
+    this.text = text
+    this.type = type
+    this.oldLineNumber = oldLineNumber
+    this.newLineNumber = newLineNuber
+    this.noTrailingNewLine = noTrailingNewLine
+  }
+
+  public withNoTrailingNewLine(noTrailingNewLine: boolean): DiffLine {
+    return new DiffLine(
+      this.text,
+      this.type,
+      this.oldLineNumber,
+      this.newLineNumber,
+      noTrailingNewLine
+    )
+  }
+
+  public isIncludeableLine() {
+    return this.type === DiffLineType.Add || this.type === DiffLineType.Delete
+  }
+
+  /** The content of the line, i.e., without the line type marker. */
+  public get content(): string {
+    return this.text.substr(1)
+  }
+}
added in remote
  their  100644 e93f04b45de5a0329772d8ff16c2b5a33afedc3f app/src/models/diff/diff-selection.ts
@@ -0,0 +1,291 @@
+import { assertNever } from '../../lib/fatal-error'
+
+/**
+ * The state of a file's diff selection
+ */
+export enum DiffSelectionType {
+  /** The entire file should be committed */
+  All,
+  /** A subset of lines in the file have been selected for committing */
+  Partial,
+  /** The file should be excluded from committing */
+  None,
+}
+
+/**
+ * Utility function which determines whether a boolean selection state
+ * matches the given DiffSelectionType. A true selection state matches
+ * DiffSelectionType.All, a false selection state matches
+ * DiffSelectionType.None and if the selection type is partial there's
+ * never a match.
+ */
+function typeMatchesSelection(
+  selectionType: DiffSelectionType,
+  selected: boolean
+): boolean {
+  switch (selectionType) {
+    case DiffSelectionType.All:
+      return selected
+    case DiffSelectionType.None:
+      return !selected
+    case DiffSelectionType.Partial:
+      return false
+    default:
+      return assertNever(
+        selectionType,
+        `Unknown selection type ${selectionType}`
+      )
+  }
+}
+
+/**
+ * An immutable, efficient, storage object for tracking selections of indexable
+ * lines. While general purpose by design this is currently used exclusively for
+ * tracking selected lines in modified files in the working directory.
+ *
+ * This class starts out with an initial (or default) selection state, ie
+ * either all lines are selected by default or no lines are selected by default.
+ *
+ * The selection can then be transformed by marking a line or a range of lines
+ * as selected or not selected. Internally the class maintains a list of lines
+ * whose selection state has diverged from the default selection state.
+ */
+export class DiffSelection {
+  private readonly defaultSelectionType:
+    | DiffSelectionType.All
+    | DiffSelectionType.None
+
+  /* Any line numbers where the selection differs from the default state. */
+  private readonly divergingLines: Set<number> | null
+
+  /* Optional set of line numbers which can be selected. */
+  private readonly selectableLines: Set<number> | null
+
+  /**
+   * Initialize a new selection instance where either all lines are selected by default
+   * or not lines are selected by default.
+   */
+  public static fromInitialSelection(
+    initialSelection: DiffSelectionType.All | DiffSelectionType.None
+  ): DiffSelection {
+    if (
+      initialSelection !== DiffSelectionType.All &&
+      initialSelection !== DiffSelectionType.None
+    ) {
+      return assertNever(
+        initialSelection,
+        'Can only instantiate a DiffSelection with All or None as the initial selection'
+      )
+    }
+
+    return new DiffSelection(initialSelection, null, null)
+  }
+
+  private constructor(
+    defaultSelectionType: DiffSelectionType.All | DiffSelectionType.None,
+    divergingLines: Set<number> | null,
+    selectableLines: Set<number> | null
+  ) {
+    this.defaultSelectionType = defaultSelectionType
+    this.divergingLines = divergingLines || null
+    this.selectableLines = selectableLines || null
+  }
+
+  /** Returns a value indicating the computed overall state of the selection */
+  public getSelectionType(): DiffSelectionType {
+    const divergingLines = this.divergingLines
+    const selectableLines = this.selectableLines
+
+    // No diverging lines, happy path. Either all lines are selected or none are.
+    if (!divergingLines) {
+      return this.defaultSelectionType
+    }
+    if (divergingLines.size === 0) {
+      return this.defaultSelectionType
+    }
+
+    // If we know which lines are selectable we need to check that
+    // all lines are divergent and return the inverse of default selection.
+    // To avoid loopting through the set that often our happy path is
+    // if there's a size mismatch.
+    if (selectableLines && selectableLines.size === divergingLines.size) {
+      const allSelectableLinesAreDivergent = [...selectableLines].every(i =>
+        divergingLines.has(i)
+      )
+
+      if (allSelectableLinesAreDivergent) {
+        return this.defaultSelectionType === DiffSelectionType.All
+          ? DiffSelectionType.None
+          : DiffSelectionType.All
+      }
+    }
+
+    // Note that without any selectable lines we'll report partial selection
+    // as long as we have any diverging lines since we have no way of knowing
+    // if _all_ lines are divergent or not
+    return DiffSelectionType.Partial
+  }
+
+  /** Returns a value indicating wether the given line number is selected or not */
+  public isSelected(lineIndex: number): boolean {
+    const lineIsDivergent =
+      !!this.divergingLines && this.divergingLines.has(lineIndex)
+
+    if (this.defaultSelectionType === DiffSelectionType.All) {
+      return !lineIsDivergent
+    } else if (this.defaultSelectionType === DiffSelectionType.None) {
+      return lineIsDivergent
+    } else {
+      return assertNever(
+        this.defaultSelectionType,
+        `Unknown base selection type ${this.defaultSelectionType}`
+      )
+    }
+  }
+
+  /**
+   * Returns a value indicating wether the given line number is selectable.
+   * A line not being selectable usually means it's a hunk header or a context
+   * line.
+   */
+  public isSelectable(lineIndex: number): boolean {
+    return this.selectableLines ? this.selectableLines.has(lineIndex) : true
+  }
+
+  /**
+   * Returns a copy of this selection instance with the provided
+   * line selection update.
+   *
+   * @param lineIndex The index (line number) of the line which should
+   *                 be selected or unselected.
+   *
+   * @param selected Whether the given line number should be marked
+   *                 as selected or not.
+   */
+  public withLineSelection(
+    lineIndex: number,
+    selected: boolean
+  ): DiffSelection {
+    return this.withRangeSelection(lineIndex, 1, selected)
+  }
+
+  /**
+   * Returns a copy of this selection instance with the provided
+   * line selection update. This is similar to the withLineSelection
+   * method except that it allows updating the selection state of
+   * a range of lines at once. Use this if you ever need to modify
+   * the selection state of more than one line at a time as it's
+   * more efficient.
+   *
+   * @param from     The line index (inclusive) from where to start
+   *                 updating the line selection state.
+   *
+   * @param to       The number of lines for which to update the
+   *                 selection state. A value of zero means no lines
+   *                 are updated and a value of 1 means only the
+   *                 line given by lineIndex will be updated.
+   *
+   * @param selected Whether the lines should be marked as selected
+   *                 or not.
+   */
+  // Lower inclusive, upper exclusive. Same as substring
+  public withRangeSelection(
+    from: number,
+    length: number,
+    selected: boolean
+  ): DiffSelection {
+    const computedSelectionType = this.getSelectionType()
+    const to = from + length
+
+    // Nothing for us to do here. This state is when all lines are already
+    // selected and we're being asked to select more or when no lines are
+    // selected and we're being asked to unselect something.
+    if (typeMatchesSelection(computedSelectionType, selected)) {
+      return this
+    }
+
+    if (computedSelectionType === DiffSelectionType.Partial) {
+      const newDivergingLines = new Set<number>(this.divergingLines!)
+
+      if (typeMatchesSelection(this.defaultSelectionType, selected)) {
+        for (let i = from; i < to; i++) {
+          newDivergingLines.delete(i)
+        }
+      } else {
+        for (let i = from; i < to; i++) {
+          // Ensure it's selectable
+          if (this.isSelectable(i)) {
+            newDivergingLines.add(i)
+          }
+        }
+      }
+
+      return new DiffSelection(
+        this.defaultSelectionType,
+        newDivergingLines.size === 0 ? null : newDivergingLines,
+        this.selectableLines
+      )
+    } else {
+      const newDivergingLines = new Set<number>()
+      for (let i = from; i < to; i++) {
+        if (this.isSelectable(i)) {
+          newDivergingLines.add(i)
+        }
+      }
+
+      return new DiffSelection(
+        computedSelectionType,
+        newDivergingLines,
+        this.selectableLines
+      )
+    }
+  }
+
+  /**
+   * Returns a copy of this selection instance where the selection state
+   * of the specified line has been toggled (inverted).
+   *
+   * @param lineIndex The index (line number) of the line which should
+   *                 be selected or unselected.
+   */
+  public withToggleLineSelection(lineIndex: number): DiffSelection {
+    return this.withLineSelection(lineIndex, !this.isSelected(lineIndex))
+  }
+
+  /**
+   * Returns a copy of this selection instance with all lines selected.
+   */
+  public withSelectAll(): DiffSelection {
+    return new DiffSelection(DiffSelectionType.All, null, this.selectableLines)
+  }
+
+  /**
+   * Returns a copy of this selection instance with no lines selected.
+   */
+  public withSelectNone(): DiffSelection {
+    return new DiffSelection(DiffSelectionType.None, null, this.selectableLines)
+  }
+
+  /**
+   * Returns a copy of this selection instance with a specified set of
+   * selecable lines. By default a DiffSelection instance allows selecting
+   * all lines (in fact, it has no notion of how many lines exists or what
+   * it is that is being selected).
+   *
+   * If the selection instance lacks a set of selectable lines it can not
+   * supply an accurate value from getSelectionType when the selection of
+   * all lines have diverged from the default state (since it doesn't know
+   * what all lines mean).
+   */
+  public withSelectableLines(selectableLines: Set<number>) {
+    const divergingLines = this.divergingLines
+      ? new Set([...this.divergingLines].filter(x => selectableLines.has(x)))
+      : null
+
+    return new DiffSelection(
+      this.defaultSelectionType,
+      divergingLines,
+      selectableLines
+    )
+  }
+}
added in remote
  their  100644 ec1f951bc9326443ec440600c4c2edcf51e5f4f5 app/src/models/diff/image.ts
@@ -0,0 +1,25 @@
+/**
+ * A container for holding an image for display in the application
+ */
+export class Image {
+  /**
+   * The base64 encoded contents of the image
+   */
+  public readonly contents: string
+
+  /**
+   * The data URI media type, so the browser can render the image correctly
+   */
+  public readonly mediaType: string
+
+  /**
+   * Size of the file in bytes
+   */
+  public readonly bytes: number
+
+  public constructor(contents: string, mediaType: string, bytes: number) {
+    this.contents = contents
+    this.mediaType = mediaType
+    this.bytes = bytes
+  }
+}
added in remote
  their  100644 ff04279f640811cae78963c899aa24f987d2bd30 app/src/models/diff/index.ts
@@ -0,0 +1,5 @@
+export * from './diff-data'
+export * from './diff-line'
+export * from './diff-selection'
+export * from './image'
+export * from './raw-diff'
added in remote
  their  100644 3182bf4a9cd153fa9d0a33937c7001a783ed140f app/src/models/diff/raw-diff.ts
@@ -0,0 +1,87 @@
+import { DiffLine } from './diff-line'
+
+/** each diff is made up of a number of hunks */
+export class DiffHunk {
+  /** details from the diff hunk header about the line start and patch length */
+  public readonly header: DiffHunkHeader
+  /** the contents - context and changes - of the diff setion */
+  public readonly lines: ReadonlyArray<DiffLine>
+  /** the diff hunk's start position in the overall file diff */
+  public readonly unifiedDiffStart: number
+  /** the diff hunk's end position in the overall file diff */
+  public readonly unifiedDiffEnd: number
+
+  public constructor(
+    header: DiffHunkHeader,
+    lines: ReadonlyArray<DiffLine>,
+    unifiedDiffStart: number,
+    unifiedDiffEnd: number
+  ) {
+    this.header = header
+    this.unifiedDiffStart = unifiedDiffStart
+    this.unifiedDiffEnd = unifiedDiffEnd
+    this.lines = lines
+  }
+}
+
+/** details about the start and end of a diff hunk */
+export class DiffHunkHeader {
+  /** The line in the old (or original) file where this diff hunk starts */
+  public readonly oldStartLine: number
+
+  /** The number of lines in the old (or original) file that this diff hunk covers */
+  public readonly oldLineCount: number
+
+  /** The line in the new file where this diff hunk starts */
+  public readonly newStartLine: number
+
+  /** The number of lines in the new file that this diff hunk covers */
+  public readonly newLineCount: number
+
+  public constructor(
+    oldStartLine: number,
+    oldLineCount: number,
+    newStartLine: number,
+    newLineCount: number,
+    sectionHeading?: string | null
+  ) {
+    this.oldStartLine = oldStartLine
+    this.oldLineCount = oldLineCount
+    this.newStartLine = newStartLine
+    this.newLineCount = newLineCount
+  }
+}
+
+/** the contents of a diff generated by Git */
+export interface IRawDiff {
+  /**
+   * The plain text contents of the diff header. This contains
+   * everything from the start of the diff up until the first
+   * hunk header starts. Note that this does not include a trailing
+   * newline.
+   */
+  readonly header: string
+
+  /**
+   * The plain text contents of the diff. This contains everything
+   * after the diff header until the last character in the diff.
+   *
+   * Note that this does not include a trailing newline nor does
+   * it include diff 'no newline at end of file' comments. For
+   * no-newline information, consult the DiffLine noTrailingNewLine
+   * property.
+   */
+  readonly contents: string
+
+  /**
+   * Each hunk in the diff with information about start, and end
+   * positions, lines and line statuses.
+   */
+  readonly hunks: ReadonlyArray<DiffHunk>
+
+  /**
+   * Whether or not the unified diff indicates that the contents
+   * could not be diffed due to one of the versions being binary.
+   */
+  readonly isBinary: boolean
+}
removed in remote
  base   100644 a87d16ff4a97dc592dfabe66a69a340629d70ea8 app/src/models/diff.ts
  our    100644 a87d16ff4a97dc592dfabe66a69a340629d70ea8 app/src/models/diff.ts
@@ -1,571 +0,0 @@
-import { assertNever } from '../lib/fatal-error'
-
-/**
- * V8 has a limit on the size of string it can create, and unless we want to
- * trigger an unhandled exception we need to do the encoding conversion by hand
- */
-export const maximumDiffStringSize = 268435441
-
-/**
- * A container for holding an image for display in the application
- */
-export class Image {
-  /**
-   * The base64 encoded contents of the image
-   */
-  public readonly contents: string
-
-  /**
-   * The data URI media type, so the browser can render the image correctly
-   */
-  public readonly mediaType: string
-
-  public constructor(contents: string, mediaType: string) {
-    this.contents = contents
-    this.mediaType = mediaType
-  }
-}
-
-/** each diff is made up of a number of hunks */
-export class DiffHunk {
-  /** details from the diff hunk header about the line start and patch length */
-  public readonly header: DiffHunkHeader
-  /** the contents - context and changes - of the diff setion */
-  public readonly lines: ReadonlyArray<DiffLine>
-  /** the diff hunk's start position in the overall file diff */
-  public readonly unifiedDiffStart: number
-  /** the diff hunk's end position in the overall file diff */
-  public readonly unifiedDiffEnd: number
-
-  public constructor(
-    header: DiffHunkHeader,
-    lines: ReadonlyArray<DiffLine>,
-    unifiedDiffStart: number,
-    unifiedDiffEnd: number
-  ) {
-    this.header = header
-    this.unifiedDiffStart = unifiedDiffStart
-    this.unifiedDiffEnd = unifiedDiffEnd
-    this.lines = lines
-  }
-}
-
-export enum DiffType {
-  /** Changes to a text file, which may be partially selected for commit */
-  Text,
-  /** Changes to files of a known format, which can be viewed in the app */
-  Image,
-  /** Changes to an unknown file format, which Git is unable to present in a human-friendly format */
-  Binary,
-  /** Change to a repository which is included as a submodule of this repository */
-  Submodule,
-  /** Diff is large enough to degrade ux if rendered */
-  LargeText,
-  /** Diff that will not be rendered */
-  Unrenderable,
-}
-
-/** indicate what a line in the diff represents */
-export enum DiffLineType {
-  Context,
-  Add,
-  Delete,
-  Hunk,
-}
-
-type LineEnding = 'CR' | 'LF' | 'CRLF'
-
-export type LineEndingsChange = {
-  from: LineEnding
-  to: LineEnding
-}
-
-/** Parse the line ending string into an enum value (or `null` if unknown) */
-export function parseLineEndingText(text: string): LineEnding | null {
-  const input = text.trim()
-  switch (input) {
-    case 'CR':
-      return 'CR'
-    case 'LF':
-      return 'LF'
-    case 'CRLF':
-      return 'CRLF'
-    default:
-      return null
-  }
-}
-
-export interface ITextDiff {
-  readonly kind: DiffType.Text
-  /** The unified text diff - including headers and context */
-  readonly text: string
-  /** The diff contents organized by hunk - how the git CLI outputs to the caller */
-  readonly hunks: ReadonlyArray<DiffHunk>
-  /** A warning from Git that the line endings have changed in this file and will affect the commit */
-  readonly lineEndingsChange?: LineEndingsChange
-}
-
-export interface IImageDiff {
-  readonly kind: DiffType.Image
-  /**
-   * The previous image, if the file was modified or deleted
-   *
-   * Will be undefined for an added image
-   */
-  readonly previous?: Image
-  /**
-   * The current image, if the file was added or modified
-   *
-   * Will be undefined for a deleted image
-   */
-  readonly current?: Image
-}
-
-export interface IBinaryDiff {
-  readonly kind: DiffType.Binary
-}
-
-export interface ILargeTextDiff {
-  readonly kind: DiffType.LargeText
-  /** The unified text diff - including headers and context */
-  readonly text: string
-  /** The diff contents organized by hunk - how the git CLI outputs to the caller */
-  readonly hunks: ReadonlyArray<DiffHunk>
-  /** A warning from Git that the line endings have changed in this file and will affect the commit */
-  readonly lineEndingsChange?: LineEndingsChange
-}
-
-export interface IUnrenderableDiff {
-  readonly kind: DiffType.Unrenderable
-}
-
-/** The union of diff types that can be rendered in Desktop */
-export type IDiff =
-  | ITextDiff
-  | IImageDiff
-  | IBinaryDiff
-  | ILargeTextDiff
-  | IUnrenderableDiff
-
-/** track details related to each line in the diff */
-export class DiffLine {
-  public readonly text: string
-  public readonly type: DiffLineType
-  public readonly oldLineNumber: number | null
-  public readonly newLineNumber: number | null
-  public readonly noTrailingNewLine: boolean
-
-  public constructor(
-    text: string,
-    type: DiffLineType,
-    oldLineNumber: number | null,
-    newLineNuber: number | null,
-    noTrailingNewLine: boolean = false
-  ) {
-    this.text = text
-    this.type = type
-    this.oldLineNumber = oldLineNumber
-    this.newLineNumber = newLineNuber
-    this.noTrailingNewLine = noTrailingNewLine
-  }
-
-  public withNoTrailingNewLine(noTrailingNewLine: boolean): DiffLine {
-    return new DiffLine(
-      this.text,
-      this.type,
-      this.oldLineNumber,
-      this.newLineNumber,
-      noTrailingNewLine
-    )
-  }
-
-  public isIncludeableLine() {
-    return this.type === DiffLineType.Add || this.type === DiffLineType.Delete
-  }
-
-  /** The content of the line, i.e., without the line type marker. */
-  public get content(): string {
-    return this.text.substr(1)
-  }
-}
-
-/** details about the start and end of a diff hunk */
-export class DiffHunkHeader {
-  /** The line in the old (or original) file where this diff hunk starts */
-  public readonly oldStartLine: number
-
-  /** The number of lines in the old (or original) file that this diff hunk covers */
-  public readonly oldLineCount: number
-
-  /** The line in the new file where this diff hunk starts */
-  public readonly newStartLine: number
-
-  /** The number of lines in the new file that this diff hunk covers */
-  public readonly newLineCount: number
-
-  public constructor(
-    oldStartLine: number,
-    oldLineCount: number,
-    newStartLine: number,
-    newLineCount: number,
-    sectionHeading?: string | null
-  ) {
-    this.oldStartLine = oldStartLine
-    this.oldLineCount = oldLineCount
-    this.newStartLine = newStartLine
-    this.newLineCount = newLineCount
-  }
-}
-
-export class FileSummary {
-  /**
-   * The number of lines added as part of this change.
-   *
-   * If the file is a binary change, this value is undefined.
-   */
-  public readonly added?: number
-  /**
-   * The number of lines removed as part of this change.
-   *
-   * If the file is a binary change, this value is undefined.
-   */
-  public readonly removed?: number
-
-  /**
-   * The path to this change, relative to the submodule root
-   */
-  public readonly path: string
-
-  public constructor(
-    path: string,
-    added: number | undefined,
-    removed: number | undefined
-  ) {
-    this.path = path
-    this.added = added
-    this.removed = removed
-  }
-
-  /** An ID for the file change. */
-  public get id(): string {
-    return `${this.added}+${this.removed}+${this.path}`
-  }
-}
-
-/** the contents of a diff generated by Git */
-export interface IRawDiff {
-  /**
-   * The plain text contents of the diff header. This contains
-   * everything from the start of the diff up until the first
-   * hunk header starts. Note that this does not include a trailing
-   * newline.
-   */
-  readonly header: string
-
-  /**
-   * The plain text contents of the diff. This contains everything
-   * after the diff header until the last character in the diff.
-   *
-   * Note that this does not include a trailing newline nor does
-   * it include diff 'no newline at end of file' comments. For
-   * no-newline information, consult the DiffLine noTrailingNewLine
-   * property.
-   */
-  readonly contents: string
-
-  /**
-   * Each hunk in the diff with information about start, and end
-   * positions, lines and line statuses.
-   */
-  readonly hunks: ReadonlyArray<DiffHunk>
-
-  /**
-   * Whether or not the unified diff indicates that the contents
-   * could not be diffed due to one of the versions being binary.
-   */
-  readonly isBinary: boolean
-}
-
-export enum DiffSelectionType {
-  All,
-  Partial,
-  None,
-}
-
-/**
- * Utility function which determines whether a boolean selection state
- * matches the given DiffSelectionType. A true selection state matches
- * DiffSelectionType.All, a false selection state matches
- * DiffSelectionType.None and if the selection type is partial there's
- * never a match.
- */
-function typeMatchesSelection(
-  selectionType: DiffSelectionType,
-  selected: boolean
-): boolean {
-  switch (selectionType) {
-    case DiffSelectionType.All:
-      return selected
-    case DiffSelectionType.None:
-      return !selected
-    case DiffSelectionType.Partial:
-      return false
-    default:
-      return assertNever(
-        selectionType,
-        `Unknown selection type ${selectionType}`
-      )
-  }
-}
-
-/**
- * An immutable, efficient, storage object for tracking selections of indexable
- * lines. While general purpose by design this is currently used exclusively for
- * tracking selected lines in modified files in the working directory.
- *
- * This class starts out with an initial (or default) selection state, ie
- * either all lines are selected by default or no lines are selected by default.
- *
- * The selection can then be transformed by marking a line or a range of lines
- * as selected or not selected. Internally the class maintains a list of lines
- * whose selection state has diverged from the default selection state.
- */
-export class DiffSelection {
-  private readonly defaultSelectionType:
-    | DiffSelectionType.All
-    | DiffSelectionType.None
-
-  /* Any line numbers where the selection differs from the default state. */
-  private readonly divergingLines: Set<number> | null
-
-  /* Optional set of line numbers which can be selected. */
-  private readonly selectableLines: Set<number> | null
-
-  /**
-   * Initialize a new selection instance where either all lines are selected by default
-   * or not lines are selected by default.
-   */
-  public static fromInitialSelection(
-    initialSelection: DiffSelectionType.All | DiffSelectionType.None
-  ): DiffSelection {
-    if (
-      initialSelection !== DiffSelectionType.All &&
-      initialSelection !== DiffSelectionType.None
-    ) {
-      return assertNever(
-        initialSelection,
-        'Can only instantiate a DiffSelection with All or None as the initial selection'
-      )
-    }
-
-    return new DiffSelection(initialSelection, null, null)
-  }
-
-  private constructor(
-    defaultSelectionType: DiffSelectionType.All | DiffSelectionType.None,
-    divergingLines: Set<number> | null,
-    selectableLines: Set<number> | null
-  ) {
-    this.defaultSelectionType = defaultSelectionType
-    this.divergingLines = divergingLines || null
-    this.selectableLines = selectableLines || null
-  }
-
-  /** Returns a value indicating the computed overall state of the selection */
-  public getSelectionType(): DiffSelectionType {
-    const divergingLines = this.divergingLines
-    const selectableLines = this.selectableLines
-
-    // No diverging lines, happy path. Either all lines are selected or none are.
-    if (!divergingLines) {
-      return this.defaultSelectionType
-    }
-    if (divergingLines.size === 0) {
-      return this.defaultSelectionType
-    }
-
-    // If we know which lines are selectable we need to check that
-    // all lines are divergent and return the inverse of default selection.
-    // To avoid loopting through the set that often our happy path is
-    // if there's a size mismatch.
-    if (selectableLines && selectableLines.size === divergingLines.size) {
-      const allSelectableLinesAreDivergent = [...selectableLines].every(i =>
-        divergingLines.has(i)
-      )
-
-      if (allSelectableLinesAreDivergent) {
-        return this.defaultSelectionType === DiffSelectionType.All
-          ? DiffSelectionType.None
-          : DiffSelectionType.All
-      }
-    }
-
-    // Note that without any selectable lines we'll report partial selection
-    // as long as we have any diverging lines since we have no way of knowing
-    // if _all_ lines are divergent or not
-    return DiffSelectionType.Partial
-  }
-
-  /** Returns a value indicating wether the given line number is selected or not */
-  public isSelected(lineIndex: number): boolean {
-    const lineIsDivergent =
-      !!this.divergingLines && this.divergingLines.has(lineIndex)
-
-    if (this.defaultSelectionType === DiffSelectionType.All) {
-      return !lineIsDivergent
-    } else if (this.defaultSelectionType === DiffSelectionType.None) {
-      return lineIsDivergent
-    } else {
-      return assertNever(
-        this.defaultSelectionType,
-        `Unknown base selection type ${this.defaultSelectionType}`
-      )
-    }
-  }
-
-  /**
-   * Returns a value indicating wether the given line number is selectable.
-   * A line not being selectable usually means it's a hunk header or a context
-   * line.
-   */
-  public isSelectable(lineIndex: number): boolean {
-    return this.selectableLines ? this.selectableLines.has(lineIndex) : true
-  }
-
-  /**
-   * Returns a copy of this selection instance with the provided
-   * line selection update.
-   *
-   * @param lineIndex The index (line number) of the line which should
-   *                 be selected or unselected.
-   *
-   * @param selected Whether the given line number should be marked
-   *                 as selected or not.
-   */
-  public withLineSelection(
-    lineIndex: number,
-    selected: boolean
-  ): DiffSelection {
-    return this.withRangeSelection(lineIndex, 1, selected)
-  }
-
-  /**
-   * Returns a copy of this selection instance with the provided
-   * line selection update. This is similar to the withLineSelection
-   * method except that it allows updating the selection state of
-   * a range of lines at once. Use this if you ever need to modify
-   * the selection state of more than one line at a time as it's
-   * more efficient.
-   *
-   * @param from     The line index (inclusive) from where to start
-   *                 updating the line selection state.
-   *
-   * @param to       The number of lines for which to update the
-   *                 selection state. A value of zero means no lines
-   *                 are updated and a value of 1 means only the
-   *                 line given by lineIndex will be updated.
-   *
-   * @param selected Whether the lines should be marked as selected
-   *                 or not.
-   */
-  // Lower inclusive, upper exclusive. Same as substring
-  public withRangeSelection(
-    from: number,
-    length: number,
-    selected: boolean
-  ): DiffSelection {
-    const computedSelectionType = this.getSelectionType()
-    const to = from + length
-
-    // Nothing for us to do here. This state is when all lines are already
-    // selected and we're being asked to select more or when no lines are
-    // selected and we're being asked to unselect something.
-    if (typeMatchesSelection(computedSelectionType, selected)) {
-      return this
-    }
-
-    if (computedSelectionType === DiffSelectionType.Partial) {
-      const newDivergingLines = new Set<number>(this.divergingLines!)
-
-      if (typeMatchesSelection(this.defaultSelectionType, selected)) {
-        for (let i = from; i < to; i++) {
-          newDivergingLines.delete(i)
-        }
-      } else {
-        for (let i = from; i < to; i++) {
-          // Ensure it's selectable
-          if (this.isSelectable(i)) {
-            newDivergingLines.add(i)
-          }
-        }
-      }
-
-      return new DiffSelection(
-        this.defaultSelectionType,
-        newDivergingLines.size === 0 ? null : newDivergingLines,
-        this.selectableLines
-      )
-    } else {
-      const newDivergingLines = new Set<number>()
-      for (let i = from; i < to; i++) {
-        if (this.isSelectable(i)) {
-          newDivergingLines.add(i)
-        }
-      }
-
-      return new DiffSelection(
-        computedSelectionType,
-        newDivergingLines,
-        this.selectableLines
-      )
-    }
-  }
-
-  /**
-   * Returns a copy of this selection instance where the selection state
-   * of the specified line has been toggled (inverted).
-   *
-   * @param lineIndex The index (line number) of the line which should
-   *                 be selected or unselected.
-   */
-  public withToggleLineSelection(lineIndex: number): DiffSelection {
-    return this.withLineSelection(lineIndex, !this.isSelected(lineIndex))
-  }
-
-  /**
-   * Returns a copy of this selection instance with all lines selected.
-   */
-  public withSelectAll(): DiffSelection {
-    return new DiffSelection(DiffSelectionType.All, null, this.selectableLines)
-  }
-
-  /**
-   * Returns a copy of this selection instance with no lines selected.
-   */
-  public withSelectNone(): DiffSelection {
-    return new DiffSelection(DiffSelectionType.None, null, this.selectableLines)
-  }
-
-  /**
-   * Returns a copy of this selection instance with a specified set of
-   * selecable lines. By default a DiffSelection instance allows selecting
-   * all lines (in fact, it has no notion of how many lines exists or what
-   * it is that is being selected).
-   *
-   * If the selection instance lacks a set of selectable lines it can not
-   * supply an accurate value from getSelectionType when the selection of
-   * all lines have diverged from the default state (since it doesn't know
-   * what all lines mean).
-   */
-  public withSelectableLines(selectableLines: Set<number>) {
-    const divergingLines = this.divergingLines
-      ? new Set([...this.divergingLines].filter(x => selectableLines.has(x)))
-      : null
-
-    return new DiffSelection(
-      this.defaultSelectionType,
-      divergingLines,
-      selectableLines
-    )
-  }
-}
merged
  result 100644 60eb2b935fefe06923b8c583082cb80e3d1ab546 app/src/models/preferences.ts
  our    100644 1e6d2e9845d5a06be700bd1a32d3c3d9f9624450 app/src/models/preferences.ts
@@ -1,5 +1,6 @@
 export enum PreferencesTab {
   Accounts = 0,
-  Git,
-  Advanced,
+  Git = 1,
+  Appearance = 2,
+  Advanced = 3,
 }
merged
  result 100644 45aab006e858dbd9f456c01363c261af3c19e3d1 app/src/models/pull-request.ts
  our    100644 a9a31a307d1ff252471481ad1b74adc64164f566 app/src/models/pull-request.ts
@@ -29,6 +29,7 @@
 export interface ICommitStatus {
   readonly id: number
   readonly state: APIRefState
+  readonly description: string
 }

 export class PullRequestStatus {
merged
  result 100644 6a4b61f9fe2be4768d09c5ba220b92bac6e36e4a app/src/models/repository.ts
  our    100644 0602a86788419c4d0be13a0de4f8c5ac6b37a368 app/src/models/repository.ts
@@ -1,6 +1,19 @@
 import * as Path from 'path'

 import { GitHubRepository } from './github-repository'
+import { IAheadBehind } from './branch'
+
+function getBaseName(path: string): string {
+  const baseName = Path.basename(path)
+
+  if (baseName.length === 0) {
+    // the repository is at the root of the drive
+    // -> show the full path here to show _something_
+    return path
+  }
+
+  return baseName
+}

 /** A local repository. */
 export class Repository {
@@ -21,8 +34,7 @@
   ) {
     this.path = path
     this.gitHubRepository = gitHubRepository
-    this.name =
-      (gitHubRepository && gitHubRepository.name) || Path.basename(path)
+    this.name = (gitHubRepository && gitHubRepository.name) || getBaseName(path)
     this.id = id
     this.missing = missing
   }
@@ -40,3 +52,18 @@
       ${this.name}`
   }
 }
+
+/**
+ * A snapshot for the local state for a given repository
+ */
+export interface ILocalRepositoryState {
+  /**
+   * The ahead/behind count for the current branch, or `null` if no tracking
+   * branch found.
+   */
+  readonly aheadBehind: IAheadBehind | null
+  /**
+   * The number of uncommitted changes currently in the repository.
+   */
+  readonly changedFilesCount: number
+}
merged
  result 100644 54aa27904efa1f49453cd0037982138833b7f1cb app/src/models/status.ts
  our    100644 c3c2f71e62048e24ae2152ec5bb51a37b4ec08b7 app/src/models/status.ts
@@ -144,15 +144,14 @@
   /** the status of the change to the file */
   public readonly status: AppFileStatus

+  /** An ID for the file change. */
+  public readonly id: string
+
   public constructor(path: string, status: AppFileStatus, oldPath?: string) {
     this.path = path
     this.status = status
     this.oldPath = oldPath
-  }
-
-  /** An ID for the file change. */
-  public get id(): string {
-    return `${this.status}+${this.path}`
+    this.id = `${this.status}+${this.path}`
   }
 }

@@ -222,9 +221,9 @@
   /**
    * The list of changes in the repository's working directory
    */
-  public readonly files: ReadonlyArray<WorkingDirectoryFileChange> = new Array<
-    WorkingDirectoryFileChange
-  >()
+  public readonly files: ReadonlyArray<WorkingDirectoryFileChange> = []
+
+  private readonly fileIxById = new Map<string, number>()

   /**
    * Update the include checkbox state of the form
@@ -245,6 +244,8 @@
     includeAll: boolean | null
   ) {
     this.files = files
+    files.forEach((f, ix) => this.fileIxById.set(f.id, ix))
+
     this.includeAll = includeAll
   }

@@ -258,7 +259,14 @@

   /** Find the file with the given ID. */
   public findFileWithID(id: string): WorkingDirectoryFileChange | null {
-    return this.files.find(f => f.id === id) || null
+    const ix = this.fileIxById.get(id)
+    return ix !== undefined ? this.files[ix] || null : null
+  }
+
+  /** Find the index of the file with the given ID. Returns -1 if not found */
+  public findFileIndexByID(id: string): number {
+    const ix = this.fileIxById.get(id)
+    return ix !== undefined ? ix : -1
   }
 }

merged
  result 100644 0211c0b5855afc22280ee81441d290e4daf89f0e app/src/ui/add-repository/create-repository.tsx
  our    100644 3d86dfd7278adf32d3ce543d8f78f9c4f6933522 app/src/ui/add-repository/create-repository.tsx
@@ -28,7 +28,6 @@
 import { Octicon, OcticonSymbol } from '../octicons'
 import { LinkButton } from '../lib/link-button'
 import { PopupType } from '../../lib/app-state'
-import { pathExists } from '../../lib/file-system'

 /** The sentinel value used to indicate no gitignore should be used. */
 const NoGitIgnoreValue = 'None'
@@ -150,25 +149,13 @@
     this.setState({ isRepository, path })
   }

-  private ensureDirectory(directory: string): Promise<void> {
-    return new Promise<void>((resolve, reject) => {
-      FSE.ensureDir(directory, err => {
-        if (err) {
-          return reject(err)
-        }
-
-        return resolve()
-      })
-    })
-  }
-
   private resolveRepositoryRoot = async (): Promise<string> => {
     const currentPath = this.state.path
     if (this.props.initialPath && this.props.initialPath === currentPath) {
       // if the user provided an initial path and didn't change it, we should
       // validate it is an existing path and use that for the repository
       try {
-        await this.ensureDirectory(currentPath)
+        await FSE.ensureDir(currentPath)
         return currentPath
       } catch {}
     }
@@ -180,7 +167,7 @@
     const fullPath = await this.resolveRepositoryRoot()

     try {
-      await this.ensureDirectory(fullPath)
+      await FSE.ensureDir(fullPath)
       this.setState({ isValidPath: true })
     } catch (e) {
       if (e.code === 'EACCES' && e.errno === -13) {
@@ -274,7 +261,7 @@

     try {
       const gitAttributes = Path.join(fullPath, '.gitattributes')
-      const gitAttributesExists = await pathExists(gitAttributes)
+      const gitAttributesExists = await FSE.pathExists(gitAttributes)
       if (!gitAttributesExists) {
         await writeGitAttributes(fullPath)
       }
merged
  result 100644 b273f0970ff626d4e8860c494a658b879c78503a app/src/ui/add-repository/git-attributes.ts
  our    100644 d7e6abfb0bd7eeaaa62ff68f64385814404a2cf4 app/src/ui/add-repository/git-attributes.ts
@@ -1,21 +1,12 @@
-import * as FS from 'fs'
-import * as Path from 'path'
+import { writeFile } from 'fs-extra'
+import { join } from 'path'

 /**
  * Write the .gitAttributes file to the given repository
  */
-export function writeGitAttributes(path: string): Promise<void> {
-  return new Promise<void>((resolve, reject) => {
-    const fullPath = Path.join(path, '.gitattributes')
-    const contents =
-      '# Auto detect text files and perform LF normalization\n* text=auto\n'
-
-    FS.writeFile(fullPath, contents, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
+export async function writeGitAttributes(path: string): Promise<void> {
+  const fullPath = join(path, '.gitattributes')
+  const contents =
+    '# Auto detect text files and perform LF normalization\n* text=auto\n'
+  await writeFile(fullPath, contents)
 }
merged
  result 100644 50809884f9200b94ab3e33a7b9ca96211cb72a25 app/src/ui/add-repository/gitignores.ts
  our    100644 14b5e0408ca2ae8146e03d585d52e9f963963607 app/src/ui/add-repository/gitignores.ts
@@ -1,5 +1,5 @@
 import * as Path from 'path'
-import * as Fs from 'fs'
+import { readdir, writeFile, readFile } from 'fs-extra'

 const GitIgnoreExtension = '.gitignore'

@@ -7,31 +7,22 @@

 let cachedGitIgnores: Map<string, string> | null = null

-function getCachedGitIgnores(): Promise<Map<string, string>> {
-  if (cachedGitIgnores) {
-    return Promise.resolve(cachedGitIgnores)
+async function getCachedGitIgnores(): Promise<Map<string, string>> {
+  if (cachedGitIgnores != null) {
+    return cachedGitIgnores
   } else {
-    return new Promise((resolve, reject) => {
-      Fs.readdir(root, (err, files) => {
-        if (err) {
-          reject(err)
-        } else {
-          const ignoreFiles = files.filter(file =>
-            file.endsWith(GitIgnoreExtension)
-          )
-
-          cachedGitIgnores = new Map()
-          for (const file of ignoreFiles) {
-            cachedGitIgnores.set(
-              Path.basename(file, GitIgnoreExtension),
-              Path.join(root, file)
-            )
-          }
+    const files = await readdir(root)
+    const ignoreFiles = files.filter(file => file.endsWith(GitIgnoreExtension))
+
+    cachedGitIgnores = new Map()
+    for (const file of ignoreFiles) {
+      cachedGitIgnores.set(
+        Path.basename(file, GitIgnoreExtension),
+        Path.join(root, file)
+      )
+    }

-          resolve(cachedGitIgnores)
-        }
-      })
-    })
+    return cachedGitIgnores
   }
 }

@@ -45,25 +36,14 @@
 async function getGitIgnoreText(name: string): Promise<string> {
   const gitIgnores = await getCachedGitIgnores()

-  return new Promise<string>((resolve, reject) => {
-    const path = gitIgnores.get(name)
-    if (!path) {
-      reject(
-        new Error(
-          `Unknown gitignore: ${name}. Only names returned from getGitIgnoreNames() can be used.`
-        )
-      )
-      return
-    }
+  const path = gitIgnores.get(name)
+  if (!path) {
+    throw new Error(
+      `Unknown gitignore: ${name}. Only names returned from getGitIgnoreNames() can be used.`
+    )
+  }

-    Fs.readFile(path, 'utf8', (err, data) => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve(data)
-      }
-    })
-  })
+  return await readFile(path, 'utf8')
 }

 /** Write the named gitignore to the repository. */
@@ -72,16 +52,6 @@
   name: string
 ): Promise<void> {
   const fullPath = Path.join(repositoryPath, '.gitignore')
-
   const text = await getGitIgnoreText(name)
-
-  return new Promise<void>((resolve, reject) => {
-    Fs.writeFile(fullPath, text, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
+  await writeFile(fullPath, text)
 }
merged
  result 100644 5bde560824e8c0b373e32c78a53dbc59473a8bdf app/src/ui/add-repository/licenses.ts
  our    100644 faaef147afa4701451223362977b28ce2faa385f app/src/ui/add-repository/licenses.ts
@@ -1,32 +1,13 @@
 import * as Path from 'path'
-import * as Fs from 'fs'
-
-interface IFrontMatterResult<T> {
-  readonly attributes: T
-  readonly body: string
-}
-
-const frontMatter: <T>(
-  path: string
-) => IFrontMatterResult<T> = require('front-matter')
-
-interface IChooseALicense {
-  readonly title: string
-  readonly nickname?: string
-  readonly featured?: boolean
-  readonly hidden?: boolean
-}
+import { writeFile, readFile } from 'fs-extra'

 export interface ILicense {
   /** The human-readable name. */
   readonly name: string
-
   /** Is the license featured? */
   readonly featured: boolean
-
   /** The actual text of the license. */
   readonly body: string
-
   /** Whether to hide the license from the standard list */
   readonly hidden: boolean
 }
@@ -39,65 +20,32 @@
   readonly year: string
 }

-const root = Path.join(__dirname, 'static', 'choosealicense.com', '_licenses')
-
 let cachedLicenses: ReadonlyArray<ILicense> | null = null

-function readFileAsync(path: string): Promise<string> {
-  return new Promise((resolve, reject) => {
-    Fs.readFile(path, 'utf8', (err, data) => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve(data)
-      }
-    })
-  })
-}
-
 /** Get the available licenses. */
-export function getLicenses(): Promise<ReadonlyArray<ILicense>> {
-  if (cachedLicenses) {
-    return Promise.resolve(cachedLicenses)
+export async function getLicenses(): Promise<ReadonlyArray<ILicense>> {
+  if (cachedLicenses != null) {
+    return cachedLicenses
   } else {
-    return new Promise((resolve, reject) => {
-      Fs.readdir(root, async (err, files) => {
-        if (err) {
-          reject(err)
-        } else {
-          const licenses = new Array<ILicense>()
-          for (const file of files) {
-            const fullPath = Path.join(root, file)
-            const contents = await readFileAsync(fullPath)
-            const result = frontMatter<IChooseALicense>(contents)
-            const license: ILicense = {
-              name: result.attributes.nickname || result.attributes.title,
-              featured: result.attributes.featured || false,
-              hidden:
-                result.attributes.hidden === undefined ||
-                result.attributes.hidden,
-              body: result.body.trim(),
-            }
-
-            if (!license.hidden) {
-              licenses.push(license)
-            }
-          }
-
-          cachedLicenses = licenses.sort((a, b) => {
-            if (a.featured) {
-              return -1
-            }
-            if (b.featured) {
-              return 1
-            }
-            return a.name.localeCompare(b.name)
-          })
-
-          resolve(cachedLicenses)
-        }
-      })
+    const licensesMetadataPath = Path.join(
+      __dirname,
+      'static',
+      'available-licenses.json'
+    )
+    const json = await readFile(licensesMetadataPath, 'utf8')
+    const licenses: Array<ILicense> = JSON.parse(json)
+
+    cachedLicenses = licenses.sort((a, b) => {
+      if (a.featured) {
+        return -1
+      }
+      if (b.featured) {
+        return 1
+      }
+      return a.name.localeCompare(b.name)
     })
+
+    return cachedLicenses
   }
 }

@@ -127,29 +75,21 @@
 }

 /** Write the license to the the repository at the given path. */
-export function writeLicense(
+export async function writeLicense(
   repositoryPath: string,
   license: ILicense,
   fields: ILicenseFields
 ): Promise<void> {
   const fullPath = Path.join(repositoryPath, 'LICENSE')

-  return new Promise<void>((resolve, reject) => {
-    const tokens: ReadonlyArray<keyof ILicenseFields> = [
-      'fullname',
-      'email',
-      'project',
-      'description',
-      'year',
-    ]
-    const body = replaceTokens(license.body, tokens, fields)
+  const tokens: ReadonlyArray<keyof ILicenseFields> = [
+    'fullname',
+    'email',
+    'project',
+    'description',
+    'year',
+  ]

-    Fs.writeFile(fullPath, body, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
+  const body = replaceTokens(license.body, tokens, fields)
+  await writeFile(fullPath, body)
 }
merged
  result 100644 f05ce45411eea70997e13c55b77d039e2aa1aa8a app/src/ui/add-repository/write-default-readme.ts
  our    100644 a9ee5d9ef7fc5782a321218da5ad12f8d34d00d3 app/src/ui/add-repository/write-default-readme.ts
@@ -1,4 +1,4 @@
-import * as FS from 'fs'
+import { writeFile } from 'fs-extra'
 import * as Path from 'path'

 const DefaultReadmeName = 'README.md'
@@ -10,16 +10,11 @@
 /**
  * Write the default README to the repository with the given name at the path.
  */
-export function writeDefaultReadme(path: string, name: string): Promise<void> {
-  return new Promise<void>((resolve, reject) => {
-    const fullPath = Path.join(path, DefaultReadmeName)
-    const contents = defaultReadmeContents(name)
-    FS.writeFile(fullPath, contents, err => {
-      if (err) {
-        reject(err)
-      } else {
-        resolve()
-      }
-    })
-  })
+export async function writeDefaultReadme(
+  path: string,
+  name: string
+): Promise<void> {
+  const fullPath = Path.join(path, DefaultReadmeName)
+  const contents = defaultReadmeContents(name)
+  await writeFile(fullPath, contents)
 }
merged
  result 100644 6a7921a17b2a7c87f83e400e06329fc525ad046e app/src/ui/app-menu/menu-pane.tsx
  our    100644 d7e43d00cd07bd5561699a12da541ef471cb3b55 app/src/ui/app-menu/menu-pane.tsx
@@ -180,7 +180,7 @@
     }
   }

-  private onSelectionChanged = (row: number, source: SelectionSource) => {
+  private onSelectedRowChanged = (row: number, source: SelectionSource) => {
     const item = this.state.items[row]
     this.props.onSelectionChanged(this.props.depth, item, source)
   }
@@ -276,9 +276,9 @@
           rowCount={this.state.items.length}
           rowHeight={this.rowHeight}
           rowRenderer={this.renderMenuItem}
-          selectedRow={this.state.selectedIndex}
+          selectedRows={[this.state.selectedIndex]}
           onRowClick={this.onRowClick}
-          onSelectionChanged={this.onSelectionChanged}
+          onSelectedRowChanged={this.onSelectedRowChanged}
           canSelectRow={this.canSelectRow}
           onRowKeyDown={this.onRowKeyDown}
           invalidationProps={this.state.items}
added in remote
  their  100644 eab8b92d267a41b8ab8c40c65e3237393641ccfc app/src/ui/app-theme.tsx
@@ -0,0 +1,59 @@
+import * as React from 'react'
+import { ApplicationTheme, getThemeName } from './lib/application-theme'
+
+interface IAppThemeProps {
+  readonly theme: ApplicationTheme
+}
+
+/**
+ * A pseudo-component responsible for adding the applicable CSS
+ * class names to the body tag in order to apply the currently
+ * selected theme.
+ *
+ * This component is a PureComponent, meaning that it'll only
+ * render when its props changes (shallow comparison).
+ *
+ * This component does not render anything into the DOM, it's
+ * purely (a)busing the component lifecycle to manipulate the
+ * body class list.
+ */
+export class AppTheme extends React.PureComponent<IAppThemeProps> {
+  public componentDidMount() {
+    this.ensureTheme()
+  }
+
+  public componentDidUpdate() {
+    this.ensureTheme()
+  }
+
+  public componentWillUnmount() {
+    this.clearThemes()
+  }
+
+  private ensureTheme() {
+    const newThemeClassName = `theme-${getThemeName(this.props.theme)}`
+    const body = document.body
+
+    if (body.classList.contains(newThemeClassName)) {
+      return
+    }
+
+    this.clearThemes()
+
+    body.classList.add(newThemeClassName)
+  }
+
+  private clearThemes() {
+    const body = document.body
+
+    for (const className of body.classList) {
+      if (className.startsWith('theme-')) {
+        body.classList.remove(className)
+      }
+    }
+  }
+
+  public render() {
+    return null
+  }
+}
merged
  result 100644 7355227d8f5b8d4c7153b94c7da59781e776bd0d app/src/ui/app.tsx
  our    100644 0349874c603d03e5db59f73672f53d9b9f74f464 app/src/ui/app.tsx
@@ -1,14 +1,15 @@
 import * as React from 'react'
-import { ipcRenderer } from 'electron'
+import { ipcRenderer, remote } from 'electron'
 import { CSSTransitionGroup } from 'react-transition-group'

 import {
   IAppState,
-  RepositorySection,
+  RepositorySectionTab,
   Popup,
   PopupType,
   FoldoutType,
   SelectionType,
+  CompareActionKind,
 } from '../lib/app-state'
 import { Dispatcher } from '../lib/dispatcher'
 import { AppStore } from '../lib/stores'
@@ -85,12 +86,17 @@
 import { InitializeLFS, AttributeMismatch } from './lfs'
 import { UpstreamAlreadyExists } from './upstream-already-exists'
 import { DeletePullRequest } from './delete-branch/delete-pull-request-dialog'
+import { MergeConflictsWarning } from './merge-conflicts'
+import { AppTheme } from './app-theme'
+import { ApplicationTheme } from './lib/application-theme'

 /** The interval at which we should check for updates. */
 const UpdateCheckInterval = 1000 * 60 * 60 * 4

 const SendStatsInterval = 1000 * 60 * 60 * 4

+const updateRepoInfoInterval = 1000 * 60 * 5
+
 interface IAppProps {
   readonly dispatcher: Dispatcher
   readonly appStore: AppStore
@@ -145,6 +151,10 @@
         },
         { timeout: ReadyDelay }
       )
+
+      window.setInterval(() => {
+        this.props.appStore.refreshAllRepositories()
+      }, updateRepoInfoInterval)
     })

     this.state = props.appStore.getState()
@@ -241,10 +251,10 @@
         return this.push()
       case 'pull':
         return this.pull()
-      case 'select-changes':
-        return this.selectChanges()
-      case 'select-history':
-        return this.selectHistory()
+      case 'show-changes':
+        return this.showChanges()
+      case 'show-history':
+        return this.showHistory()
       case 'choose-repository':
         return this.chooseRepository()
       case 'add-local-repository':
@@ -265,16 +275,23 @@
         return this.props.dispatcher.showPopup({ type: PopupType.Preferences })
       case 'open-working-directory':
         return this.openCurrentRepositoryWorkingDirectory()
-      case 'update-branch':
+      case 'update-branch': {
+        this.props.dispatcher.recordMenuInitiatedUpdate()
         return this.updateBranch()
-      case 'merge-branch':
+      }
+      case 'compare-to-branch': {
+        return this.showHistory(true)
+      }
+      case 'merge-branch': {
+        this.props.dispatcher.recordMenuInitiatedMerge()
         return this.mergeBranch()
+      }
       case 'show-repository-settings':
         return this.showRepositorySettings()
       case 'view-repository-on-github':
         return this.viewRepositoryOnGitHub()
-      case 'compare-branch':
-        return this.compareBranch()
+      case 'compare-on-github':
+        return this.compareBranchOnDotcom()
       case 'open-in-shell':
         return this.openCurrentRepositoryInShell()
       case 'clone-repository':
@@ -290,11 +307,31 @@
         return this.props.dispatcher.installCLI()
       case 'open-external-editor':
         return this.openCurrentRepositoryInExternalEditor()
+      case 'select-all':
+        return this.selectAll()
     }

     return assertNever(name, `Unknown menu event name: ${name}`)
   }

+  /**
+   * Handler for the 'select-all' menu event, dispatches
+   * a custom DOM event originating from the element which
+   * currently has keyboard focus. Components have a chance
+   * to intercept this event and implement their own 'select
+   * all' logic.
+   */
+  private selectAll() {
+    const event = new CustomEvent('select-all', {
+      bubbles: true,
+      cancelable: true,
+    })
+
+    if (document.activeElement.dispatchEvent(event)) {
+      remote.getCurrentWebContents().selectAll()
+    }
+  }
+
   private boomtown() {
     setImmediate(() => {
       throw new Error('Boomtown!')
@@ -360,7 +397,7 @@
     })
   }

-  private compareBranch() {
+  private compareBranchOnDotcom() {
     const htmlURL = this.getCurrentRepositoryGitHubURL()
     if (!htmlURL) {
       return
@@ -461,20 +498,30 @@
     this.props.dispatcher.showPopup({ type: PopupType.About })
   }

-  private selectChanges() {
+  private async showHistory(showBranchList: boolean = false) {
     const state = this.state.selectedState
     if (state == null || state.type !== SelectionType.Repository) {
       return
     }

-    this.props.dispatcher.closeCurrentFoldout()
-    this.props.dispatcher.changeRepositorySection(
+    await this.props.dispatcher.closeCurrentFoldout()
+
+    await this.props.dispatcher.initializeCompare(state.repository, {
+      kind: CompareActionKind.History,
+    })
+
+    await this.props.dispatcher.changeRepositorySection(
       state.repository,
-      RepositorySection.Changes
+      RepositorySectionTab.History
     )
+
+    await this.props.dispatcher.updateCompareForm(state.repository, {
+      filterText: '',
+      showBranchList,
+    })
   }

-  private selectHistory() {
+  private showChanges() {
     const state = this.state.selectedState
     if (state == null || state.type !== SelectionType.Repository) {
       return
@@ -483,7 +530,7 @@
     this.props.dispatcher.closeCurrentFoldout()
     this.props.dispatcher.changeRepositorySection(
       state.repository,
-      RepositorySection.History
+      RepositorySectionTab.Changes
     )
   }

@@ -934,6 +981,11 @@
           />
         )
       case PopupType.ConfirmDiscardChanges:
+        const showSetting =
+          popup.showDiscardChangesSetting === undefined
+            ? true
+            : popup.showDiscardChangesSetting
+
         return (
           <DiscardChanges
             key="discard-changes"
@@ -943,6 +995,7 @@
             confirmDiscardChanges={
               this.state.askForConfirmationOnDiscardChanges
             }
+            showDiscardChangesSetting={showSetting}
             onDismissed={this.onPopupDismissed}
             onConfirmDiscardChangesChanged={this.onConfirmDiscardChangesChanged}
           />
@@ -965,10 +1018,11 @@
             enterpriseAccount={this.getEnterpriseAccount()}
             onDismissed={this.onPopupDismissed}
             selectedShell={this.state.selectedShell}
+            selectedTheme={this.state.selectedTheme}
           />
         )
       case PopupType.MergeBranch: {
-        const repository = popup.repository
+        const { repository, branch } = popup
         const state = this.props.appStore.getRepositoryState(repository)

         const tip = state.branchesState.tip
@@ -983,6 +1037,7 @@
             defaultBranch={state.branchesState.defaultBranch}
             recentBranches={state.branchesState.recentBranches}
             currentBranch={currentBranch}
+            initialBranch={branch}
             onDismissed={this.onPopupDismissed}
           />
         )
@@ -1204,6 +1259,14 @@
             pullRequest={popup.pullRequest}
           />
         )
+      case PopupType.MergeConflicts:
+        return (
+          <MergeConflictsWarning
+            dispatcher={this.props.dispatcher}
+            repository={popup.repository}
+            onDismissed={this.onPopupDismissed}
+          />
+        )
       default:
         return assertNever(popup, `Unknown popup type: ${popup}`)
     }
@@ -1337,12 +1400,17 @@
         selectedRepository={selectedRepository}
         onSelectionChanged={this.onSelectionChanged}
         repositories={this.state.repositories}
+        localRepositoryStateLookup={this.state.localRepositoryStateLookup}
+        askForConfirmationOnRemoveRepository={
+          this.state.askForConfirmationOnRepositoryRemoval
+        }
         onRemoveRepository={this.removeRepository}
         onOpenInShell={this.openInShell}
         onShowRepository={this.showRepository}
         onOpenInExternalEditor={this.openInExternalEditor}
         externalEditorLabel={externalEditorLabel}
         shellLabel={shellLabel}
+        dispatcher={this.props.dispatcher}
       />
     )
   }
@@ -1355,8 +1423,8 @@
     this.props.dispatcher.openShell(repository.path)
   }

-  private openFileInExternalEditor = (path: string) => {
-    this.props.dispatcher.openInExternalEditor(path)
+  private openFileInExternalEditor = (fullPath: string) => {
+    this.props.dispatcher.openInExternalEditor(fullPath)
   }

   private openInExternalEditor = (
@@ -1409,6 +1477,8 @@

     const currentState: DropdownState = isOpen ? 'open' : 'closed'

+    const tooltip = repository && !isOpen ? repository.path : undefined
+
     const foldoutStyle: React.CSSProperties = {
       position: 'absolute',
       marginLeft: 0,
@@ -1422,6 +1492,7 @@
         icon={icon}
         title={title}
         description={__DARWIN__ ? 'Current Repository' : 'Current repository'}
+        tooltip={tooltip}
         foldoutStyle={foldoutStyle}
         onDropdownStateChanged={this.onRepositoryDropdownStateChanged}
         dropdownContentRenderer={this.renderRepositoryList}
@@ -1594,26 +1665,27 @@
     }

     if (selectedState.type === SelectionType.Repository) {
-      const externalEditorLabel = this.state.selectedExternalEditor
+      const externalEditorLabel = state.selectedExternalEditor

       return (
         <RepositoryView
           repository={selectedState.repository}
           state={selectedState.state}
           dispatcher={this.props.dispatcher}
-          emoji={this.state.emoji}
-          sidebarWidth={this.state.sidebarWidth}
-          commitSummaryWidth={this.state.commitSummaryWidth}
+          emoji={state.emoji}
+          sidebarWidth={state.sidebarWidth}
+          commitSummaryWidth={state.commitSummaryWidth}
           issuesStore={this.props.appStore.issuesStore}
           gitHubUserStore={this.props.appStore.gitHubUserStore}
           onViewCommitOnGitHub={this.onViewCommitOnGitHub}
-          imageDiffType={this.state.imageDiffType}
+          imageDiffType={state.imageDiffType}
           askForConfirmationOnDiscardChanges={
-            this.state.askForConfirmationOnDiscardChanges
+            state.askForConfirmationOnDiscardChanges
           }
-          accounts={this.state.accounts}
+          accounts={state.accounts}
           externalEditorLabel={externalEditorLabel}
           onOpenInExternalEditor={this.openFileInExternalEditor}
+          isDivergingBranchBannerVisible={state.isDivergingBranchBannerVisible}
         />
       )
     } else if (selectedState.type === SelectionType.CloningRepository) {
@@ -1652,8 +1724,13 @@

     const className = this.state.appIsFocused ? 'focused' : 'blurred'

+    const currentTheme = this.state.showWelcomeFlow
+      ? ApplicationTheme.Light
+      : this.state.selectedTheme
+
     return (
       <div id="desktop-app-chrome" className={className}>
+        <AppTheme theme={currentTheme} />
         {this.renderTitlebar()}
         {this.state.showWelcomeFlow
           ? this.renderWelcomeFlow()
merged
  result 100644 ffb19e643f39201e7668941e3125223f6319fdd7 app/src/ui/autocompletion/autocompleting-text-input.tsx
  our    100644 fa4fe8265157ad6e485388bac030717e2e634543 app/src/ui/autocompletion/autocompleting-text-input.tsx
@@ -1,5 +1,10 @@
 import * as React from 'react'
-import { List, SelectionSource } from '../lib/list'
+import {
+  List,
+  SelectionSource,
+  findNextSelectableRow,
+  SelectionDirection,
+} from '../lib/list'
 import { IAutocompletionProvider } from './index'
 import { fatalError } from '../../lib/fatal-error'
 import * as classNames from 'classnames'
@@ -28,6 +33,9 @@
   /** Disabled state for input field. */
   readonly disabled?: boolean

+  /** Indicates if input field should be required */
+  readonly isRequired?: boolean
+
   /**
    * Called when the user changes the value in the input field.
    */
@@ -96,7 +104,6 @@
   IAutocompletingTextInputState<Object>
 > {
   private element: ElementType | null = null
-  private autocompletionList: List | null = null

   /** The identifier for each autocompletion request. */
   private autocompletionRequestID = 0
@@ -122,10 +129,6 @@
     )
   }

-  private storeAutocompletionListRef = (ref: List | null) => {
-    this.autocompletionList = ref
-  }
-
   private renderAutocompletions() {
     const state = this.state.autocompletionState
     if (!state) {
@@ -180,17 +183,16 @@
     return (
       <div className={className} style={{ top, left, height }}>
         <List
-          ref={this.storeAutocompletionListRef}
           rowCount={items.length}
           rowHeight={RowHeight}
-          selectedRow={selectedRow}
+          selectedRows={[selectedRow]}
           rowRenderer={this.renderItem}
           scrollToRow={selectedRow}
           selectOnHover={true}
           focusOnHover={false}
           onRowMouseDown={this.onRowMouseDown}
           onRowClick={this.insertCompletionOnClick}
-          onSelectionChanged={this.onSelectionChanged}
+          onSelectedRowChanged={this.onSelectedRowChanged}
           invalidationProps={searchText}
         />
       </div>
@@ -211,7 +213,7 @@
     }
   }

-  private onSelectionChanged = (row: number, source: SelectionSource) => {
+  private onSelectedRowChanged = (row: number, source: SelectionSource) => {
     const currentAutoCompletionState = this.state.autocompletionState

     if (!currentAutoCompletionState) {
@@ -270,6 +272,7 @@
       onBlur: this.onBlur,
       onContextMenu: this.onContextMenu,
       disabled: this.props.disabled,
+      'aria-required': this.props.isRequired ? true : false,
     }

     return React.createElement<React.HTMLAttributes<ElementType>, ElementType>(
@@ -363,7 +366,7 @@

   private getMovementDirection(
     event: React.KeyboardEvent<any>
-  ): 'up' | 'down' | null {
+  ): SelectionDirection | null {
     switch (event.key) {
       case 'ArrowUp':
         return 'up'
@@ -401,11 +404,12 @@
     const direction = this.getMovementDirection(event)
     if (direction) {
       event.preventDefault()
+      const rowCount = currentAutoCompletionState.items.length

-      const nextRow = this.autocompletionList!.nextSelectableRow(
+      const nextRow = findNextSelectableRow(rowCount, {
         direction,
-        selectedRow
-      )
+        row: selectedRow,
+      })

       if (nextRow !== null) {
         const newSelectedItem = currentAutoCompletionState.items[nextRow]
added in remote
  their  100644 474f18ccb67239743953eda7f33488769a615c05 app/src/ui/branches/branch-list-item.tsx
@@ -0,0 +1,49 @@
+import * as React from 'react'
+import * as moment from 'moment'
+
+import { IMatches } from '../../lib/fuzzy-find'
+
+import { Octicon, OcticonSymbol } from '../octicons'
+import { HighlightText } from '../lib/highlight-text'
+
+interface IBranchListItemProps {
+  /** The name of the branch */
+  readonly name: string
+
+  /** Specifies whether this item is currently selected */
+  readonly isCurrentBranch: boolean
+
+  /** The date may be null if we haven't loaded the tip commit yet. */
+  readonly lastCommitDate: Date | null
+
+  /** The characters in the branch name to highlight */
+  readonly matches: IMatches
+}
+
+/** The branch component. */
+export class BranchListItem extends React.Component<IBranchListItemProps, {}> {
+  public render() {
+    const lastCommitDate = this.props.lastCommitDate
+    const isCurrentBranch = this.props.isCurrentBranch
+    const name = this.props.name
+
+    const date = lastCommitDate ? moment(lastCommitDate).fromNow() : ''
+    const icon = isCurrentBranch ? OcticonSymbol.check : OcticonSymbol.gitBranch
+    const infoTitle = isCurrentBranch
+      ? 'Current branch'
+      : lastCommitDate
+        ? lastCommitDate.toString()
+        : ''
+    return (
+      <div className="branches-list-item">
+        <Octicon className="icon" symbol={icon} />
+        <div className="name" title={name}>
+          <HighlightText text={name} highlight={this.props.matches.title} />
+        </div>
+        <div className="description" title={infoTitle}>
+          {date}
+        </div>
+      </div>
+    )
+  }
+}
merged
  result 100644 d64fb68c7b730c7a0bbccfb64e4a8acf364fd5e9 app/src/ui/branches/branch-list.tsx
  our    100644 32bcadc42b0cd4c81a0fadc6da4c43b862a2c902 app/src/ui/branches/branch-list.tsx
@@ -1,27 +1,24 @@
 import * as React from 'react'
+
 import { Branch } from '../../models/branch'
-import {
-  groupBranches,
-  IBranchListItem,
-  BranchGroupIdentifier,
-} from './group-branches'
-import { BranchListItem } from './branch'
+
+import { assertNever } from '../../lib/fatal-error'
+
 import {
   FilterList,
   IFilterListGroup,
   SelectionSource,
 } from '../lib/filter-list'
-import { assertNever } from '../../lib/fatal-error'
+import { IMatches } from '../../lib/fuzzy-find'
 import { Button } from '../lib/button'
-import { NoBranches } from './no-branches'
+import { TextBox } from '../lib/text-box'

-/**
- * TS can't parse generic specialization in JSX, so we have to alias it here
- * with the generic type. See https://github.com/Microsoft/TypeScript/issues/6395.
- */
-const BranchesFilterList: new () => FilterList<
-  IBranchListItem
-> = FilterList as any
+import {
+  groupBranches,
+  IBranchListItem,
+  BranchGroupIdentifier,
+} from './group-branches'
+import { NoBranches } from './no-branches'

 const RowHeight = 30

@@ -91,6 +88,16 @@
    * to prepopulate the new branch name field.
    */
   readonly onCreateNewBranch?: (name: string) => void
+
+  readonly textbox?: TextBox
+
+  /**
+   * Render function to apply to each branch in the list
+   */
+  readonly renderBranch: (
+    item: IBranchListItem,
+    matches: IMatches
+  ) => JSX.Element
 }

 interface IBranchListState {
@@ -138,30 +145,77 @@
   IBranchListProps,
   IBranchListState
 > {
+  private branchFilterList: FilterList<IBranchListItem> | null = null
+
   public constructor(props: IBranchListProps) {
     super(props)
     this.state = createState(props)
   }

-  private renderItem = (
-    item: IBranchListItem,
-    matches: ReadonlyArray<number>
-  ) => {
-    const branch = item.branch
-    const commit = branch.tip
-    const currentBranchName = this.props.currentBranch
-      ? this.props.currentBranch.name
-      : null
+  public componentWillReceiveProps(nextProps: IBranchListProps) {
+    this.setState(createState(nextProps))
+  }
+
+  public selectFirstItem(focus: boolean = false) {
+    if (this.branchFilterList !== null) {
+      this.branchFilterList.selectFirstItem(focus)
+    }
+  }
+
+  public render() {
     return (
-      <BranchListItem
-        name={branch.name}
-        isCurrentBranch={branch.name === currentBranchName}
-        lastCommitDate={commit ? commit.author.date : null}
-        matches={matches}
+      <FilterList<IBranchListItem>
+        ref={this.onBranchesFilterListRef}
+        className="branches-list"
+        rowHeight={RowHeight}
+        filterText={this.props.filterText}
+        onFilterTextChanged={this.props.onFilterTextChanged}
+        onFilterKeyDown={this.props.onFilterKeyDown}
+        selectedItem={this.state.selectedItem}
+        renderItem={this.renderItem}
+        renderGroupHeader={this.renderGroupHeader}
+        onItemClick={this.onItemClick}
+        onSelectionChanged={this.onSelectionChanged}
+        groups={this.state.groups}
+        invalidationProps={this.props.allBranches}
+        renderPostFilter={this.onRenderNewButton}
+        renderNoItems={this.onRenderNoItems}
+        filterTextBox={this.props.textbox}
       />
     )
   }

+  private onBranchesFilterListRef = (
+    filterList: FilterList<IBranchListItem> | null
+  ) => {
+    this.branchFilterList = filterList
+  }
+
+  private renderItem = (item: IBranchListItem, matches: IMatches) => {
+    return this.props.renderBranch(item, matches)
+  }
+
+  private parseHeader(label: string): BranchGroupIdentifier | null {
+    switch (label) {
+      case 'default':
+      case 'recent':
+      case 'other':
+        return label
+      default:
+        return null
+    }
+  }
+
+  private renderGroupHeader = (label: string) => {
+    const identifier = this.parseHeader(label)
+
+    return identifier !== null ? (
+      <div className="branches-list-content filter-list-group-header">
+        {this.getGroupLabel(identifier)}
+      </div>
+    ) : null
+  }
+
   private getGroupLabel(identifier: BranchGroupIdentifier) {
     if (identifier === 'default') {
       return __DARWIN__ ? 'Default Branch' : 'Default branch'
@@ -174,15 +228,23 @@
     }
   }

-  private renderGroupHeader = (id: string) => {
-    const identifier = id as BranchGroupIdentifier
+  private onRenderNoItems = () => {
     return (
-      <div className="branches-list-content filter-list-group-header">
-        {this.getGroupLabel(identifier)}
-      </div>
+      <NoBranches
+        onCreateNewBranch={this.onCreateNewBranch}
+        canCreateNewBranch={this.props.canCreateNewBranch}
+      />
     )
   }

+  private onRenderNewButton = () => {
+    return this.props.canCreateNewBranch ? (
+      <Button className="new-branch-button" onClick={this.onCreateNewBranch}>
+        {__DARWIN__ ? 'New Branch' : 'New branch'}
+      </Button>
+    ) : null
+  }
+
   private onItemClick = (item: IBranchListItem) => {
     if (this.props.onItemClick) {
       this.props.onItemClick(item.branch)
@@ -201,52 +263,6 @@
     }
   }

-  public componentWillReceiveProps(nextProps: IBranchListProps) {
-    this.setState(createState(nextProps))
-  }
-
-  public render() {
-    return (
-      <BranchesFilterList
-        className="branches-list"
-        rowHeight={RowHeight}
-        filterText={this.props.filterText}
-        onFilterTextChanged={this.props.onFilterTextChanged}
-        onFilterKeyDown={this.props.onFilterKeyDown}
-        selectedItem={this.state.selectedItem}
-        renderItem={this.renderItem}
-        renderGroupHeader={this.renderGroupHeader}
-        onItemClick={this.onItemClick}
-        onSelectionChanged={this.onSelectionChanged}
-        groups={this.state.groups}
-        invalidationProps={this.props.allBranches}
-        renderPostFilter={this.renderNewButton}
-        renderNoItems={this.renderNoItems}
-      />
-    )
-  }
-
-  private renderNoItems = () => {
-    return (
-      <NoBranches
-        onCreateNewBranch={this.onCreateNewBranch}
-        canCreateNewBranch={this.props.canCreateNewBranch}
-      />
-    )
-  }
-
-  private renderNewButton = () => {
-    if (this.props.canCreateNewBranch) {
-      return (
-        <Button className="new-branch-button" onClick={this.onCreateNewBranch}>
-          {__DARWIN__ ? 'New Branch' : 'New branch'}
-        </Button>
-      )
-    } else {
-      return null
-    }
-  }
-
   private onCreateNewBranch = () => {
     if (this.props.onCreateNewBranch) {
       this.props.onCreateNewBranch(this.props.filterText)
added in remote
  their  100644 dd27f7b0f40a3be55aa8a51cd83f116cf289c7e6 app/src/ui/branches/branch-renderer.tsx
@@ -0,0 +1,25 @@
+import * as React from 'react'
+
+import { Branch } from '../../models/branch'
+
+import { IBranchListItem } from './group-branches'
+import { BranchListItem } from './branch-list-item'
+import { IMatches } from '../../lib/fuzzy-find'
+
+export function renderDefaultBranch(
+  item: IBranchListItem,
+  matches: IMatches,
+  currentBranch: Branch | null
+): JSX.Element {
+  const branch = item.branch
+  const commit = branch.tip
+  const currentBranchName = currentBranch ? currentBranch.name : null
+  return (
+    <BranchListItem
+      name={branch.name}
+      isCurrentBranch={branch.name === currentBranchName}
+      lastCommitDate={commit ? commit.author.date : null}
+      matches={matches}
+    />
+  )
+}
removed in remote
  base   100644 a0b819ee744d244551744b38bdf6cc5ab5cfd9bf app/src/ui/branches/branch.tsx
  our    100644 a0b819ee744d244551744b38bdf6cc5ab5cfd9bf app/src/ui/branches/branch.tsx
@@ -1,42 +0,0 @@
-import * as React from 'react'
-import * as moment from 'moment'
-
-import { Octicon, OcticonSymbol } from '../octicons'
-import { HighlightText } from '../lib/highlight-text'
-
-interface IBranchProps {
-  readonly name: string
-  readonly isCurrentBranch: boolean
-
-  /** The date may be null if we haven't loaded the tip commit yet. */
-  readonly lastCommitDate: Date | null
-
-  /** The characters in the branch name to highlight */
-  readonly matches: ReadonlyArray<number>
-}
-
-/** The branch component. */
-export class BranchListItem extends React.Component<IBranchProps, {}> {
-  public render() {
-    const lastCommitDate = this.props.lastCommitDate
-    const isCurrentBranch = this.props.isCurrentBranch
-    const name = this.props.name
-
-    const date = lastCommitDate ? moment(lastCommitDate).fromNow() : ''
-    const icon = isCurrentBranch ? OcticonSymbol.check : OcticonSymbol.gitBranch
-    const infoTitle = isCurrentBranch
-      ? 'Current branch'
-      : lastCommitDate ? lastCommitDate.toString() : ''
-    return (
-      <div className="branches-list-item">
-        <Octicon className="icon" symbol={icon} />
-        <div className="name" title={name}>
-          <HighlightText text={name} highlight={this.props.matches} />
-        </div>
-        <div className="description" title={infoTitle}>
-          {date}
-        </div>
-      </div>
-    )
-  }
-}
merged
  result 100644 13f691705648f0b7a0f7303372de8f2db79f3d76 app/src/ui/branches/branches-container.tsx
  our    100644 2f69f46fba8a6dfaa8628742c9c00631c32b24c3 app/src/ui/branches/branches-container.tsx
@@ -1,16 +1,23 @@
 import * as React from 'react'
-import { Dispatcher } from '../../lib/dispatcher'
-import { FoldoutType, PopupType } from '../../lib/app-state'
+import { CSSTransitionGroup } from 'react-transition-group'
+
+import { PullRequest } from '../../models/pull-request'
 import { Repository } from '../../models/repository'
 import { Branch } from '../../models/branch'
-import { BranchList } from './branch-list'
-import { TabBar } from '../tab-bar'
 import { BranchesTab } from '../../models/branches-tab'
+
+import { Dispatcher } from '../../lib/dispatcher'
+import { FoldoutType, PopupType } from '../../lib/app-state'
 import { assertNever } from '../../lib/fatal-error'
+
+import { TabBar } from '../tab-bar'
+
+import { BranchList } from './branch-list'
 import { PullRequestList } from './pull-request-list'
 import { PullRequestsLoading } from './pull-requests-loading'
-import { PullRequest } from '../../models/pull-request'
-import { CSSTransitionGroup } from 'react-transition-group'
+import { IBranchListItem } from './group-branches'
+import { renderDefaultBranch } from './branch-renderer'
+import { IMatches } from '../../lib/fuzzy-find'

 const PullRequestsLoadingCrossFadeInTimeout = 300
 const PullRequestsLoadingCrossFadeOutTimeout = 200
@@ -91,6 +98,10 @@
     )
   }

+  private renderBranch = (item: IBranchListItem, matches: IMatches) => {
+    return renderDefaultBranch(item, matches, this.props.currentBranch)
+  }
+
   private renderSelectedTab() {
     let tab = this.props.selectedTab
     if (!this.props.repository.gitHubRepository) {
@@ -112,6 +123,7 @@
             onSelectionChanged={this.onBranchSelectionChanged}
             canCreateNewBranch={true}
             onCreateNewBranch={this.onCreateBranchWithName}
+            renderBranch={this.renderBranch}
           />
         )

merged
  result 100644 7451fb01e997e0bfbc31e57c3e69d5f34ae179ea app/src/ui/branches/ci-status.tsx
  our    100644 1f7ff2736a141923c6fb9112cfd5f398896acf1e app/src/ui/branches/ci-status.tsx
@@ -4,6 +4,7 @@
 import { assertNever } from '../../lib/fatal-error'
 import * as classNames from 'classnames'
 import { PullRequestStatus } from '../../models/pull-request'
+import { getPRStatusSummary } from './pull-request-status'

 interface ICIStatusProps {
   /** The classname for the underlying element. */
@@ -17,7 +18,7 @@
 export class CIStatus extends React.Component<ICIStatusProps, {}> {
   public render() {
     const status = this.props.status
-    const ciTitle = generateStatusHistory(status)
+    const title = getPRStatusSummary(status)
     const state = status.state

     return (
@@ -28,25 +29,12 @@
           this.props.className
         )}
         symbol={getSymbolForState(state)}
-        title={ciTitle}
+        title={title}
       />
     )
   }
 }

-function generateStatusHistory(prStatus: PullRequestStatus): string {
-  const statusCount = prStatus.statuses.length || 0
-
-  if (statusCount === 0) {
-    return prStatus.state.toUpperCase()
-  } else {
-    const successCount = prStatus.statuses.filter(x => x.state === 'success')
-      .length
-
-    return `${successCount}/${statusCount} checks OK`
-  }
-}
-
 function getSymbolForState(state: APIRefState): OcticonSymbol {
   switch (state) {
     case 'pending':
merged
  result 100644 f4953500cb984957451e61da094929c0254c811d app/src/ui/branches/group-branches.ts
  our    100644 2fd74251410406f3439b9e4e709abb36b13b8dd8 app/src/ui/branches/group-branches.ts
@@ -4,7 +4,7 @@
 export type BranchGroupIdentifier = 'default' | 'recent' | 'other'

 export interface IBranchListItem extends IFilterListItem {
-  readonly text: string
+  readonly text: ReadonlyArray<string>
   readonly id: string
   readonly branch: Branch
 }
@@ -22,7 +22,7 @@
       identifier: 'default',
       items: [
         {
-          text: defaultBranch.name,
+          text: [defaultBranch.name],
           id: defaultBranch.name,
           branch: defaultBranch,
         },
@@ -40,7 +40,7 @@

     for (const branch of recentBranchesWithoutDefault) {
       recentBranches.push({
-        text: branch.name,
+        text: [branch.name],
         id: branch.name,
         branch,
       })
@@ -57,7 +57,7 @@
     b => b.name !== defaultBranchName && !recentBranchNames.has(b.name)
   )
   const remainingItems = remainingBranches.map(b => ({
-    text: b.name,
+    text: [b.name],
     id: b.name,
     branch: b,
   }))
merged
  result 100644 bcb647c13a47252579f1da58a3632ba021373dd8 app/src/ui/branches/index.ts
  our    100644 a62107b46da20b86867baa54600fa7cbc8f9eb41 app/src/ui/branches/index.ts
@@ -2,4 +2,6 @@
 export { BranchList } from './branch-list'
 export { BranchesContainer } from './branches-container'
 export { PullRequestBadge } from './pull-request-badge'
-export { groupBranches } from './group-branches'
+export { groupBranches, IBranchListItem } from './group-branches'
+export { BranchListItem } from './branch-list-item'
+export { renderDefaultBranch } from './branch-renderer'
merged
  result 100644 65a3baac5401a65b19efd6017970323efc6fc8fa app/src/ui/branches/no-branches.tsx
  our    100644 b6f86111727f7f6fb160bb9f2a6ed052d339dca8 app/src/ui/branches/no-branches.tsx
@@ -43,13 +43,7 @@
       )
     }

-    return (
-      <div className="no-branches">
-        <img src={BlankSlateImage} className="blankslate-image" />
-
-        <div className="title">Sorry, I can't find that branch</div>
-      </div>
-    )
+    return <div className="no-branches">Sorry, I can't find that branch</div>
   }

   private renderShortcut() {
merged
  result 100644 075b2904f501296734519cbb19ed658a9f168a05 app/src/ui/branches/pull-request-list-item.tsx
  our    100644 b89deea91855c4909ea7801c74d3978b0e398d1a app/src/ui/branches/pull-request-list-item.tsx
@@ -5,6 +5,7 @@
 import { CIStatus } from './ci-status'
 import { PullRequestStatus } from '../../models/pull-request'
 import { HighlightText } from '../lib/highlight-text'
+import { IMatches } from '../../lib/fuzzy-find'

 export interface IPullRequestListItemProps {
   /** The title. */
@@ -32,7 +33,7 @@
   readonly loading?: boolean

   /** The characters in the PR title to highlight */
-  readonly matches: ReadonlyArray<number>
+  readonly matches: IMatches
 }

 /** Pull requests as rendered in the Pull Requests list. */
@@ -51,7 +52,7 @@
   public render() {
     const title = this.props.loading === true ? undefined : this.props.title
     const subtitle = this.getSubtitle()
-
+    const matches = this.props.matches
     const className = classNames('pull-request-item', {
       loading: this.props.loading === true,
     })
@@ -61,10 +62,10 @@
         <Octicon className="icon" symbol={OcticonSymbol.gitPullRequest} />
         <div className="info">
           <div className="title" title={title}>
-            <HighlightText text={title || ''} highlight={this.props.matches} />
+            <HighlightText text={title || ''} highlight={matches.title} />
           </div>
           <div className="subtitle" title={subtitle}>
-            {subtitle}
+            <HighlightText text={subtitle || ''} highlight={matches.subtitle} />
           </div>
         </div>
         {this.renderPullRequestStatus()}
merged
  result 100644 484112784b83cd0d9be46284b3a1fb1b877894b2 app/src/ui/branches/pull-request-list.tsx
  our    100644 1f9009ad85604378e350167422ee4056fad94c1c app/src/ui/branches/pull-request-list.tsx
@@ -1,4 +1,5 @@
 import * as React from 'react'
+import * as moment from 'moment'
 import {
   FilterList,
   IFilterListGroup,
@@ -8,21 +9,14 @@
 import { PullRequestListItem } from './pull-request-list-item'
 import { PullRequest, PullRequestStatus } from '../../models/pull-request'
 import { NoPullRequests } from './no-pull-requests'
+import { IMatches } from '../../lib/fuzzy-find'

 interface IPullRequestListItem extends IFilterListItem {
   readonly id: string
-  readonly text: string
+  readonly text: ReadonlyArray<string>
   readonly pullRequest: PullRequest
 }

-/**
- * TS can't parse generic specialization in JSX, so we have to alias it here
- * with the generic type. See https://github.com/Microsoft/TypeScript/issues/6395.
- */
-const PullRequestFilterList: new () => FilterList<
-  IPullRequestListItem
-> = FilterList as any
-
 export const RowHeight = 47

 interface IPullRequestListProps {
@@ -126,7 +120,7 @@

   public render() {
     return (
-      <PullRequestFilterList
+      <FilterList<IPullRequestListItem>
         className="pull-request-list"
         rowHeight={RowHeight}
         groups={this.state.groupedItems}
@@ -157,7 +151,7 @@

   private renderPullRequest = (
     item: IPullRequestListItem,
-    matches: ReadonlyArray<number>
+    matches: IMatches
   ) => {
     const pr = item.pullRequest
     const refStatuses = pr.status != null ? pr.status.statuses : []
@@ -203,11 +197,16 @@
   }
 }

+function getSubtitle(pr: PullRequest) {
+  const timeAgo = moment(pr.created).fromNow()
+  return `#${pr.number} opened ${timeAgo} by ${pr.author}`
+}
+
 function createListItems(
   pullRequests: ReadonlyArray<PullRequest>
 ): IFilterListGroup<IPullRequestListItem> {
   const items = pullRequests.map(pr => ({
-    text: pr.title,
+    text: [pr.title, getSubtitle(pr)],
     id: pr.number.toString(),
     pullRequest: pr,
   }))
added in remote
  their  100644 54db06f6493895ecd48deef8273b206d613d60e2 app/src/ui/branches/pull-request-status.ts
@@ -0,0 +1,48 @@
+import { PullRequestStatus, ICommitStatus } from '../../models/pull-request'
+import { APIRefState } from '../../lib/api'
+import { assertNever } from '../../lib/fatal-error'
+
+function formatState(state: APIRefState): string {
+  switch (state) {
+    case 'failure':
+      return 'Commit status: failed'
+    case 'pending':
+    case 'success':
+      return `Commit status: ${state}`
+
+    default:
+      return assertNever(state, `Unknown APIRefState value: ${state}`)
+  }
+}
+
+function formatSingleStatus(status: ICommitStatus) {
+  const word = status.state
+  const sentenceCaseWord =
+    word.charAt(0).toUpperCase() + word.substring(1, word.length)
+
+  return `${sentenceCaseWord}: ${status.description}`
+}
+
+/**
+ * Convert the Pull Request status to an app-friendly string.
+ *
+ * If the pull request contains commit statuses, this method will compute
+ * the number of successful statuses. Oteherwise, it will fall back
+ * to the `state` value reported by the GitHub API.
+ */
+export function getPRStatusSummary(prStatus: PullRequestStatus): string {
+  const statusCount = prStatus.statuses.length || 0
+
+  if (statusCount === 0) {
+    return formatState(prStatus.state)
+  }
+
+  if (statusCount === 1) {
+    return formatSingleStatus(prStatus.statuses[0])
+  }
+
+  const successCount = prStatus.statuses.filter(x => x.state === 'success')
+    .length
+
+  return `${successCount}/${statusCount} checks OK`
+}
merged
  result 100644 6965fcba858e40dc9bebce9bd3f18f369bde8ae3 app/src/ui/branches/pull-requests-loading.tsx
  our    100644 55f55e50c3c466ac8f51c62622a11dae48b16ea1 app/src/ui/branches/pull-requests-loading.tsx
@@ -8,21 +8,13 @@

 const FacadeCount = 6

-/**
- * TS can't parse generic specialization in JSX, so we have to alias it here
- * with the generic type. See https://github.com/Microsoft/TypeScript/issues/6395.
- */
-const PullRequestsLoadingList: new () => FilterList<
-  IFilterListItem
-> = FilterList as any
-
 const prLoadingItemProps: IPullRequestListItemProps = {
   loading: true,
   author: '',
   created: new Date(0),
   number: 0,
   title: '',
-  matches: [],
+  matches: { title: [], subtitle: [] },
   status: {
     sha: '4b825dc642cb6eb9a060e54bf8d69288fbee4904',
     totalCount: 1,
@@ -38,7 +30,7 @@
     const items: Array<IFilterListItem> = []
     for (let i = 0; i < FacadeCount; i++) {
       items.push({
-        text: '',
+        text: [''],
         id: i.toString(),
       })
     }
@@ -51,7 +43,7 @@
     ]

     return (
-      <PullRequestsLoadingList
+      <FilterList<IFilterListItem>
         className="pull-request-list"
         rowHeight={RowHeight}
         groups={groups}
merged
  result 100644 5e20b50a00f1033a845d4faf66cd584088157811 app/src/ui/changes/changed-file.tsx
  our    100644 3bb750a806ac20d6733638b383d80bd8dc9719b6 app/src/ui/changes/changed-file.tsx
@@ -17,7 +17,7 @@
   readonly onContextMenu: (
     path: string,
     status: AppFileStatus,
-    event: React.MouseEvent<any>
+    event: React.MouseEvent<HTMLDivElement>
   ) => void
 }

merged
  result 100644 e92f60ef1e0ceb5edca52df2ec9a0ba4f404eee8 app/src/ui/changes/changes-list.tsx
  our    100644 0519a49d3e52c4ce4be705f752ca036f6160faf6 app/src/ui/changes/changes-list.tsx
@@ -1,39 +1,44 @@
 import * as React from 'react'
 import * as Path from 'path'

-import { CommitMessage } from './commit-message'
-import { ChangedFile } from './changed-file'
-import { List, ClickSource } from '../lib/list'
+import { ICommitMessage } from '../../lib/app-state'
+import { IGitHubUser } from '../../lib/databases'
+import { Dispatcher } from '../../lib/dispatcher'
+import { ITrailer } from '../../lib/git/interpret-trailers'
+import { IMenuItem } from '../../lib/menu-item'
+import { revealInFileManager } from '../../lib/app-shell'
 import {
+  AppFileStatus,
   WorkingDirectoryStatus,
   WorkingDirectoryFileChange,
-  AppFileStatus,
 } from '../../models/status'
 import { DiffSelectionType } from '../../models/diff'
 import { CommitIdentity } from '../../models/commit-identity'
+import { Repository } from '../../models/repository'
+import { IAuthor } from '../../models/author'
+import { List, ClickSource } from '../lib/list'
 import { Checkbox, CheckboxValue } from '../lib/checkbox'
-import { ICommitMessage } from '../../lib/app-state'
-import { IGitHubUser } from '../../lib/databases'
-import { Dispatcher } from '../../lib/dispatcher'
+import {
+  isSafeFileExtension,
+  DefaultEditorLabel,
+  RevealInFileManagerLabel,
+  OpenWithDefaultProgramLabel,
+} from '../lib/context-menu'
+import { CommitMessage } from './commit-message'
+import { ChangedFile } from './changed-file'
 import { IAutocompletionProvider } from '../autocompletion'
-import { Repository } from '../../models/repository'
 import { showContextualMenu } from '../main-process-proxy'
-import { IAuthor } from '../../models/author'
-import { ITrailer } from '../../lib/git/interpret-trailers'
-import { IMenuItem } from '../../lib/menu-item'
+import { arrayEquals } from '../../lib/equality'

 const RowHeight = 29
-const RestrictedFileExtensions = ['.cmd', '.exe', '.bat', '.sh']
-const defaultEditorLabel = __DARWIN__
-  ? 'Open in External Editor'
-  : 'Open in external editor'
+
 const GitIgnoreFileName = '.gitignore'

 interface IChangesListProps {
   readonly repository: Repository
   readonly workingDirectory: WorkingDirectoryStatus
-  readonly selectedFileID: string | null
-  readonly onFileSelectionChanged: (row: number) => void
+  readonly selectedFileIDs: string[]
+  readonly onFileSelectionChanged: (rows: ReadonlyArray<number>) => void
   readonly onIncludeChanged: (path: string, include: boolean) => void
   readonly onSelectAll: (selectAll: boolean) => void
   readonly onCreateCommit: (
@@ -42,17 +47,12 @@
     trailers?: ReadonlyArray<ITrailer>
   ) => Promise<boolean>
   readonly onDiscardChanges: (file: WorkingDirectoryFileChange) => void
+  readonly askForConfirmationOnDiscardChanges: boolean
   readonly onDiscardAllChanges: (
     files: ReadonlyArray<WorkingDirectoryFileChange>
   ) => void

   /**
-   * Called to reveal a file in the native file manager.
-   * @param path The path of the file relative to the root of the repository
-   */
-  readonly onRevealInFileManager: (path: string) => void
-
-  /**
    * Called to open a file it its default application
    * @param path The path of the file relative to the root of the repository
    */
@@ -69,7 +69,6 @@
    * List Props for documentation.
    */
   readonly onRowClick?: (row: number, source: ClickSource) => void
-
   readonly commitMessage: ICommitMessage | null
   readonly contextualCommitMessage: ICommitMessage | null

@@ -77,7 +76,7 @@
   readonly autocompletionProviders: ReadonlyArray<IAutocompletionProvider<any>>

   /** Called when the given pattern should be ignored. */
-  readonly onIgnore: (pattern: string) => void
+  readonly onIgnore: (pattern: string | string[]) => void

   /**
    * Whether or not to show a field for adding co-authors to
@@ -98,13 +97,58 @@
   readonly externalEditorLabel?: string

   /**
-   * Called to open a file using the user's configured applications
-   * @param path The path of the file relative to the root of the repository
+   * Callback to open a selected file using the configured external editor
+   *
+   * @param fullPath The full path to the file on disk
    */
-  readonly onOpenInExternalEditor: (path: string) => void
+  readonly onOpenInExternalEditor: (fullPath: string) => void
 }

-export class ChangesList extends React.Component<IChangesListProps, {}> {
+interface IChangesState {
+  readonly selectedRows: ReadonlyArray<number>
+}
+
+function getSelectedRowsFromProps(
+  props: IChangesListProps
+): ReadonlyArray<number> {
+  const selectedFileIDs = props.selectedFileIDs
+  const selectedRows = []
+
+  for (const id of selectedFileIDs) {
+    const ix = props.workingDirectory.findFileIndexByID(id)
+    if (ix !== -1) {
+      selectedRows.push(ix)
+    }
+  }
+
+  return selectedRows
+}
+
+export class ChangesList extends React.Component<
+  IChangesListProps,
+  IChangesState
+> {
+  public constructor(props: IChangesListProps) {
+    super(props)
+    this.state = {
+      selectedRows: getSelectedRowsFromProps(props),
+    }
+  }
+
+  public componentWillReceiveProps(nextProps: IChangesListProps) {
+    // No need to update state unless we haven't done it yet or the
+    // selected file id list has changed.
+    if (
+      !arrayEquals(nextProps.selectedFileIDs, this.props.selectedFileIDs) ||
+      !arrayEquals(
+        nextProps.workingDirectory.files,
+        this.props.workingDirectory.files
+      )
+    ) {
+      this.setState({ selectedRows: getSelectedRowsFromProps(nextProps) })
+    }
+  }
+
   private onIncludeAllChanged = (event: React.FormEvent<HTMLInputElement>) => {
     const include = event.currentTarget.checked
     this.props.onSelectAll(include)
@@ -117,7 +161,9 @@
     const includeAll =
       selection === DiffSelectionType.All
         ? true
-        : selection === DiffSelectionType.None ? false : null
+        : selection === DiffSelectionType.None
+          ? false
+          : null

     return (
       <ChangedFile
@@ -126,9 +172,9 @@
         oldPath={file.oldPath}
         include={includeAll}
         key={file.id}
+        onContextMenu={this.onItemContextMenu}
         onIncludeChanged={this.props.onIncludeChanged}
         availableWidth={this.props.availableWidth}
-        onContextMenu={this.onItemContextMenu}
       />
     )
   }
@@ -148,14 +194,43 @@
     this.props.onDiscardAllChanges(this.props.workingDirectory.files)
   }

-  private onDiscardChanges = (path: string) => {
+  private onDiscardChanges = (files: ReadonlyArray<string>) => {
     const workingDirectory = this.props.workingDirectory
-    const file = workingDirectory.files.find(f => f.path === path)
-    if (!file) {
-      return
+
+    if (files.length === 1) {
+      const modifiedFile = workingDirectory.files.find(f => f.path === files[0])
+
+      if (modifiedFile != null) {
+        this.props.onDiscardChanges(modifiedFile)
+      }
+    } else {
+      const modifiedFiles = new Array<WorkingDirectoryFileChange>()
+
+      files.forEach(file => {
+        const modifiedFile = workingDirectory.files.find(f => f.path === file)
+
+        if (modifiedFile != null) {
+          modifiedFiles.push(modifiedFile)
+        }
+      })
+
+      if (modifiedFiles.length > 0) {
+        this.props.onDiscardAllChanges(modifiedFiles)
+      }
     }
+  }

-    this.props.onDiscardChanges(file)
+  private getDiscardChangesMenuItemLabel = (files: ReadonlyArray<string>) => {
+    const label =
+      files.length === 1
+        ? __DARWIN__
+          ? `Discard Changes`
+          : `Discard changes`
+        : __DARWIN__
+          ? `Discard ${files.length} Selected Changes`
+          : `Discard ${files.length} selected changes`
+
+    return this.props.askForConfirmationOnDiscardChanges ? `${label}‚Ä¶` : label
   }

   private onContextMenu = (event: React.MouseEvent<any>) => {
@@ -175,64 +250,97 @@
   private onItemContextMenu = (
     path: string,
     status: AppFileStatus,
-    event: React.MouseEvent<any>
+    event: React.MouseEvent<HTMLDivElement>
   ) => {
     event.preventDefault()

     const extension = Path.extname(path)
-    const fileName = Path.basename(path)
-    const isSafeExtension = __WIN32__
-      ? RestrictedFileExtensions.indexOf(extension.toLowerCase()) === -1
-      : true
-    const revealInFileManagerLabel = __DARWIN__
-      ? 'Reveal in Finder'
-      : __WIN32__ ? 'Show in Explorer' : 'Show in your File Manager'
+    const isSafeExtension = isSafeFileExtension(extension)
     const openInExternalEditor = this.props.externalEditorLabel
       ? `Open in ${this.props.externalEditorLabel}`
-      : defaultEditorLabel
+      : DefaultEditorLabel
+
+    const wd = this.props.workingDirectory
+    const selectedFiles = new Array<WorkingDirectoryFileChange>()
+    const paths = new Array<string>()
+    const extensions = new Set<string>()
+
+    this.props.selectedFileIDs.forEach(fileID => {
+      const newFile = wd.findFileWithID(fileID)
+      if (newFile) {
+        selectedFiles.push(newFile)
+        paths.push(newFile.path)
+
+        const extension = Path.extname(newFile.path)
+        if (extension.length) {
+          extensions.add(extension)
+        }
+      }
+    })
+
     const items: IMenuItem[] = [
       {
-        label: __DARWIN__ ? 'Discard Changes‚Ä¶' : 'Discard changes‚Ä¶',
-        action: () => this.onDiscardChanges(path),
+        label: this.getDiscardChangesMenuItemLabel(paths),
+        action: () => this.onDiscardChanges(paths),
       },
       {
         label: __DARWIN__ ? 'Discard All Changes‚Ä¶' : 'Discard all changes‚Ä¶',
         action: () => this.onDiscardAllChanges(),
       },
       { type: 'separator' },
-      {
-        label: 'Ignore',
-        action: () => this.props.onIgnore(path),
-        enabled: fileName !== GitIgnoreFileName,
-      },
     ]

-    if (extension.length) {
+    if (paths.length === 1) {
+      items.push({
+        label: __DARWIN__ ? 'Ignore File' : 'Ignore file',
+        action: () => this.props.onIgnore(path),
+        enabled: Path.basename(path) !== GitIgnoreFileName,
+      })
+    } else if (paths.length > 1) {
       items.push({
-        label: __DARWIN__
-          ? `Ignore All ${extension} Files`
-          : `Ignore all ${extension} files`,
-        action: () => this.props.onIgnore(`*${extension}`),
-        enabled: fileName !== GitIgnoreFileName,
+        label: `Ignore ${paths.length} selected files`,
+        action: () => {
+          // Filter out any .gitignores that happens to be selected, ignoring
+          // those doesn't make sense.
+          this.props.onIgnore(
+            paths.filter(path => Path.basename(path) !== GitIgnoreFileName)
+          )
+        },
+        // Enable this action as long as there's something selected which isn't
+        // a .gitignore file.
+        enabled: paths.some(path => Path.basename(path) !== GitIgnoreFileName),
       })
     }

+    // Five menu items should be enough for everyone
+    Array.from(extensions)
+      .slice(0, 5)
+      .forEach(extension => {
+        items.push({
+          label: __DARWIN__
+            ? `Ignore All ${extension} Files`
+            : `Ignore all ${extension} files`,
+          action: () => this.props.onIgnore(`*${extension}`),
+        })
+      })
+
     items.push(
       { type: 'separator' },
       {
-        label: revealInFileManagerLabel,
-        action: () => this.props.onRevealInFileManager(path),
+        label: RevealInFileManagerLabel,
+        action: () => revealInFileManager(this.props.repository, path),
         enabled: status !== AppFileStatus.Deleted,
       },
       {
         label: openInExternalEditor,
-        action: () => this.props.onOpenInExternalEditor(path),
+        action: () => {
+          const fullPath = Path.join(this.props.repository.path, path)
+          this.props.onOpenInExternalEditor(fullPath)
+        },
         enabled: isSafeExtension && status !== AppFileStatus.Deleted,
       },
       {
-        label: __DARWIN__
-          ? 'Open with Default Program'
-          : 'Open with default program',
+        label: OpenWithDefaultProgramLabel,
         action: () => this.props.onOpenItem(path),
         enabled: isSafeExtension && status !== AppFileStatus.Deleted,
       }
@@ -243,9 +351,6 @@

   public render() {
     const fileList = this.props.workingDirectory.files
-    const selectedRow = fileList.findIndex(
-      file => file.id === this.props.selectedFileID
-    )
     const fileCount = fileList.length
     const filesPlural = fileCount === 1 ? 'file' : 'files'
     const filesDescription = `${fileCount} changed ${filesPlural}`
@@ -268,7 +373,8 @@
           rowCount={this.props.workingDirectory.files.length}
           rowHeight={RowHeight}
           rowRenderer={this.renderRow}
-          selectedRow={selectedRow}
+          selectedRows={this.state.selectedRows}
+          selectionMode="multi"
           onSelectionChanged={this.props.onFileSelectionChanged}
           invalidationProps={this.props.workingDirectory}
           onRowClick={this.props.onRowClick}
merged
  result 100644 0a0e18fc9f4c8956a648726827dc496f3d5f98db app/src/ui/changes/commit-message.tsx
  our    100644 5ea583fb1898ce0a5637a81c7d29dfcf835f8309 app/src/ui/changes/commit-message.tsx
@@ -343,8 +343,12 @@

   private get toggleCoAuthorsText(): string {
     return this.props.showCoAuthoredBy
-      ? __DARWIN__ ? 'Remove Co-Authors' : 'Remove co-authors'
-      : __DARWIN__ ? 'Add Co-Authors' : 'Add co-authors'
+      ? __DARWIN__
+        ? 'Remove Co-Authors'
+        : 'Remove co-authors'
+      : __DARWIN__
+        ? 'Add Co-Authors'
+        : 'Add co-authors'
   }

   private getAddRemoveCoAuthorsMenuItem(): IMenuItem {
@@ -491,8 +495,9 @@
           {this.renderAvatar()}

           <AutocompletingInput
+            isRequired={true}
             className="summary-field"
-            placeholder="Summary"
+            placeholder="Summary (required)"
             value={this.state.summary}
             onValueChanged={this.onSummaryChanged}
             autocompletionProviders={this.props.autocompletionProviders}
added in remote
  their  100644 cb84fdd59ab575c56de3c3411ba9c9fc989bf26d app/src/ui/changes/files-changed-badge.tsx
@@ -0,0 +1,24 @@
+import * as React from 'react'
+
+interface IFilesChangedBadgeProps {
+  readonly filesChangedCount: number
+}
+
+/** The number that can be displayed as a specific value */
+const MaximumChangesCount = 300
+
+/** Displays number of files that have changed */
+export class FilesChangedBadge extends React.Component<
+  IFilesChangedBadgeProps,
+  {}
+> {
+  public render() {
+    const filesChangedCount = this.props.filesChangedCount
+    const badgeCount =
+      filesChangedCount > MaximumChangesCount
+        ? `${MaximumChangesCount}+`
+        : filesChangedCount
+
+    return <span className="counter">{badgeCount}</span>
+  }
+}
added in remote
  their  100644 185bc1b81106f809ad63e79d4b3adf97946f68ce app/src/ui/changes/multiple-selection.tsx
@@ -0,0 +1,26 @@
+import * as React from 'react'
+import { encodePathAsUrl } from '../../lib/path'
+
+const BlankSlateImage = encodePathAsUrl(
+  __dirname,
+  'static/multiple-files-selected.svg'
+)
+
+interface IMultipleSelectionProps {
+  /** Called when the user chooses to open the repository. */
+  readonly count: number
+}
+/** The component to display when there are no local changes. */
+export class MultipleSelection extends React.Component<
+  IMultipleSelectionProps,
+  {}
+> {
+  public render() {
+    return (
+      <div className="panel blankslate" id="no-changes">
+        <img src={BlankSlateImage} className="blankslate-image" />
+        <div>{this.props.count} files selected</div>
+      </div>
+    )
+  }
+}
merged
  result 100644 090ffa423a170c926a8b7fdcd04748ff3bd2d416 app/src/ui/changes/no-changes.tsx
  our    100644 0184f2d912257317c527a0b019d070ee191f17c4 app/src/ui/changes/no-changes.tsx
@@ -1,6 +1,9 @@
 import * as React from 'react'
-import { LinkButton } from '../lib/link-button'
+
 import { encodePathAsUrl } from '../../lib/path'
+import { revealInFileManager } from '../../lib/app-shell'
+import { Repository } from '../../models/repository'
+import { LinkButton } from '../lib/link-button'

 const BlankSlateImage = encodePathAsUrl(
   __dirname,
@@ -8,8 +11,7 @@
 )

 interface INoChangesProps {
-  /** Called when the user chooses to open the repository. */
-  readonly onOpenRepository: () => void
+  readonly repository: Repository
 }

 /** The component to display when there are no local changes. */
@@ -17,7 +19,9 @@
   public render() {
     const opener = __DARWIN__
       ? 'Finder'
-      : __WIN32__ ? 'Explorer' : 'your File Manager'
+      : __WIN32__
+        ? 'Explorer'
+        : 'your File Manager'
     return (
       <div className="panel blankslate" id="no-changes">
         <img src={BlankSlateImage} className="blankslate-image" />
@@ -33,6 +37,6 @@
   }

   private open = () => {
-    this.props.onOpenRepository()
+    revealInFileManager(this.props.repository, '')
   }
 }
merged
  result 100644 ff1760bbd4b1a3d5ea8ac084b1282e99b2ea288b app/src/ui/changes/sidebar.tsx
  our    100644 c6fc23660a5320772101aa310315dc9bca822d5c app/src/ui/changes/sidebar.tsx
@@ -52,10 +52,11 @@
   readonly externalEditorLabel?: string

   /**
-   * Called to open a file using the user's configured applications
-   * @param path The path of the file relative to the root of the repository
+   * Callback to open a selected file using the configured external editor
+   *
+   * @param fullPath The full path to the file on disk
    */
-  readonly onOpenInExternalEditor: (path: string) => void
+  readonly onOpenInExternalEditor: (fullPath: string) => void
 }

 export class ChangesSidebar extends React.Component<IChangesSidebarProps, {}> {
@@ -124,9 +125,9 @@
     )
   }

-  private onFileSelectionChanged = (row: number) => {
-    const file = this.props.changes.workingDirectory.files[row]
-    this.props.dispatcher.changeChangesSelection(this.props.repository, file)
+  private onFileSelectionChanged = (rows: ReadonlyArray<number>) => {
+    const files = rows.map(i => this.props.changes.workingDirectory.files[i])
+    this.props.dispatcher.changeChangesSelection(this.props.repository, files)
   }

   private onIncludeChanged = (path: string, include: boolean) => {
@@ -169,30 +170,19 @@
   private onDiscardAllChanges = (
     files: ReadonlyArray<WorkingDirectoryFileChange>
   ) => {
-    if (!this.props.askForConfirmationOnDiscardChanges) {
-      this.props.dispatcher.discardChanges(this.props.repository, files)
-    } else {
-      this.props.dispatcher.showPopup({
-        type: PopupType.ConfirmDiscardChanges,
-        repository: this.props.repository,
-        files,
-      })
-    }
+    this.props.dispatcher.showPopup({
+      type: PopupType.ConfirmDiscardChanges,
+      repository: this.props.repository,
+      showDiscardChangesSetting: false,
+      files,
+    })
   }

-  private onIgnore = (pattern: string) => {
+  private onIgnore = (pattern: string | string[]) => {
     this.props.dispatcher.ignore(this.props.repository, pattern)
   }

   /**
-   * Reveals a file from a repository in the native file manager.
-   * @param path The path of the file relative to the root of the repository
-   */
-  private onRevealInFileManager = (path: string) => {
-    this.props.dispatcher.revealInFileManager(this.props.repository, path)
-  }
-
-  /**
    * Open file with default application.
    * @param path The path of the file relative to the root of the repository
    */
@@ -229,11 +219,18 @@
    * Handles click events from the List item container, note that this is
    * Not the same thing as the element returned by the row renderer in ChangesList
    */
-  private onChangedItemClick = (row: number, source: ClickSource) => {
+  private onChangedItemClick = (
+    rows: number | number[],
+    source: ClickSource
+  ) => {
     // Toggle selection when user presses the spacebar or enter while focused
-    // on a list item
+    // on a list item or on the list's container
     if (source.kind === 'keyboard') {
-      this.onToggleInclude(row)
+      if (rows instanceof Array) {
+        rows.forEach(row => this.onToggleInclude(row))
+      } else {
+        this.onToggleInclude(rows)
+      }
     }
   }

@@ -274,7 +271,7 @@

   public render() {
     const changesState = this.props.changes
-    const selectedFileID = changesState.selectedFileID
+    const selectedFileIDs = changesState.selectedFileIDs

     // TODO: I think user will expect the avatar to match that which
     // they have configured in GitHub.com as well as GHE so when we add
@@ -292,14 +289,16 @@
           dispatcher={this.props.dispatcher}
           repository={this.props.repository}
           workingDirectory={changesState.workingDirectory}
-          selectedFileID={selectedFileID}
+          selectedFileIDs={selectedFileIDs}
           onFileSelectionChanged={this.onFileSelectionChanged}
           onCreateCommit={this.onCreateCommit}
           onIncludeChanged={this.onIncludeChanged}
           onSelectAll={this.onSelectAll}
           onDiscardChanges={this.onDiscardChanges}
+          askForConfirmationOnDiscardChanges={
+            this.props.askForConfirmationOnDiscardChanges
+          }
           onDiscardAllChanges={this.onDiscardAllChanges}
-          onRevealInFileManager={this.onRevealInFileManager}
           onOpenItem={this.onOpenItem}
           onRowClick={this.onChangedItemClick}
           commitAuthor={this.props.commitAuthor}
merged
  result 100644 81bb2d3dc71f42c419af98460238b7063d80badd app/src/ui/clone-repository/clone-github-repository.tsx
  our    100644 e546634cdd499994bb68f6f3ed1d56e956b4bc45 app/src/ui/clone-repository/clone-github-repository.tsx
@@ -10,6 +10,7 @@
 import { FilterList } from '../lib/filter-list'
 import { API } from '../../lib/api'
 import { IFilterListGroup } from '../lib/filter-list'
+import { IMatches } from '../../lib/fuzzy-find'
 import {
   ICloneableRepositoryListItem,
   groupRepositories,
@@ -204,13 +205,13 @@

   private renderItem = (
     item: ICloneableRepositoryListItem,
-    matches: ReadonlyArray<number>
+    matches: IMatches
   ) => {
     return (
       <div className="clone-repository-list-item">
         <Octicon className="icon" symbol={item.icon} />
-        <div className="name" title={item.text}>
-          <HighlightText text={item.text} highlight={matches} />
+        <div className="name" title={item.text[0]}>
+          <HighlightText text={item.text[0]} highlight={matches.title} />
         </div>
       </div>
     )
merged
  result 100644 e8132c67eee073fe0faec333fa15a273e811d960 app/src/ui/clone-repository/clone-repository.tsx
  our    100644 b4e9cbd7caed04fee894293ace81b6f332f1b6ea app/src/ui/clone-repository/clone-repository.tsx
@@ -1,6 +1,8 @@
 import * as Path from 'path'
 import * as React from 'react'
 import { remote } from 'electron'
+import { pathExists } from 'fs-extra'
+
 import { Button } from '../lib/button'
 import { ButtonGroup } from '../lib/button-group'
 import { Dispatcher } from '../../lib/dispatcher'
@@ -17,7 +19,7 @@
 import { CloneRepositoryTab } from '../../models/clone-repository-tab'
 import { CloneGenericRepository } from './clone-generic-repository'
 import { CloneGithubRepository } from './clone-github-repository'
-import { pathExists } from '../../lib/file-system'
+
 import { assertNever } from '../../lib/fatal-error'
 import { CallToAction } from '../lib/call-to-action'

merged
  result 100644 b7412f2d5dd94cba15f7a987e719915969a75f6e app/src/ui/clone-repository/group-repositories.ts
  our    100644 d14189ae128a22845dc39ec28b62ae2e108a42ba app/src/ui/clone-repository/group-repositories.ts
@@ -11,7 +11,7 @@
   readonly id: string

   /** The search text. */
-  readonly text: string
+  readonly text: ReadonlyArray<string>

   /** The name of the repository. */
   readonly name: string
@@ -43,7 +43,7 @@

       return {
         id: repo.html_url,
-        text: `${repo.owner.login}/${repo.name}`,
+        text: [`${repo.owner.login}/${repo.name}`],
         url: repo.clone_url,
         name: repo.name,
         icon,
merged
  result 100644 9f7be035e77bad03025c737279092ba7598a0816 app/src/ui/diff/binary-file.tsx
  our    100644 81c0dcd6e5fe3e4fd3fec3e5a8dcdff5b3167656 app/src/ui/diff/binary-file.tsx
@@ -5,6 +5,8 @@
 import { openFile } from '../../lib/open-file'
 import { Dispatcher } from '../../lib/dispatcher/dispatcher'

+import { LinkButton } from '../lib/link-button'
+
 interface IBinaryFileProps {
   readonly repository: Repository
   readonly path: string
@@ -13,7 +15,7 @@

 /** represents the default view for a file that we cannot render a diff for */
 export class BinaryFile extends React.Component<IBinaryFileProps, {}> {
-  private handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+  private open = () => {
     const fullPath = Path.join(this.props.repository.path, this.props.path)
     openFile(fullPath, this.props.dispatcher)
   }
@@ -23,9 +25,9 @@
       <div className="panel binary" id="diff">
         <div className="image-header">This binary file has changed.</div>
         <div className="image-header">
-          <a href="#" onClick={this.handleClick}>
+          <LinkButton onClick={this.open}>
             Open file in external program.
-          </a>
+          </LinkButton>
         </div>
       </div>
     )
merged
  result 100644 dc40c8309be3d5fb88ce7c549d18e0a218138062 app/src/ui/diff/diff-explorer.ts
  our    100644 3ee24b252827ef7e376d781a6925ef1d1bf00a40 app/src/ui/diff/diff-explorer.ts
@@ -1,13 +1,13 @@
-import { DiffLine, DiffHunk, ITextDiff } from '../../models/diff'
+import { DiffLine, DiffHunk } from '../../models/diff'

 /**
  * Locate the diff hunk for the given (absolute) line number in the diff.
  */
 export function diffHunkForIndex(
-  diff: ITextDiff,
+  hunks: ReadonlyArray<DiffHunk>,
   index: number
 ): DiffHunk | null {
-  const hunk = diff.hunks.find(h => {
+  const hunk = hunks.find(h => {
     return index >= h.unifiedDiffStart && index <= h.unifiedDiffEnd
   })
   return hunk || null
@@ -17,10 +17,10 @@
  * Locate the diff line for the given (absolute) line number in the diff.
  */
 export function diffLineForIndex(
-  diff: ITextDiff,
+  hunks: ReadonlyArray<DiffHunk>,
   index: number
 ): DiffLine | null {
-  const hunk = diffHunkForIndex(diff, index)
+  const hunk = diffHunkForIndex(hunks, index)
   if (!hunk) {
     return null
   }
@@ -31,10 +31,10 @@
 /** Get the line number as represented in the diff text itself. */
 export function lineNumberForDiffLine(
   diffLine: DiffLine,
-  diff: ITextDiff
+  hunks: ReadonlyArray<DiffHunk>
 ): number {
   let lineOffset = 0
-  for (const hunk of diff.hunks) {
+  for (const hunk of hunks) {
     const index = hunk.lines.indexOf(diffLine)
     if (index > -1) {
       return index + lineOffset
@@ -51,10 +51,10 @@
  * should be displayed as interactive, as a hunk is not granular enough
  */
 export function findInteractiveDiffRange(
-  diff: ITextDiff,
+  hunks: ReadonlyArray<DiffHunk>,
   index: number
 ): { start: number; end: number } | null {
-  const hunk = diffHunkForIndex(diff, index)
+  const hunk = diffHunkForIndex(hunks, index)
   if (!hunk) {
     return null
   }
merged
  result 100644 fc770e214454b6980005a0f84ae50a9a1ca5d322 app/src/ui/diff/diff-line-gutter.tsx
  our    100644 352915a1f60aafefce6fe604e3b32b325148ae69 app/src/ui/diff/diff-line-gutter.tsx
@@ -1,5 +1,5 @@
 import * as React from 'react'
-import { ITextDiff, DiffLine, DiffLineType } from '../../models/diff'
+import { DiffHunk, DiffLine, DiffLineType } from '../../models/diff'
 import { diffHunkForIndex, findInteractiveDiffRange } from './diff-explorer'
 import { hoverCssClass, selectedLineClass } from './selection/selection'
 import { assertNever } from '../../lib/fatal-error'
@@ -30,7 +30,7 @@
   /**
    * The diff currently displayed in the app
    */
-  readonly diff: ITextDiff
+  readonly hunks: ReadonlyArray<DiffHunk>

   /**
    * Callback to apply hover effect to specific lines in the diff
@@ -55,7 +55,7 @@
    */
   readonly onMouseDown: (
     index: number,
-    diff: ITextDiff,
+    hunks: ReadonlyArray<DiffHunk>,
     isRangeSelection: boolean
   ) => void

@@ -183,7 +183,7 @@

   private updateHoverState(isRangeSelection: boolean, isActive: boolean) {
     if (isRangeSelection) {
-      const range = findInteractiveDiffRange(this.props.diff, this.props.index)
+      const range = findInteractiveDiffRange(this.props.hunks, this.props.index)
       if (!range) {
         console.error('unable to find range for given index in diff')
         return
@@ -210,7 +210,7 @@
   private mouseMoveHandler = (ev: MouseEvent) => {
     ev.preventDefault()

-    const hunk = diffHunkForIndex(this.props.diff, this.props.index)
+    const hunk = diffHunkForIndex(this.props.hunks, this.props.index)
     if (!hunk) {
       console.error('unable to find hunk for given line in diff')
       return
@@ -219,7 +219,7 @@
     const isRangeSelection = isMouseCursorNearEdge(ev)
     const isSelectionActive = this.props.isSelectionEnabled()

-    const range = findInteractiveDiffRange(this.props.diff, this.props.index)
+    const range = findInteractiveDiffRange(this.props.hunks, this.props.index)
     if (!range) {
       console.error('unable to find range for given index in diff')
       return
@@ -241,7 +241,7 @@
   private mouseDownHandler = (ev: MouseEvent) => {
     ev.preventDefault()
     const isRangeSelection = isMouseCursorNearEdge(ev)
-    this.props.onMouseDown(this.props.index, this.props.diff, isRangeSelection)
+    this.props.onMouseDown(this.props.index, this.props.hunks, isRangeSelection)
   }

   private applyEventHandlers = (elem: HTMLSpanElement | null) => {
merged
  result 100644 f36e0e4c22d67391c497dcea94021c47fbbc6a61 app/src/ui/diff/diff-syntax-mode.ts
  our    100644 d4f02e6c2ed4f9295eef2dbf64aba1c0ec9cfc74 app/src/ui/diff/diff-syntax-mode.ts
@@ -1,4 +1,4 @@
-import { ITextDiff, DiffLine } from '../../models/diff'
+import { DiffHunk, DiffLine } from '../../models/diff'
 import * as CodeMirror from 'codemirror'
 import { diffLineForIndex } from './diff-explorer'
 import { ITokens } from '../../lib/highlighter/types'
@@ -9,7 +9,7 @@
   /**
    * The unified diff representing the change
    */
-  readonly diff: ITextDiff
+  readonly hunks: ReadonlyArray<DiffHunk>

   /**
    * Tokens returned from the highlighter for the 'before'
@@ -80,16 +80,16 @@
 export class DiffSyntaxMode {
   public static readonly ModeName = 'github-diff-syntax'

-  private readonly diff?: ITextDiff
+  private readonly hunks?: ReadonlyArray<DiffHunk>
   private readonly oldTokens?: ITokens
   private readonly newTokens?: ITokens

   public constructor(
-    diff?: ITextDiff,
+    hunks?: ReadonlyArray<DiffHunk>,
     oldTokens?: ITokens,
     newTokens?: ITokens
   ) {
-    this.diff = diff
+    this.hunks = hunks
     this.oldTokens = oldTokens
     this.newTokens = newTokens
   }
@@ -125,11 +125,11 @@
     // This happens when the mode is running without tokens, in this
     // case there's really nothing more for us to do than what we've
     // already done above to deal with the diff line marker.
-    if (!this.diff) {
+    if (this.hunks == null) {
       return skipLine(stream, state)
     }

-    const diffLine = diffLineForIndex(this.diff, state.diffLineIndex)
+    const diffLine = diffLineForIndex(this.hunks, state.diffLineIndex)

     if (!diffLine) {
       return skipLine(stream, state)
@@ -181,7 +181,7 @@
   }

   return new DiffSyntaxMode(
-    modeOptions.diff,
+    modeOptions.hunks,
     modeOptions.oldTokens,
     modeOptions.newTokens
   )
merged
  result 100644 7c53bfbb331587afae9c40fa77ad4a1849862f53 app/src/ui/diff/image-diffs/deleted-image-diff.tsx
  our    100644 100c204b222ee1c211c495cf5774d61af6e9a9f1 app/src/ui/diff/image-diffs/deleted-image-diff.tsx
@@ -1,7 +1,7 @@
 import * as React from 'react'

 import { Image } from '../../../models/diff'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'

 interface IDeletedImageDiffProps {
   readonly previous: Image
@@ -17,7 +17,7 @@
       <div className="panel image" id="diff">
         <div className="image-diff-previous">
           <div className="image-diff-header">Deleted</div>
-          <DiffImage image={this.props.previous} />
+          <ImageContainer image={this.props.previous} />
         </div>
       </div>
     )
removed in remote
  base   100644 67ff04efa95b3fe39f2e6d791501325575a01dda app/src/ui/diff/image-diffs/diff-image.tsx
  our    100644 67ff04efa95b3fe39f2e6d791501325575a01dda app/src/ui/diff/image-diffs/diff-image.tsx
@@ -1,28 +0,0 @@
-import * as React from 'react'
-
-import { Image } from '../../../models/diff'
-
-interface IImageProps {
-  readonly image: Image
-
-  readonly style?: React.CSSProperties
-
-  readonly onElementLoad?: (img: HTMLImageElement) => void
-}
-
-export class DiffImage extends React.Component<IImageProps, {}> {
-  public render() {
-    const image = this.props.image
-    const imageSource = `data:${image.mediaType};base64,${image.contents}`
-
-    return (
-      <img src={imageSource} style={this.props.style} onLoad={this.onLoad} />
-    )
-  }
-
-  private onLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {
-    if (this.props.onElementLoad) {
-      this.props.onElementLoad(e.currentTarget)
-    }
-  }
-}
merged
  result 100644 a5bf0078cc777a1299e2fd0a994ea22e7f4e2ee4 app/src/ui/diff/image-diffs/difference-blend.tsx
  our    100644 a2e1e7a2bd40cd3103502b06e735ac8d0e05be7a app/src/ui/diff/image-diffs/difference-blend.tsx
@@ -1,5 +1,5 @@
 import * as React from 'react'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'
 import { ICommonImageDiffProperties } from './modified-image-diff'

 export class DifferenceBlend extends React.Component<
@@ -22,7 +22,7 @@
         <div className="sizing-container">
           <div className="image-container" style={style}>
             <div className="image-diff-previous">
-              <DiffImage
+              <ImageContainer
                 image={this.props.previous}
                 onElementLoad={this.props.onPreviousImageLoad}
                 style={maxSize}
@@ -30,7 +30,7 @@
             </div>

             <div className="image-diff-current">
-              <DiffImage
+              <ImageContainer
                 image={this.props.current}
                 onElementLoad={this.props.onCurrentImageLoad}
                 style={{
added in remote
  their  100644 f386dd026ea4d48ee9269f19f2a14971ff443bcd app/src/ui/diff/image-diffs/image-container.tsx
@@ -0,0 +1,31 @@
+import * as React from 'react'
+
+import { Image } from '../../../models/diff'
+
+interface IImageProps {
+  /** The image contents to render */
+  readonly image: Image
+
+  /** Optional styles to apply to the image container */
+  readonly style?: React.CSSProperties
+
+  /** callback to fire after the image has been loaded */
+  readonly onElementLoad?: (img: HTMLImageElement) => void
+}
+
+export class ImageContainer extends React.Component<IImageProps, {}> {
+  public render() {
+    const image = this.props.image
+    const imageSource = `data:${image.mediaType};base64,${image.contents}`
+
+    return (
+      <img src={imageSource} style={this.props.style} onLoad={this.onLoad} />
+    )
+  }
+
+  private onLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {
+    if (this.props.onElementLoad) {
+      this.props.onElementLoad(e.currentTarget)
+    }
+  }
+}
merged
  result 100644 72df75e401ac62f8a6dd1db8febe5c703e2719f4 app/src/ui/diff/image-diffs/new-image-diff.tsx
  our    100644 2f089e3cea9dc0357a79e44e705e11b5f56ff5b3 app/src/ui/diff/image-diffs/new-image-diff.tsx
@@ -1,7 +1,7 @@
 import * as React from 'react'

 import { Image } from '../../../models/diff'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'

 interface INewImageDiffProps {
   readonly current: Image
@@ -14,7 +14,7 @@
       <div className="panel image" id="diff">
         <div className="image-diff-current">
           <div className="image-diff-header">Added</div>
-          <DiffImage image={this.props.current} />
+          <ImageContainer image={this.props.current} />
         </div>
       </div>
     )
merged
  result 100644 4e23bc6c3f0c1317cb751c3767325753b2e108ba app/src/ui/diff/image-diffs/onion-skin.tsx
  our    100644 fd55c2e19b5edb2849cf28c270f109f2c5e29b6a app/src/ui/diff/image-diffs/onion-skin.tsx
@@ -1,6 +1,6 @@
 import * as React from 'react'
 import { ICommonImageDiffProperties } from './modified-image-diff'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'

 interface IOnionSkinState {
   readonly crossfade: number
@@ -32,7 +32,7 @@
         <div className="sizing-container" ref={this.props.onContainerRef}>
           <div className="image-container" style={style}>
             <div className="image-diff-previous" style={style}>
-              <DiffImage
+              <ImageContainer
                 image={this.props.previous}
                 onElementLoad={this.props.onPreviousImageLoad}
                 style={maxSize}
@@ -46,7 +46,7 @@
                 opacity: this.state.crossfade,
               }}
             >
-              <DiffImage
+              <ImageContainer
                 image={this.props.current}
                 onElementLoad={this.props.onCurrentImageLoad}
                 style={maxSize}
merged
  result 100644 15f3635eca7dc317535634f3b6a2425108039574 app/src/ui/diff/image-diffs/swipe.tsx
  our    100644 3521bfb7f464e480630b10b9f2a49b947501b436 app/src/ui/diff/image-diffs/swipe.tsx
@@ -1,6 +1,6 @@
 import * as React from 'react'
 import { ICommonImageDiffProperties } from './modified-image-diff'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'

 /** How much bigger the slider should be than the images. */
 const SliderOverflow = 14
@@ -35,7 +35,7 @@
         <div className="sizing-container" ref={this.props.onContainerRef}>
           <div className="image-container" style={style}>
             <div className="image-diff-current" style={style}>
-              <DiffImage
+              <ImageContainer
                 image={this.props.current}
                 onElementLoad={this.props.onCurrentImageLoad}
                 style={maxSize}
@@ -49,7 +49,7 @@
               }}
             >
               <div className="image-diff-previous" style={style}>
-                <DiffImage
+                <ImageContainer
                   image={this.props.previous}
                   onElementLoad={this.props.onPreviousImageLoad}
                   style={maxSize}
merged
  result 100644 8120d22a6487dd73d1da4fa2b4bb7515593c24cb app/src/ui/diff/image-diffs/two-up.tsx
  our    100644 b7ddc388ed938aabd72200af704a3aefccdf7ba6 app/src/ui/diff/image-diffs/two-up.tsx
@@ -1,7 +1,9 @@
 import * as React from 'react'
-import { DiffImage } from './diff-image'
+import { ImageContainer } from './image-container'
 import { ICommonImageDiffProperties } from './modified-image-diff'
 import { ISize } from './sizing'
+import { formatBytes, Sign } from '../../lib/bytes'
+import * as classNames from 'classnames'

 /**
  * The height of the Deleted/Added labels at the top and the image dimension
@@ -27,40 +29,69 @@
       ),
       maxHeight: this.props.maxSize.height - ControlsHeight,
     }
+    const percentDiff = (previous: number, current: number) => {
+      const diff = Math.round((100 * (current - previous)) / previous)
+      const sign = diff > 0 ? '+' : ''
+      return sign + diff + '%'
+    }

     const zeroSize = { width: 0, height: 0 }
     const previousImageSize = this.props.previousImageSize || zeroSize
     const currentImageSize = this.props.currentImageSize || zeroSize
+    const diffPercent = percentDiff(
+      this.props.previous.bytes,
+      this.props.current.bytes
+    )
+    const diffBytes = this.props.current.bytes - this.props.previous.bytes

     return (
-      <div className="image-diff-two-up" ref={this.props.onContainerRef}>
-        <div className="image-diff-previous">
-          <div className="image-diff-header">Deleted</div>
-          <DiffImage
-            image={this.props.previous}
-            onElementLoad={this.props.onPreviousImageLoad}
-            style={style}
-          />
+      <div className="image-diff-container" ref={this.props.onContainerRef}>
+        <div className="image-diff-two-up">
+          <div className="image-diff-previous">
+            <div className="image-diff-header">Deleted</div>
+            <ImageContainer
+              image={this.props.previous}
+              onElementLoad={this.props.onPreviousImageLoad}
+              style={style}
+            />

-          <div className="image-diff-footer">
-            <span className="strong">W:</span> {previousImageSize.width}px |{' '}
-            <span className="strong">H:</span> {previousImageSize.height}px
+            <div className="image-diff-footer">
+              <span className="strong">W:</span> {previousImageSize.width}px |{' '}
+              <span className="strong">H:</span> {previousImageSize.height}px |{' '}
+              <span className="strong">Size:</span>{' '}
+              {formatBytes(this.props.previous.bytes)}
+            </div>
           </div>
-        </div>

-        <div className="image-diff-current">
-          <div className="image-diff-header">Added</div>
-          <DiffImage
-            image={this.props.current}
-            onElementLoad={this.props.onCurrentImageLoad}
-            style={style}
-          />
+          <div className="image-diff-current">
+            <div className="image-diff-header">Added</div>
+            <ImageContainer
+              image={this.props.current}
+              onElementLoad={this.props.onCurrentImageLoad}
+              style={style}
+            />

-          <div className="image-diff-footer">
-            <span className="strong">W:</span> {currentImageSize.width}px |{' '}
-            <span className="strong">H:</span> {currentImageSize.height}px
+            <div className="image-diff-footer">
+              <span className="strong">W:</span> {currentImageSize.width}px |{' '}
+              <span className="strong">H:</span> {currentImageSize.height}px |{' '}
+              <span className="strong">Size:</span>{' '}
+              {formatBytes(this.props.current.bytes)}
+            </div>
           </div>
         </div>
+        <div className="image-diff-summary">
+          Diff:{' '}
+          <span
+            className={classNames({
+              added: diffBytes > 0,
+              removed: diffBytes < 0,
+            })}
+          >
+            {diffBytes !== 0
+              ? `${formatBytes(diffBytes, Sign.Forced)} (${diffPercent})`
+              : 'No size difference'}
+          </span>
+        </div>
       </div>
     )
   }
merged
  result 100644 8695c640dc0a5184c74a112f131a2e2a07ef572d app/src/ui/diff/index.tsx
  our    100644 4c035cd8232f41eb5911c3407db12ac26112844d app/src/ui/diff/index.tsx
@@ -1,22 +1,12 @@
-import { clipboard } from 'electron'
 import * as React from 'react'
-import * as ReactDOM from 'react-dom'
-import * as Path from 'path'
-import { Disposable } from 'event-kit'
+import { Editor } from 'codemirror'

 import { assertNever } from '../../lib/fatal-error'
-import {
-  NewImageDiff,
-  ModifiedImageDiff,
-  DeletedImageDiff,
-} from './image-diffs'
-import { BinaryFile } from './binary-file'
-
-import { Editor } from 'codemirror'
-import { CodeMirrorHost } from './code-mirror-host'
-import { Repository } from '../../models/repository'
 import { encodePathAsUrl } from '../../lib/path'
 import { ImageDiffType } from '../../lib/app-state'
+import { Dispatcher } from '../../lib/dispatcher/dispatcher'
+
+import { Repository } from '../../models/repository'
 import {
   CommittedFileChange,
   WorkingDirectoryFileChange,
@@ -28,257 +18,29 @@
   IDiff,
   IImageDiff,
   ITextDiff,
-  DiffLine,
-  DiffLineType,
   ILargeTextDiff,
 } from '../../models/diff'
-import { Dispatcher } from '../../lib/dispatcher/dispatcher'
-
-import {
-  diffLineForIndex,
-  diffHunkForIndex,
-  findInteractiveDiffRange,
-  lineNumberForDiffLine,
-} from './diff-explorer'
-import { DiffLineGutter } from './diff-line-gutter'
-import { IEditorConfigurationExtra } from './editor-configuration-extra'
-import { ISelectionStrategy } from './selection/selection-strategy'
-import { DragDropSelection } from './selection/drag-drop-selection-strategy'
-import { RangeSelection } from './selection/range-selection-strategy'
-import { Octicon, OcticonSymbol } from '../octicons'
-
-import { fatalError } from '../../lib/fatal-error'

-import { RangeSelectionSizePixels } from './edge-detection'
-import { relativeChanges } from './changed-range'
-import { getPartialBlobContents } from '../../lib/git/show'
-import { readPartialFile } from '../../lib/file-system'
-
-import { DiffSyntaxMode, IDiffSyntaxModeSpec } from './diff-syntax-mode'
-import { highlight } from '../../lib/highlighter/worker'
-import { ITokens } from '../../lib/highlighter/types'
 import { Button } from '../lib/button'

-/** The longest line for which we'd try to calculate a line diff. */
-const MaxIntraLineDiffStringLength = 4096
-
-/** The maximum number of bytes we'll process for highlighting. */
-const MaxHighlightContentLength = 256 * 1024
+import {
+  NewImageDiff,
+  ModifiedImageDiff,
+  DeletedImageDiff,
+} from './image-diffs'
+import { BinaryFile } from './binary-file'
+import { diffLineForIndex } from './diff-explorer'
+import { DiffLineGutter } from './diff-line-gutter'
+import { DiffSyntaxMode } from './diff-syntax-mode'

-// This is a custom version of the no-newline octicon that's exactly as
-// tall as it needs to be (8px) which helps with aligning it on the line.
-const narrowNoNewlineSymbol = new OcticonSymbol(
-  16,
-  8,
-  'm 16,1 0,3 c 0,0.55 -0.45,1 -1,1 l -3,0 0,2 -3,-3 3,-3 0,2 2,0 0,-2 2,0 z M 8,4 C 8,6.2 6.2,8 4,8 1.8,8 0,6.2 0,4 0,1.8 1.8,0 4,0 6.2,0 8,1.8 8,4 Z M 1.5,5.66 5.66,1.5 C 5.18,1.19 4.61,1 4,1 2.34,1 1,2.34 1,4 1,4.61 1.19,5.17 1.5,5.66 Z M 7,4 C 7,3.39 6.81,2.83 6.5,2.34 L 2.34,6.5 C 2.82,6.81 3.39,7 4,7 5.66,7 7,5.66 7,4 Z'
-)
+import { ISelectionStrategy } from './selection/selection-strategy'
+import { TextDiff } from './text-diff'

 // image used when no diff is displayed
 const NoDiffImage = encodePathAsUrl(__dirname, 'static/ufo-alert.svg')

 type ChangedFile = WorkingDirectoryFileChange | CommittedFileChange

-interface ILineFilters {
-  readonly oldLineFilter: Array<number>
-  readonly newLineFilter: Array<number>
-}
-
-interface IFileContents {
-  readonly file: ChangedFile
-  readonly oldContents: Buffer
-  readonly newContents: Buffer
-}
-
-interface IFileTokens {
-  readonly oldTokens: ITokens
-  readonly newTokens: ITokens
-}
-
-async function getOldFileContent(
-  repository: Repository,
-  file: ChangedFile
-): Promise<Buffer> {
-  if (file.status === AppFileStatus.New) {
-    return new Buffer(0)
-  }
-
-  let commitish
-
-  if (file instanceof WorkingDirectoryFileChange) {
-    // If we pass an empty string here we get the contents
-    // that are in the index. But since we call diff with
-    // --no-index (see diff.ts) we need to look at what's
-    // actually committed to get the appropriate content.
-    commitish = 'HEAD'
-  } else if (file instanceof CommittedFileChange) {
-    commitish = `${file.commitish}^`
-  } else {
-    return assertNever(file, 'Unknown file change type')
-  }
-
-  return getPartialBlobContents(
-    repository,
-    commitish,
-    file.oldPath || file.path,
-    MaxHighlightContentLength
-  )
-}
-
-async function getNewFileContent(
-  repository: Repository,
-  file: ChangedFile
-): Promise<Buffer> {
-  if (file.status === AppFileStatus.Deleted) {
-    return new Buffer(0)
-  }
-
-  if (file instanceof WorkingDirectoryFileChange) {
-    return readPartialFile(
-      Path.join(repository.path, file.path),
-      0,
-      MaxHighlightContentLength - 1
-    )
-  } else if (file instanceof CommittedFileChange) {
-    return getPartialBlobContents(
-      repository,
-      file.commitish,
-      file.path,
-      MaxHighlightContentLength
-    )
-  }
-
-  return assertNever(file, 'Unknown file change type')
-}
-
-async function getFileContents(
-  repo: Repository,
-  file: ChangedFile,
-  lineFilters: ILineFilters
-): Promise<IFileContents> {
-  const oldContentsPromise = lineFilters.oldLineFilter.length
-    ? getOldFileContent(repo, file)
-    : Promise.resolve(new Buffer(0))
-
-  const newContentsPromise = lineFilters.newLineFilter.length
-    ? getNewFileContent(repo, file)
-    : Promise.resolve(new Buffer(0))
-
-  const [oldContents, newContents] = await Promise.all([
-    oldContentsPromise.catch(e => {
-      log.error('Could not load old contents for syntax highlighting', e)
-      return new Buffer(0)
-    }),
-    newContentsPromise.catch(e => {
-      log.error('Could not load new contents for syntax highlighting', e)
-      return new Buffer(0)
-    }),
-  ])
-
-  return { file, oldContents, newContents }
-}
-
-/**
- * Figure out which lines we need to have tokenized in
- * both the old and new version of the file.
- */
-function getLineFilters(diff: ITextDiff): ILineFilters {
-  const oldLineFilter = new Array<number>()
-  const newLineFilter = new Array<number>()
-
-  const diffLines = new Array<DiffLine>()
-
-  let anyAdded = false
-  let anyDeleted = false
-
-  for (const hunk of diff.hunks) {
-    for (const line of hunk.lines) {
-      anyAdded = anyAdded || line.type === DiffLineType.Add
-      anyDeleted = anyDeleted || line.type === DiffLineType.Delete
-      diffLines.push(line)
-    }
-  }
-
-  for (const line of diffLines) {
-    // So this might need a little explaining. What we're trying
-    // to achieve here is if the diff contains only additions or
-    // only deletions we'll source all the highlighted lines from
-    // either the before or after file. That way we can completely
-    // disregard loading, and highlighting, the other version.
-    if (line.oldLineNumber !== null && line.newLineNumber !== null) {
-      if (anyAdded && !anyDeleted) {
-        newLineFilter.push(line.newLineNumber - 1)
-      } else {
-        oldLineFilter.push(line.oldLineNumber - 1)
-      }
-    } else {
-      // If there's a mix (meaning we'll have to read from both
-      // anyway) we'll prioritize the old version since
-      // that's immutable and less likely to be the subject of a
-      // race condition when someone rapidly modifies the file on
-      // disk.
-      if (line.oldLineNumber !== null) {
-        oldLineFilter.push(line.oldLineNumber - 1)
-      } else if (line.newLineNumber !== null) {
-        newLineFilter.push(line.newLineNumber - 1)
-      }
-    }
-  }
-
-  return { oldLineFilter, newLineFilter }
-}
-
-async function highlightContents(
-  contents: IFileContents,
-  tabSize: number,
-  lineFilters: ILineFilters
-): Promise<IFileTokens> {
-  const { file, oldContents, newContents } = contents
-
-  const [oldTokens, newTokens] = await Promise.all([
-    highlight(
-      oldContents.toString('utf8'),
-      Path.extname(file.oldPath || file.path),
-      tabSize,
-      lineFilters.oldLineFilter
-    ).catch(e => {
-      log.error('Highlighter worked failed for old contents', e)
-      return {}
-    }),
-    highlight(
-      newContents.toString('utf8'),
-      Path.extname(file.path),
-      tabSize,
-      lineFilters.newLineFilter
-    ).catch(e => {
-      log.error('Highlighter worked failed for new contents', e)
-      return {}
-    }),
-  ])
-
-  return { oldTokens, newTokens }
-}
-
-/**
- * Checks to see if any key parameters in the props object that are used
- * when performing highlighting has changed. This is used to determine
- * whether highlighting should abort in between asynchronous operations
- * due to some factor (like which file is currently selected) have changed
- * and thus rendering the in-flight highlighting data useless.
- */
-function highlightParametersEqual(newProps: IDiffProps, prevProps: IDiffProps) {
-  if (newProps === prevProps) {
-    return true
-  }
-
-  return (
-    newProps.file.path === prevProps.file.path &&
-    newProps.file.oldPath === prevProps.file.oldPath &&
-    newProps.diff.kind === DiffType.Text &&
-    prevProps.diff.kind === DiffType.Text &&
-    newProps.diff.text === prevProps.diff.text
-  )
-}
-
 /** The props for the Diff component. */
 interface IDiffProps {
   readonly repository: Repository
@@ -313,21 +75,6 @@
 /** A component which renders a diff for a file. */
 export class Diff extends React.Component<IDiffProps, IDiffState> {
   private codeMirror: Editor | null = null
-  private gutterWidth: number | null = null
-
-  /**
-   * We store the scroll position before reloading the same diff so that we can
-   * restore it when we're done. If we're not reloading the same diff, this'll
-   * be null.
-   */
-  private scrollPositionToRestore: { left: number; top: number } | null = null
-
-  /**
-   * A mapping from CodeMirror line handles to disposables which, when disposed
-   * cleans up any line gutter components and events associated with that line.
-   * See renderLine for more information.
-   */
-  private readonly lineCleanup = new Map<any, Disposable>()

   /**
    * Maintain the current state of the user interacting with the diff gutter
@@ -348,27 +95,7 @@
   }

   public componentWillReceiveProps(nextProps: IDiffProps) {
-    // If we're reloading the same file, we want to save the current scroll
-    // position and restore it after the diff's been updated.
-    const sameFile =
-      nextProps.file &&
-      this.props.file &&
-      nextProps.file.id === this.props.file.id
-
-    // Happy path, if the text hasn't changed we won't re-render
-    // and subsequently won't have to restore the scroll position.
-    const textHasChanged = nextProps.diff !== this.props.diff
-
     const codeMirror = this.codeMirror
-    if (codeMirror && sameFile && textHasChanged) {
-      const scrollInfo = codeMirror.getScrollInfo()
-      this.scrollPositionToRestore = {
-        left: scrollInfo.left,
-        top: scrollInfo.top,
-      }
-    } else {
-      this.scrollPositionToRestore = null
-    }

     if (
       codeMirror &&
@@ -394,8 +121,6 @@
         return
       }

-      this.gutterWidth = null
-
       const diff = nextProps.diff
       this.cachedGutterElements.forEach((element, index) => {
         if (!element) {
@@ -404,7 +129,7 @@
         }

         if (diff.kind === DiffType.Text) {
-          const line = diffLineForIndex(diff, index)
+          const line = diffLineForIndex(diff.hunks, index)
           const isIncludable = line ? line.isIncludeableLine() : false
           const isSelected = selection.isSelected(index) && isIncludable
           element.setSelected(isSelected)
@@ -413,179 +138,26 @@
     }
   }

-  public componentWillUnmount() {
-    this.dispose()
-  }
-
-  public componentDidUpdate(prevProps: IDiffProps) {
-    const diff = this.props.diff
-    if (diff === prevProps.diff) {
-      return
-    }
-
-    if (
-      prevProps.diff.kind === DiffType.Text &&
-      diff.kind === DiffType.Text &&
-      diff.text === prevProps.diff.text
-    ) {
-      return
-    }
-
-    if (diff.kind === DiffType.Text && this.codeMirror) {
-      this.codeMirror.setOption('mode', { name: DiffSyntaxMode.ModeName })
-    }
-
-    this.initDiffSyntaxMode()
-  }
-
-  public componentDidMount() {
-    if (this.props.diff.kind === DiffType.Text) {
-      this.initDiffSyntaxMode()
-    }
-  }
-
   public render() {
-    return this.renderDiff(this.props.diff)
-  }
-
-  public async initDiffSyntaxMode() {
-    const cm = this.codeMirror
-    const file = this.props.file
     const diff = this.props.diff
-    const repo = this.props.repository
-
-    if (!cm || diff.kind !== DiffType.Text) {
-      return
-    }
-
-    // Store the current props to that we can see if anything
-    // changes from underneath us as we're making asynchronous
-    // operations that makes our data stale or useless.
-    const propsSnapshot = this.props
-
-    const lineFilters = getLineFilters(diff)
-    const contents = await getFileContents(repo, file, lineFilters)
-
-    if (!highlightParametersEqual(this.props, propsSnapshot)) {
-      return
-    }
-
-    const tsOpt = cm.getOption('tabSize')
-    const tabSize = typeof tsOpt === 'number' ? tsOpt : 4
-
-    const tokens = await highlightContents(contents, tabSize, lineFilters)
-
-    if (!highlightParametersEqual(this.props, propsSnapshot)) {
-      return
-    }

-    const spec: IDiffSyntaxModeSpec = {
-      name: DiffSyntaxMode.ModeName,
-      diff,
-      oldTokens: tokens.oldTokens,
-      newTokens: tokens.newTokens,
-    }
-
-    cm.setOption('mode', spec)
-  }
-
-  private dispose() {
-    this.codeMirror = null
-
-    this.lineCleanup.forEach(disposable => disposable.dispose())
-    this.lineCleanup.clear()
-
-    document.removeEventListener('mouseup', this.onDocumentMouseUp)
-  }
-
-  /**
-   * compute the diff gutter width based on what's been rendered in the browser
-   */
-  private getAndCacheGutterWidth = (): number | null => {
-    if (this.gutterWidth) {
-      return this.gutterWidth
-    }
-
-    if (this.codeMirror) {
-      // as getWidth will return 0 for elements that are offscreen, this code
-      // will look for the first row of the current viewport, which should be
-      // onscreen
-      const viewport = this.codeMirror.getScrollInfo()
-      const top = viewport.top
-
-      const row = this.codeMirror.lineAtHeight(top, 'local')
-      const element = this.cachedGutterElements.get(row)
-
-      if (!element) {
-        console.error(
-          `unable to find element at ${row}, should probably look into that`
-        )
-        return null
-      }
-
-      this.gutterWidth = element.getWidth()
-
-      if (this.gutterWidth === 0) {
-        console.error(
-          `element at row ${row} does not have a width, should probably look into that`
-        )
-      }
-    }
-
-    return this.gutterWidth
-  }
-
-  private updateRangeHoverState = (
-    start: number,
-    end: number,
-    show: boolean
-  ) => {
-    for (let i = start; i <= end; i++) {
-      this.hoverLine(i, show)
-    }
-  }
-
-  private hoverLine = (row: number, include: boolean) => {
-    const element = this.cachedGutterElements.get(row)
-
-    // element may not be drawn by the editor, so updating it isn't necessary
-    if (element) {
-      element.setHover(include)
-    }
-  }
-
-  /**
-   * start a selection gesture based on the current interation
-   */
-  private startSelection = (
-    file: WorkingDirectoryFileChange,
-    diff: ITextDiff,
-    index: number,
-    isRangeSelection: boolean
-  ) => {
-    const snapshot = file.selection
-    const selected = snapshot.isSelected(index)
-    const desiredSelection = !selected
-
-    if (isRangeSelection) {
-      const range = findInteractiveDiffRange(diff, index)
-      if (!range) {
-        console.error('unable to find range for given line in diff')
-        return
+    switch (diff.kind) {
+      case DiffType.Text:
+        return this.renderText(diff)
+      case DiffType.Binary:
+        return this.renderBinaryFile()
+      case DiffType.Image:
+        return this.renderImage(diff)
+      case DiffType.LargeText: {
+        return this.state.forceShowLargeDiff
+          ? this.renderLargeText(diff)
+          : this.renderLargeTextDiff()
       }
-
-      this.selection = new RangeSelection(
-        range.start,
-        range.end,
-        desiredSelection,
-        snapshot
-      )
-    } else {
-      this.selection = new DragDropSelection(index, desiredSelection, snapshot)
+      case DiffType.Unrenderable:
+        return this.renderUnrenderableDiff()
+      default:
+        return assertNever(diff, `Unsupported diff type: ${diff}`)
     }
-
-    this.selection.paint(this.cachedGutterElements)
-    document.addEventListener('mouseup', this.onDocumentMouseUp)
   }

   /**
@@ -618,332 +190,6 @@
     this.selection = null
   }

-  private onGutterMouseDown = (
-    index: number,
-    diff: ITextDiff,
-    isRangeSelection: boolean
-  ) => {
-    if (!(this.props.file instanceof WorkingDirectoryFileChange)) {
-      fatalError(
-        'must not start selection when selected file is not a WorkingDirectoryFileChange'
-      )
-      return
-    }
-
-    if (isRangeSelection) {
-      const hunk = diffHunkForIndex(diff, index)
-      if (!hunk) {
-        console.error('unable to find hunk for given line in diff')
-      }
-    }
-    this.startSelection(this.props.file, diff, index, isRangeSelection)
-  }
-
-  private onGutterMouseMove = (index: number) => {
-    if (!this.selection) {
-      return
-    }
-
-    this.selection.update(index)
-    this.selection.paint(this.cachedGutterElements)
-  }
-
-  private onDiffTextMouseMove = (
-    ev: MouseEvent,
-    diff: ITextDiff,
-    index: number
-  ) => {
-    const isActive = this.isMouseCursorNearGutter(ev)
-    if (isActive === null) {
-      return
-    }
-
-    const diffLine = diffLineForIndex(diff, index)
-    if (!diffLine) {
-      return
-    }
-
-    if (!diffLine.isIncludeableLine()) {
-      return
-    }
-
-    const range = findInteractiveDiffRange(diff, index)
-    if (!range) {
-      console.error('unable to find range for given index in diff')
-      return
-    }
-
-    this.updateRangeHoverState(range.start, range.end, isActive)
-  }
-
-  private onDiffTextMouseDown = (
-    ev: MouseEvent,
-    diff: ITextDiff,
-    index: number
-  ) => {
-    const isActive = this.isMouseCursorNearGutter(ev)
-
-    if (isActive) {
-      // this line is important because it prevents the codemirror editor
-      // from handling the event and resetting the scroll position.
-      // it doesn't do this when you click on elements in the gutter,
-      // which is an amazing joke to have placed upon me right now
-      ev.preventDefault()
-
-      if (!(this.props.file instanceof WorkingDirectoryFileChange)) {
-        fatalError(
-          'must not start selection when selected file is not a WorkingDirectoryFileChange'
-        )
-        return
-      }
-
-      this.startSelection(this.props.file, diff, index, true)
-    }
-  }
-
-  private onDiffTextMouseLeave = (
-    ev: MouseEvent,
-    diff: ITextDiff,
-    index: number
-  ) => {
-    const range = findInteractiveDiffRange(diff, index)
-    if (!range) {
-      console.error('unable to find range for given index in diff')
-      return
-    }
-
-    this.updateRangeHoverState(range.start, range.end, false)
-  }
-
-  private isMouseCursorNearGutter = (ev: MouseEvent): boolean | null => {
-    const width = this.getAndCacheGutterWidth()
-
-    if (!width) {
-      // should fail earlier than this with a helpful error message
-      return null
-    }
-
-    const deltaX = ev.layerX - width
-    return deltaX >= 0 && deltaX <= RangeSelectionSizePixels
-  }
-
-  private renderLine = (instance: any, line: any, element: HTMLElement) => {
-    const existingLineDisposable = this.lineCleanup.get(line)
-
-    // If we can find the line in our cleanup list that means the line is
-    // being re-rendered. Agains, CodeMirror doesn't fire the 'delete' event
-    // when this happens.
-    if (existingLineDisposable) {
-      existingLineDisposable.dispose()
-      this.lineCleanup.delete(line)
-    }
-
-    const diff = this.props.diff
-    if (diff.kind !== DiffType.Text) {
-      return
-    }
-
-    const index = instance.getLineNumber(line) as number
-
-    const diffLine = diffLineForIndex(diff, index)
-    if (diffLine) {
-      const diffLineElement = element.children[0] as HTMLSpanElement
-
-      let noNewlineReactContainer: HTMLSpanElement | null = null
-
-      if (diffLine.noTrailingNewLine) {
-        noNewlineReactContainer = document.createElement('span')
-        noNewlineReactContainer.setAttribute(
-          'title',
-          'No newline at end of file'
-        )
-        ReactDOM.render(
-          <Octicon symbol={narrowNoNewlineSymbol} className="no-newline" />,
-          noNewlineReactContainer
-        )
-        diffLineElement.appendChild(noNewlineReactContainer)
-      }
-
-      const gutterReactContainer = document.createElement('span')
-
-      let isIncluded = false
-      if (this.props.file instanceof WorkingDirectoryFileChange) {
-        isIncluded = this.props.file.selection.isSelected(index)
-      }
-
-      const cache = this.cachedGutterElements
-
-      ReactDOM.render(
-        <DiffLineGutter
-          line={diffLine}
-          isIncluded={isIncluded}
-          index={index}
-          readOnly={this.props.readOnly}
-          diff={diff}
-          updateRangeHoverState={this.updateRangeHoverState}
-          isSelectionEnabled={this.isSelectionEnabled}
-          onMouseDown={this.onGutterMouseDown}
-          onMouseMove={this.onGutterMouseMove}
-        />,
-        gutterReactContainer,
-        function(this: DiffLineGutter) {
-          if (this !== undefined) {
-            cache.set(index, this)
-          }
-        }
-      )
-
-      const onMouseMoveLine: (ev: MouseEvent) => void = ev => {
-        this.onDiffTextMouseMove(ev, diff, index)
-      }
-
-      const onMouseDownLine: (ev: MouseEvent) => void = ev => {
-        this.onDiffTextMouseDown(ev, diff, index)
-      }
-
-      const onMouseLeaveLine: (ev: MouseEvent) => void = ev => {
-        this.onDiffTextMouseLeave(ev, diff, index)
-      }
-
-      if (!this.props.readOnly) {
-        diffLineElement.addEventListener('mousemove', onMouseMoveLine)
-        diffLineElement.addEventListener('mousedown', onMouseDownLine)
-        diffLineElement.addEventListener('mouseleave', onMouseLeaveLine)
-      }
-
-      element.insertBefore(gutterReactContainer, diffLineElement)
-
-      // Hack(ish?). In order to be a real good citizen we need to unsubscribe from
-      // the line delete event once we've been called once or the component has been
-      // unmounted. In the latter case it's _probably_ not strictly necessary since
-      // the only thing gc rooted by the event should be isolated and eligble for
-      // collection. But let's be extra cautious I guess.
-      //
-      // The only way to unsubscribe is to pass the exact same function given to the
-      // 'on' function to the 'off' so we need a reference to ourselves, basically.
-      let deleteHandler: () => void // eslint-disable-line prefer-const
-
-      // Since we manually render a react component we have to take care of unmounting
-      // it or else we'll leak memory. This disposable will unmount the component.
-      //
-      // See https://facebook.github.io/react/blog/2015/10/01/react-render-and-top-level-api.html
-      const gutterCleanup = new Disposable(() => {
-        this.cachedGutterElements.delete(index)
-
-        ReactDOM.unmountComponentAtNode(gutterReactContainer)
-
-        if (noNewlineReactContainer) {
-          ReactDOM.unmountComponentAtNode(noNewlineReactContainer)
-        }
-
-        if (!this.props.readOnly) {
-          diffLineElement.removeEventListener('mousemove', onMouseMoveLine)
-          diffLineElement.removeEventListener('mousedown', onMouseDownLine)
-          diffLineElement.removeEventListener('mouseleave', onMouseLeaveLine)
-        }
-
-        line.off('delete', deleteHandler)
-      })
-
-      // Add the cleanup disposable to our list of disposables so that we clean up when
-      // this component is unmounted or when the line is re-rendered. When either of that
-      // happens the line 'delete' event doesn't  fire.
-      this.lineCleanup.set(line, gutterCleanup)
-
-      // If the line delete event fires we dispose of the disposable (disposing is
-      // idempotent)
-      deleteHandler = () => {
-        const disp = this.lineCleanup.get(line)
-        if (disp) {
-          this.lineCleanup.delete(line)
-          disp.dispose()
-        }
-      }
-      line.on('delete', deleteHandler)
-    }
-  }
-
-  private isSelectionEnabled = () => {
-    return this.selection == null
-  }
-
-  private restoreScrollPosition(cm: Editor) {
-    const scrollPosition = this.scrollPositionToRestore
-    if (cm && scrollPosition) {
-      cm.scrollTo(scrollPosition.left, scrollPosition.top)
-    }
-  }
-
-  private markIntraLineChanges(codeMirror: Editor, diff: ITextDiff) {
-    for (const hunk of diff.hunks) {
-      const additions = hunk.lines.filter(l => l.type === DiffLineType.Add)
-      const deletions = hunk.lines.filter(l => l.type === DiffLineType.Delete)
-      if (additions.length !== deletions.length) {
-        continue
-      }
-
-      for (let i = 0; i < additions.length; i++) {
-        const addLine = additions[i]
-        const deleteLine = deletions[i]
-        if (
-          addLine.text.length > MaxIntraLineDiffStringLength ||
-          deleteLine.text.length > MaxIntraLineDiffStringLength
-        ) {
-          continue
-        }
-
-        const changeRanges = relativeChanges(
-          addLine.content,
-          deleteLine.content
-        )
-        const addRange = changeRanges.stringARange
-        if (addRange.length > 0) {
-          const addLineNumber = lineNumberForDiffLine(addLine, diff)
-          if (addLineNumber > -1) {
-            const addFrom = {
-              line: addLineNumber,
-              ch: addRange.location + 1,
-            }
-            const addTo = {
-              line: addLineNumber,
-              ch: addRange.location + addRange.length + 1,
-            }
-            codeMirror
-              .getDoc()
-              .markText(addFrom, addTo, { className: 'cm-diff-add-inner' })
-          }
-        }
-
-        const deleteRange = changeRanges.stringBRange
-        if (deleteRange.length > 0) {
-          const deleteLineNumber = lineNumberForDiffLine(deleteLine, diff)
-          if (deleteLineNumber > -1) {
-            const deleteFrom = {
-              line: deleteLineNumber,
-              ch: deleteRange.location + 1,
-            }
-            const deleteTo = {
-              line: deleteLineNumber,
-              ch: deleteRange.location + deleteRange.length + 1,
-            }
-            codeMirror.getDoc().markText(deleteFrom, deleteTo, {
-              className: 'cm-diff-delete-inner',
-            })
-          }
-        }
-      }
-    }
-  }
-
-  private onChanges = (cm: Editor) => {
-    this.restoreScrollPosition(cm)
-
-    const diff = this.props.diff
-    if (diff.kind === DiffType.Text) {
-      this.markIntraLineChanges(cm, diff)
-    }
-  }
-
   private onChangeImageDiffType = (type: ImageDiffType) => {
     this.props.dispatcher.changeImageDiffType(type)
   }
@@ -977,7 +223,7 @@
   private renderLargeTextDiff() {
     return (
       <div className="panel empty large-diff">
-        <img src={NoDiffImage} />
+        <img src={NoDiffImage} className="blankslate-image" />
         <p>
           The diff is too large to be displayed by default.
           <br />
@@ -1003,8 +249,8 @@
   private renderLargeText(diff: ILargeTextDiff) {
     // guaranteed to be set since this function won't be called if text or hunks are null
     const textDiff: ITextDiff = {
-      text: diff.text!,
-      hunks: diff.hunks!,
+      text: diff.text,
+      hunks: diff.hunks,
       kind: DiffType.Text,
       lineEndingsChange: diff.lineEndingsChange,
     }
@@ -1043,107 +289,18 @@
   }

   private renderTextDiff(diff: ITextDiff) {
-    const options: IEditorConfigurationExtra = {
-      lineNumbers: false,
-      readOnly: true,
-      showCursorWhenSelecting: false,
-      cursorBlinkRate: -1,
-      lineWrapping: true,
-      mode: { name: DiffSyntaxMode.ModeName },
-      // Make sure CodeMirror doesn't capture Tab and thus destroy tab navigation
-      extraKeys: { Tab: false },
-      scrollbarStyle: __DARWIN__ ? 'simple' : 'native',
-      styleSelectedText: true,
-      lineSeparator: '\n',
-      specialChars: /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/,
-    }
-
-    // If the text looks like it could have been formatted using Windows
-    // line endings (\r\n) we need to massage it a bit before we hand it
-    // off to CodeMirror. That's because CodeMirror has two ways of splitting
-    // lines, one is the built in which splits on \n, \r\n and \r. The last
-    // one is important because that will match carriage return characters
-    // inside a diff line. The other way is when consumers supply the
-    // lineSeparator option. That option only takes a string meaning we can
-    // either make it split on '\r\n', '\n' or '\r' but not what we would like
-    // to do, namely '\r?\n'. We want to keep CR characters inside of a diff
-    // line so that we can mark them using the specialChars attribute so
-    // we convert all \r\n to \n and remove any trailing \r character.
-    const text =
-      diff.text.indexOf('\r') !== -1
-        ? diff.text
-            // Capture the \r if followed by (positive lookahead) a \n or
-            // the end of the string. Note that this does not capture the \n.
-            .replace(/\r(?=\n|$)/g, '')
-        : diff.text
-
     return (
-      <CodeMirrorHost
-        className="diff-code-mirror"
-        value={text}
-        options={options}
-        isSelectionEnabled={this.isSelectionEnabled}
-        onChanges={this.onChanges}
-        onRenderLine={this.renderLine}
-        ref={this.getAndStoreCodeMirrorInstance}
-        onCopy={this.onCopy}
+      <TextDiff
+        repository={this.props.repository}
+        file={this.props.file}
+        readOnly={this.props.readOnly}
+        onIncludeChanged={this.props.onIncludeChanged}
+        text={diff.text}
+        hunks={diff.hunks}
       />
     )
   }

-  private onCopy = (editor: CodeMirror.Editor, event: Event) => {
-    event.preventDefault()
-
-    // Remove the diff line markers from the copied text. The beginning of the
-    // selection might start within a line, in which case we don't have to trim
-    // the diff type marker. But for selections that span multiple lines, we'll
-    // trim it.
-    const doc = editor.getDoc()
-    const lines = doc.getSelections()
-    const selectionRanges = doc.listSelections()
-    const lineContent: Array<string> = []
-
-    for (let i = 0; i < lines.length; i++) {
-      const range = selectionRanges[i]
-      const content = lines[i]
-      const contentLines = content.split('\n')
-      for (const [i, line] of contentLines.entries()) {
-        if (i === 0 && range.head.ch > 0) {
-          lineContent.push(line)
-        } else {
-          lineContent.push(line.substr(1))
-        }
-      }
-
-      const textWithoutMarkers = lineContent.join('\n')
-      clipboard.writeText(textWithoutMarkers)
-    }
-  }
-
-  private getAndStoreCodeMirrorInstance = (cmh: CodeMirrorHost | null) => {
-    this.codeMirror = cmh === null ? null : cmh.getEditor()
-  }
-
-  private renderDiff(diff: IDiff): JSX.Element | null {
-    switch (diff.kind) {
-      case DiffType.Text:
-        return this.renderText(diff)
-      case DiffType.Binary:
-        return this.renderBinaryFile()
-      case DiffType.Image:
-        return this.renderImage(diff)
-      case DiffType.LargeText: {
-        return this.state.forceShowLargeDiff
-          ? this.renderLargeText(diff)
-          : this.renderLargeTextDiff()
-      }
-      case DiffType.Unrenderable:
-        return this.renderUnrenderableDiff()
-      default:
-        return assertNever(diff, `Unsupported diff type: ${diff}`)
-    }
-  }
-
   private showLargeDiff = () => {
     this.setState({ forceShowLargeDiff: true })
   }
added in remote
  their  100644 1ece0b9f0ed9655b30e1319e0b541d63d81d049c app/src/ui/diff/syntax-highlighting/index.ts
@@ -0,0 +1,201 @@
+import * as Path from 'path'
+
+import { assertNever } from '../../../lib/fatal-error'
+
+import { getPartialBlobContents } from '../../../lib/git/show'
+import { readPartialFile } from '../../../lib/file-system'
+import { highlight } from '../../../lib/highlighter/worker'
+import { ITokens } from '../../../lib/highlighter/types'
+
+import {
+  CommittedFileChange,
+  WorkingDirectoryFileChange,
+  AppFileStatus,
+} from '../../../models/status'
+import { Repository } from '../../../models/repository'
+import { DiffHunk, DiffLineType, DiffLine } from '../../../models/diff'
+
+/** The maximum number of bytes we'll process for highlighting. */
+const MaxHighlightContentLength = 256 * 1024
+
+type ChangedFile = WorkingDirectoryFileChange | CommittedFileChange
+
+interface ILineFilters {
+  readonly oldLineFilter: Array<number>
+  readonly newLineFilter: Array<number>
+}
+
+interface IFileContents {
+  readonly file: ChangedFile
+  readonly oldContents: Buffer
+  readonly newContents: Buffer
+}
+
+interface IFileTokens {
+  readonly oldTokens: ITokens
+  readonly newTokens: ITokens
+}
+
+async function getOldFileContent(
+  repository: Repository,
+  file: ChangedFile
+): Promise<Buffer> {
+  if (file.status === AppFileStatus.New) {
+    return new Buffer(0)
+  }
+
+  let commitish
+
+  if (file instanceof WorkingDirectoryFileChange) {
+    // If we pass an empty string here we get the contents
+    // that are in the index. But since we call diff with
+    // --no-index (see diff.ts) we need to look at what's
+    // actually committed to get the appropriate content.
+    commitish = 'HEAD'
+  } else if (file instanceof CommittedFileChange) {
+    commitish = `${file.commitish}^`
+  } else {
+    return assertNever(file, 'Unknown file change type')
+  }
+
+  return getPartialBlobContents(
+    repository,
+    commitish,
+    file.oldPath || file.path,
+    MaxHighlightContentLength
+  )
+}
+
+async function getNewFileContent(
+  repository: Repository,
+  file: ChangedFile
+): Promise<Buffer> {
+  if (file.status === AppFileStatus.Deleted) {
+    return new Buffer(0)
+  }
+
+  if (file instanceof WorkingDirectoryFileChange) {
+    return readPartialFile(
+      Path.join(repository.path, file.path),
+      0,
+      MaxHighlightContentLength - 1
+    )
+  } else if (file instanceof CommittedFileChange) {
+    return getPartialBlobContents(
+      repository,
+      file.commitish,
+      file.path,
+      MaxHighlightContentLength
+    )
+  }
+
+  return assertNever(file, 'Unknown file change type')
+}
+
+export async function getFileContents(
+  repo: Repository,
+  file: ChangedFile,
+  lineFilters: ILineFilters
+): Promise<IFileContents> {
+  const oldContentsPromise = lineFilters.oldLineFilter.length
+    ? getOldFileContent(repo, file)
+    : Promise.resolve(new Buffer(0))
+
+  const newContentsPromise = lineFilters.newLineFilter.length
+    ? getNewFileContent(repo, file)
+    : Promise.resolve(new Buffer(0))
+
+  const [oldContents, newContents] = await Promise.all([
+    oldContentsPromise.catch(e => {
+      log.error('Could not load old contents for syntax highlighting', e)
+      return new Buffer(0)
+    }),
+    newContentsPromise.catch(e => {
+      log.error('Could not load new contents for syntax highlighting', e)
+      return new Buffer(0)
+    }),
+  ])
+
+  return { file, oldContents, newContents }
+}
+
+/**
+ * Figure out which lines we need to have tokenized in
+ * both the old and new version of the file.
+ */
+export function getLineFilters(hunks: ReadonlyArray<DiffHunk>): ILineFilters {
+  const oldLineFilter = new Array<number>()
+  const newLineFilter = new Array<number>()
+
+  const diffLines = new Array<DiffLine>()
+
+  let anyAdded = false
+  let anyDeleted = false
+
+  for (const hunk of hunks) {
+    for (const line of hunk.lines) {
+      anyAdded = anyAdded || line.type === DiffLineType.Add
+      anyDeleted = anyDeleted || line.type === DiffLineType.Delete
+      diffLines.push(line)
+    }
+  }
+
+  for (const line of diffLines) {
+    // So this might need a little explaining. What we're trying
+    // to achieve here is if the diff contains only additions or
+    // only deletions we'll source all the highlighted lines from
+    // either the before or after file. That way we can completely
+    // disregard loading, and highlighting, the other version.
+    if (line.oldLineNumber !== null && line.newLineNumber !== null) {
+      if (anyAdded && !anyDeleted) {
+        newLineFilter.push(line.newLineNumber - 1)
+      } else {
+        oldLineFilter.push(line.oldLineNumber - 1)
+      }
+    } else {
+      // If there's a mix (meaning we'll have to read from both
+      // anyway) we'll prioritize the old version since
+      // that's immutable and less likely to be the subject of a
+      // race condition when someone rapidly modifies the file on
+      // disk.
+      if (line.oldLineNumber !== null) {
+        oldLineFilter.push(line.oldLineNumber - 1)
+      } else if (line.newLineNumber !== null) {
+        newLineFilter.push(line.newLineNumber - 1)
+      }
+    }
+  }
+
+  return { oldLineFilter, newLineFilter }
+}
+
+export async function highlightContents(
+  contents: IFileContents,
+  tabSize: number,
+  lineFilters: ILineFilters
+): Promise<IFileTokens> {
+  const { file, oldContents, newContents } = contents
+
+  const [oldTokens, newTokens] = await Promise.all([
+    highlight(
+      oldContents.toString('utf8'),
+      Path.extname(file.oldPath || file.path),
+      tabSize,
+      lineFilters.oldLineFilter
+    ).catch(e => {
+      log.error('Highlighter worked failed for old contents', e)
+      return {}
+    }),
+    highlight(
+      newContents.toString('utf8'),
+      Path.extname(file.path),
+      tabSize,
+      lineFilters.newLineFilter
+    ).catch(e => {
+      log.error('Highlighter worked failed for new contents', e)
+      return {}
+    }),
+  ])
+
+  return { oldTokens, newTokens }
+}
added in remote
  their  100644 6fec151426449ef33b9603d5c070b906db0d39ce app/src/ui/diff/text-diff.tsx
@@ -0,0 +1,767 @@
+import * as React from 'react'
+import * as ReactDOM from 'react-dom'
+import { clipboard } from 'electron'
+import { Editor } from 'codemirror'
+import { Disposable } from 'event-kit'
+
+import { fatalError } from '../../lib/fatal-error'
+
+import { DiffHunk, DiffLineType, DiffSelection } from '../../models/diff'
+import {
+  WorkingDirectoryFileChange,
+  CommittedFileChange,
+} from '../../models/status'
+
+import { Octicon, OcticonSymbol } from '../octicons'
+
+import { IEditorConfigurationExtra } from './editor-configuration-extra'
+import { DiffSyntaxMode, IDiffSyntaxModeSpec } from './diff-syntax-mode'
+import { CodeMirrorHost } from './code-mirror-host'
+import { DiffLineGutter } from './diff-line-gutter'
+import {
+  diffLineForIndex,
+  diffHunkForIndex,
+  findInteractiveDiffRange,
+  lineNumberForDiffLine,
+} from './diff-explorer'
+import { RangeSelectionSizePixels } from './edge-detection'
+
+import { ISelectionStrategy } from './selection/selection-strategy'
+import { RangeSelection } from './selection/range-selection-strategy'
+import { DragDropSelection } from './selection/drag-drop-selection-strategy'
+
+import {
+  getLineFilters,
+  getFileContents,
+  highlightContents,
+} from './syntax-highlighting'
+import { relativeChanges } from './changed-range'
+import { Repository } from '../../models/repository'
+
+/** The longest line for which we'd try to calculate a line diff. */
+const MaxIntraLineDiffStringLength = 4096
+
+// This is a custom version of the no-newline octicon that's exactly as
+// tall as it needs to be (8px) which helps with aligning it on the line.
+const narrowNoNewlineSymbol = new OcticonSymbol(
+  16,
+  8,
+  'm 16,1 0,3 c 0,0.55 -0.45,1 -1,1 l -3,0 0,2 -3,-3 3,-3 0,2 2,0 0,-2 2,0 z M 8,4 C 8,6.2 6.2,8 4,8 1.8,8 0,6.2 0,4 0,1.8 1.8,0 4,0 6.2,0 8,1.8 8,4 Z M 1.5,5.66 5.66,1.5 C 5.18,1.19 4.61,1 4,1 2.34,1 1,2.34 1,4 1,4.61 1.19,5.17 1.5,5.66 Z M 7,4 C 7,3.39 6.81,2.83 6.5,2.34 L 2.34,6.5 C 2.82,6.81 3.39,7 4,7 5.66,7 7,5.66 7,4 Z'
+)
+
+type ChangedFile = WorkingDirectoryFileChange | CommittedFileChange
+
+/**
+ * Checks to see if any key parameters in the props object that are used
+ * when performing highlighting has changed. This is used to determine
+ * whether highlighting should abort in between asynchronous operations
+ * due to some factor (like which file is currently selected) have changed
+ * and thus rendering the in-flight highlighting data useless.
+ */
+function highlightParametersEqual(
+  newProps: ITextDiffProps,
+  prevProps: ITextDiffProps
+) {
+  if (newProps === prevProps) {
+    return true
+  }
+
+  return (
+    newProps.file.path === prevProps.file.path &&
+    newProps.file.oldPath === prevProps.file.oldPath &&
+    newProps.text === prevProps.text
+  )
+}
+
+interface ITextDiffProps {
+  readonly repository: Repository
+  readonly file: ChangedFile
+  readonly readOnly: boolean
+  readonly onIncludeChanged?: (diffSelection: DiffSelection) => void
+  readonly text: string
+  readonly hunks: ReadonlyArray<DiffHunk>
+}
+
+export class TextDiff extends React.Component<ITextDiffProps, {}> {
+  private codeMirror: Editor | null = null
+
+  private gutterWidth: number | null = null
+
+  /**
+   * We store the scroll position before reloading the same diff so that we can
+   * restore it when we're done. If we're not reloading the same diff, this'll
+   * be null.
+   */
+  private scrollPositionToRestore: { left: number; top: number } | null = null
+
+  /**
+   * A mapping from CodeMirror line handles to disposables which, when disposed
+   * cleans up any line gutter components and events associated with that line.
+   * See renderLine for more information.
+   */
+  private readonly lineCleanup = new Map<any, Disposable>()
+
+  /**
+   *  a local cache of gutter elements, keyed by the row in the diff
+   */
+  private cachedGutterElements = new Map<number, DiffLineGutter>()
+
+  /**
+   * Maintain the current state of the user interacting with the diff gutter
+   */
+  private selection: ISelectionStrategy | null = null
+
+  private async initDiffSyntaxMode() {
+    const cm = this.codeMirror
+    const file = this.props.file
+    const hunks = this.props.hunks
+    const repo = this.props.repository
+
+    if (!cm) {
+      return
+    }
+
+    // Store the current props to that we can see if anything
+    // changes from underneath us as we're making asynchronous
+    // operations that makes our data stale or useless.
+    const propsSnapshot = this.props
+
+    const lineFilters = getLineFilters(hunks)
+    const contents = await getFileContents(repo, file, lineFilters)
+
+    if (!highlightParametersEqual(this.props, propsSnapshot)) {
+      return
+    }
+
+    const tsOpt = cm.getOption('tabSize')
+    const tabSize = typeof tsOpt === 'number' ? tsOpt : 4
+
+    const tokens = await highlightContents(contents, tabSize, lineFilters)
+
+    if (!highlightParametersEqual(this.props, propsSnapshot)) {
+      return
+    }
+
+    const spec: IDiffSyntaxModeSpec = {
+      name: DiffSyntaxMode.ModeName,
+      hunks: this.props.hunks,
+      oldTokens: tokens.oldTokens,
+      newTokens: tokens.newTokens,
+    }
+
+    cm.setOption('mode', spec)
+  }
+
+  private dispose() {
+    this.codeMirror = null
+
+    this.lineCleanup.forEach(disposable => disposable.dispose())
+    this.lineCleanup.clear()
+
+    document.removeEventListener('mouseup', this.onDocumentMouseUp)
+  }
+
+  /**
+   * compute the diff gutter width based on what's been rendered in the browser
+   */
+  private getAndCacheGutterWidth = (): number | null => {
+    if (this.gutterWidth) {
+      return this.gutterWidth
+    }
+
+    if (this.codeMirror) {
+      // as getWidth will return 0 for elements that are offscreen, this code
+      // will look for the first row of the current viewport, which should be
+      // onscreen
+      const viewport = this.codeMirror.getScrollInfo()
+      const top = viewport.top
+
+      const row = this.codeMirror.lineAtHeight(top, 'local')
+      const element = this.cachedGutterElements.get(row)
+
+      if (!element) {
+        console.error(
+          `unable to find element at ${row}, should probably look into that`
+        )
+        return null
+      }
+
+      this.gutterWidth = element.getWidth()
+
+      if (this.gutterWidth === 0) {
+        console.error(
+          `element at row ${row} does not have a width, should probably look into that`
+        )
+      }
+    }
+
+    return this.gutterWidth
+  }
+
+  private updateRangeHoverState = (
+    start: number,
+    end: number,
+    show: boolean
+  ) => {
+    for (let i = start; i <= end; i++) {
+      this.hoverLine(i, show)
+    }
+  }
+
+  private hoverLine = (row: number, include: boolean) => {
+    const element = this.cachedGutterElements.get(row)
+
+    // element may not be drawn by the editor, so updating it isn't necessary
+    if (element) {
+      element.setHover(include)
+    }
+  }
+
+  /**
+   * start a selection gesture based on the current interation
+   */
+  private startSelection = (
+    file: WorkingDirectoryFileChange,
+    hunks: ReadonlyArray<DiffHunk>,
+    index: number,
+    isRangeSelection: boolean
+  ) => {
+    const snapshot = file.selection
+    const selected = snapshot.isSelected(index)
+    const desiredSelection = !selected
+
+    if (isRangeSelection) {
+      const range = findInteractiveDiffRange(hunks, index)
+      if (!range) {
+        console.error('unable to find range for given line in diff')
+        return
+      }
+
+      this.selection = new RangeSelection(
+        range.start,
+        range.end,
+        desiredSelection,
+        snapshot
+      )
+    } else {
+      this.selection = new DragDropSelection(index, desiredSelection, snapshot)
+    }
+
+    this.selection.paint(this.cachedGutterElements)
+    document.addEventListener('mouseup', this.onDocumentMouseUp)
+  }
+
+  /**
+   * Helper event listener, registered when starting a selection by
+   * clicking anywhere on or near the gutter. Immediately removes itself
+   * from the mouseup event on the document element and ends any current
+   * selection.
+   *
+   * TODO: Once Electron upgrades to Chrome 55 we can drop this in favor
+   * of the 'once' option in addEventListener, see
+   * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener
+   */
+  private onDocumentMouseUp = (ev: MouseEvent) => {
+    ev.preventDefault()
+    document.removeEventListener('mouseup', this.onDocumentMouseUp)
+    this.endSelection()
+  }
+
+  /**
+   * complete the selection gesture and apply the change to the diff
+   */
+  private endSelection = () => {
+    if (!this.props.onIncludeChanged || !this.selection) {
+      return
+    }
+
+    this.props.onIncludeChanged(this.selection.done())
+
+    // operation is completed, clean this up
+    this.selection = null
+  }
+
+  private onGutterMouseDown = (
+    index: number,
+    hunks: ReadonlyArray<DiffHunk>,
+    isRangeSelection: boolean
+  ) => {
+    if (!(this.props.file instanceof WorkingDirectoryFileChange)) {
+      fatalError(
+        'must not start selection when selected file is not a WorkingDirectoryFileChange'
+      )
+      return
+    }
+
+    if (isRangeSelection) {
+      const hunk = diffHunkForIndex(hunks, index)
+      if (!hunk) {
+        console.error('unable to find hunk for given line in diff')
+      }
+    }
+    this.startSelection(this.props.file, hunks, index, isRangeSelection)
+  }
+
+  private onGutterMouseMove = (index: number) => {
+    if (!this.selection) {
+      return
+    }
+
+    this.selection.update(index)
+    this.selection.paint(this.cachedGutterElements)
+  }
+
+  private onDiffTextMouseMove = (
+    ev: MouseEvent,
+    hunks: ReadonlyArray<DiffHunk>,
+    index: number
+  ) => {
+    const isActive = this.isMouseCursorNearGutter(ev)
+    if (isActive === null) {
+      return
+    }
+
+    const diffLine = diffLineForIndex(hunks, index)
+    if (!diffLine) {
+      return
+    }
+
+    if (!diffLine.isIncludeableLine()) {
+      return
+    }
+
+    const range = findInteractiveDiffRange(hunks, index)
+    if (!range) {
+      console.error('unable to find range for given index in diff')
+      return
+    }
+
+    this.updateRangeHoverState(range.start, range.end, isActive)
+  }
+
+  private onDiffTextMouseDown = (
+    ev: MouseEvent,
+    hunks: ReadonlyArray<DiffHunk>,
+    index: number
+  ) => {
+    const isActive = this.isMouseCursorNearGutter(ev)
+
+    if (isActive) {
+      // this line is important because it prevents the codemirror editor
+      // from handling the event and resetting the scroll position.
+      // it doesn't do this when you click on elements in the gutter,
+      // which is an amazing joke to have placed upon me right now
+      ev.preventDefault()
+
+      if (!(this.props.file instanceof WorkingDirectoryFileChange)) {
+        fatalError(
+          'must not start selection when selected file is not a WorkingDirectoryFileChange'
+        )
+        return
+      }
+
+      this.startSelection(this.props.file, hunks, index, true)
+    }
+  }
+
+  private onDiffTextMouseLeave = (
+    ev: MouseEvent,
+    hunks: ReadonlyArray<DiffHunk>,
+    index: number
+  ) => {
+    const range = findInteractiveDiffRange(hunks, index)
+    if (!range) {
+      console.error('unable to find range for given index in diff')
+      return
+    }
+
+    this.updateRangeHoverState(range.start, range.end, false)
+  }
+
+  private isMouseCursorNearGutter = (ev: MouseEvent): boolean | null => {
+    const width = this.getAndCacheGutterWidth()
+
+    if (!width) {
+      // should fail earlier than this with a helpful error message
+      return null
+    }
+
+    const deltaX = ev.layerX - width
+    return deltaX >= 0 && deltaX <= RangeSelectionSizePixels
+  }
+
+  private isSelectionEnabled = () => {
+    return this.selection == null
+  }
+
+  private restoreScrollPosition(cm: Editor) {
+    const scrollPosition = this.scrollPositionToRestore
+    if (cm && scrollPosition) {
+      cm.scrollTo(scrollPosition.left, scrollPosition.top)
+    }
+  }
+
+  private renderLine = (instance: any, line: any, element: HTMLElement) => {
+    const existingLineDisposable = this.lineCleanup.get(line)
+
+    // If we can find the line in our cleanup list that means the line is
+    // being re-rendered. Agains, CodeMirror doesn't fire the 'delete' event
+    // when this happens.
+    if (existingLineDisposable) {
+      existingLineDisposable.dispose()
+      this.lineCleanup.delete(line)
+    }
+
+    const index = instance.getLineNumber(line) as number
+
+    const diffLine = diffLineForIndex(this.props.hunks, index)
+    if (diffLine) {
+      const diffLineElement = element.children[0] as HTMLSpanElement
+
+      let noNewlineReactContainer: HTMLSpanElement | null = null
+
+      if (diffLine.noTrailingNewLine) {
+        noNewlineReactContainer = document.createElement('span')
+        noNewlineReactContainer.setAttribute(
+          'title',
+          'No newline at end of file'
+        )
+        ReactDOM.render(
+          <Octicon symbol={narrowNoNewlineSymbol} className="no-newline" />,
+          noNewlineReactContainer
+        )
+        diffLineElement.appendChild(noNewlineReactContainer)
+      }
+
+      const gutterReactContainer = document.createElement('span')
+
+      let isIncluded = false
+      if (this.props.file instanceof WorkingDirectoryFileChange) {
+        isIncluded = this.props.file.selection.isSelected(index)
+      }
+
+      const cache = this.cachedGutterElements
+
+      const hunks = this.props.hunks
+
+      ReactDOM.render(
+        <DiffLineGutter
+          line={diffLine}
+          isIncluded={isIncluded}
+          index={index}
+          readOnly={this.props.readOnly}
+          hunks={hunks}
+          updateRangeHoverState={this.updateRangeHoverState}
+          isSelectionEnabled={this.isSelectionEnabled}
+          onMouseDown={this.onGutterMouseDown}
+          onMouseMove={this.onGutterMouseMove}
+        />,
+        gutterReactContainer,
+        function(this: DiffLineGutter) {
+          if (this !== undefined) {
+            cache.set(index, this)
+          }
+        }
+      )
+
+      const onMouseMoveLine: (ev: MouseEvent) => void = ev => {
+        this.onDiffTextMouseMove(ev, hunks, index)
+      }
+
+      const onMouseDownLine: (ev: MouseEvent) => void = ev => {
+        this.onDiffTextMouseDown(ev, hunks, index)
+      }
+
+      const onMouseLeaveLine: (ev: MouseEvent) => void = ev => {
+        this.onDiffTextMouseLeave(ev, hunks, index)
+      }
+
+      if (!this.props.readOnly) {
+        diffLineElement.addEventListener('mousemove', onMouseMoveLine)
+        diffLineElement.addEventListener('mousedown', onMouseDownLine)
+        diffLineElement.addEventListener('mouseleave', onMouseLeaveLine)
+      }
+
+      element.insertBefore(gutterReactContainer, diffLineElement)
+
+      // Hack(ish?). In order to be a real good citizen we need to unsubscribe from
+      // the line delete event once we've been called once or the component has been
+      // unmounted. In the latter case it's _probably_ not strictly necessary since
+      // the only thing gc rooted by the event should be isolated and eligble for
+      // collection. But let's be extra cautious I guess.
+      //
+      // The only way to unsubscribe is to pass the exact same function given to the
+      // 'on' function to the 'off' so we need a reference to ourselves, basically.
+      let deleteHandler: () => void // eslint-disable-line prefer-const
+
+      // Since we manually render a react component we have to take care of unmounting
+      // it or else we'll leak memory. This disposable will unmount the component.
+      //
+      // See https://facebook.github.io/react/blog/2015/10/01/react-render-and-top-level-api.html
+      const gutterCleanup = new Disposable(() => {
+        this.cachedGutterElements.delete(index)
+
+        ReactDOM.unmountComponentAtNode(gutterReactContainer)
+
+        if (noNewlineReactContainer) {
+          ReactDOM.unmountComponentAtNode(noNewlineReactContainer)
+        }
+
+        if (!this.props.readOnly) {
+          diffLineElement.removeEventListener('mousemove', onMouseMoveLine)
+          diffLineElement.removeEventListener('mousedown', onMouseDownLine)
+          diffLineElement.removeEventListener('mouseleave', onMouseLeaveLine)
+        }
+
+        line.off('delete', deleteHandler)
+      })
+
+      // Add the cleanup disposable to our list of disposables so that we clean up when
+      // this component is unmounted or when the line is re-rendered. When either of that
+      // happens the line 'delete' event doesn't  fire.
+      this.lineCleanup.set(line, gutterCleanup)
+
+      // If the line delete event fires we dispose of the disposable (disposing is
+      // idempotent)
+      deleteHandler = () => {
+        const disp = this.lineCleanup.get(line)
+        if (disp) {
+          this.lineCleanup.delete(line)
+          disp.dispose()
+        }
+      }
+      line.on('delete', deleteHandler)
+    }
+  }
+
+  private getAndStoreCodeMirrorInstance = (cmh: CodeMirrorHost | null) => {
+    this.codeMirror = cmh === null ? null : cmh.getEditor()
+  }
+
+  private onCopy = (editor: Editor, event: Event) => {
+    event.preventDefault()
+
+    // Remove the diff line markers from the copied text. The beginning of the
+    // selection might start within a line, in which case we don't have to trim
+    // the diff type marker. But for selections that span multiple lines, we'll
+    // trim it.
+    const doc = editor.getDoc()
+    const lines = doc.getSelections()
+    const selectionRanges = doc.listSelections()
+    const lineContent: Array<string> = []
+
+    for (let i = 0; i < lines.length; i++) {
+      const range = selectionRanges[i]
+      const content = lines[i]
+      const contentLines = content.split('\n')
+      for (const [i, line] of contentLines.entries()) {
+        if (i === 0 && range.head.ch > 0) {
+          lineContent.push(line)
+        } else {
+          lineContent.push(line.substr(1))
+        }
+      }
+
+      const textWithoutMarkers = lineContent.join('\n')
+      clipboard.writeText(textWithoutMarkers)
+    }
+  }
+
+  private markIntraLineChanges(
+    codeMirror: Editor,
+    hunks: ReadonlyArray<DiffHunk>
+  ) {
+    for (const hunk of hunks) {
+      const additions = hunk.lines.filter(l => l.type === DiffLineType.Add)
+      const deletions = hunk.lines.filter(l => l.type === DiffLineType.Delete)
+      if (additions.length !== deletions.length) {
+        continue
+      }
+
+      for (let i = 0; i < additions.length; i++) {
+        const addLine = additions[i]
+        const deleteLine = deletions[i]
+        if (
+          addLine.text.length > MaxIntraLineDiffStringLength ||
+          deleteLine.text.length > MaxIntraLineDiffStringLength
+        ) {
+          continue
+        }
+
+        const changeRanges = relativeChanges(
+          addLine.content,
+          deleteLine.content
+        )
+        const addRange = changeRanges.stringARange
+        if (addRange.length > 0) {
+          const addLineNumber = lineNumberForDiffLine(addLine, hunks)
+          if (addLineNumber > -1) {
+            const addFrom = {
+              line: addLineNumber,
+              ch: addRange.location + 1,
+            }
+            const addTo = {
+              line: addLineNumber,
+              ch: addRange.location + addRange.length + 1,
+            }
+            codeMirror
+              .getDoc()
+              .markText(addFrom, addTo, { className: 'cm-diff-add-inner' })
+          }
+        }
+
+        const deleteRange = changeRanges.stringBRange
+        if (deleteRange.length > 0) {
+          const deleteLineNumber = lineNumberForDiffLine(deleteLine, hunks)
+          if (deleteLineNumber > -1) {
+            const deleteFrom = {
+              line: deleteLineNumber,
+              ch: deleteRange.location + 1,
+            }
+            const deleteTo = {
+              line: deleteLineNumber,
+              ch: deleteRange.location + deleteRange.length + 1,
+            }
+            codeMirror.getDoc().markText(deleteFrom, deleteTo, {
+              className: 'cm-diff-delete-inner',
+            })
+          }
+        }
+      }
+    }
+  }
+
+  private onChanges = (cm: Editor) => {
+    this.restoreScrollPosition(cm)
+
+    this.markIntraLineChanges(cm, this.props.hunks)
+  }
+
+  public componentWillReceiveProps(nextProps: ITextDiffProps) {
+    // If we're reloading the same file, we want to save the current scroll
+    // position and restore it after the diff's been updated.
+    const sameFile =
+      nextProps.file &&
+      this.props.file &&
+      nextProps.file.id === this.props.file.id
+
+    // Happy path, if the text hasn't changed we won't re-render
+    // and subsequently won't have to restore the scroll position.
+    const textHasChanged = nextProps.text !== this.props.text
+
+    const codeMirror = this.codeMirror
+    if (codeMirror && sameFile && textHasChanged) {
+      const scrollInfo = codeMirror.getScrollInfo()
+      this.scrollPositionToRestore = {
+        left: scrollInfo.left,
+        top: scrollInfo.top,
+      }
+    } else {
+      this.scrollPositionToRestore = null
+    }
+
+    if (codeMirror && this.props.text !== nextProps.text) {
+      codeMirror.setOption('mode', { name: DiffSyntaxMode.ModeName })
+    }
+
+    // HACK: This entire section is a hack. Whenever we receive
+    // props we update all currently visible gutter elements with
+    // the selection state from the file.
+    if (nextProps.file instanceof WorkingDirectoryFileChange) {
+      const selection = nextProps.file.selection
+      const oldSelection =
+        this.props.file instanceof WorkingDirectoryFileChange
+          ? this.props.file.selection
+          : null
+
+      // Nothing has changed
+      if (oldSelection === selection) {
+        return
+      }
+
+      this.gutterWidth = null
+
+      const hunks = nextProps.hunks
+      this.cachedGutterElements.forEach((element, index) => {
+        if (!element) {
+          console.error('expected DOM element for diff gutter not found')
+          return
+        }
+
+        const line = diffLineForIndex(hunks, index)
+        const isIncludable = line ? line.isIncludeableLine() : false
+        const isSelected = selection.isSelected(index) && isIncludable
+        element.setSelected(isSelected)
+      })
+    }
+  }
+
+  public componentWillUnmount() {
+    this.dispose()
+  }
+
+  public componentDidUpdate(prevProps: ITextDiffProps) {
+    if (this.props.text === prevProps.text) {
+      return
+    }
+
+    if (this.codeMirror) {
+      this.codeMirror.setOption('mode', { name: DiffSyntaxMode.ModeName })
+    }
+
+    this.initDiffSyntaxMode()
+  }
+
+  public componentDidMount() {
+    this.initDiffSyntaxMode()
+  }
+
+  public render() {
+    const options: IEditorConfigurationExtra = {
+      lineNumbers: false,
+      readOnly: true,
+      showCursorWhenSelecting: false,
+      cursorBlinkRate: -1,
+      lineWrapping: true,
+      mode: { name: DiffSyntaxMode.ModeName },
+      // Make sure CodeMirror doesn't capture Tab and thus destroy tab navigation
+      extraKeys: { Tab: false },
+      scrollbarStyle: __DARWIN__ ? 'simple' : 'native',
+      styleSelectedText: true,
+      lineSeparator: '\n',
+      specialChars: /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/,
+    }
+
+    // If the text looks like it could have been formatted using Windows
+    // line endings (\r\n) we need to massage it a bit before we hand it
+    // off to CodeMirror. That's because CodeMirror has two ways of splitting
+    // lines, one is the built in which splits on \n, \r\n and \r. The last
+    // one is important because that will match carriage return characters
+    // inside a diff line. The other way is when consumers supply the
+    // lineSeparator option. That option only takes a string meaning we can
+    // either make it split on '\r\n', '\n' or '\r' but not what we would like
+    // to do, namely '\r?\n'. We want to keep CR characters inside of a diff
+    // line so that we can mark them using the specialChars attribute so
+    // we convert all \r\n to \n and remove any trailing \r character.
+    const text =
+      this.props.text.indexOf('\r') !== -1
+        ? this.props.text
+            // Capture the \r if followed by (positive lookahead) a \n or
+            // the end of the string. Note that this does not capture the \n.
+            .replace(/\r(?=\n|$)/g, '')
+        : this.props.text
+
+    return (
+      <CodeMirrorHost
+        className="diff-code-mirror"
+        value={text}
+        options={options}
+        isSelectionEnabled={this.isSelectionEnabled}
+        onChanges={this.onChanges}
+        onRenderLine={this.renderLine}
+        ref={this.getAndStoreCodeMirrorInstance}
+        onCopy={this.onCopy}
+      />
+    )
+  }
+}
merged
  result 100644 2554a2b18a26273423e0c5b405f02cfc870a00e4 app/src/ui/discard-changes/discard-changes-dialog.tsx
  our    100644 78b4d51f4ee8816a057066d15e425e65833d4ef1 app/src/ui/discard-changes/discard-changes-dialog.tsx
@@ -15,6 +15,12 @@
   readonly dispatcher: Dispatcher
   readonly files: ReadonlyArray<WorkingDirectoryFileChange>
   readonly confirmDiscardChanges: boolean
+  /**
+   * Determines whether to show the option
+   * to ask for confirmation when discarding
+   * changes
+   */
+  readonly showDiscardChangesSetting: boolean
   readonly onDismissed: () => void
   readonly onConfirmDiscardChangesChanged: (optOut: boolean) => void
 }
@@ -65,15 +71,7 @@
           <p>
             Changes can be restored by retrieving them from the {trashName}.
           </p>
-          <Checkbox
-            label="Do not show this message again"
-            value={
-              this.state.confirmDiscardChanges
-                ? CheckboxValue.Off
-                : CheckboxValue.On
-            }
-            onChange={this.onCheckboxChanged}
-          />
+          {this.renderConfirmDiscardChanges()}
         </DialogContent>

         <DialogFooter>
@@ -88,6 +86,27 @@
     )
   }

+  private renderConfirmDiscardChanges() {
+    if (this.props.showDiscardChangesSetting) {
+      return (
+        <Checkbox
+          label="Do not show this message again"
+          value={
+            this.state.confirmDiscardChanges
+              ? CheckboxValue.Off
+              : CheckboxValue.On
+          }
+          onChange={this.onConfirmDiscardChangesChanged}
+        />
+      )
+    } else {
+      // since we ignore the users option to not show
+      // confirmation, we don't want to show a checkbox
+      // that will have no effect
+      return null
+    }
+  }
+
   private renderFileList() {
     if (this.props.files.length > MaxFilesToList) {
       return (
@@ -126,7 +145,9 @@
     this.props.onDismissed()
   }

-  private onCheckboxChanged = (event: React.FormEvent<HTMLInputElement>) => {
+  private onConfirmDiscardChangesChanged = (
+    event: React.FormEvent<HTMLInputElement>
+  ) => {
     const value = !event.currentTarget.checked

     this.setState({ confirmDiscardChanges: value })
merged
  result 100644 3e0e90eccd5a8894b7cce153c15009fe732a39cc app/src/ui/history/commit-list.tsx
  our    100644 a440227b4ebc22b52f57595a0c3e68129de6bfdf app/src/ui/history/commit-list.tsx
@@ -12,7 +12,7 @@
   readonly gitHubRepository: GitHubRepository | null

   /** The list of commits SHAs to display, in order. */
-  readonly commits: ReadonlyArray<string>
+  readonly commitSHAs: ReadonlyArray<string>

   /** The commits loaded, keyed by their full SHA. */
   readonly commitLookup: Map<string, Commit>
@@ -29,6 +29,9 @@
   /** The list of known local commits for the current branch */
   readonly localCommitSHAs: ReadonlyArray<string>

+  /** The message to display inside the list when no results are displayed */
+  readonly emptyListMessage: JSX.Element | string
+
   /** Callback which fires when a commit has been selected in the list */
   readonly onCommitSelected: (commit: Commit) => void

@@ -45,7 +48,7 @@
 /** A component which displays the list of commits. */
 export class CommitList extends React.Component<ICommitListProps, {}> {
   private renderCommit = (row: number) => {
-    const sha = this.props.commits[row]
+    const sha = this.props.commitSHAs[row]
     const commit = this.props.commitLookup.get(sha)

     if (commit == null) {
@@ -73,8 +76,8 @@
     )
   }

-  private onRowChanged = (row: number) => {
-    const sha = this.props.commits[row]
+  private onSelectedRowChanged = (row: number) => {
+    const sha = this.props.commitSHAs[row]
     const commit = this.props.commitLookup.get(sha)
     if (commit) {
       this.props.onCommitSelected(commit)
@@ -94,25 +97,27 @@
       return -1
     }

-    return this.props.commits.findIndex(s => s === sha)
+    return this.props.commitSHAs.findIndex(s => s === sha)
   }

   public render() {
-    if (this.props.commits.length === 0) {
-      return <div className="panel blankslate">No history</div>
+    if (this.props.commitSHAs.length === 0) {
+      return (
+        <div className="panel blankslate">{this.props.emptyListMessage}</div>
+      )
     }

     return (
       <div id="commit-list">
         <List
-          rowCount={this.props.commits.length}
+          rowCount={this.props.commitSHAs.length}
           rowHeight={RowHeight}
-          selectedRow={this.rowForSHA(this.props.selectedSHA)}
+          selectedRows={[this.rowForSHA(this.props.selectedSHA)]}
           rowRenderer={this.renderCommit}
-          onSelectionChanged={this.onRowChanged}
+          onSelectedRowChanged={this.onSelectedRowChanged}
           onScroll={this.onScroll}
           invalidationProps={{
-            commits: this.props.commits,
+            commits: this.props.commitSHAs,
             gitHubUsers: this.props.gitHubUsers,
           }}
         />
added in remote
  their  100644 16d4efb540d90ba9514f7b5da356f9fa5372e2f6 app/src/ui/history/compare-branch-list-item.tsx
@@ -0,0 +1,58 @@
+import * as React from 'react'
+
+import { Octicon, OcticonSymbol } from '../octicons'
+import { HighlightText } from '../lib/highlight-text'
+import { Branch, IAheadBehind } from '../../models/branch'
+import { IMatches } from '../../lib/fuzzy-find'
+
+interface ICompareBranchListItemProps {
+  readonly branch: Branch
+
+  /** Specifies whether this item is currently selected */
+  readonly isCurrentBranch: boolean
+
+  /** The characters in the branch name to highlight */
+  readonly matches: IMatches
+
+  readonly aheadBehind: IAheadBehind | null
+}
+
+export class CompareBranchListItem extends React.Component<
+  ICompareBranchListItemProps,
+  {}
+> {
+  public render() {
+    const isCurrentBranch = this.props.isCurrentBranch
+    const branch = this.props.branch
+    const icon = isCurrentBranch ? OcticonSymbol.check : OcticonSymbol.gitBranch
+
+    const aheadBehind = this.props.aheadBehind
+
+    const aheadBehindElement = aheadBehind ? (
+      <div className="branch-commit-counter">
+        <span className="branch-commit-counter-item">
+          {aheadBehind.behind}
+          <Octicon className="icon" symbol={OcticonSymbol.arrowDown} />
+        </span>
+
+        <span className="branch-commit-counter-item">
+          {aheadBehind.ahead}
+          <Octicon className="icon" symbol={OcticonSymbol.arrowUp} />
+        </span>
+      </div>
+    ) : null
+
+    return (
+      <div className="branches-list-item">
+        <Octicon className="icon" symbol={icon} />
+        <div className="name" title={branch.name}>
+          <HighlightText
+            text={branch.name}
+            highlight={this.props.matches.title}
+          />
+        </div>
+        {aheadBehindElement}
+      </div>
+    )
+  }
+}
added in remote
  their  100644 bcdf27db5507a5d1393fd75a4a3d177d41a3e81c app/src/ui/history/compare.tsx
@@ -0,0 +1,576 @@
+import * as React from 'react'
+import { CSSTransitionGroup } from 'react-transition-group'
+
+import { IGitHubUser } from '../../lib/databases'
+import { Commit } from '../../models/commit'
+import {
+  ComparisonView,
+  ICompareState,
+  CompareActionKind,
+  ICompareBranch,
+} from '../../lib/app-state'
+import { CommitList } from './commit-list'
+import { Repository } from '../../models/repository'
+import { Branch } from '../../models/branch'
+import { Dispatcher } from '../../lib/dispatcher'
+import { ThrottledScheduler } from '../lib/throttled-scheduler'
+import { BranchList } from '../branches'
+import { TextBox } from '../lib/text-box'
+import { IBranchListItem } from '../branches/group-branches'
+import { TabBar } from '../tab-bar'
+import { CompareBranchListItem } from './compare-branch-list-item'
+import { FancyTextBox } from '../lib/fancy-text-box'
+import { OcticonSymbol } from '../octicons'
+import { SelectionSource } from '../lib/filter-list'
+import { IMatches } from '../../lib/fuzzy-find'
+import { Ref } from '../lib/ref'
+import {
+  NewCommitsBanner,
+  DismissalReason,
+} from '../notification/new-commits-banner'
+import { enableNotificationOfBranchUpdates } from '../../lib/feature-flag'
+import { MergeCallToAction } from './merge-call-to-action'
+
+interface ICompareSidebarProps {
+  readonly repository: Repository
+  readonly compareState: ICompareState
+  readonly gitHubUsers: Map<string, IGitHubUser>
+  readonly emoji: Map<string, string>
+  readonly commitLookup: Map<string, Commit>
+  readonly localCommitSHAs: ReadonlyArray<string>
+  readonly dispatcher: Dispatcher
+  readonly currentBranch: Branch | null
+  readonly isDivergingBranchBannerVisible: boolean
+  readonly onRevertCommit: (commit: Commit) => void
+  readonly onViewCommitOnGitHub: (sha: string) => void
+}
+
+interface ICompareSidebarState {
+  /**
+   * This branch should only be used when tracking interactions that the user is performing.
+   *
+   * For all other cases, use the prop
+   */
+  readonly focusedBranch: Branch | null
+  readonly selectedCommit: Commit | null
+
+  /**
+   * Flag that tracks whether the user interacted with one of the notification's
+   * "call to action" buttons
+   */
+  readonly hasConsumedNotification: boolean
+}
+
+/** If we're within this many rows from the bottom, load the next history batch. */
+const CloseToBottomThreshold = 10
+
+export class CompareSidebar extends React.Component<
+  ICompareSidebarProps,
+  ICompareSidebarState
+> {
+  private textbox: TextBox | null = null
+  private readonly loadChangedFilesScheduler = new ThrottledScheduler(200)
+  private branchList: BranchList | null = null
+  private loadingMoreCommitsPromise: Promise<void> | null = null
+
+  public constructor(props: ICompareSidebarProps) {
+    super(props)
+
+    this.state = {
+      focusedBranch: null,
+      selectedCommit: null,
+      hasConsumedNotification: false,
+    }
+  }
+
+  public componentWillReceiveProps(nextProps: ICompareSidebarProps) {
+    const newFormState = nextProps.compareState.formState
+    const oldFormState = this.props.compareState.formState
+
+    if (this.textbox !== null) {
+      if (
+        !this.props.compareState.showBranchList &&
+        nextProps.compareState.showBranchList
+      ) {
+        // showBranchList changes from false -> true
+        //  -> ensure the textbox has focus
+        this.textbox.focus()
+      } else if (
+        this.props.compareState.showBranchList &&
+        !nextProps.compareState.showBranchList
+      ) {
+        // showBranchList changes from true -> false
+        //  -> ensure the textbox no longer has focus
+        this.textbox.blur()
+      }
+    }
+
+    if (
+      newFormState.kind !== oldFormState.kind &&
+      newFormState.kind === ComparisonView.None
+    ) {
+      this.setState({
+        focusedBranch: null,
+      })
+      return
+    }
+
+    if (
+      newFormState.kind !== ComparisonView.None &&
+      oldFormState.kind !== ComparisonView.None
+    ) {
+      const oldBranch = oldFormState.comparisonBranch
+      const newBranch = newFormState.comparisonBranch
+
+      if (oldBranch.name !== newBranch.name) {
+        // ensure the focused branch is in sync with the chosen branch
+        this.setState({
+          focusedBranch: newBranch,
+        })
+      }
+    }
+  }
+
+  public componentWillMount() {
+    this.props.dispatcher.initializeCompare(this.props.repository)
+  }
+
+  public componentWillUnmount() {
+    this.textbox = null
+  }
+
+  public render() {
+    const { allBranches, filterText, showBranchList } = this.props.compareState
+    const placeholderText = getPlaceholderText(this.props.compareState)
+    const DivergingBannerAnimationTimeout = 300
+
+    return (
+      <div id="compare-view">
+        <CSSTransitionGroup
+          transitionName="diverge-banner"
+          transitionAppear={true}
+          transitionAppearTimeout={DivergingBannerAnimationTimeout}
+          transitionEnterTimeout={DivergingBannerAnimationTimeout}
+          transitionLeaveTimeout={DivergingBannerAnimationTimeout}
+        >
+          {this.renderNotificationBanner()}
+        </CSSTransitionGroup>
+
+        <div className="compare-form">
+          <FancyTextBox
+            symbol={OcticonSymbol.gitBranch}
+            type="search"
+            placeholder={placeholderText}
+            onFocus={this.onTextBoxFocused}
+            value={filterText}
+            disabled={allBranches.length === 0}
+            onRef={this.onTextBoxRef}
+            onValueChanged={this.onBranchFilterTextChanged}
+            onKeyDown={this.onBranchFilterKeyDown}
+            onSearchCleared={this.handleEscape}
+          />
+        </div>
+
+        {showBranchList ? this.renderFilterList() : this.renderCommits()}
+      </div>
+    )
+  }
+
+  private onBranchesListRef = (branchList: BranchList | null) => {
+    this.branchList = branchList
+  }
+
+  private renderNotificationBanner() {
+    if (!enableNotificationOfBranchUpdates()) {
+      return null
+    }
+
+    if (!this.props.isDivergingBranchBannerVisible) {
+      return null
+    }
+
+    const { inferredComparisonBranch } = this.props.compareState
+
+    return inferredComparisonBranch.branch !== null &&
+      inferredComparisonBranch.aheadBehind !== null &&
+      inferredComparisonBranch.aheadBehind.behind > 0 ? (
+      <div className="diverge-banner-wrapper">
+        <NewCommitsBanner
+          dispatcher={this.props.dispatcher}
+          repository={this.props.repository}
+          commitsBehindBaseBranch={inferredComparisonBranch.aheadBehind.behind}
+          baseBranch={inferredComparisonBranch.branch}
+          onDismiss={this.onNotificationBannerDismissed}
+        />
+      </div>
+    ) : null
+  }
+
+  private renderCommits() {
+    const formState = this.props.compareState.formState
+    return (
+      <div className="compare-commit-list">
+        {formState.kind === ComparisonView.None
+          ? this.renderCommitList()
+          : this.renderTabBar(formState)}
+      </div>
+    )
+  }
+
+  private viewHistoryForBranch = () => {
+    this.props.dispatcher.executeCompare(this.props.repository, {
+      kind: CompareActionKind.History,
+    })
+
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      showBranchList: false,
+    })
+  }
+
+  private renderCommitList() {
+    const { formState, commitSHAs } = this.props.compareState
+    const selectedCommit = this.state.selectedCommit
+
+    let emptyListMessage: string | JSX.Element
+    if (formState.kind === ComparisonView.None) {
+      emptyListMessage = 'No history'
+    } else {
+      const currentlyComparedBranchName = formState.comparisonBranch.name
+
+      emptyListMessage =
+        formState.kind === ComparisonView.Ahead ? (
+          <p>
+            The compared branch (<Ref>{currentlyComparedBranchName}</Ref>) is up
+            to date with your branch
+          </p>
+        ) : (
+          <p>
+            Your branch is up to date with the compared branch (<Ref>
+              {currentlyComparedBranchName}
+            </Ref>)
+          </p>
+        )
+    }
+
+    return (
+      <CommitList
+        gitHubRepository={this.props.repository.gitHubRepository}
+        commitLookup={this.props.commitLookup}
+        commitSHAs={commitSHAs}
+        selectedSHA={selectedCommit !== null ? selectedCommit.sha : null}
+        gitHubUsers={this.props.gitHubUsers}
+        localCommitSHAs={this.props.localCommitSHAs}
+        emoji={this.props.emoji}
+        onViewCommitOnGitHub={this.props.onViewCommitOnGitHub}
+        onRevertCommit={this.props.onRevertCommit}
+        onCommitSelected={this.onCommitSelected}
+        onScroll={this.onScroll}
+        emptyListMessage={emptyListMessage}
+      />
+    )
+  }
+
+  private renderActiveTab() {
+    const formState = this.props.compareState.formState
+    return (
+      <div className="compare-commit-list">
+        {this.renderCommitList()}
+        {formState.kind === ComparisonView.Behind
+          ? this.renderMergeCallToAction(formState)
+          : null}
+      </div>
+    )
+  }
+
+  private renderFilterList() {
+    const {
+      defaultBranch,
+      allBranches,
+      recentBranches,
+      filterText,
+    } = this.props.compareState
+
+    return (
+      <BranchList
+        ref={this.onBranchesListRef}
+        defaultBranch={defaultBranch}
+        currentBranch={this.props.currentBranch}
+        allBranches={allBranches}
+        recentBranches={recentBranches}
+        filterText={filterText}
+        textbox={this.textbox!}
+        selectedBranch={this.state.focusedBranch}
+        canCreateNewBranch={false}
+        onSelectionChanged={this.onSelectionChanged}
+        onItemClick={this.onBranchItemClicked}
+        onFilterTextChanged={this.onBranchFilterTextChanged}
+        renderBranch={this.renderCompareBranchListItem}
+      />
+    )
+  }
+
+  private renderMergeCallToAction(formState: ICompareBranch) {
+    if (this.props.currentBranch == null) {
+      return null
+    }
+
+    return (
+      <MergeCallToAction
+        repository={this.props.repository}
+        dispatcher={this.props.dispatcher}
+        currentBranch={this.props.currentBranch}
+        formState={formState}
+        onMerged={this.onMerge}
+      />
+    )
+  }
+
+  private onTabClicked = (index: number) => {
+    const formState = this.props.compareState.formState
+
+    if (formState.kind === ComparisonView.None) {
+      return
+    }
+
+    const mode = index === 0 ? ComparisonView.Behind : ComparisonView.Ahead
+    const branch = formState.comparisonBranch
+
+    this.props.dispatcher.executeCompare(this.props.repository, {
+      kind: CompareActionKind.Branch,
+      branch,
+      mode,
+    })
+  }
+
+  private renderTabBar(formState: ICompareBranch) {
+    const selectedTab = formState.kind === ComparisonView.Behind ? 0 : 1
+
+    return (
+      <div className="compare-content">
+        <TabBar selectedIndex={selectedTab} onTabClicked={this.onTabClicked}>
+          <span>{`Behind (${formState.aheadBehind.behind})`}</span>
+          <span>{`Ahead (${formState.aheadBehind.ahead})`}</span>
+        </TabBar>
+        {this.renderActiveTab()}
+      </div>
+    )
+  }
+
+  private renderCompareBranchListItem = (
+    item: IBranchListItem,
+    matches: IMatches
+  ) => {
+    const currentBranch = this.props.currentBranch
+
+    const currentBranchName = currentBranch != null ? currentBranch.name : null
+    const branch = item.branch
+
+    const aheadBehind = currentBranch
+      ? this.props.compareState.aheadBehindCache.get(
+          currentBranch.tip.sha,
+          branch.tip.sha
+        )
+      : null
+
+    return (
+      <CompareBranchListItem
+        branch={branch}
+        isCurrentBranch={branch.name === currentBranchName}
+        matches={matches}
+        aheadBehind={aheadBehind}
+      />
+    )
+  }
+
+  private onBranchFilterKeyDown = (
+    event: React.KeyboardEvent<HTMLInputElement>
+  ) => {
+    const key = event.key
+
+    if (key === 'Enter') {
+      if (this.props.compareState.filterText.length === 0) {
+        this.handleEscape()
+      } else {
+        if (this.state.focusedBranch == null) {
+          this.viewHistoryForBranch()
+        } else {
+          const branch = this.state.focusedBranch
+
+          this.props.dispatcher.executeCompare(this.props.repository, {
+            kind: CompareActionKind.Branch,
+            branch,
+            mode: ComparisonView.Behind,
+          })
+
+          this.props.dispatcher.updateCompareForm(this.props.repository, {
+            filterText: branch.name,
+          })
+        }
+
+        if (this.textbox) {
+          this.textbox.blur()
+        }
+      }
+    } else if (key === 'Escape') {
+      this.handleEscape()
+    } else if (key === 'ArrowDown') {
+      if (this.branchList !== null) {
+        this.branchList.selectFirstItem(true)
+      }
+    }
+  }
+
+  private handleEscape = () => {
+    this.clearFilterState()
+    if (this.textbox) {
+      this.textbox.blur()
+    }
+  }
+
+  private onCommitSelected = (commit: Commit) => {
+    this.props.dispatcher.changeHistoryCommitSelection(
+      this.props.repository,
+      commit.sha
+    )
+
+    this.loadChangedFilesScheduler.queue(() => {
+      this.props.dispatcher.loadChangedFilesForCurrentSelection(
+        this.props.repository
+      )
+    })
+
+    this.setState({ selectedCommit: commit })
+  }
+
+  private onScroll = (start: number, end: number) => {
+    const compareState = this.props.compareState
+    const formState = compareState.formState
+
+    if (formState.kind !== ComparisonView.None) {
+      // as the app is currently comparing the current branch to some other
+      // branch, everything needed should be loaded
+      return
+    }
+
+    const commits = compareState.commitSHAs
+    if (commits.length - end <= CloseToBottomThreshold) {
+      if (this.loadingMoreCommitsPromise != null) {
+        // as this callback fires for any scroll event we need to guard
+        // against re-entrant calls to loadNextHistoryBatch
+        return
+      }
+
+      this.loadingMoreCommitsPromise = this.props.dispatcher
+        .loadNextHistoryBatch(this.props.repository)
+        .then(() => {
+          // deferring unsetting this flag to some time _after_ the commits
+          // have been appended to prevent eagerly adding more commits due
+          // to scroll events (which fire indiscriminately)
+          window.setTimeout(() => {
+            this.loadingMoreCommitsPromise = null
+          }, 500)
+        })
+    }
+  }
+
+  private onBranchFilterTextChanged = (filterText: string) => {
+    if (filterText.length === 0) {
+      this.setState({ focusedBranch: null })
+    }
+
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      filterText,
+    })
+  }
+
+  private clearFilterState = () => {
+    this.setState({
+      focusedBranch: null,
+    })
+
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      filterText: '',
+    })
+
+    this.viewHistoryForBranch()
+  }
+
+  private onBranchItemClicked = (branch: Branch) => {
+    this.props.dispatcher.executeCompare(this.props.repository, {
+      branch,
+      kind: CompareActionKind.Branch,
+      mode: ComparisonView.Behind,
+    })
+
+    this.setState({
+      focusedBranch: null,
+    })
+
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      filterText: branch.name,
+      showBranchList: false,
+    })
+  }
+
+  private onSelectionChanged = (
+    branch: Branch | null,
+    source: SelectionSource
+  ) => {
+    if (source.kind === 'mouseclick' && branch != null) {
+      this.props.dispatcher.executeCompare(this.props.repository, {
+        branch,
+        kind: CompareActionKind.Branch,
+        mode: ComparisonView.Behind,
+      })
+    }
+
+    this.setState({
+      focusedBranch: branch,
+    })
+  }
+
+  private onTextBoxFocused = () => {
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      showBranchList: true,
+    })
+  }
+
+  private onTextBoxRef = (textbox: TextBox) => {
+    this.textbox = textbox
+  }
+
+  private onNotificationBannerDismissed = (reason: DismissalReason) => {
+    this.props.dispatcher.setDivergingBranchBannerVisibility(false)
+    this.props.dispatcher.recordDivergingBranchBannerDismissal()
+
+    switch (reason) {
+      case 'close':
+        this.setState({ hasConsumedNotification: false })
+        break
+      case 'compare':
+      case 'merge':
+        this.setState({ hasConsumedNotification: true })
+        break
+    }
+  }
+
+  private onMerge = () => {
+    if (this.state.hasConsumedNotification) {
+      this.props.dispatcher.recordDivergingBranchBannerInfluencedMerge()
+    }
+  }
+}
+
+function getPlaceholderText(state: ICompareState) {
+  const { allBranches, formState } = state
+
+  if (allBranches.length === 0) {
+    return __DARWIN__ ? 'No Branches to Compare' : 'No branches to compare'
+  } else if (formState.kind === ComparisonView.None) {
+    return __DARWIN__
+      ? 'Select Branch to Compare...'
+      : 'Select branch to compare...'
+  } else {
+    return undefined
+  }
+}
merged
  result 100644 1089df377346334f2f773b466948b625f3c4cab3 app/src/ui/history/file-list.tsx
  our    100644 458d1749d658b33d17f3dfc497271a59131f9345 app/src/ui/history/file-list.tsx
@@ -1,18 +1,53 @@
 import * as React from 'react'
+import * as Path from 'path'
+import { pathExists } from 'fs-extra'
+import { revealInFileManager } from '../../lib/app-shell'
+
 import { FileChange, mapStatus, iconForStatus } from '../../models/status'
+import { Repository } from '../../models/repository'
+
 import { PathLabel } from '../lib/path-label'
-import { Octicon } from '../octicons'
+import {
+  isSafeFileExtension,
+  DefaultEditorLabel,
+  RevealInFileManagerLabel,
+  OpenWithDefaultProgramLabel,
+} from '../lib/context-menu'
 import { List } from '../lib/list'

+import { Octicon } from '../octicons'
+import { showContextualMenu } from '../main-process-proxy'
+
 interface IFileListProps {
   readonly files: ReadonlyArray<FileChange>
   readonly selectedFile: FileChange | null
   readonly onSelectedFileChanged: (file: FileChange) => void
   readonly availableWidth: number
+
+  /**
+   * Called to open a file with its default application
+   * @param path The path of the file relative to the root of the repository
+   */
+  readonly onOpenItem: (path: string) => void
+
+  /** The name of the currently selected external editor */
+  readonly externalEditorLabel?: string
+
+  /**
+   * Called to open a file using the user's configured applications
+   * @param path The path of the file relative to the root of the repository
+   */
+  readonly onOpenInExternalEditor: (path: string) => void
+
+  /**
+   * Repository that we use to get the base path and build
+   * full path for the file in commit to check for file existence
+   */
+  readonly repository: Repository
 }

 export class FileList extends React.Component<IFileListProps, {}> {
-  private onSelectionChanged = (row: number) => {
+  private onSelectedRowChanged = (row: number) => {
     const file = this.props.files[row]
     this.props.onSelectedFileChanged(file)
   }
@@ -32,7 +67,7 @@
       statusWidth

     return (
-      <div className="file">
+      <div className="file" onContextMenu={this.onContextMenu}>
         <PathLabel
           path={file.path}
           oldPath={file.oldPath}
@@ -60,10 +95,59 @@
           rowRenderer={this.renderFile}
           rowCount={this.props.files.length}
           rowHeight={29}
-          selectedRow={this.rowForFile(this.props.selectedFile)}
-          onSelectionChanged={this.onSelectionChanged}
+          selectedRows={[this.rowForFile(this.props.selectedFile)]}
+          onSelectedRowChanged={this.onSelectedRowChanged}
         />
       </div>
     )
   }
+
+  private onContextMenu = async (event: React.MouseEvent<HTMLDivElement>) => {
+    event.preventDefault()
+
+    if (this.props.selectedFile == null) {
+      return
+    }
+
+    const filePath = this.props.selectedFile.path
+    const fullPath = Path.join(this.props.repository.path, filePath)
+    const fileExistsOnDisk = await pathExists(fullPath)
+    if (!fileExistsOnDisk) {
+      showContextualMenu([
+        {
+          label: __DARWIN__
+            ? 'File Does Not Exist on Disk'
+            : 'File does not exist on disk',
+          enabled: false,
+        },
+      ])
+      return
+    }
+
+    const extension = Path.extname(filePath)
+
+    const isSafeExtension = isSafeFileExtension(extension)
+    const openInExternalEditor = this.props.externalEditorLabel
+      ? `Open in ${this.props.externalEditorLabel}`
+      : DefaultEditorLabel
+
+    const items = [
+      {
+        label: RevealInFileManagerLabel,
+        action: () => revealInFileManager(this.props.repository, filePath),
+        enabled: fileExistsOnDisk,
+      },
+      {
+        label: openInExternalEditor,
+        action: () => this.props.onOpenInExternalEditor(fullPath),
+        enabled: isSafeExtension && fileExistsOnDisk,
+      },
+      {
+        label: OpenWithDefaultProgramLabel,
+        action: () => this.props.onOpenItem(filePath),
+        enabled: isSafeExtension && fileExistsOnDisk,
+      },
+    ]
+    showContextualMenu(items)
+  }
 }
removed in remote
  base   100644 7d1e09aa5b1ea18dda23f94daadcfe54a2491b42 app/src/ui/history/history.tsx
  our    100644 7d1e09aa5b1ea18dda23f94daadcfe54a2491b42 app/src/ui/history/history.tsx
@@ -1,178 +0,0 @@
-import * as React from 'react'
-import { CommitSummary } from './commit-summary'
-import { Diff } from '../diff'
-import { FileList } from './file-list'
-import { Repository } from '../../models/repository'
-import { CommittedFileChange, FileChange } from '../../models/status'
-import { Commit } from '../../models/commit'
-import { Dispatcher } from '../../lib/dispatcher'
-import {
-  IHistoryState as IAppHistoryState,
-  ImageDiffType,
-} from '../../lib/app-state'
-import { encodePathAsUrl } from '../../lib/path'
-import { ThrottledScheduler } from '../lib/throttled-scheduler'
-import { IGitHubUser } from '../../lib/databases'
-import { Resizable } from '../resizable'
-
-interface IHistoryProps {
-  readonly repository: Repository
-  readonly dispatcher: Dispatcher
-  readonly history: IAppHistoryState
-  readonly emoji: Map<string, string>
-  readonly commits: Map<string, Commit>
-  readonly commitSummaryWidth: number
-  readonly gitHubUsers: Map<string, IGitHubUser>
-  readonly imageDiffType: ImageDiffType
-}
-
-interface IHistoryState {
-  readonly isExpanded: boolean
-}
-
-/** The History component. Contains the commit list, commit summary, and diff. */
-export class History extends React.Component<IHistoryProps, IHistoryState> {
-  private readonly loadChangedFilesScheduler = new ThrottledScheduler(200)
-
-  public constructor(props: IHistoryProps) {
-    super(props)
-
-    this.state = {
-      isExpanded: false,
-    }
-  }
-
-  private onFileSelected = (file: FileChange) => {
-    this.props.dispatcher.changeHistoryFileSelection(
-      this.props.repository,
-      file as CommittedFileChange
-    )
-  }
-
-  public componentWillUpdate(nextProps: IHistoryProps) {
-    // Reset isExpanded if we're switching commits.
-    if (nextProps.history.selection.sha !== this.props.history.selection.sha) {
-      if (this.state.isExpanded) {
-        this.setState({ isExpanded: false })
-      }
-    }
-  }
-
-  public componentWillUnmount() {
-    this.loadChangedFilesScheduler.clear()
-  }
-
-  private renderDiff(commit: Commit | null) {
-    const files = this.props.history.changedFiles
-    const file = this.props.history.selection.file
-    const diff = this.props.history.diff
-
-    if (!diff || !file) {
-      // don't show both 'empty' messages
-      const message = files.length === 0 ? '' : 'No file selected'
-
-      return (
-        <div className="panel blankslate" id="diff">
-          {message}
-        </div>
-      )
-    }
-
-    return (
-      <Diff
-        repository={this.props.repository}
-        imageDiffType={this.props.imageDiffType}
-        file={file}
-        diff={diff}
-        readOnly={true}
-        dispatcher={this.props.dispatcher}
-      />
-    )
-  }
-
-  private renderCommitSummary(commit: Commit) {
-    return (
-      <CommitSummary
-        commit={commit}
-        files={this.props.history.changedFiles}
-        emoji={this.props.emoji}
-        repository={this.props.repository}
-        gitHubUsers={this.props.gitHubUsers}
-        onExpandChanged={this.onExpandChanged}
-        isExpanded={this.state.isExpanded}
-      />
-    )
-  }
-
-  private onExpandChanged = (isExpanded: boolean) => {
-    this.setState({ isExpanded })
-  }
-
-  private onCommitSummaryReset = () => {
-    this.props.dispatcher.resetCommitSummaryWidth()
-  }
-
-  private onCommitSummaryResize = (width: number) => {
-    this.props.dispatcher.setCommitSummaryWidth(width)
-  }
-
-  private renderFileList() {
-    const files = this.props.history.changedFiles
-    if (files.length === 0) {
-      return <div className="fill-window">No files in commit</div>
-    }
-
-    // -1 for right hand side border
-    const availableWidth = this.props.commitSummaryWidth - 1
-
-    return (
-      <FileList
-        files={files}
-        onSelectedFileChanged={this.onFileSelected}
-        selectedFile={this.props.history.selection.file}
-        availableWidth={availableWidth}
-      />
-    )
-  }
-
-  public render() {
-    const sha = this.props.history.selection.sha
-    const commit = sha ? this.props.commits.get(sha) || null : null
-
-    if (!sha || !commit) {
-      return <NoCommitSelected />
-    }
-
-    const className = this.state.isExpanded ? 'expanded' : 'collapsed'
-
-    return (
-      <div id="history" className={className}>
-        {this.renderCommitSummary(commit)}
-        <div id="commit-details">
-          <Resizable
-            width={this.props.commitSummaryWidth}
-            onResize={this.onCommitSummaryResize}
-            onReset={this.onCommitSummaryReset}
-          >
-            {this.renderFileList()}
-          </Resizable>
-          {this.renderDiff(commit)}
-        </div>
-      </div>
-    )
-  }
-}
-
-function NoCommitSelected() {
-  const BlankSlateImage = encodePathAsUrl(
-    __dirname,
-    'static/empty-no-commit.svg'
-  )
-
-  return (
-    <div className="panel blankslate">
-      <img src={BlankSlateImage} className="blankslate-image" />
-      No commit selected
-    </div>
-  )
-}
merged
  result 100644 5314aa21a17e6eaad7f73ab8e92c99e6e83f2108 app/src/ui/history/index.ts
  our    100644 caa18019759a791f9a4e2b42c02a348a0cf36a0d app/src/ui/history/index.ts
@@ -1,2 +1,2 @@
-export { HistorySidebar } from './sidebar'
-export { History } from './history'
+export { SelectedCommit } from './selected-commit'
+export { CompareSidebar } from './compare'
added in remote
  their  100644 f43d04c4253b198fd579a2e189a03c4aa13ce472 app/src/ui/history/merge-call-to-action.tsx
@@ -0,0 +1,87 @@
+import * as React from 'react'
+
+import { CompareActionKind, ICompareBranch } from '../../lib/app-state'
+import { Repository } from '../../models/repository'
+import { Branch } from '../../models/branch'
+import { Dispatcher } from '../../lib/dispatcher'
+import { Button } from '../lib/button'
+
+interface IMergeCallToActionProps {
+  readonly repository: Repository
+  readonly dispatcher: Dispatcher
+  readonly currentBranch: Branch
+  readonly formState: ICompareBranch
+
+  /**
+   * Callback to execute after a merge has been performed
+   */
+  readonly onMerged: () => void
+}
+
+export class MergeCallToAction extends React.Component<
+  IMergeCallToActionProps,
+  {}
+> {
+  public render() {
+    const count = this.props.formState.aheadBehind.behind
+
+    return (
+      <div className="merge-cta">
+        <Button
+          type="submit"
+          disabled={count <= 0}
+          onClick={this.onMergeClicked}
+        >
+          Merge into <strong>{this.props.currentBranch.name}</strong>
+        </Button>
+
+        {this.renderMergeDetails(
+          this.props.formState,
+          this.props.currentBranch
+        )}
+      </div>
+    )
+  }
+
+  private renderMergeDetails(formState: ICompareBranch, currentBranch: Branch) {
+    const branch = formState.comparisonBranch
+    const count = formState.aheadBehind.behind
+
+    if (count > 0) {
+      const pluralized = count === 1 ? 'commit' : 'commits'
+      return (
+        <div className="merge-message">
+          This will merge
+          <strong>{` ${count} ${pluralized}`}</strong>
+          {` `}from{` `}
+          <strong>{branch.name}</strong>
+          {` `}into{` `}
+          <strong>{currentBranch.name}</strong>
+        </div>
+      )
+    }
+
+    return null
+  }
+
+  private onMergeClicked = async (event: React.MouseEvent<any>) => {
+    const formState = this.props.formState
+
+    this.props.dispatcher.recordCompareInitiatedMerge()
+
+    await this.props.dispatcher.mergeBranch(
+      this.props.repository,
+      formState.comparisonBranch.name
+    )
+
+    this.props.dispatcher.executeCompare(this.props.repository, {
+      kind: CompareActionKind.History,
+    })
+
+    this.props.dispatcher.updateCompareForm(this.props.repository, {
+      showBranchList: false,
+      filterText: '',
+    })
+    this.props.onMerged()
+  }
+}
added in remote
  their  100644 70a7fdc0fff924c282d71feffe17b638f50a18fd app/src/ui/history/selected-commit.tsx
@@ -0,0 +1,211 @@
+import * as React from 'react'
+import * as Path from 'path'
+
+import { CommitSummary } from './commit-summary'
+import { Diff } from '../diff'
+import { FileList } from './file-list'
+import { Repository } from '../../models/repository'
+import { CommittedFileChange, FileChange } from '../../models/status'
+import { Commit } from '../../models/commit'
+import { Dispatcher } from '../../lib/dispatcher'
+import { ImageDiffType } from '../../lib/app-state'
+import { encodePathAsUrl } from '../../lib/path'
+import { ThrottledScheduler } from '../lib/throttled-scheduler'
+import { IGitHubUser } from '../../lib/databases'
+import { Resizable } from '../resizable'
+import { openFile } from '../../lib/open-file'
+import { IDiff } from '../../models/diff'
+
+interface ISelectedCommitProps {
+  readonly repository: Repository
+  readonly dispatcher: Dispatcher
+  readonly emoji: Map<string, string>
+  readonly selectedCommit: Commit | null
+  readonly changedFiles: ReadonlyArray<CommittedFileChange>
+  readonly selectedFile: CommittedFileChange | null
+  readonly currentDiff: IDiff | null
+  readonly commitSummaryWidth: number
+  readonly gitHubUsers: Map<string, IGitHubUser>
+  readonly selectedDiffType: ImageDiffType
+  /** The name of the currently selected external editor */
+  readonly externalEditorLabel?: string
+
+  /**
+   * Called to open a file using the user's configured applications
+   * @param path The path of the file relative to the root of the repository
+   */
+  readonly onOpenInExternalEditor: (path: string) => void
+}
+
+interface ISelectedCommitState {
+  readonly isExpanded: boolean
+}
+
+/** The History component. Contains the commit list, commit summary, and diff. */
+export class SelectedCommit extends React.Component<
+  ISelectedCommitProps,
+  ISelectedCommitState
+> {
+  private readonly loadChangedFilesScheduler = new ThrottledScheduler(200)
+
+  public constructor(props: ISelectedCommitProps) {
+    super(props)
+
+    this.state = {
+      isExpanded: false,
+    }
+  }
+
+  private onFileSelected = (file: FileChange) => {
+    this.props.dispatcher.changeHistoryFileSelection(
+      this.props.repository,
+      file as CommittedFileChange
+    )
+  }
+
+  public componentWillUpdate(nextProps: ISelectedCommitProps) {
+    // reset isExpanded if we're switching commits.
+    const currentValue = this.props.selectedCommit
+      ? this.props.selectedCommit.sha
+      : undefined
+    const nextValue = nextProps.selectedCommit
+      ? nextProps.selectedCommit.sha
+      : undefined
+
+    if ((currentValue || nextValue) && currentValue !== nextValue) {
+      if (this.state.isExpanded) {
+        this.setState({ isExpanded: false })
+      }
+    }
+  }
+
+  public componentWillUnmount() {
+    this.loadChangedFilesScheduler.clear()
+  }
+
+  private renderDiff() {
+    const file = this.props.selectedFile
+    const diff = this.props.currentDiff
+
+    if (file == null || diff == null) {
+      // don't show both 'empty' messages
+      const message =
+        this.props.changedFiles.length === 0 ? '' : 'No file selected'
+
+      return (
+        <div className="panel blankslate" id="diff">
+          {message}
+        </div>
+      )
+    }
+
+    return (
+      <Diff
+        repository={this.props.repository}
+        imageDiffType={this.props.selectedDiffType}
+        file={file}
+        diff={diff}
+        readOnly={true}
+        dispatcher={this.props.dispatcher}
+      />
+    )
+  }
+
+  private renderCommitSummary(commit: Commit) {
+    return (
+      <CommitSummary
+        commit={commit}
+        files={this.props.changedFiles}
+        emoji={this.props.emoji}
+        repository={this.props.repository}
+        gitHubUsers={this.props.gitHubUsers}
+        onExpandChanged={this.onExpandChanged}
+        isExpanded={this.state.isExpanded}
+      />
+    )
+  }
+
+  private onExpandChanged = (isExpanded: boolean) => {
+    this.setState({ isExpanded })
+  }
+
+  private onCommitSummaryReset = () => {
+    this.props.dispatcher.resetCommitSummaryWidth()
+  }
+
+  private onCommitSummaryResize = (width: number) => {
+    this.props.dispatcher.setCommitSummaryWidth(width)
+  }
+
+  private renderFileList() {
+    const files = this.props.changedFiles
+    if (files.length === 0) {
+      return <div className="fill-window">No files in commit</div>
+    }
+
+    // -1 for right hand side border
+    const availableWidth = this.props.commitSummaryWidth - 1
+
+    return (
+      <FileList
+        files={files}
+        onSelectedFileChanged={this.onFileSelected}
+        selectedFile={this.props.selectedFile}
+        availableWidth={availableWidth}
+        onOpenItem={this.onOpenItem}
+        externalEditorLabel={this.props.externalEditorLabel}
+        onOpenInExternalEditor={this.props.onOpenInExternalEditor}
+        repository={this.props.repository}
+      />
+    )
+  }
+
+  /**
+   * Open file with default application.
+   * @param path The path of the file relative to the root of the repository
+   */
+  private onOpenItem = (path: string) => {
+    const fullPath = Path.join(this.props.repository.path, path)
+    openFile(fullPath, this.props.dispatcher)
+  }
+
+  public render() {
+    const commit = this.props.selectedCommit
+
+    if (commit == null) {
+      return <NoCommitSelected />
+    }
+
+    const className = this.state.isExpanded ? 'expanded' : 'collapsed'
+
+    return (
+      <div id="history" className={className}>
+        {this.renderCommitSummary(commit)}
+        <div id="commit-details">
+          <Resizable
+            width={this.props.commitSummaryWidth}
+            onResize={this.onCommitSummaryResize}
+            onReset={this.onCommitSummaryReset}
+          >
+            {this.renderFileList()}
+          </Resizable>
+          {this.renderDiff()}
+        </div>
+      </div>
+    )
+  }
+}
+
+function NoCommitSelected() {
+  const BlankSlateImage = encodePathAsUrl(
+    __dirname,
+    'static/empty-no-commit.svg'
+  )
+
+  return (
+    <div className="panel blankslate">
+      <img src={BlankSlateImage} className="blankslate-image" />
+      No commit selected
+    </div>
+  )
+}
removed in remote
  base   100644 5c5a20826435e372f8786d01a203be39bc2046cb app/src/ui/history/sidebar.tsx
  our    100644 5c5a20826435e372f8786d01a203be39bc2046cb app/src/ui/history/sidebar.tsx
@@ -1,70 +0,0 @@
-import * as React from 'react'
-import { CommitList } from './commit-list'
-import { Repository } from '../../models/repository'
-import { Commit } from '../../models/commit'
-import { Dispatcher } from '../../lib/dispatcher'
-import { IGitHubUser } from '../../lib/databases'
-import { IHistoryState } from '../../lib/app-state'
-import { ThrottledScheduler } from '../lib/throttled-scheduler'
-
-/** If we're within this many rows from the bottom, load the next history batch. */
-const CloseToBottomThreshold = 10
-
-interface IHistorySidebarProps {
-  readonly repository: Repository
-  readonly dispatcher: Dispatcher
-  readonly history: IHistoryState
-  readonly gitHubUsers: Map<string, IGitHubUser>
-  readonly emoji: Map<string, string>
-  readonly commitLookup: Map<string, Commit>
-  readonly localCommitSHAs: ReadonlyArray<string>
-  readonly onRevertCommit: (commit: Commit) => void
-  readonly onViewCommitOnGitHub: (sha: string) => void
-}
-
-/** The History component. Contains the commit list, commit summary, and diff. */
-export class HistorySidebar extends React.Component<IHistorySidebarProps, {}> {
-  private readonly loadChangedFilesScheduler = new ThrottledScheduler(200)
-
-  private onCommitSelected = (commit: Commit) => {
-    this.props.dispatcher.changeHistoryCommitSelection(
-      this.props.repository,
-      commit.sha
-    )
-
-    this.loadChangedFilesScheduler.queue(() => {
-      this.props.dispatcher.loadChangedFilesForCurrentSelection(
-        this.props.repository
-      )
-    })
-  }
-
-  private onScroll = (start: number, end: number) => {
-    const history = this.props.history.history
-    if (history.length - end <= CloseToBottomThreshold) {
-      this.props.dispatcher.loadNextHistoryBatch(this.props.repository)
-    }
-  }
-
-  public componentWillUnmount() {
-    this.loadChangedFilesScheduler.clear()
-  }
-
-  public render() {
-    return (
-      <CommitList
-        gitHubRepository={this.props.repository.gitHubRepository}
-        commitLookup={this.props.commitLookup}
-        commits={this.props.history.history}
-        selectedSHA={this.props.history.selection.sha}
-        onCommitSelected={this.onCommitSelected}
-        onScroll={this.onScroll}
-        gitHubUsers={this.props.gitHubUsers}
-        emoji={this.props.emoji}
-        localCommitSHAs={this.props.localCommitSHAs}
-        onRevertCommit={this.props.onRevertCommit}
-        onViewCommitOnGitHub={this.props.onViewCommitOnGitHub}
-      />
-    )
-  }
-}
merged
  result 100644 e09719d3d34c3169bd68c26a84f6b7040c4d34a1 app/src/ui/index.tsx
  our    100644 68dedd34f265a41733b16e76f0ce3b07e05f865e app/src/ui/index.tsx
@@ -12,6 +12,7 @@
   gitAuthenticationErrorHandler,
   externalEditorErrorHandler,
   openShellErrorHandler,
+  mergeConflictHandler,
   lfsAttributeMismatchHandler,
   defaultErrorHandler,
   missingRepositoryHandler,
@@ -138,6 +139,7 @@
 dispatcher.registerErrorHandler(upstreamAlreadyExistsHandler)
 dispatcher.registerErrorHandler(externalEditorErrorHandler)
 dispatcher.registerErrorHandler(openShellErrorHandler)
+dispatcher.registerErrorHandler(mergeConflictHandler)
 dispatcher.registerErrorHandler(lfsAttributeMismatchHandler)
 dispatcher.registerErrorHandler(gitAuthenticationErrorHandler)
 dispatcher.registerErrorHandler(pushNeedsPullHandler)
added in remote
  their  100644 ea7e335764dce50a5697270ad74ac61d4df250d3 app/src/ui/lib/application-theme.ts
@@ -0,0 +1,56 @@
+import { assertNever } from '../../lib/fatal-error'
+
+/**
+ * A set of the user-selectable appearances (aka themes)
+ */
+export enum ApplicationTheme {
+  Light,
+  Dark,
+}
+
+/**
+ * Gets the friendly name of an application theme for use
+ * in persisting to storage and/or calculating the required
+ * body class name to set in order to apply the theme.
+ */
+export function getThemeName(theme: ApplicationTheme): string {
+  switch (theme) {
+    case ApplicationTheme.Light:
+      return 'light'
+    case ApplicationTheme.Dark:
+      return 'dark'
+    default:
+      return assertNever(theme, `Unknown theme ${theme}`)
+  }
+}
+
+// The key under which the currently selected theme is persisted
+// in localStorage.
+const applicationThemeKey = 'theme'
+
+/**
+ * Load the currently selected theme from the persistent
+ * store (localStorage). If no theme is selected the default
+ * theme will be returned.
+ */
+export function getPersistedTheme(): ApplicationTheme {
+  return localStorage.getItem(applicationThemeKey) === 'dark'
+    ? ApplicationTheme.Dark
+    : ApplicationTheme.Light
+}
+
+/**
+ * Load the name of the currently selected theme from the persistent
+ * store (localStorage). If no theme is selected the default
+ * theme name will be returned.
+ */
+export function getPersistedThemeName(): string {
+  return getThemeName(getPersistedTheme())
+}
+
+/**
+ * Store the given theme in the persistent store (localStorage).
+ */
+export function setPersistedTheme(theme: ApplicationTheme) {
+  localStorage.setItem(applicationThemeKey, getThemeName(theme))
+}
merged
  result 100644 fc57454845110cf3f68a914d768fbd7c0fcb7334 app/src/ui/lib/author-input.tsx
  our    100644 ce2ac281f54bee2dd43287b02559765a97896d98 app/src/ui/lib/author-input.tsx
@@ -174,17 +174,6 @@
   return scanWhile(doc, start, (doc, pos) => !predicate(doc, pos), iter)
 }

-/**
- * Given a cursor position, expand it into a range covering as
- * long of an autocompletable string as possible.
- */
-function getHintRangeFromCursor(doc: Doc, cursor: Position) {
-  return {
-    from: scanUntil(doc, cursor, isMarkOrWhitespace, prevPosition),
-    to: scanUntil(doc, cursor, isMarkOrWhitespace, nextPosition),
-  }
-}
-
 function appendTextMarker(
   cm: Editor,
   text: string,
@@ -635,7 +624,10 @@
     const doc = cm.getDoc()
     const cursor = doc.getCursor() as Readonly<Position>

-    const { from, to } = getHintRangeFromCursor(doc, cursor)
+    // expand the current cursor position into a range covering as
+    // long of an autocompletable string as possible.
+    const from = scanUntil(doc, cursor, isMarkOrWhitespace, prevPosition)
+    const to = scanUntil(doc, cursor, isMarkOrWhitespace, nextPosition)

     const word = doc.getRange(from, to)

merged
  result 100644 e67fec4d040e5e4975cb0ae8992ec28f6683df0e app/src/ui/lib/branch-name-warnings.tsx
  our    100644 f5d37c46294aebe893fe8c432c70b78e9297a20b app/src/ui/lib/branch-name-warnings.tsx
@@ -1,4 +1,5 @@
 import * as React from 'react'
+import { Branch } from '../../models/branch'

 import { Row } from './row'
 import { Octicon, OcticonSymbol } from '../octicons'
@@ -30,3 +31,18 @@
     return null
   }
 }
+export function renderBranchHasRemoteWarning(branch: Branch) {
+  if (branch.upstream != null) {
+    return (
+      <Row className="warning-helper-text">
+        <Octicon symbol={OcticonSymbol.alert} />
+        <p>
+          This branch is tracking <Ref>{branch.upstream}</Ref> and renaming this
+          branch will not change the branch name on the remote.
+        </p>
+      </Row>
+    )
+  } else {
+    return null
+  }
+}
added in remote
  their  100644 3700c8d5f94db7df3f64d2b73d4da9ae0dcad379 app/src/ui/lib/bytes.ts
@@ -0,0 +1,27 @@
+/**
+ * Number sign display mode
+ */
+export const enum Sign {
+  Normal,
+  Forced,
+}
+
+/**
+ * Display bytes in human readable format like:
+ *    23GB
+ *   -43B
+ * It's also possible to force sign in order to get the
+ * plus sign in case of positive numbers like:
+ *   +23GB
+ *   -43B
+ */
+export const formatBytes = (bytes: number, signType: Sign = Sign.Normal) => {
+  if (!Number.isFinite(bytes)) {
+    return 'Unknown'
+  }
+  const sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB']
+  const sizeIndex = Math.floor(Math.log(Math.abs(bytes)) / Math.log(1024))
+  const sign = signType === Sign.Forced && bytes > 0 ? '+' : ''
+  const value = Math.round(bytes / Math.pow(1024, sizeIndex))
+  return `${sign}${value}${sizes[sizeIndex]}`
+}
added in remote
  their  100644 8e64852c77aab8327ec82aee0e7504fd934abe7b app/src/ui/lib/context-menu.ts
@@ -0,0 +1,21 @@
+const RestrictedFileExtensions = ['.cmd', '.exe', '.bat', '.sh']
+export const DefaultEditorLabel = __DARWIN__
+  ? 'Open in External Editor'
+  : 'Open in external editor'
+
+export const RevealInFileManagerLabel = __DARWIN__
+  ? 'Reveal in Finder'
+  : __WIN32__
+    ? 'Show in Explorer'
+    : 'Show in your File Manager'
+
+export const OpenWithDefaultProgramLabel = __DARWIN__
+  ? 'Open with Default Program'
+  : 'Open with default program'
+
+export function isSafeFileExtension(extension: string): boolean {
+  if (__WIN32__) {
+    return RestrictedFileExtensions.indexOf(extension.toLowerCase()) === -1
+  }
+  return true
+}
added in remote
  their  100644 7e0e709f0e2c042f8e122480dc6f4a05460633d4 app/src/ui/lib/fancy-text-box.tsx
@@ -0,0 +1,73 @@
+import * as React from 'react'
+import { Octicon, OcticonSymbol } from '../octicons'
+import { TextBox, ITextBoxProps } from './text-box'
+import * as classNames from 'classnames'
+
+interface IFancyTextBoxProps extends ITextBoxProps {
+  /** Icon to render */
+  readonly symbol: OcticonSymbol
+
+  /** Callback used to get a reference to internal TextBox */
+  readonly onRef: (textbox: TextBox) => void
+}
+
+interface IFancyTextBoxState {
+  readonly isFocused: boolean
+}
+
+export class FancyTextBox extends React.Component<
+  IFancyTextBoxProps,
+  IFancyTextBoxState
+> {
+  public constructor(props: IFancyTextBoxProps) {
+    super(props)
+
+    this.state = { isFocused: false }
+  }
+
+  public render() {
+    const componentCSS = classNames(
+      'fancy-text-box-component',
+      this.props.className,
+      { disabled: this.props.disabled },
+      { focused: this.state.isFocused }
+    )
+    const octiconCSS = classNames('fancy-octicon')
+
+    return (
+      <div className={componentCSS}>
+        <Octicon className={octiconCSS} symbol={this.props.symbol} />
+        <TextBox
+          value={this.props.value}
+          onFocus={this.onFocus}
+          onBlur={this.onBlur}
+          autoFocus={this.props.autoFocus}
+          disabled={this.props.disabled}
+          type={this.props.type}
+          placeholder={this.props.placeholder}
+          onKeyDown={this.props.onKeyDown}
+          onValueChanged={this.props.onValueChanged}
+          onSearchCleared={this.props.onSearchCleared}
+          tabIndex={this.props.tabIndex}
+          ref={this.props.onRef}
+        />
+      </div>
+    )
+  }
+
+  private onFocus = () => {
+    if (this.props.onFocus !== undefined) {
+      this.props.onFocus()
+    }
+
+    this.setState({ isFocused: true })
+  }
+
+  private onBlur = () => {
+    if (this.props.onBlur !== undefined) {
+      this.props.onBlur()
+    }
+
+    this.setState({ isFocused: false })
+  }
+}
merged
  result 100644 c845440dc0449aaf6b81f86a7a77eb0d3d8d1a8f app/src/ui/lib/filter-list.tsx
  our    100644 b9bb01a8b42988979f70713fba1d5035438fda4d app/src/ui/lib/filter-list.tsx
@@ -1,16 +1,20 @@
 import * as React from 'react'
 import * as classnames from 'classnames'

-import { List, SelectionSource as ListSelectionSource } from '../lib/list'
+import {
+  List,
+  SelectionSource as ListSelectionSource,
+  findNextSelectableRow,
+} from '../lib/list'
 import { TextBox } from '../lib/text-box'
 import { Row } from '../lib/row'

-import { match, IMatch } from '../../lib/fuzzy-find'
+import { match, IMatch, IMatches } from '../../lib/fuzzy-find'

 /** An item in the filter list. */
 export interface IFilterListItem {
   /** The text which represents the item. This is used for filtering. */
-  readonly text: string
+  readonly text: ReadonlyArray<string>

   /** A unique identifier for the item. */
   readonly id: string
@@ -34,7 +38,7 @@
   readonly kind: 'item'
   readonly item: T
   /** Array of indexes in `item.text` that should be highlighted */
-  readonly matches: ReadonlyArray<number>
+  readonly matches: IMatches
 }

 /**
@@ -59,10 +63,7 @@
   readonly selectedItem: T | null

   /** Called to render each visible item. */
-  readonly renderItem: (
-    item: T,
-    matches: ReadonlyArray<number>
-  ) => JSX.Element | null
+  readonly renderItem: (item: T, matches: IMatches) => JSX.Element | null

   /** Called to render header for the group with the given identifier. */
   readonly renderGroupHeader?: (identifier: string) => JSX.Element | null
@@ -117,6 +118,14 @@

   /** Called when there are no items to render.  */
   readonly renderNoItems?: () => JSX.Element | null
+
+  /**
+   * A reference to a TextBox that will be used to control this component.
+   *
+   * See https://github.com/desktop/desktop/issues/4317 for refactoring work to
+   * make this more composable which should make this unnecessary.
+   */
+  readonly filterTextBox?: TextBox
 }

 interface IFilterListState<T extends IFilterListItem> {
@@ -151,6 +160,12 @@
     this.state = createStateUpdate(props)
   }

+  public componentWillMount() {
+    if (this.props.filterTextBox !== undefined) {
+      this.filterTextBox = this.props.filterTextBox
+    }
+  }
+
   public componentWillReceiveProps(nextProps: IFilterListProps<T>) {
     this.setState(createStateUpdate(nextProps))
   }
@@ -189,29 +204,34 @@
   }

   public componentDidMount() {
-    if (this.filterTextBox != null) {
+    if (this.filterTextBox !== null) {
       this.filterTextBox.selectAll()
     }
   }

+  public renderTextBox() {
+    return (
+      <TextBox
+        ref={this.onTextBoxRef}
+        type="search"
+        autoFocus={true}
+        placeholder="Filter"
+        className="filter-list-filter-field"
+        onValueChanged={this.onFilterValueChanged}
+        onKeyDown={this.onKeyDown}
+        value={this.props.filterText}
+        disabled={this.props.disabled}
+      />
+    )
+  }
+
   public render() {
     return (
       <div className={classnames('filter-list', this.props.className)}>
         {this.props.renderPreList ? this.props.renderPreList() : null}

         <Row className="filter-field-row">
-          <TextBox
-            ref={this.onTextBoxRef}
-            type="search"
-            autoFocus={true}
-            placeholder="Filter"
-            className="filter-list-filter-field"
-            onValueChanged={this.onFilterValueChanged}
-            onKeyDown={this.onKeyDown}
-            value={this.props.filterText}
-            disabled={this.props.disabled}
-          />
-
+          {this.props.filterTextBox === undefined ? this.renderTextBox() : null}
           {this.props.renderPostFilter ? this.props.renderPostFilter() : null}
         </Row>

@@ -220,6 +240,29 @@
     )
   }

+  public selectFirstItem(focus: boolean = false) {
+    if (this.list === null) {
+      return
+    }
+
+    const next = findNextSelectableRow(
+      this.state.rows.length,
+      {
+        direction: 'down',
+        row: -1,
+      },
+      this.canSelectRow
+    )
+
+    if (next !== null) {
+      this.setState({ selectedRow: next }, () => {
+        if (focus && this.list !== null) {
+          this.list.focus()
+        }
+      })
+    }
+  }
+
   private renderContent() {
     if (this.state.rows.length === 0 && this.props.renderNoItems) {
       return this.props.renderNoItems()
@@ -230,8 +273,8 @@
           rowCount={this.state.rows.length}
           rowRenderer={this.renderRow}
           rowHeight={this.props.rowHeight}
-          selectedRow={this.state.selectedRow}
-          onSelectionChanged={this.onSelectionChanged}
+          selectedRows={[this.state.selectedRow]}
+          onSelectedRowChanged={this.onSelectedRowChanged}
           onRowClick={this.onRowClick}
           onRowKeyDown={this.onRowKeyDown}
           canSelectRow={this.canSelectRow}
@@ -269,7 +312,7 @@
     }
   }

-  private onSelectionChanged = (index: number, source: SelectionSource) => {
+  private onSelectedRowChanged = (index: number, source: SelectionSource) => {
     this.setState({ selectedRow: index })

     if (this.props.onSelectionChanged) {
@@ -305,8 +348,19 @@
       return
     }

-    const firstSelectableRow = list.nextSelectableRow('down', -1)
-    const lastSelectableRow = list.nextSelectableRow('up', 0)
+    const rowCount = this.state.rows.length
+
+    const firstSelectableRow = findNextSelectableRow(
+      rowCount,
+      { direction: 'down', row: -1 },
+      this.canSelectRow
+    )
+    const lastSelectableRow = findNextSelectableRow(
+      rowCount,
+      { direction: 'up', row: 0 },
+      this.canSelectRow
+    )
+
     let shouldFocus = false

     if (event.key === 'ArrowUp' && row === firstSelectableRow) {
@@ -341,9 +395,15 @@
       return
     }

+    const rowCount = this.state.rows.length
+
     if (key === 'ArrowDown') {
-      if (this.state.rows.length > 0) {
-        const selectedRow = list.nextSelectableRow('down', -1)
+      if (rowCount > 0) {
+        const selectedRow = findNextSelectableRow(
+          rowCount,
+          { direction: 'down', row: -1 },
+          this.canSelectRow
+        )
         if (selectedRow != null) {
           this.setState({ selectedRow }, () => {
             list.focus()
@@ -353,8 +413,12 @@

       event.preventDefault()
     } else if (key === 'ArrowUp') {
-      if (this.state.rows.length > 0) {
-        const selectedRow = list.nextSelectableRow('up', 0)
+      if (rowCount > 0) {
+        const selectedRow = findNextSelectableRow(
+          rowCount,
+          { direction: 'up', row: 0 },
+          this.canSelectRow
+        )
         if (selectedRow != null) {
           this.setState({ selectedRow }, () => {
             list.focus()
@@ -365,7 +429,7 @@
       event.preventDefault()
     } else if (key === 'Enter') {
       // no repositories currently displayed, bail out
-      if (!this.state.rows.length) {
+      if (rowCount === 0) {
         return event.preventDefault()
       }

@@ -375,15 +439,25 @@
         return event.preventDefault()
       }

-      const row = list.nextSelectableRow('down', -1)
+      const row = findNextSelectableRow(
+        rowCount,
+        { direction: 'down', row: -1 },
+        this.canSelectRow
+      )

-      if (row) {
+      if (row != null) {
         this.onRowClick(row)
       }
     }
   }
 }

+export function getText<T extends IFilterListItem>(
+  item: T
+): ReadonlyArray<string> {
+  return item['text']
+}
+
 function createStateUpdate<T extends IFilterListItem>(
   props: IFilterListProps<T>
 ) {
@@ -392,8 +466,12 @@

   for (const group of props.groups) {
     const items: ReadonlyArray<IMatch<T>> = filter
-      ? match(filter, group.items, 'text')
-      : group.items.map(item => ({ score: 1, matches: [], item }))
+      ? match(filter, group.items, getText)
+      : group.items.map(item => ({
+          score: 1,
+          matches: { title: [], subtitle: [] },
+          item,
+        }))

     if (!items.length) {
       continue
merged
  result 100644 709940e3ff06be4683e739ccf2696ae16823aaa8 app/src/ui/lib/focus-container.tsx
  our    100644 8b8d3c828c4c092d1c07ade684131afd70e763a0 app/src/ui/lib/focus-container.tsx
@@ -4,6 +4,10 @@
 interface IFocusContainerProps {
   readonly className?: string
   readonly onClick?: (event: React.MouseEvent<HTMLDivElement>) => void
+  readonly onKeyDown?: (event: React.KeyboardEvent<HTMLDivElement>) => void
+
+  /** Callback used when focus is within container */
+  readonly onFocusWithinChanged?: (focusWithin: boolean) => void
 }

 interface IFocusContainerState {
@@ -26,20 +30,43 @@
   IFocusContainerState
 > {
   private wrapperRef: HTMLDivElement | null = null
+  private focusWithinChangedTimeoutId: number | null = null

   public constructor(props: IFocusContainerProps) {
     super(props)
     this.state = { focusWithin: false }
   }

+  /**
+   * Update the focus state of the container, aborting any in-flight animation
+   *
+   * @param focusWithin the new focus state of the control
+   */
+  private onFocusWithinChanged(focusWithin: boolean) {
+    this.setState({ focusWithin })
+
+    if (this.focusWithinChangedTimeoutId !== null) {
+      cancelAnimationFrame(this.focusWithinChangedTimeoutId)
+      this.focusWithinChangedTimeoutId = null
+    }
+
+    this.focusWithinChangedTimeoutId = requestAnimationFrame(() => {
+      if (this.props.onFocusWithinChanged) {
+        this.props.onFocusWithinChanged(focusWithin)
+      }
+
+      this.focusWithinChangedTimeoutId = null
+    })
+  }
+
   private onWrapperRef = (elem: HTMLDivElement) => {
     if (elem) {
       elem.addEventListener('focusin', () => {
-        this.setState({ focusWithin: true })
+        this.onFocusWithinChanged(true)
       })

       elem.addEventListener('focusout', () => {
-        this.setState({ focusWithin: false })
+        this.onFocusWithinChanged(false)
       })
     }

@@ -52,6 +79,12 @@
     }
   }

+  private onKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {
+    if (this.props.onKeyDown) {
+      this.props.onKeyDown(e)
+    }
+  }
+
   private onMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {
     // If someone is clicking on the focuscontainer itself we'll
     // cancel it, that saves us from having a focusout/in cycle
@@ -72,6 +105,7 @@
         ref={this.onWrapperRef}
         onClick={this.onClick}
         onMouseDown={this.onMouseDown}
+        onKeyDown={this.onKeyDown}
       >
         {this.props.children}
       </div>
merged
  result 100644 861d4a732ccab52dda47589ad6904afbdd204d56 app/src/ui/lib/list/index.ts
  our    100644 c1edf1e2d209c6b876ba5deb92af9d75fa5be1a6 app/src/ui/lib/list/index.ts
@@ -1 +1,2 @@
 export * from './list'
+export * from './selection'
merged
  result 100644 e534ebfd72eb9026d47bcdcd9e3077b295db520a app/src/ui/lib/list/list.tsx
  our    100644 b802d39f208620ff995e34fe62a149883b81c618 app/src/ui/lib/list/list.tsx
@@ -1,9 +1,19 @@
 import * as React from 'react'
 import * as ReactDOM from 'react-dom'
 import { Grid, AutoSizer } from 'react-virtualized'
-import { shallowEquals } from '../../../lib/equality'
+import { shallowEquals, arrayEquals } from '../../../lib/equality'
+import { FocusContainer } from '../../lib/focus-container'
 import { ListRow } from './list-row'
+import {
+  findNextSelectableRow,
+  SelectionSource,
+  SelectionDirection,
+  IMouseClickSource,
+  IKeyboardSource,
+  ISelectAllSource,
+} from './selection'
 import { createUniqueId, releaseUniqueId } from '../../lib/id-pool'
+import { range } from '../../../lib/range'

 /**
  * Describe the first argument given to the cellRenderer,
@@ -28,37 +38,6 @@
   readonly style: React.CSSProperties
 }

-/**
- * Interface describing a user initiated selection change event
- * originating from a pointer device clicking or pressing on an item.
- */
-export interface IMouseClickSource {
-  readonly kind: 'mouseclick'
-  readonly event: React.MouseEvent<any>
-}
-
-/**
- * Interface describing a user initiated selection change event
- * originating from a pointer device hovering over an item.
- * Only applicable when selectedOnHover is set.
- */
-export interface IHoverSource {
-  readonly kind: 'hover'
-  readonly event: React.MouseEvent<any>
-}
-
-/**
- * Interface describing a user initiated selection change event
- * originating from a keyboard
- */
-export interface IKeyboardSource {
-  readonly kind: 'keyboard'
-  readonly event: React.KeyboardEvent<any>
-}
-
-/** A type union of possible sources of a selection changed event */
-export type SelectionSource = IMouseClickSource | IHoverSource | IKeyboardSource
-
 export type ClickSource = IMouseClickSource | IKeyboardSource

 interface IListProps {
@@ -89,11 +68,11 @@
   readonly rowHeight: number | ((info: { index: number }) => number)

   /**
-   * The currently selected row index. Used to attach a special
-   * selection class on that row container as well as being used
+   * The currently selected rows indexes. Used to attach a special
+   * selection class on those row's containers as well as being used
    * for keyboard selection.
    */
-  readonly selectedRow: number
+  readonly selectedRows: ReadonlyArray<number>

   /**
    * This function will be called when a pointer device is pressed and then
@@ -111,16 +90,68 @@
   readonly onRowClick?: (row: number, soure: ClickSource) => void

   /**
+   * This prop defines the behaviour of the selection of items whithin this list.
+   *  - 'single' : (default) single list-item selection. [shift] and [ctrl] have
+   * no effect. Use in combination with one of:
+   *             onSelectedRowChanged(row: number)
+   *             onSelectionChanged(rows: number[])
+   *  - 'range' : allows for selecting continuous ranges. [shift] can be used.
+   * [ctrl] has no effect. Use in combination with one of:
+   *             onSelectedRangeChanged(start: number, end: number)
+   *             onSelectionChanged(rows: number[])
+   *  - 'multi' : allows range and/or arbitrary selection. [shift] and [ctrl]
+   * can be used. Use in combination with:
+   *             onSelectionChanged(rows: number[])
+   */
+  readonly selectionMode?: 'single' | 'range' | 'multi'
+
+  /**
    * This function will be called when the selection changes as a result of a
    * user keyboard or mouse action (i.e. not when props change). This function
    * will not be invoked when an already selected row is clicked on.
+   * Use this function when the selectionMode is 'single'
    *
    * @param row    - The index of the row that was just selected
    * @param source - The kind of user action that provoked the change, either
    *                 a pointer device press, hover (if selectOnHover is set) or
    *                 a keyboard event (arrow up/down)
    */
-  readonly onSelectionChanged?: (row: number, source: SelectionSource) => void
+  readonly onSelectedRowChanged?: (row: number, source: SelectionSource) => void
+
+  /**
+   * This function will be called when the selection changes as a result of a
+   * user keyboard or mouse action (i.e. not when props change). This function
+   * will not be invoked when an already selected row is clicked on.
+   * Index parameters are inclusive
+   * Use this function when the selectionMode is 'range'
+   *
+   * @param start  - The index of the first selected row
+   * @param end    - The index of the last selected row
+   * @param source - The kind of user action that provoked the change, either
+   *                 a pointer device press, hover (if selectOnHover is set) or
+   *                 a keyboard event (arrow up/down)
+   */
+  readonly onSelectedRangeChanged?: (
+    start: number,
+    end: number,
+    source: SelectionSource
+  ) => void
+
+  /**
+   * This function will be called when the selection changes as a result of a
+   * user keyboard or mouse action (i.e. not when props change). This function
+   * will not be invoked when an already selected row is clicked on.
+   * Use this function for any selectionMode
+   *
+   * @param rows   - The indexes of the row(s) that are part of the selection
+   * @param source - The kind of user action that provoked the change, either
+   *                 a pointer device press, hover (if selectOnHover is set) or
+   *                 a keyboard event (arrow up/down)
+   */
+  readonly onSelectionChanged?: (
+    rows: ReadonlyArray<number>,
+    source: SelectionSource
+  ) => void

   /**
    * A handler called whenever a key down event is received on the
@@ -185,6 +216,21 @@
   readonly rowIdPrefix?: string
 }

+/**
+ * Create an array with row indices between firstRow and lastRow (inclusive).
+ *
+ * This is essentially a range function with the explicit behavior of
+ * inclusive upper and lower bound.
+ */
+function createSelectionBetween(
+  firstRow: number,
+  lastRow: number
+): ReadonlyArray<number> {
+  // range is upper bound exclusive
+  const end = lastRow > firstRow ? lastRow + 1 : lastRow - 1
+  return range(firstRow, end)
+}
+
 export class List extends React.Component<IListProps, IListState> {
   private focusItem: HTMLDivElement | null = null
   private fakeScroll: HTMLDivElement | null = null
@@ -254,13 +300,53 @@
     }
   }

+  private onSelectAll = (event: Event) => {
+    const selectionMode = this.props.selectionMode
+
+    if (selectionMode !== 'range' && selectionMode !== 'multi') {
+      return
+    }
+
+    event.preventDefault()
+
+    if (this.props.rowCount <= 0) {
+      return
+    }
+
+    const source: ISelectAllSource = { kind: 'select-all' }
+    const firstRow = 0
+    const lastRow = this.props.rowCount - 1
+
+    if (this.props.onSelectionChanged) {
+      const newSelection = createSelectionBetween(firstRow, lastRow)
+      this.props.onSelectionChanged(newSelection, source)
+    }
+
+    if (selectionMode === 'range' && this.props.onSelectedRangeChanged) {
+      this.props.onSelectedRangeChanged(firstRow, lastRow, source)
+    }
+  }
+
   private onRef = (element: HTMLDivElement | null) => {
+    if (element === null && this.list !== null) {
+      this.list.removeEventListener('select-all', this.onSelectAll)
+    }
+
     this.list = element

+    if (element !== null) {
+      // This is a custom event that desktop emits through <App />
+      // when the user selects the Edit > Select all menu item. We
+      // hijack it and select all list items rather than let it bubble
+      // to electron's default behavior which is to select all selectable
+      // text in the renderer.
+      element.addEventListener('select-all', this.onSelectAll)
+    }
+
     if (this.resizeObserver) {
       this.resizeObserver.disconnect()

-      if (element) {
+      if (element !== null) {
         this.resizeObserver.observe(element)
       } else {
         this.setState({ width: undefined, height: undefined })
@@ -269,10 +355,11 @@
   }

   private handleKeyDown = (event: React.KeyboardEvent<any>) => {
-    const row = this.props.selectedRow
-    if (row >= 0 && this.props.onRowKeyDown) {
-      this.props.onRowKeyDown(row, event)
-    }
+    this.props.selectedRows.forEach(row => {
+      if (this.props.onRowKeyDown) {
+        this.props.onRowKeyDown(row, event)
+      }
+    })

     // The consumer is given a change to prevent the default behavior for
     // keyboard navigation so that they can customize its behavior as needed.
@@ -281,10 +368,26 @@
     }

     if (event.key === 'ArrowDown') {
-      this.moveSelection('down', event)
+      if (
+        event.shiftKey &&
+        this.props.selectionMode &&
+        this.props.selectionMode !== 'single'
+      ) {
+        this.addSelection('down', event)
+      } else {
+        this.moveSelection('down', event)
+      }
       event.preventDefault()
     } else if (event.key === 'ArrowUp') {
-      this.moveSelection('up', event)
+      if (
+        event.shiftKey &&
+        this.props.selectionMode &&
+        this.props.selectionMode !== 'single'
+      ) {
+        this.addSelection('up', event)
+      } else {
+        this.moveSelection('up', event)
+      }
       event.preventDefault()
     }
   }
@@ -300,18 +403,37 @@
     // We give consumers the power to prevent the onRowClick event by subscribing
     // to the onRowKeyDown event and calling event.preventDefault. This lets
     // consumers add their own semantics for keyboard presses.
-    if (!event.defaultPrevented && this.props.onRowClick) {
-      if (event.key === 'Enter' || event.key === ' ') {
-        this.props.onRowClick(rowIndex, { kind: 'keyboard', event })
-        event.preventDefault()
-      }
+    if (
+      !event.defaultPrevented &&
+      (event.key === 'Enter' || event.key === ' ')
+    ) {
+      this.toggleSelection(event)
+      event.preventDefault()
+    }
+  }
+
+  private onKeyDown = (event: React.KeyboardEvent<any>) => {
+    if (event.key === 'Enter' || event.key === ' ') {
+      this.toggleSelection(event)
+      event.preventDefault()
     }
   }

+  private toggleSelection = (event: React.KeyboardEvent<any>) => {
+    this.props.selectedRows.forEach(row => {
+      if (this.props.onRowClick) {
+        this.props.onRowClick(row, { kind: 'keyboard', event })
+      }
+    })
+  }
+
   private onRowMouseOver = (row: number, event: React.MouseEvent<any>) => {
     if (this.props.selectOnHover && this.canSelectRow(row)) {
-      if (row !== this.props.selectedRow && this.props.onSelectionChanged) {
-        this.props.onSelectionChanged(row, { kind: 'hover', event })
+      if (
+        this.props.selectedRows.includes(row) &&
+        this.props.onSelectionChanged
+      ) {
+        this.props.onSelectionChanged([row], { kind: 'hover', event })
         // By calling scrollRowToVisible we ensure that hovering over a partially
         // visible item at the top or bottom of the list scrolls it into view but
         // more importantly `scrollRowToVisible` automatically manages focus so
@@ -322,54 +444,76 @@
     }
   }

-  /**
-   * Determine the next selectable row, given the direction and row. This will
-   * take `canSelectRow` into account.
-   *
-   * Returns null if no row can be selected.
-   */
-  public nextSelectableRow(
-    direction: 'up' | 'down',
-    row: number
-  ): number | null {
-    // If the row we're starting from is outside our list, make sure we start
-    // walking from _just_ outside the list. We'll also need to walk one more
-    // row than we normally would since the first step is just getting us into
-    // the list.
-    const baseRow = Math.min(Math.max(row, -1), this.props.rowCount)
-    const startOutsideList = row < 0 || row >= this.props.rowCount
-    const rowDelta = startOutsideList
-      ? this.props.rowCount + 1
-      : this.props.rowCount
-
-    for (let i = 1; i < rowDelta; i++) {
-      const delta = direction === 'up' ? i * -1 : i
-      // Modulo accounting for negative values, see https://stackoverflow.com/a/4467559
-      const nextRow =
-        (baseRow + delta + this.props.rowCount) % this.props.rowCount
-
-      if (this.canSelectRow(nextRow)) {
-        return nextRow
-      }
+  /** Convenience method for invoking canSelectRow callback when it exists */
+  private canSelectRow = (rowIndex: number) => {
+    return this.props.canSelectRow ? this.props.canSelectRow(rowIndex) : true
+  }
+
+  private addSelection(
+    direction: SelectionDirection,
+    event: React.KeyboardEvent<any>
+  ) {
+    if (this.props.selectedRows.length === 0) {
+      return this.moveSelection(direction, event)
     }

-    return null
-  }
+    const lastSelection = this.props.selectedRows[
+      this.props.selectedRows.length - 1
+    ]

-  /** Convenience method for invoking canSelectRow callback when it exists */
-  private canSelectRow(rowIndex: number) {
-    return this.props.canSelectRow ? this.props.canSelectRow(rowIndex) : true
+    const selectionOrigin = this.props.selectedRows[0]
+
+    const newRow = findNextSelectableRow(
+      this.props.rowCount,
+      { direction, row: lastSelection, wrap: false },
+      this.canSelectRow
+    )
+
+    if (newRow != null) {
+      if (this.props.onSelectionChanged) {
+        const newSelection = createSelectionBetween(selectionOrigin, newRow)
+        this.props.onSelectionChanged(newSelection, { kind: 'keyboard', event })
+      }
+
+      if (
+        this.props.selectionMode === 'range' &&
+        this.props.onSelectedRangeChanged
+      ) {
+        this.props.onSelectedRangeChanged(selectionOrigin, newRow, {
+          kind: 'keyboard',
+          event,
+        })
+      }
+
+      this.scrollRowToVisible(newRow)
+    }
   }

   private moveSelection(
-    direction: 'up' | 'down',
+    direction: SelectionDirection,
     event: React.KeyboardEvent<any>
   ) {
-    const newRow = this.nextSelectableRow(direction, this.props.selectedRow)
+    const lastSelection =
+      this.props.selectedRows.length > 0
+        ? this.props.selectedRows[this.props.selectedRows.length - 1]
+        : -1
+
+    const newRow = findNextSelectableRow(
+      this.props.rowCount,
+      { direction, row: lastSelection },
+      this.canSelectRow
+    )

     if (newRow != null) {
       if (this.props.onSelectionChanged) {
-        this.props.onSelectionChanged(newRow, { kind: 'keyboard', event })
+        this.props.onSelectionChanged([newRow], { kind: 'keyboard', event })
+      }
+
+      if (this.props.onSelectedRowChanged) {
+        this.props.onSelectedRowChanged(newRow, {
+          kind: 'keyboard',
+          event,
+        })
       }

       this.scrollRowToVisible(newRow)
@@ -407,8 +551,11 @@
         this.state.height !== prevState.height

       if (!gridHasUpdatedAlready) {
-        const selectedRowChanged =
-          prevProps.selectedRow !== this.props.selectedRow
+        const selectedRowChanged = !arrayEquals(
+          prevProps.selectedRows,
+          this.props.selectedRows
+        )
+
         const invalidationPropsChanged = !shallowEquals(
           prevProps.invalidationProps,
           this.props.invalidationProps
@@ -452,13 +599,13 @@
   private renderRow = (params: IRowRendererParams) => {
     const rowIndex = params.rowIndex
     const selectable = this.canSelectRow(rowIndex)
-    const selected = rowIndex === this.props.selectedRow
+    const selected = this.props.selectedRows.indexOf(rowIndex) !== -1
     const focused = rowIndex === this.focusRow

     // An unselectable row shouldn't be focusable
     let tabIndex: number | undefined = undefined
     if (selectable) {
-      tabIndex = selected ? 0 : -1
+      tabIndex = selected && this.props.selectedRows[0] === rowIndex ? 0 : -1
     }

     // We only need to keep a reference to the focused element
@@ -509,9 +656,12 @@
       )
     }

+    // we select the last item from the selection array for this prop
     const activeDescendant =
-      this.props.selectedRow !== -1 && this.state.rowIdPrefix
-        ? `${this.state.rowIdPrefix}-${this.props.selectedRow}`
+      this.props.selectedRows.length && this.state.rowIdPrefix
+        ? `${this.state.rowIdPrefix}-${
+            this.props.selectedRows[this.props.selectedRows.length - 1]
+          }`
         : undefined

     const role = this.props.ariaMode === 'menu' ? 'menu' : 'listbox'
@@ -534,13 +684,18 @@
    * Renders the react-virtualized Grid component and optionally
    * a fake scroll bar component if running on Windows.
    *
-   * @param {width} - The width of the Grid as given by AutoSizer
-   * @param {height} - The height of the Grid as given by AutoSizer
+   * @param width - The width of the Grid as given by AutoSizer
+   * @param height - The height of the Grid as given by AutoSizer
    *
    */
   private renderContents(width: number, height: number) {
     if (__WIN32__) {
-      return [this.renderGrid(width, height), this.renderFakeScroll(height)]
+      return (
+        <>
+          {this.renderGrid(width, height)}
+          {this.renderFakeScroll(height)}
+        </>
+      )
     }

     return this.renderGrid(width, height)
@@ -557,8 +712,8 @@
   /**
    * Renders the react-virtualized Grid component
    *
-   * @param {width} - The width of the Grid as given by AutoSizer
-   * @param {height} - The height of the Grid as given by AutoSizer
+   * @param width - The width of the Grid as given by AutoSizer
+   * @param height - The height of the Grid as given by AutoSizer
    */
   private renderGrid(width: number, height: number) {
     let scrollToRow = this.props.scrollToRow
@@ -572,28 +727,32 @@
     // the list itself needs to be focusable so that you can reach
     // it with keyboard navigation and select an item.
     const tabIndex =
-      this.props.selectedRow < 0 && this.props.rowCount > 0 ? 0 : -1
+      this.props.selectedRows.length < 1 && this.props.rowCount > 0 ? 0 : -1

     return (
-      <Grid
-        aria-label={''}
-        key="grid"
-        role={''}
-        ref={this.onGridRef}
-        autoContainerWidth={true}
-        width={width}
-        height={height}
-        columnWidth={width}
-        columnCount={1}
-        rowCount={this.props.rowCount}
-        rowHeight={this.props.rowHeight}
-        cellRenderer={this.renderRow}
-        onScroll={this.onScroll}
-        scrollToRow={scrollToRow}
-        overscanRowCount={4}
-        style={this.gridStyle}
-        tabIndex={tabIndex}
-      />
+      <FocusContainer
+        className="list-focus-container"
+        onKeyDown={this.onKeyDown}
+      >
+        <Grid
+          aria-label={''}
+          role={''}
+          ref={this.onGridRef}
+          autoContainerWidth={true}
+          width={width}
+          height={height}
+          columnWidth={width}
+          columnCount={1}
+          rowCount={this.props.rowCount}
+          rowHeight={this.props.rowHeight}
+          cellRenderer={this.renderRow}
+          onScroll={this.onScroll}
+          scrollToRow={scrollToRow}
+          overscanRowCount={4}
+          style={this.gridStyle}
+          tabIndex={tabIndex}
+        />
+      </FocusContainer>
     )
   }

@@ -608,7 +767,7 @@
    * be coupled with styling that hides scroll bars on Grid
    * and accurately positions the fake scroll bar.
    *
-   * @param {height} - The height of the Grid as given by AutoSizer
+   * @param height The height of the Grid as given by AutoSizer
    *
    */
   private renderFakeScroll(height: number) {
@@ -624,7 +783,6 @@

     return (
       <div
-        key="fake-scroll"
         className="fake-scroll"
         ref={this.onFakeScrollRef}
         style={{ height }}
@@ -652,7 +810,7 @@

     if (this.grid) {
       const element = ReactDOM.findDOMNode(this.grid)
-      if (element) {
+      if (element instanceof Element) {
         element.scrollTop = e.currentTarget.scrollTop
       }
     }
@@ -664,8 +822,90 @@
         this.props.onRowMouseDown(row, event)
       }

-      if (row !== this.props.selectedRow && this.props.onSelectionChanged) {
-        this.props.onSelectionChanged(row, { kind: 'mouseclick', event })
+      // macOS allow emulating a right click by holding down the ctrl key while
+      // performing a "normal" click.
+      const isRightClick =
+        event.button === 2 ||
+        (__DARWIN__ && event.button === 0 && event.ctrlKey)
+
+      // prevent the right-click event from changing the selection if not necessary
+      if (isRightClick && this.props.selectedRows.includes(row)) {
+        return
+      }
+
+      const multiSelectKey = __DARWIN__ ? event.metaKey : event.ctrlKey
+
+      if (
+        event.shiftKey &&
+        this.props.selectedRows.length &&
+        this.props.selectionMode &&
+        this.props.selectionMode !== 'single'
+      ) {
+        /*
+         * if [shift] is pressed and selectionMode is different than 'single',
+         * select all in-between first selection and current row
+         */
+        const selectionOrigin = this.props.selectedRows[0]
+
+        if (this.props.onSelectionChanged) {
+          const newSelection = createSelectionBetween(selectionOrigin, row)
+          this.props.onSelectionChanged(newSelection, {
+            kind: 'mouseclick',
+            event,
+          })
+        }
+        if (
+          this.props.selectionMode === 'range' &&
+          this.props.onSelectedRangeChanged
+        ) {
+          this.props.onSelectedRangeChanged(selectionOrigin, row, {
+            kind: 'mouseclick',
+            event,
+          })
+        }
+      } else if (multiSelectKey && this.props.selectionMode === 'multi') {
+        /*
+         * if [ctrl] is pressed and selectionMode is 'multi',
+         * toggle selection of the targeted row
+         */
+        if (this.props.onSelectionChanged) {
+          let newSelection: ReadonlyArray<number>
+          if (this.props.selectedRows.includes(row)) {
+            // remove the ability to deselect the last item
+            if (this.props.selectedRows.length === 1) {
+              return
+            }
+            newSelection = this.props.selectedRows.filter(ix => ix !== row)
+          } else {
+            newSelection = [...this.props.selectedRows, row]
+          }
+
+          this.props.onSelectionChanged(newSelection, {
+            kind: 'mouseclick',
+            event,
+          })
+        }
+      } else if (
+        this.props.selectedRows.length !== 1 ||
+        (this.props.selectedRows.length === 1 &&
+          row !== this.props.selectedRows[0])
+      ) {
+        /*
+         * if no special key is pressed, and that the selection is different,
+         * single selection occurs
+         */
+        if (this.props.onSelectionChanged) {
+          this.props.onSelectionChanged([row], { kind: 'mouseclick', event })
+        }
+        if (this.props.onSelectedRangeChanged) {
+          this.props.onSelectedRangeChanged(row, row, {
+            kind: 'mouseclick',
+            event,
+          })
+        }
+        if (this.props.onSelectedRowChanged) {
+          this.props.onSelectedRowChanged(row, { kind: 'mouseclick', event })
+        }
       }
     }
   }
@@ -717,10 +957,13 @@
    */
   public focus() {
     if (
-      this.props.selectedRow >= 0 &&
-      this.props.selectedRow < this.props.rowCount
+      this.props.selectedRows.length > 0 &&
+      this.props.selectedRows[this.props.selectedRows.length - 1] <
+        this.props.rowCount
     ) {
-      this.scrollRowToVisible(this.props.selectedRow)
+      this.scrollRowToVisible(
+        this.props.selectedRows[this.props.selectedRows.length - 1]
+      )
     } else {
       if (this.grid) {
         const element = ReactDOM.findDOMNode(this.grid) as HTMLDivElement
added in remote
  their  100644 e508ad7bd721169b3f96558a76f7e5a32bcf8a71 app/src/ui/lib/list/selection.ts
@@ -0,0 +1,142 @@
+import * as React from 'react'
+
+export type SelectionDirection = 'up' | 'down'
+
+interface ISelectRowAction {
+  /**
+   * The vertical direction use when searching for a selectable row.
+   */
+  readonly direction: SelectionDirection
+
+  /**
+   * The starting row index to search from.
+   */
+  readonly row: number
+
+  /**
+   * A flag to indicate or not to look beyond the last or first
+   * row (depending on direction) such that given the last row and
+   * a downward direction will consider the first row as a
+   * candidate or given the first row and an upward direction
+   * will consider the last row as a candidate.
+   *
+   * Defaults to true if not set.
+   */
+  readonly wrap?: boolean
+}
+
+/**
+ * Interface describing a user initiated selection change event
+ * originating from a pointer device clicking or pressing on an item.
+ */
+export interface IMouseClickSource {
+  readonly kind: 'mouseclick'
+  readonly event: React.MouseEvent<any>
+}
+
+/**
+ * Interface describing a user initiated selection change event
+ * originating from a pointer device hovering over an item.
+ * Only applicable when selectedOnHover is set.
+ */
+export interface IHoverSource {
+  readonly kind: 'hover'
+  readonly event: React.MouseEvent<any>
+}
+
+/**
+ * Interface describing a user initiated selection change event
+ * originating from a keyboard
+ */
+export interface IKeyboardSource {
+  readonly kind: 'keyboard'
+  readonly event: React.KeyboardEvent<any>
+}
+
+/**
+ * Interface describing a user initiated selection of all list
+ * items (usually by clicking the Edit > Select all menu item in
+ * the application window). This is highly specific to GitHub Desktop
+ */
+export interface ISelectAllSource {
+  readonly kind: 'select-all'
+}
+
+/** A type union of possible sources of a selection changed event */
+export type SelectionSource =
+  | IMouseClickSource
+  | IHoverSource
+  | IKeyboardSource
+  | ISelectAllSource
+
+/**
+ * Determine the next selectable row, given the direction and a starting
+ * row index. Whether a row is selectable or not is determined using
+ * the `canSelectRow` function, which defaults to true if not provided.
+ *
+ * Returns null if no row can be selected or if the only selectable row is
+ * identical to the given row parameter.
+ */
+export function findNextSelectableRow(
+  rowCount: number,
+  action: ISelectRowAction,
+  canSelectRow: (row: number) => boolean = row => true
+): number | null {
+  if (rowCount === 0) {
+    return null
+  }
+
+  const { direction, row } = action
+  const wrap = action.wrap === undefined ? true : action.wrap
+
+  // Ensure the row value is in the range between 0 and rowCount - 1
+  //
+  // If the row falls outside this range, use the direction
+  // given to choose a suitable value:
+  //
+  //  - move in an upward direction -> select last row
+  //  - move in a downward direction -> select first row
+  //
+  let currentRow =
+    row < 0 || row >= rowCount ? (direction === 'up' ? rowCount - 1 : 0) : row
+
+  // handle specific case from switching from filter text to list
+  //
+  // locking currentRow to [0,rowCount) above means that the below loops
+  // will skip over the first entry
+  if (direction === 'down' && row === -1) {
+    currentRow = -1
+  }
+
+  const delta = direction === 'up' ? -1 : 1
+
+  // Iterate through all rows (starting offset from the
+  // given row and ending on and including the given row)
+  for (let i = 0; i < rowCount; i++) {
+    currentRow += delta
+
+    if (currentRow >= rowCount) {
+      // We've hit rock bottom, wrap around to the top
+      // if we're allowed to or give up.
+      if (wrap) {
+        currentRow = 0
+      } else {
+        break
+      }
+    } else if (currentRow < 0) {
+      // We've reached the top, wrap around to the bottom
+      // if we're allowed to or give up
+      if (wrap) {
+        currentRow = rowCount - 1
+      } else {
+        break
+      }
+    }
+
+    if (row !== currentRow && canSelectRow(currentRow)) {
+      return currentRow
+    }
+  }
+
+  return null
+}
merged
  result 100644 d99f339f0d967a2ba0f2d644345ead21bc38e5ba app/src/ui/lib/text-box.tsx
  our    100644 eb0d0735615b2dfce3311a6dae577bdf93ba84cb app/src/ui/lib/text-box.tsx
@@ -4,7 +4,7 @@
 import { LinkButton } from './link-button'
 import { showContextualMenu } from '../main-process-proxy'

-interface ITextBoxProps {
+export interface ITextBoxProps {
   /** The label for the input field. */
   readonly label?: string | JSX.Element

@@ -74,6 +74,21 @@

   /** The tab index of the input element. */
   readonly tabIndex?: number
+
+  /**
+   * Callback used when the component is focused.
+   */
+  readonly onFocus?: () => void
+
+  /**
+   * Callback used when the component loses focus.
+   */
+  readonly onBlur?: () => void
+
+  /**
+   * Callback used when the user has cleared the search text.
+   */
+  readonly onSearchCleared?: () => void
 }

 interface ITextBoxState {
@@ -128,11 +143,18 @@
    * (i.e. if it's not disabled explicitly or implicitly through for example a fieldset).
    */
   public focus() {
-    if (this.inputElement === null) {
-      return
+    if (this.inputElement !== null) {
+      this.inputElement.focus()
     }
+  }

-    this.inputElement.focus()
+  /**
+   * Programmatically removes keyboard focus from the inner text input element
+   */
+  public blur() {
+    if (this.inputElement !== null) {
+      this.inputElement.blur()
+    }
   }

   private onChange = (event: React.FormEvent<HTMLInputElement>) => {
@@ -145,8 +167,33 @@
     })
   }

+  private onSearchTextCleared = () => {
+    if (this.props.onSearchCleared != null) {
+      this.props.onSearchCleared()
+    }
+  }
+
+  /**
+   * The search event here is a Chrome and Safari specific event that is
+   * only reported for input[type=search] elements.
+   *
+   * Source: http://help.dottoro.com/ljdvxmhr.php
+   *
+   * TODO: can we hook into the warning API of React to report on incorrect usage
+   * when you set a `onSearchCleared` callback prop but don't use a `type=search`
+   * input - because this won't set an event handler.
+   *
+   */
   private onInputRef = (element: HTMLInputElement | null) => {
+    if (this.inputElement != null && this.props.type === 'search') {
+      this.inputElement.removeEventListener('search', this.onSearchTextCleared)
+    }
+
     this.inputElement = element
+
+    if (this.inputElement != null && this.props.type === 'search') {
+      this.inputElement.addEventListener('search', this.onSearchTextCleared)
+    }
   }

   private renderLabelLink() {
@@ -184,8 +231,10 @@
   }

   private onKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {
+    const value = this.state.value
+
     if (
-      this.state.value !== '' &&
+      value !== '' &&
       this.props.type === 'search' &&
       event.key === 'Escape'
     ) {
@@ -197,6 +246,17 @@
       if (this.props.onValueChanged) {
         this.props.onValueChanged(value)
       }
+    } else if (
+      this.props.type === 'search' &&
+      event.key === 'Escape' &&
+      value === ''
+    ) {
+      if (this.props.onBlur) {
+        this.props.onBlur()
+        if (this.inputElement !== null) {
+          this.inputElement.blur()
+        }
+      }
     }

     if (this.props.onKeyDown !== undefined) {
@@ -215,6 +275,8 @@
         <input
           id={inputId}
           ref={this.onInputRef}
+          onFocus={this.onFocus}
+          onBlur={this.onBlur}
           autoFocus={this.props.autoFocus}
           disabled={this.props.disabled}
           type={this.props.type}
@@ -228,4 +290,16 @@
       </div>
     )
   }
+
+  private onFocus = (event: React.FocusEvent<HTMLInputElement>) => {
+    if (!this.props.autoFocus && this.props.onFocus !== undefined) {
+      this.props.onFocus()
+    }
+  }
+
+  private onBlur = (event: React.FocusEvent<HTMLInputElement>) => {
+    if (this.props.onBlur !== undefined) {
+      this.props.onBlur()
+    }
+  }
 }
merged
  result 100644 eb960cbb3550362276de8faca04b1ee76ceeeb7d app/src/ui/lib/throttled-scheduler.ts
  our    100644 51483eacd05ac47e8e0f0294f02716133e190a78 app/src/ui/lib/throttled-scheduler.ts
@@ -6,7 +6,7 @@
   /**
    * Initialize a new instance of the ThrottledScheduler class
    *
-   * @param {delay} - The minimum interval between invocations
+   * @param delay The minimum interval between invocations
    *                  of callbacks.
    */
   public constructor(delay: number) {
merged
  result 100644 6a7e6976257ec16e58a7331db61b40096a9bde08 app/src/ui/merge-branch/merge.tsx
  our    100644 ccf9cd14a0406216b970ab0f7e5a98bec880171d app/src/ui/merge-branch/merge.tsx
@@ -1,12 +1,18 @@
 import * as React from 'react'
-import { Button } from '../lib/button'
+
+import { getAheadBehind } from '../../lib/git'
 import { Dispatcher } from '../../lib/dispatcher'
+
 import { Branch } from '../../models/branch'
 import { Repository } from '../../models/repository'
-import { getAheadBehind } from '../../lib/git'
+
+import { Button } from '../lib/button'
 import { ButtonGroup } from '../lib/button-group'
+
 import { Dialog, DialogContent, DialogFooter } from '../dialog'
-import { BranchList } from '../branches'
+import { BranchList, IBranchListItem, renderDefaultBranch } from '../branches'
+import { revSymmetricDifference } from '../../lib/git'
+import { IMatches } from '../../lib/fuzzy-find'

 interface IMergeProps {
   readonly dispatcher: Dispatcher
@@ -33,6 +39,11 @@
   readonly recentBranches: ReadonlyArray<Branch>

   /**
+   * The branch to select when the merge dialog is opened
+   */
+  readonly initialBranch?: Branch
+
+  /**
    * A function that's called when the dialog is dismissed by the user in the
    * ways described in the Dialog component's dismissable prop.
    */
@@ -59,12 +70,10 @@
   public constructor(props: IMergeProps) {
     super(props)

-    const currentBranch = props.currentBranch
-    const defaultBranch = props.defaultBranch
+    const selectedBranch = this.resolveSelectedBranch()

     this.state = {
-      // Select the default branch unless that's currently checked out
-      selectedBranch: currentBranch === defaultBranch ? null : defaultBranch,
+      selectedBranch,
       commitCount: undefined,
       filterText: '',
     }
@@ -128,6 +137,10 @@
     )
   }

+  private renderBranch = (item: IBranchListItem, matches: IMatches) => {
+    return renderDefaultBranch(item, matches, this.props.currentBranch)
+  }
+
   public render() {
     const selectedBranch = this.state.selectedBranch
     const currentBranch = this.props.currentBranch
@@ -156,6 +169,7 @@
             selectedBranch={selectedBranch}
             onSelectionChanged={this.onSelectionChanged}
             canCreateNewBranch={false}
+            renderBranch={this.renderBranch}
           />
         </DialogContent>
         <DialogFooter>
@@ -172,7 +186,7 @@
   }

   private async updateCommitCount(branch: Branch) {
-    const range = `...${branch.name}`
+    const range = revSymmetricDifference('', branch.name)
     const aheadBehind = await getAheadBehind(this.props.repository, range)
     const commitCount = aheadBehind ? aheadBehind.behind : 0

@@ -193,4 +207,21 @@
     this.props.dispatcher.mergeBranch(this.props.repository, branch.name)
     this.props.dispatcher.closePopup()
   }
+
+  /**
+   * Returns the branch to use as the selected branch
+   *
+   * The initial branch is used if passed
+   * otherwise, the default branch will be used iff it's
+   * not the currently checked out branch
+   */
+  private resolveSelectedBranch() {
+    const { currentBranch, defaultBranch, initialBranch } = this.props
+
+    if (initialBranch !== undefined) {
+      return initialBranch
+    }
+
+    return currentBranch === defaultBranch ? null : defaultBranch
+  }
 }
added in remote
  their  100644 994e1b5f87e28b721ae596a604deb0ff02f5e377 app/src/ui/merge-conflicts/index.ts
@@ -0,0 +1 @@
+export * from './merge-conflicts-warning'
added in remote
  their  100644 866251dcc5479cdce56345e42689d894ad96e243 app/src/ui/merge-conflicts/merge-conflicts-warning.tsx
@@ -0,0 +1,54 @@
+import * as React from 'react'
+import { Button } from '../lib/button'
+import { ButtonGroup } from '../lib/button-group'
+import { Dialog, DialogContent, DialogFooter } from '../dialog'
+import { Dispatcher } from '../../lib/dispatcher'
+import { RepositorySectionTab } from '../../lib/app-state'
+import { Repository } from '../../models/repository'
+
+interface IMergeConflictsWarningProps {
+  readonly dispatcher: Dispatcher
+  readonly repository: Repository
+  readonly onDismissed: () => void
+}
+
+export class MergeConflictsWarning extends React.Component<
+  IMergeConflictsWarningProps,
+  {}
+> {
+  private onSubmit = () => {
+    this.props.dispatcher.changeRepositorySection(
+      this.props.repository,
+      RepositorySectionTab.Changes
+    )
+    this.props.onDismissed()
+  }
+
+  public render() {
+    return (
+      <Dialog
+        id="merge-conflicts-warning"
+        title={__DARWIN__ ? 'Merge Conflicts Found' : 'Merge conflicts found'}
+        onDismissed={this.props.onDismissed}
+        onSubmit={this.onSubmit}
+      >
+        <DialogContent>
+          <p>Conflicts were detected as part of the last merge operation.</p>
+          <p>
+            You will need to view and resolve these conflicts via your editor or
+            shell before finishing and creating the merge commit.
+          </p>
+        </DialogContent>
+
+        <DialogFooter>
+          <ButtonGroup>
+            <Button type="submit">
+              {__DARWIN__ ? 'View Conflicts' : 'View conflicts'}
+            </Button>
+            <Button onClick={this.props.onDismissed}>Close</Button>
+          </ButtonGroup>
+        </DialogFooter>
+      </Dialog>
+    )
+  }
+}
added in remote
  their  100644 292e9594562025347221742f225faa4c5188009d app/src/ui/notification/new-commits-banner.tsx
@@ -0,0 +1,119 @@
+import * as React from 'react'
+import { Ref } from '../lib/ref'
+import { Octicon, OcticonSymbol } from '../octicons'
+import { Branch } from '../../models/branch'
+import { Button } from '../lib/button'
+import { Dispatcher } from '../../lib/dispatcher'
+import { Repository } from '../../models/repository'
+import {
+  CompareActionKind,
+  ComparisonView,
+  PopupType,
+} from '../../lib/app-state'
+
+export type DismissalReason = 'close' | 'compare' | 'merge'
+
+interface INewCommitsBannerProps {
+  readonly dispatcher: Dispatcher
+
+  readonly repository: Repository
+
+  /**
+   * The number of commits behind base branch
+   */
+  readonly commitsBehindBaseBranch: number
+
+  /**
+   * The target branch that will accept commits
+   * from the current branch
+   */
+  readonly baseBranch: Branch
+
+  /**
+   * Callback used to dismiss the banner
+   */
+  readonly onDismiss: (reason: DismissalReason) => void
+}
+
+/**
+ * Banner used to notify user that their branch is a number of commits behind the base branch
+ */
+export class NewCommitsBanner extends React.Component<
+  INewCommitsBannerProps,
+  {}
+> {
+  public render() {
+    const pluralize = this.props.commitsBehindBaseBranch > 1
+
+    return (
+      <div className="notification-banner diverge-banner">
+        <Octicon
+          symbol={OcticonSymbol.lightBulb}
+          className="notification-icon"
+        />
+
+        <div className="notification-banner-content">
+          <div className="notification-banner-content-body">
+            <p>
+              We have noticed that your branch is{' '}
+              <strong>
+                {this.props.commitsBehindBaseBranch} commit{pluralize
+                  ? 's'
+                  : ''}
+              </strong>{' '}
+              behind <Ref>{this.props.baseBranch.name}</Ref>.
+            </p>
+          </div>
+          <div>
+            <Button className="small-button" onClick={this.onComparedClicked}>
+              View commits
+            </Button>
+            <Button
+              className="small-button"
+              type="submit"
+              onClick={this.onMergeClicked}
+            >
+              Merge...
+            </Button>
+          </div>
+        </div>
+
+        <a
+          className="close"
+          aria-label="Dismiss banner"
+          onClick={this.onDismissed}
+        >
+          <Octicon symbol={OcticonSymbol.x} />
+        </a>
+      </div>
+    )
+  }
+
+  private onDismissed = () => {
+    this.props.onDismiss('close')
+  }
+
+  private onComparedClicked = () => {
+    const { repository, dispatcher } = this.props
+
+    dispatcher.executeCompare(repository, {
+      kind: CompareActionKind.Branch,
+      branch: this.props.baseBranch,
+      mode: ComparisonView.Behind,
+    })
+    dispatcher.recordDivergingBranchBannerInitiatedCompare()
+    this.props.onDismiss('compare')
+  }
+
+  private onMergeClicked = () => {
+    const { repository, dispatcher } = this.props
+
+    dispatcher.showPopup({
+      type: PopupType.MergeBranch,
+      branch: this.props.baseBranch,
+      repository,
+    })
+    dispatcher.recordDivergingBranchBannerInitatedMerge()
+    this.props.onDismiss('merge')
+  }
+}
added in remote
  their  100644 461f079df545b3f64329fb9b73d8484c1ad0792d app/src/ui/preferences/appearance.tsx
@@ -0,0 +1,49 @@
+import * as React from 'react'
+import { DialogContent } from '../dialog'
+import {
+  VerticalSegmentedControl,
+  ISegmentedItem,
+} from '../lib/vertical-segmented-control'
+import { ApplicationTheme } from '../lib/application-theme'
+import { fatalError } from '../../lib/fatal-error'
+
+interface IAppearanceProps {
+  readonly selectedTheme: ApplicationTheme
+  readonly onSelectedThemeChanged: (theme: ApplicationTheme) => void
+}
+
+const themes: ReadonlyArray<ISegmentedItem> = [
+  { title: 'Light', description: 'The default theme of GitHub Desktop' },
+  {
+    title: 'Dark (beta)',
+    description:
+      'A beta version of our dark theme. Still under development. Please report any issues you may find to our issue tracker.',
+  },
+]
+
+export class Appearance extends React.Component<IAppearanceProps, {}> {
+  private onSelectedThemeChanged = (index: number) => {
+    if (index === 0) {
+      this.props.onSelectedThemeChanged(ApplicationTheme.Light)
+    } else if (index === 1) {
+      this.props.onSelectedThemeChanged(ApplicationTheme.Dark)
+    } else {
+      fatalError(`Unknown theme index ${index}`)
+    }
+  }
+
+  public render() {
+    const selectedIndex =
+      this.props.selectedTheme === ApplicationTheme.Dark ? 1 : 0
+
+    return (
+      <DialogContent>
+        <VerticalSegmentedControl
+          items={themes}
+          selectedIndex={selectedIndex}
+          onSelectionChanged={this.onSelectedThemeChanged}
+        />
+      </DialogContent>
+    )
+  }
+}
merged
  result 100644 95db24f350ede1c020f0629457aa6ff90b2b6d90 app/src/ui/preferences/preferences.tsx
  our    100644 e26aab501de9210761f4d41ed2f05f1f7c516da8 app/src/ui/preferences/preferences.tsx
@@ -21,6 +21,8 @@
 import { Shell, getAvailableShells } from '../../lib/shells'
 import { getAvailableEditors } from '../../lib/editors/lookup'
 import { disallowedCharacters } from './identifier-rules'
+import { Appearance } from './appearance'
+import { ApplicationTheme } from '../lib/application-theme'

 interface IPreferencesProps {
   readonly dispatcher: Dispatcher
@@ -33,6 +35,7 @@
   readonly confirmDiscardChanges: boolean
   readonly selectedExternalEditor?: ExternalEditor
   readonly selectedShell: Shell
+  readonly selectedTheme: ApplicationTheme
 }

 interface IPreferencesState {
@@ -134,6 +137,7 @@
         >
           <span>Accounts</span>
           <span>Git</span>
+          <span>Appearance</span>
           <span>Advanced</span>
         </TabBar>

@@ -203,6 +207,13 @@
           />
         )
       }
+      case PreferencesTab.Appearance:
+        return (
+          <Appearance
+            selectedTheme={this.props.selectedTheme}
+            onSelectedThemeChanged={this.onSelectedThemeChanged}
+          />
+        )
       case PreferencesTab.Advanced: {
         return (
           <Advanced
@@ -269,12 +280,17 @@
     this.setState({ selectedShell: shell })
   }

+  private onSelectedThemeChanged = (theme: ApplicationTheme) => {
+    this.props.dispatcher.setSelectedTheme(theme)
+  }
+
   private renderFooter() {
     const hasDisabledError = this.state.disallowedCharactersMessage != null

     const index = this.state.selectedIndex
     switch (index) {
       case PreferencesTab.Accounts:
+      case PreferencesTab.Appearance:
         return null
       case PreferencesTab.Advanced:
       case PreferencesTab.Git: {
merged
  result 100644 ffbdef89f9f0f16e966a7d27c2db06bd897c3db6 app/src/ui/publish-repository/publish.tsx
  our    100644 dbb16e8d0667b3c7f6a9514dda9d6ec8354fe75d app/src/ui/publish-repository/publish.tsx
@@ -13,7 +13,7 @@
 import { getDotComAPIEndpoint } from '../../lib/api'
 import { assertNever, fatalError } from '../../lib/fatal-error'
 import { CallToAction } from '../lib/call-to-action'
-import { getGitDescription } from '../../lib/git/description'
+import { getGitDescription } from '../../lib/git'

 enum PublishTab {
   DotCom = 0,
merged
  result 100644 036558085db62e6798f39f0d0f7fdd38b7fca5f1 app/src/ui/rename-branch/rename-branch-dialog.tsx
  our    100644 30deb34b0cdc3ac313cbdde5418abcc33bb4a22c app/src/ui/rename-branch/rename-branch-dialog.tsx
@@ -9,7 +9,10 @@
 import { Button } from '../lib/button'
 import { ButtonGroup } from '../lib/button-group'
 import { Dialog, DialogContent, DialogFooter } from '../dialog'
-import { renderBranchNameWarning } from '../lib/branch-name-warnings'
+import {
+  renderBranchNameWarning,
+  renderBranchHasRemoteWarning,
+} from '../lib/branch-name-warnings'

 interface IRenameBranchProps {
   readonly dispatcher: Dispatcher
@@ -54,6 +57,7 @@
             this.state.newName,
             sanitizedBranchName(this.state.newName)
           )}
+          {renderBranchHasRemoteWarning(this.props.branch)}
         </DialogContent>

         <DialogFooter>
merged
  result 100644 9e6e38681ef352ce76fa65fea817492a6aef088f app/src/ui/repositories-list/group-repositories.ts
  our    100644 18baeebd67753abfd4d4547921f30c8bef878511 app/src/ui/repositories-list/group-repositories.ts
@@ -1,22 +1,31 @@
-import { Repository } from '../../models/repository'
+import { Repository, ILocalRepositoryState } from '../../models/repository'
 import { CloningRepository } from '../../models/cloning-repository'
 import { getDotComAPIEndpoint } from '../../lib/api'
 import { caseInsensitiveCompare } from '../../lib/compare'
 import { IFilterListGroup, IFilterListItem } from '../lib/filter-list'
+import { IAheadBehind } from '../../models/branch'

 export type RepositoryGroupIdentifier = 'github' | 'enterprise' | 'other'

 export type Repositoryish = Repository | CloningRepository

 export interface IRepositoryListItem extends IFilterListItem {
-  readonly text: string
+  readonly text: ReadonlyArray<string>
   readonly id: string
   readonly repository: Repositoryish
   readonly needsDisambiguation: boolean
+  readonly aheadBehind: IAheadBehind | null
+  readonly changedFilesCount: number
+}
+
+const fallbackValue = {
+  changedFilesCount: 0,
+  aheadBehind: null,
 }

 export function groupRepositories(
-  repositories: ReadonlyArray<Repositoryish>
+  repositories: ReadonlyArray<Repositoryish>,
+  localRepositoryStateLookup: Map<number, ILocalRepositoryState>
 ): ReadonlyArray<IFilterListGroup<IRepositoryListItem>> {
   const grouped = new Map<RepositoryGroupIdentifier, Repositoryish[]>()
   for (const repository of repositories) {
@@ -59,11 +68,15 @@
     repositories.sort((x, y) => caseInsensitiveCompare(x.name, y.name))
     const items: ReadonlyArray<IRepositoryListItem> = repositories.map(r => {
       const nameCount = names.get(r.name) || 0
+      const { aheadBehind, changedFilesCount } =
+        localRepositoryStateLookup.get(r.id) || fallbackValue
       return {
-        text: r.name,
+        text: [r.name],
         id: r.id.toString(),
         repository: r,
         needsDisambiguation: nameCount > 1,
+        aheadBehind,
+        changedFilesCount,
       }
     })

merged
  result 100644 e4ca588b503842ff6df4517d209f5fc5537d4a11 app/src/ui/repositories-list/repositories-list.tsx
  our    100644 07ff55df057daaa50bdeec7aaaaafce35d03d1a2 app/src/ui/repositories-list/repositories-list.tsx
@@ -8,23 +8,25 @@
   RepositoryGroupIdentifier,
 } from './group-repositories'
 import { FilterList } from '../lib/filter-list'
+import { IMatches } from '../../lib/fuzzy-find'
 import { assertNever } from '../../lib/fatal-error'
-
-/**
- * TS can't parse generic specialization in JSX, so we have to alias it here
- * with the generic type. See https://github.com/Microsoft/TypeScript/issues/6395.
- */
-const RepositoryFilterList: new () => FilterList<
-  IRepositoryListItem
-> = FilterList as any
+import { ILocalRepositoryState } from '../../models/repository'
+import { enableRepoInfoIndicators } from '../../lib/feature-flag'
+import { Dispatcher } from '../../lib/dispatcher'

 interface IRepositoriesListProps {
   readonly selectedRepository: Repositoryish | null
   readonly repositories: ReadonlyArray<Repositoryish>

+  /** A cache of the latest repository state values, keyed by the repository id */
+  readonly localRepositoryStateLookup: Map<number, ILocalRepositoryState>
+
   /** Called when a repository has been selected. */
   readonly onSelectionChanged: (repository: Repositoryish) => void

+  /** Whether the user has enabled the setting to confirm removing a repository from the app */
+  readonly askForConfirmationOnRemoveRepository: boolean
+
   /** Called when the repository should be removed. */
   readonly onRemoveRepository: (repository: Repositoryish) => void

@@ -48,6 +50,8 @@

   /** The text entered by the user to filter their repository list */
   readonly filterText: string
+
+  readonly dispatcher: Dispatcher
 }

 const RowHeight = 29
@@ -57,16 +61,16 @@
   IRepositoriesListProps,
   {}
 > {
-  private renderItem = (
-    item: IRepositoryListItem,
-    matches: ReadonlyArray<number>
-  ) => {
+  private renderItem = (item: IRepositoryListItem, matches: IMatches) => {
     const repository = item.repository
     return (
       <RepositoryListItem
         key={repository.id}
         repository={repository}
         needsDisambiguation={item.needsDisambiguation}
+        askForConfirmationOnRemoveRepository={
+          this.props.askForConfirmationOnRemoveRepository
+        }
         onRemoveRepository={this.props.onRemoveRepository}
         onShowRepository={this.props.onShowRepository}
         onOpenInShell={this.props.onOpenInShell}
@@ -74,6 +78,8 @@
         externalEditorLabel={this.props.externalEditorLabel}
         shellLabel={this.props.shellLabel}
         matches={matches}
+        aheadBehind={item.aheadBehind}
+        changedFilesCount={item.changedFilesCount}
       />
     )
   }
@@ -101,6 +107,14 @@
   }

   private onItemClick = (item: IRepositoryListItem) => {
+    if (enableRepoInfoIndicators()) {
+      const hasIndicator =
+        item.changedFilesCount > 0 ||
+        (item.aheadBehind !== null
+          ? item.aheadBehind.ahead > 0 || item.aheadBehind.behind > 0
+          : false)
+      this.props.dispatcher.recordRepoClicked(hasIndicator)
+    }
     this.props.onSelectionChanged(item.repository)
   }

@@ -109,7 +123,10 @@
       return this.noRepositories()
     }

-    const groups = groupRepositories(this.props.repositories)
+    const groups = groupRepositories(
+      this.props.repositories,
+      this.props.localRepositoryStateLookup
+    )

     let selectedItem: IRepositoryListItem | null = null
     const selectedRepository = this.props.selectedRepository
@@ -129,7 +146,7 @@

     return (
       <div className="repository-list">
-        <RepositoryFilterList
+        <FilterList<IRepositoryListItem>
           rowHeight={RowHeight}
           selectedItem={selectedItem}
           filterText={this.props.filterText}
merged
  result 100644 6ca3c771c795eba242cc4b795e3a3b0bbb4c7488 app/src/ui/repositories-list/repository-list-item.tsx
  our    100644 8a3459beeeb3be1978c9c1f3a4aefe8f497007fb app/src/ui/repositories-list/repository-list-item.tsx
@@ -1,10 +1,12 @@
 import * as React from 'react'
 import { Repository } from '../../models/repository'
-import { Octicon, iconForRepository } from '../octicons'
+import { Octicon, iconForRepository, OcticonSymbol } from '../octicons'
 import { showContextualMenu } from '../main-process-proxy'
 import { Repositoryish } from './group-repositories'
 import { IMenuItem } from '../../lib/menu-item'
 import { HighlightText } from '../lib/highlight-text'
+import { IMatches } from '../../lib/fuzzy-find'
+import { IAheadBehind } from '../../models/branch'

 const defaultEditorLabel = __DARWIN__
   ? 'Open in External Editor'
@@ -13,6 +15,9 @@
 interface IRepositoryListItemProps {
   readonly repository: Repositoryish

+  /** Whether the user has enabled the setting to confirm removing a repository from the app */
+  readonly askForConfirmationOnRemoveRepository: boolean
+
   /** Called when the repository should be removed. */
   readonly onRemoveRepository: (repository: Repositoryish) => void

@@ -35,7 +40,13 @@
   readonly shellLabel: string

   /** The characters in the repository name to highlight */
-  readonly matches: ReadonlyArray<number>
+  readonly matches: IMatches
+
+  /** Number of commits this local repo branch is behind or ahead of its remote brance */
+  readonly aheadBehind: IAheadBehind | null
+
+  /** Number of uncommitted changes */
+  readonly changedFilesCount: number
 }

 /** A repository item. */
@@ -48,7 +59,37 @@
     const path = repository.path
     const gitHubRepo =
       repository instanceof Repository ? repository.gitHubRepository : null
-    const tooltip = gitHubRepo
+    const hasChanges = this.props.changedFilesCount > 0
+    const renderAheadBehindIndicator = () => {
+      if (
+        !(repository instanceof Repository) ||
+        this.props.aheadBehind === null
+      ) {
+        return null
+      }
+      const { ahead, behind } = this.props.aheadBehind
+      if (ahead === 0 && behind === 0) {
+        return null
+      }
+      const commitGrammar = (commitNum: number) =>
+        `${commitNum} commit${commitNum > 1 ? 's' : ''}` // english is hard
+      const aheadBehindTooltip =
+        'The currently checked out branch is' +
+        (behind ? ` ${commitGrammar(behind)} behind ` : '') +
+        (behind && ahead ? 'and' : '') +
+        (ahead ? ` ${commitGrammar(ahead)} ahead of ` : '') +
+        'its tracked branch.'
+
+      return (
+        <div className="ahead-behind" title={aheadBehindTooltip}>
+          {ahead > 0 ? <Octicon symbol={OcticonSymbol.arrowSmallUp} /> : null}
+          {behind > 0 ? (
+            <Octicon symbol={OcticonSymbol.arrowSmallDown} />
+          ) : null}
+        </div>
+      )
+    }
+    const repoTooltip = gitHubRepo
       ? gitHubRepo.fullName + '\n' + gitHubRepo.htmlURL + '\n' + path
       : path

@@ -58,20 +99,30 @@
     }

     return (
-      <div
-        onContextMenu={this.onContextMenu}
-        className="repository-list-item"
-        title={tooltip}
-      >
+      <div onContextMenu={this.onContextMenu} className="repository-list-item">
+        <div
+          className="change-indicator-wrapper"
+          title={
+            hasChanges ? 'There are uncommitted changes in this repository' : ''
+          }
+        >
+          {hasChanges ? (
+            <Octicon
+              className="change-indicator"
+              symbol={OcticonSymbol.primitiveDot}
+            />
+          ) : null}
+        </div>
         <Octicon symbol={iconForRepository(repository)} />
-
-        <div className="name">
+        <div className="name" title={repoTooltip}>
           {prefix ? <span className="prefix">{prefix}</span> : null}
           <HighlightText
             text={repository.name}
-            highlight={this.props.matches}
+            highlight={this.props.matches.title}
           />
         </div>
+
+        {renderAheadBehindIndicator()}
       </div>
     )
   }
@@ -101,7 +152,9 @@

     const showRepositoryLabel = __DARWIN__
       ? 'Show in Finder'
-      : __WIN32__ ? 'Show in Explorer' : 'Show in your File Manager'
+      : __WIN32__
+        ? 'Show in Explorer'
+        : 'Show in your File Manager'

     const items: ReadonlyArray<IMenuItem> = [
       {
@@ -121,7 +174,9 @@
       },
       { type: 'separator' },
       {
-        label: 'Remove',
+        label: this.props.askForConfirmationOnRemoveRepository
+          ? 'Remove‚Ä¶'
+          : 'Remove',
         action: this.removeRepository,
       },
     ]
merged
  result 100644 e58c21864cb0ef80f8d9edc3a5f278674a560cdd app/src/ui/repository.tsx
  our    100644 a96947579eba87694e2e84bfba57b1e4814b9ad6 app/src/ui/repository.tsx
@@ -5,26 +5,30 @@
 import { UiView } from './ui-view'
 import { Changes, ChangesSidebar } from './changes'
 import { NoChanges } from './changes/no-changes'
-import { History, HistorySidebar } from './history'
+import { MultipleSelection } from './changes/multiple-selection'
+import { FilesChangedBadge } from './changes/files-changed-badge'
+import { SelectedCommit, CompareSidebar } from './history'
 import { Resizable } from './resizable'
 import { TabBar } from './tab-bar'
 import {
-  IRepositoryState as IRepositoryModelState,
-  RepositorySection,
+  IRepositoryState,
+  RepositorySectionTab,
   ImageDiffType,
 } from '../lib/app-state'
 import { Dispatcher } from '../lib/dispatcher'
 import { IssuesStore, GitHubUserStore } from '../lib/stores'
 import { assertNever } from '../lib/fatal-error'
-import { Octicon, OcticonSymbol } from './octicons'
 import { Account } from '../models/account'
+import { enableNotificationOfBranchUpdates } from '../lib/feature-flag'
+import { FocusContainer } from './lib/focus-container'
+import { OcticonSymbol, Octicon } from './octicons'

 /** The widest the sidebar can be with the minimum window size. */
 const MaxSidebarWidth = 495

-interface IRepositoryProps {
+interface IRepositoryViewProps {
   readonly repository: Repo
-  readonly state: IRepositoryModelState
+  readonly state: IRepositoryState
   readonly dispatcher: Dispatcher
   readonly emoji: Map<string, string>
   readonly sidebarWidth: number
@@ -40,10 +44,21 @@
   readonly externalEditorLabel?: string

   /**
-   * Called to open a file using the user's configured applications
-   * @param path The path of the file relative to the root of the repository
+   * Callback to open a selected file using the configured external editor
+   *
+   * @param fullPath The full path to the file on disk
    */
-  readonly onOpenInExternalEditor: (path: string) => void
+  readonly onOpenInExternalEditor: (fullPath: string) => void
+
+  /**
+   * Determines if the notification banner and associated dot
+   * on this history tab will be rendered
+   */
+  readonly isDivergingBranchBannerVisible: boolean
+}
+
+interface IRepositoryViewState {
+  readonly sidebarHasFocusWithin: boolean
 }

 const enum Tab {
@@ -51,12 +66,32 @@
   History = 1,
 }

-export class RepositoryView extends React.Component<IRepositoryProps, {}> {
+export class RepositoryView extends React.Component<
+  IRepositoryViewProps,
+  IRepositoryViewState
+> {
+  public constructor(props: IRepositoryViewProps) {
+    super(props)
+
+    this.state = {
+      sidebarHasFocusWithin: false,
+    }
+  }
+
+  private renderChangesBadge(): JSX.Element | null {
+    const filesChangedCount = this.props.state.changesState.workingDirectory
+      .files.length
+
+    if (filesChangedCount <= 0) {
+      return null
+    }
+
+    return <FilesChangedBadge filesChangedCount={filesChangedCount} />
+  }
+
   private renderTabs(): JSX.Element {
-    const hasChanges =
-      this.props.state.changesState.workingDirectory.files.length > 0
     const selectedTab =
-      this.props.state.selectedSection === RepositorySection.Changes
+      this.props.state.selectedSection === RepositorySectionTab.Changes
         ? Tab.Changes
         : Tab.History

@@ -64,14 +99,19 @@
       <TabBar selectedIndex={selectedTab} onTabClicked={this.onTabClicked}>
         <span className="with-indicator">
           <span>Changes</span>
-          {hasChanges ? (
+          {this.renderChangesBadge()}
+        </span>
+
+        <div className="with-indicator">
+          <span>History</span>
+          {enableNotificationOfBranchUpdates() &&
+          this.props.isDivergingBranchBannerVisible ? (
             <Octicon
               className="indicator"
               symbol={OcticonSymbol.primitiveDot}
             />
           ) : null}
-        </span>
-        <span>History</span>
+        </div>
       </TabBar>
     )
   }
@@ -116,18 +156,25 @@
     )
   }

-  private renderHistorySidebar(): JSX.Element {
+  private renderCompareSidebar(): JSX.Element {
+    const tip = this.props.state.branchesState.tip
+    const currentBranch = tip.kind === TipState.Valid ? tip.branch : null
+
     return (
-      <HistorySidebar
+      <CompareSidebar
         repository={this.props.repository}
-        dispatcher={this.props.dispatcher}
-        history={this.props.state.historyState}
+        compareState={this.props.state.compareState}
+        currentBranch={currentBranch}
         gitHubUsers={this.props.state.gitHubUsers}
         emoji={this.props.emoji}
         commitLookup={this.props.state.commitLookup}
         localCommitSHAs={this.props.state.localCommitSHAs}
+        dispatcher={this.props.dispatcher}
         onRevertCommit={this.onRevertCommit}
         onViewCommitOnGitHub={this.props.onViewCommitOnGitHub}
+        isDivergingBranchBannerVisible={
+          this.props.isDivergingBranchBannerVisible
+        }
       />
     )
   }
@@ -135,10 +182,10 @@
   private renderSidebarContents(): JSX.Element {
     const selectedSection = this.props.state.selectedSection

-    if (selectedSection === RepositorySection.Changes) {
+    if (selectedSection === RepositorySectionTab.Changes) {
       return this.renderChangesSidebar()
-    } else if (selectedSection === RepositorySection.History) {
-      return this.renderHistorySidebar()
+    } else if (selectedSection === RepositorySectionTab.History) {
+      return this.renderCompareSidebar()
     } else {
       return assertNever(selectedSection, 'Unknown repository section')
     }
@@ -154,57 +201,92 @@

   private renderSidebar(): JSX.Element {
     return (
-      <Resizable
-        id="repository-sidebar"
-        width={this.props.sidebarWidth}
-        onReset={this.handleSidebarWidthReset}
-        onResize={this.handleSidebarResize}
-        maximumWidth={MaxSidebarWidth}
-      >
-        {this.renderTabs()}
-        {this.renderSidebarContents()}
-      </Resizable>
+      <FocusContainer onFocusWithinChanged={this.onSidebarFocusWithinChanged}>
+        <Resizable
+          id="repository-sidebar"
+          width={this.props.sidebarWidth}
+          onReset={this.handleSidebarWidthReset}
+          onResize={this.handleSidebarResize}
+          maximumWidth={MaxSidebarWidth}
+        >
+          {this.renderTabs()}
+          {this.renderSidebarContents()}
+        </Resizable>
+      </FocusContainer>
     )
   }

-  private renderContent(): JSX.Element {
+  private onSidebarFocusWithinChanged = (sidebarHasFocusWithin: boolean) => {
+    // this lets us know that focus is somewhere within the sidebar
+    this.setState({ sidebarHasFocusWithin })
+
+    if (
+      sidebarHasFocusWithin === false &&
+      this.props.state.selectedSection === RepositorySectionTab.History
+    ) {
+      this.props.dispatcher.updateCompareForm(this.props.repository, {
+        showBranchList: false,
+      })
+    }
+  }
+
+  private renderContent(): JSX.Element | null {
     const selectedSection = this.props.state.selectedSection

-    if (selectedSection === RepositorySection.Changes) {
+    if (selectedSection === RepositorySectionTab.Changes) {
       const changesState = this.props.state.changesState
-      const selectedFileID = changesState.selectedFileID
-      const selectedFile = selectedFileID
-        ? changesState.workingDirectory.findFileWithID(selectedFileID)
-        : null
-      const diff = changesState.diff
+      const selectedFileIDs = changesState.selectedFileIDs
+
+      if (selectedFileIDs.length > 1) {
+        return <MultipleSelection count={selectedFileIDs.length} />
+      }
+
       if (
-        !changesState.workingDirectory.files.length ||
-        !selectedFile ||
-        !diff
+        changesState.workingDirectory.files.length === 0 ||
+        selectedFileIDs.length === 0 ||
+        changesState.diff === null
       ) {
-        return <NoChanges onOpenRepository={this.openRepository} />
+        return <NoChanges repository={this.props.repository} />
       } else {
+        const workingDirectory = changesState.workingDirectory
+        const selectedFile = workingDirectory.findFileWithID(selectedFileIDs[0])
+
+        if (!selectedFile) {
+          return null
+        }
+
         return (
           <Changes
             repository={this.props.repository}
             dispatcher={this.props.dispatcher}
             file={selectedFile}
-            diff={diff}
+            diff={changesState.diff}
             imageDiffType={this.props.imageDiffType}
           />
         )
       }
-    } else if (selectedSection === RepositorySection.History) {
+    } else if (selectedSection === RepositorySectionTab.History) {
+      const { historyState } = this.props.state
+
+      const sha = historyState.selection.sha
+
+      const selectedCommit =
+        sha != null ? this.props.state.commitLookup.get(sha) || null : null
+
       return (
-        <History
+        <SelectedCommit
           repository={this.props.repository}
           dispatcher={this.props.dispatcher}
-          history={this.props.state.historyState}
+          selectedCommit={selectedCommit}
+          changedFiles={historyState.changedFiles}
+          selectedFile={historyState.selection.file}
+          currentDiff={historyState.diff}
           emoji={this.props.emoji}
-          commits={this.props.state.commitLookup}
           commitSummaryWidth={this.props.commitSummaryWidth}
           gitHubUsers={this.props.state.gitHubUsers}
-          imageDiffType={this.props.imageDiffType}
+          selectedDiffType={this.props.imageDiffType}
+          externalEditorLabel={this.props.externalEditorLabel}
+          onOpenInExternalEditor={this.props.onOpenInExternalEditor}
         />
       )
     } else {
@@ -221,10 +303,6 @@
     )
   }

-  private openRepository = () => {
-    this.props.dispatcher.revealInFileManager(this.props.repository, '')
-  }
-
   private onRevertCommit = (commit: Commit) => {
     this.props.dispatcher.revertCommit(this.props.repository, commit)
   }
@@ -235,9 +313,9 @@
     // as there's only two tabs.
     if (e.ctrlKey && e.key === 'Tab') {
       const section =
-        this.props.state.selectedSection === RepositorySection.History
-          ? RepositorySection.Changes
-          : RepositorySection.History
+        this.props.state.selectedSection === RepositorySectionTab.History
+          ? RepositorySectionTab.Changes
+          : RepositorySectionTab.History

       this.props.dispatcher.changeRepositorySection(
         this.props.repository,
@@ -250,8 +328,9 @@
   private onTabClicked = (tab: Tab) => {
     const section =
       tab === Tab.History
-        ? RepositorySection.History
-        : RepositorySection.Changes
+        ? RepositorySectionTab.History
+        : RepositorySectionTab.Changes
+
     this.props.dispatcher.changeRepositorySection(
       this.props.repository,
       section
merged
  result 100644 598a0cabc7864df6db50781101811dedf580a766 app/src/ui/resizable/resizable.tsx
  our    100644 e565705f992ba7d7bd86bdcb4a577dec86ca0714 app/src/ui/resizable/resizable.tsx
@@ -9,8 +9,8 @@
 export class Resizable extends React.Component<IResizableProps, {}> {
   public static defaultProps: IResizableProps = {
     width: 250,
-    minimumWidth: 150,
     maximumWidth: 350,
+    minimumWidth: 200,
   }

   private startWidth: number | null = null
@@ -96,8 +96,8 @@
   public render() {
     const style: React.CSSProperties = {
       width: this.getCurrentWidth(),
-      maximumWidth: this.props.maximumWidth,
-      minimumWidth: this.props.minimumWidth,
+      maxWidth: this.props.maximumWidth,
+      minWidth: this.props.minimumWidth,
     }

     return (
merged
  result 100644 ac499b9891bcd8714b42b66a5d2ff2a003a09a8f app/src/ui/toolbar/push-pull-button.tsx
  our    100644 b2e039b53887ee7cc2d3325232edcfb08a70ed7e app/src/ui/toolbar/push-pull-button.tsx
@@ -1,9 +1,10 @@
 import * as React from 'react'
 import { ToolbarButton, ToolbarButtonStyle } from './button'
-import { IAheadBehind, Progress } from '../../lib/app-state'
+import { Progress } from '../../lib/app-state'
 import { Dispatcher } from '../../lib/dispatcher'
 import { Octicon, OcticonSymbol } from '../octicons'
 import { Repository } from '../../models/repository'
+import { IAheadBehind } from '../../models/branch'
 import { TipState } from '../../models/tip'
 import { RelativeTime } from '../relative-time'
 import { FetchType } from '../../lib/stores/index'
merged
  result 100644 82f0e853181e3bf4cab092bd28785970c4c492d9 app/src/ui/updates/update-available.tsx
  our    100644 3054daf31cb24e5c2f9804c31515163e7bbaad76 app/src/ui/updates/update-available.tsx
@@ -25,7 +25,10 @@
           An updated version of GitHub Desktop is available and will be
           installed at the next launch. See{' '}
           <LinkButton uri={this.props.releaseNotesLink}>what's new</LinkButton>{' '}
-          or <LinkButton onClick={this.updateNow}>restart now</LinkButton>.
+          or{' '}
+          <LinkButton onClick={this.updateNow}>
+            restart GitHub Desktop
+          </LinkButton>.
         </span>

         <a className="close" onClick={this.dismiss}>
merged
  result 160000 d247be923e48ba4d02cf76dba79f0460d2f1a9a8 app/static/common/choosealicense.com
  our    160000 fe965f16f6f690d40a738e75a46fad3f41f5daa3 app/static/common/choosealicense.com
merged
  result 160000 18e28746b0862059dbee8694fd366a679cb812fb app/static/common/gitignore
  our    160000 690a433b668348c33087d34fafe2155ebe8bb4cf app/static/common/gitignore
added in remote
  their  100644 b78f57622a54a50d820cb145c0f9a61a66bb9a39 app/static/common/multiple-files-selected.svg
@@ -0,0 +1 @@
+<svg width="379" height="177" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M197.32 102.94c-4.942-3.055-6.222-9.461-6.222-9.461s-1.508 4.63-6.239 5.955l.82 2.576 5.972 1.53 5.67-.6z" fill="#F7F8F9"/><path d="M197.32 102.94c-4.942-3.055-6.222-9.461-6.222-9.461s-1.508 4.63-6.239 5.955l.82 2.576 5.972 1.53 5.67-.6z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M180.128 100.758s-2.555-2.233-1.364-7.111c0 0 7.512 10.492 18.556 9.294 0 0-6.758 3.825-17.192-2.183" fill="#F7F8F9"/><path d="M180.128 100.758s-2.555-2.233-1.364-7.111c0 0 7.512 10.492 18.556 9.294 0 0-6.758 3.825-17.192-2.183z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M151.694 125.297c4.3-.344 7.773 3.36 7.773 3.36s.84-4.515-2.6-5.733l-6.436-.798 1.263 3.17z" fill="#F7F8F9"/><path d="M151.694 125.297c4.3-.344 7.773 3.36 7.773 3.36s.84-4.515-2.6-5.733l-6.436-.798 1.263 3.17z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M140.158 124.575s5.554.012 9.503 3.883c0 0 2.866-6.41 7.206-5.534 0 0-13.92-6.12-16.709 1.65" fill="#F7F8F9"/><path d="M140.158 124.575s5.554.012 9.503 3.883c0 0 2.866-6.41 7.206-5.534 0 0-13.92-6.12-16.709 1.65z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M219.598 172.051c0 2.566-17.221 4.644-38.463 4.644-21.243 0-38.464-2.078-38.464-4.644 0-2.566 17.22-4.646 38.464-4.646 21.242 0 38.463 2.08 38.463 4.646" fill="#EBF1F9"/><path d="M206.767 165.495l-4.4 1.912" fill="#F7F8F9"/><path d="M206.767 165.495l-4.4 1.912M160.369 166.06l1.084.39s2.663-1.184 4.693-1.263" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M153.726 166.45s2.851 1.195 4.942 1.989" fill="#F7F8F9"/><path d="M153.726 166.45s2.851 1.195 4.942 1.989M178.012 167.444s3.319-.037 5.367.994c0 0 1.27-1.115 4.157-2.064" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M189.255 169.08s-2.344.943-3.359 1.974" fill="#F7F8F9"/><path d="M189.255 169.08s-2.344.943-3.359 1.974" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M170.982 169.08s1.41.006 3.048.593" fill="#F7F8F9"/><path d="M170.982 169.08s1.41.006 3.048.593" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M171.024 169.99c-3.018.657-9.34 3.284-9.34 3.284l-7.757-3.794c-.359-6.275-2.012-25.022-2.012-25.022s12.428 2.772 18.103.657c0 0 4.598 2.406 10.128 2.48 0 0-1.005 2.553-.933 3.502 0 0 2.155.655 3.232.655l-.719-7.804.72-.44-1.366-.363s5.316-1.751 8.333-4.889c0 0 8.692-.73 18.749-5.69 0 0-1.222 3.43-4.454 6.711l4.814 1.096-2.156 30.858-7.4 3.21s-5.314-2.335-9.913-3.21l-5.961 3.575s-3.951-1.969-12.068-3.502v-1.313z" fill="#F7F8F9"/><path d="M171.024 169.99c-3.018.657-9.34 3.284-9.34 3.284l-7.757-3.794c-.359-6.275-2.012-25.022-2.012-25.022s12.428 2.772 18.103.657c0 0 4.598 2.406 10.128 2.48 0 0-1.005 2.553-.933 3.502 0 0 2.155.655 3.232.655l-.719-7.804.72-.44-1.366-.363s5.316-1.751 8.333-4.889c0 0 8.692-.73 18.749-5.69 0 0-1.222 3.43-4.454 6.711l4.814 1.096-2.156 30.858-7.4 3.21s-5.314-2.335-9.913-3.21l-5.961 3.575s-3.951-1.969-12.068-3.502v-1.313z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M151.916 144.457s4.885 5.472 9.41 6.93c0 0 10.846.804 18.82-3.792" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M161.685 173.274l-.359-10.58-1.077.732s-2.946-1.606-4.598-5.618c0 0 2.946 2.116 5.315 2.188l.36-8.608" fill="#F7F8F9"/><path d="M161.685 173.274l-.359-10.58-1.077.732s-2.946-1.606-4.598-5.618c0 0 2.946 2.116 5.315 2.188l.36-8.608" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path fill="#F7F8F9" d="M208.521 140.373l-8.573 4.757-9.99-1.398"/><path stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round" d="M208.521 140.373l-8.573 4.757-9.99-1.398"/><path d="M198.967 174.44s.825-18.21.981-29.31" fill="#F7F8F9"/><path d="M198.967 174.44s.825-18.21.981-29.31M192.298 147.587c3.826-.158 7.579 1.348 7.579 1.348s3.35-3.012 5.536-3.012" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M207.685 152.344l-3.13 1.342" fill="#F7F8F9"/><path d="M207.685 152.344l-3.13 1.342M192.298 162.33s5.03 1.43 7.16 2.382l1.115-.476M189.054 171.231l1.604-17.143-6.79 3.568-.777 17.15" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M174.445 153.686l-4.864 3.335s4.996-.395 14.286.635" fill="#F7F8F9"/><path d="M174.445 153.686l-4.864 3.335s4.996-.395 14.286.635" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M190.658 154.088l-1.332-.402" fill="#F7F8F9"/><path d="M190.658 154.088l-1.332-.402" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M171.024 169.99s-.351-9.084-1.443-12.969" fill="#F7F8F9"/><path d="M171.024 169.99s-.351-9.084-1.443-12.969" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M161.326 162.695s4.718-2.922 8.711-3.545c0 0-5.27-.46-9.07.847" fill="#F7F8F9"/><path d="M161.326 162.695s4.718-2.922 8.711-3.545c0 0-5.27-.46-9.07.847M154.748 152.344s5.07 1.897 6.399 3.327c0 0 4.062-1.503 6.716-1.583" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><g><path d="M152.875 154.441s1.873.4 3.512 1.35" fill="#F7F8F9"/><path d="M152.875 154.441s1.873.4 3.512 1.35" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/></g><g><path d="M170.302 160.955s3.338-.049 5.915.427" fill="#F7F8F9"/><path d="M170.302 160.955s3.338-.049 5.915.427" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/></g><g><path d="M190.066 160.418s-1.203.726-2.374 1.438" fill="#F7F8F9"/><path d="M190.066 160.418s-1.203.726-2.374 1.438" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/></g><path d="M192.298 155.671s5.778.4 8.275 3.016c0 0 1.508-2.141 2.745-3.57l-3.65 1.23s-3.78-1.076-7.37-.676" fill="#F7F8F9"/><path d="M192.298 155.671s5.778.4 8.275 3.016c0 0 1.508-2.141 2.745-3.57l-3.65 1.23s-3.78-1.076-7.37-.676zM179.213 151.097s-4.09.236-7.603.345c0 0 3.525 3.993 11.481 5.58 0 0 3.664-2.067 7.567-4.006 0 0-3.857-.268-8.213-1.264" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><g><path d="M203.708 139.278s-1.34 1.65-1.652 1.889c0 0-9.01 3.734-19.611 2.342" fill="#F7F8F9"/><path d="M203.708 139.278s-1.34 1.65-1.652 1.889c0 0-9.01 3.734-19.611 2.342" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/></g><g stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"><path d="M136.408 165.104v-96.18" stroke-dasharray="2.519,3.358"/><path d="M136.408 65.77v-2.365M158.914 54.606l1.616 1.715"/><path d="M164.822 60.874l103.005 109.28" stroke-dasharray="2.505,3.34"/><path d="M136.408 173.775v-2.364M269.974 172.431l1.618 1.717"/></g><g stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"><path d="M154.625 26.459l-33.393 12.697-5.629-14.138c-3.588-9.011.978-19.16 10.2-22.666 9.22-3.508 19.603.957 23.193 9.968l5.629 14.139zM121.488 25.577c-4-8.257-.22-16.892 8.623-19.166M162 32.48l-42.04 15.987-3.052-7.665 42.04-15.986zM156.973 29.979l-18.86 7.17M154.706 40.656l-23.716 9.02-3.085-4.23 26.15-9.943zM139.27 54.494c.284 1.396-.642 2.75-2.069 3.028-1.427.277-2.813-.626-3.099-2.022-.283-1.395.643-2.75 2.07-3.029 1.427-.277 2.815.629 3.099 2.023zM136.172 52.472l-.902-4.425M156.44 47.007c.756 1.214.36 2.798-.884 3.536s-2.865.351-3.62-.865c-.755-1.216-.358-2.798.886-3.538 1.242-.736 2.865-.349 3.618.867zM152.822 46.14l-2.395-3.855"/></g><path d="M74.118 40.066l-.847-2.758a.686.686 0 0 1 0-.406l.847-2.76a.692.692 0 0 0-.863-.865l-2.751.85a.68.68 0 0 1-.406 0l-2.749-.85a.692.692 0 0 0-.864.866l.846 2.759a.686.686 0 0 1 0 .406l-.846 2.758a.693.693 0 0 0 .864.867l2.75-.85a.68.68 0 0 1 .405 0l2.75.85a.692.692 0 0 0 .864-.867z" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><g stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"><path d="M196.115 16.524l6.092 6.11M196.115 22.634l6.092-6.11"/></g><path d="M336.838.97c.887 0 1.604.72 1.604 1.61 0 .887-.717 1.608-1.604 1.608a1.606 1.606 0 0 1-1.604-1.608c0-.89.718-1.61 1.604-1.61zM276.908 103.22l-1.347-2.55a.687.687 0 0 0-.287-.289l-2.543-1.349a.693.693 0 0 1 0-1.224l2.543-1.35a.684.684 0 0 0 .287-.288l1.347-2.55a.69.69 0 0 1 1.221 0l1.346 2.55a.692.692 0 0 0 .286.288l2.544 1.35c.49.26.49.963 0 1.224l-2.544 1.35a.695.695 0 0 0-.286.288l-1.346 2.55a.69.69 0 0 1-1.221 0zM318.571 154.413v8.64M322.88 158.733h-8.617" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><g stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"><path d="M87.815 67.417l-2.337 2.344M94.316 60.897L91.98 63.24M87.815 67.417a2.94 2.94 0 0 0 4.164 0 2.959 2.959 0 0 0 0-4.176 2.938 2.938 0 0 0-4.164 0 2.959 2.959 0 0 0 0 4.176z"/></g><path d="M35.913 19.09c0 1.031-.833 1.869-1.864 1.869a1.866 1.866 0 0 1-1.863-1.87c0-1.03.834-1.868 1.863-1.868 1.03 0 1.864.838 1.864 1.868zM264.036 2.58c0 1.03-.833 1.868-1.864 1.868a1.867 1.867 0 0 1-1.862-1.868c0-1.033.835-1.87 1.862-1.87 1.03 0 1.864.837 1.864 1.87zM346.306 107.981l-.995-1.887-1.882-.998 1.882-.998.995-1.888.996 1.888 1.881.998-1.881.998zM242.525 60.162c-.887 0-1.604.72-1.604 1.609 0 .888.718 1.609 1.604 1.609.886 0 1.604-.721 1.604-1.609 0-.89-.718-1.609-1.604-1.609zM83.826 96.327v4.186M85.912 98.42H81.74M5.168 120.64a2.22 2.22 0 0 1-2.217 2.224 2.22 2.22 0 0 1-2.217-2.223c0-1.227.994-2.224 2.217-2.224a2.22 2.22 0 0 1 2.217 2.224zM36.927 154.445l-.996-1.887-1.881-.998 1.881-1 .996-1.886.995 1.886 1.882 1-1.882.998zM45.862 84.256l1.355-.419 1.357.42-.418-1.362.418-1.36-1.357.418-1.355-.417.417 1.36zM10.5 61.149l3.604 1.977-3.604 1.977-1.972 3.615-1.971-3.615-3.605-1.977 3.605-1.977 1.971-3.616zM377.062 61.77l1.154 3.955-3.942-1.159-3.944 1.16 1.156-3.955-1.156-3.956 3.944 1.16 3.942-1.16zM303.997 23.625c10.875 0 19.693 8.842 19.693 19.752 0 10.906-8.818 19.749-19.693 19.749-10.876 0-19.692-8.843-19.692-19.75 0-10.909 8.816-19.751 19.692-19.751zM315.852 34.503a32.8 32.8 0 0 0 1.44-5.697" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/><path d="M303.523 50.936c3.38-2.371 6.283-5.409 8.563-8.853a34.853 34.853 0 0 0 1.801-3.05M296.332 54.827c.76-.29 1.508-.613 2.243-.962M289.47 56.71a33.651 33.651 0 0 0 3.078-.65M291.072 52.983c7.25-2.203 13.647-7.11 18.055-13.364M285.813 36.545a33.538 33.538 0 0 0 5.268-3.959M292.922 36.295a33.407 33.407 0 0 0 8.112-10.005M307.19 62.737c4.283-1.988 8.072-4.98 11.14-8.567M319.426 41.837c.122-.273.243-.544.358-.818M301.33 59.432c5.65-2.29 10.552-6.276 14.222-11.133a36.555 36.555 0 0 0 2.816-4.33M295.37 61.134a28.366 28.366 0 0 0 3.61-.862M318.523 49.072c2.11-3.096 3.659-6.521 4.666-10.13M299.576 62.623a33.442 33.442 0 0 0 9.83-4.497M305.86 35.41a33.723 33.723 0 0 0 4.573-10.704M300.735 41.56a32.647 32.647 0 0 0 1.948-2.014M285.382 49.831a33.477 33.477 0 0 0 4.05-1.231M305.96 26.367c.328-.832.624-1.678.887-2.535M298.23 38.03c2.394-2.26 4.543-4.841 5.941-7.846M294.652 41.102a68.23 68.23 0 0 0 1.6-1.313M284.512 46.233a33.515 33.515 0 0 0 7.747-3.508M288.219 39.775a30.348 30.348 0 0 1-3.843 1.936" stroke="#C9DEF2" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
\ No newline at end of file
merged
  result 100644 b1af174b6d02934b6e9b5f29051ccc89c28454ad app/styles/_globals.scss
  our    100644 bd56fae88ff49ce2925253e0e5444f48d93a6c5b app/styles/_globals.scss
@@ -115,6 +115,7 @@
   align-items: center;
   justify-content: center;
   text-align: center;
+  padding: var(--spacing);
 }

 // Stretches an element to fill the entire window (such as an overlay)
merged
  result 100644 2547663981e9047637d8e4edf9b40db74c9d5c51 app/styles/_mixins.scss
  our    100644 2c54d4b7728a6487ddd3f6fd4ac7d7c641b10459 app/styles/_mixins.scss
@@ -3,3 +3,4 @@
 @import 'mixins/octicon-status';
 @import 'mixins/textboxish';
 @import 'mixins/checkboard-background';
+@import 'mixins/close-button';
merged
  result 100644 fe75df3631a5a6b0a4f5c1fc08ec016a19917524 app/styles/_ui.scss
  our    100644 bc30cbb3646a0a92d2c552e53b0bca7865ccd9f7 app/styles/_ui.scss
@@ -64,3 +64,5 @@
 @import 'ui/author-input';
 @import 'ui/avatar-stack';
 @import 'ui/commit-attribution';
+@import 'ui/fancy-text-box';
+@import 'ui/notification-banner';
merged
  result 100644 e9cb993ff22775125bb8a2e21a27d8b596619870 app/styles/_variables.scss
  our    100644 120c6de98e0e7f66eb9d0d0fced3c8fcfbb627ea app/styles/_variables.scss
@@ -5,6 +5,12 @@
 // Primer colors, see https://github.com/primer/primer-css/blob/master/modules/primer-support/lib/variables/color-system.scss
 @import '~primer-support/lib/variables/color-system.scss';

+// Extracted as a SCSS variable so that we can define the --overlay-background-color
+// on both the :root and the ::backdrop scope. The ::backdrop pseudo-element
+// doesn't inherit :root, see
+// https://bugs.chromium.org/p/chromium/issues/detail?id=594096
+$overlay-background-color: rgba(0, 0, 0, 0.4);
+
 :root {
   --color-new: $green;
   --color-deleted: $red;
@@ -14,7 +20,6 @@

   --text-color: $gray-900;
   --text-secondary-color: $gray-500;
-  --text-tertiary-color: $gray-400;
   --background-color: $white;

   --button-height: 25px;
@@ -26,6 +31,7 @@
   --button-focus-border-color: $blue-600;

   --link-button-color: $blue;
+  --link-button-hover-color: $blue-600;

   --secondary-button-background: $gray-000;
   --secondary-button-hover-background: $white;
@@ -36,11 +42,8 @@
   // Typography
   //
   // Font, line-height, and color for body text, headings, and more.
-  --font-family-sans-serif: -apple-system, BlinkMacSystemFont, 'Segoe UI',
-    'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans',
-    'Helvetica Neue', Arial, sans-serif;
-  --font-family-monospace: Menlo, Monaco, Consolas, 'Liberation Mono',
-    'Courier New', monospace;
+  --font-family-sans-serif: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, sans-serif;
+  --font-family-monospace: Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;

   /**
    * Font weight to use for semibold text
@@ -86,12 +89,14 @@
   // or an item in a tab control header. It's up to each implementation
   // to decide what states to support (active selection, selection, etc).

+  --box-background-color: var(--background-color);
   --box-alt-background-color: $gray-100;

   /**
    * Background color for skeleton or "loading" boxes
    */
   --box-skeleton-background-color: $gray-200;
+  --skeleton-background-gradient: -webkit-linear-gradient(left, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.5) 50%, rgba(255, 255, 255, 0) 100%);

   /**
    * Border color for boxes.
@@ -145,6 +150,19 @@
   --box-selected-active-border-color: $gray-400;

   /**
+   * Gradient used to indicate that content is overflowing, intended
+   * for use when content can be expanded through other means than
+   * scrolling.
+   */
+  --box-overflow-shadow-background: linear-gradient(180deg, rgba($white, 0) 0%, rgba($white, 1) 90%, rgba($white, 1) 100%);
+
+  /**
+   * Author input (co-authors)
+   */
+  --co-author-tag-background-color: $blue-000;
+  --co-author-tag-border-color: $blue-200;
+
+  /**
    * The height of the title bar area on Win32 platforms
    * If changed, update titleBarHeight in 'app/src/ui/dialog/dialog.tsx'
   */
@@ -173,6 +191,7 @@
   --toolbar-height: 50px;

   --toolbar-background-color: $gray-900;
+  --toolbar-border-color: $gray-900;
   --toolbar-text-color: $white;
   --toolbar-text-secondary-color: $gray-300;

@@ -196,10 +215,48 @@
   --toolbar-button-hover-progress-color: $gray-700;
   --toolbar-dropdown-open-progress-color: $gray-200;

+  /**
+   * App menu bar colors (Windows/Linux only)
+   */
+  --app-menu-button-color: var(--toolbar-text-color);
+  --app-menu-button-hover-color: var(--toolbar-button-hover-color);
+  --app-menu-button-hover-background-color: var(--toolbar-button-hover-background-color);
+  --app-menu-button-active-color: var(--toolbar-button-active-color);
+  --app-menu-button-active-background-color: var(--toolbar-button-active-background-color);
+  --app-menu-pane-color: var(--text-color);
+  --app-menu-pane-secondary-color: var(--text-secondary-color);
+  --app-menu-pane-background-color: var(--toolbar-button-active-background-color);
+  --app-menu-divider-color: var(--box-border-color);
+
+  /**
+    * Background color for badges inside of toolbar buttons.
+    * Examples of badges are the ahead/behind bubble in the
+    * push/pull button and the PR badge in the branch drop
+    * down button.
+    */
+  --toolbar-badge-background-color: $gray-600;
+  --toolbar-badge-active-background-color: $gray-200;
+
   --tab-bar-height: 29px;
   --tab-bar-active-color: $blue;
   --tab-bar-background-color: $white;

+  /** Count bubble colors when used inside of a tab bar item */
+  --tab-bar-count-color: var(--text-color);
+  --tab-bar-count-background-color: $gray-200;
+
+  /**
+    * Badge colors when used inside of list items.
+    * Example of this is the change indicators inside
+    * of the repository list.
+    */
+  --list-item-badge-color: $gray-800;
+  --list-item-badge-background-color: $gray-200;
+  --list-item-selected-badge-color: $gray-900;
+  --list-item-selected-badge-background-color: $gray-300;
+  --list-item-selected-active-badge-color: $gray-900;
+  --list-item-selected-active-badge-background-color: $white;
+
   /** Win32 has custom scrol bars, see _scroll.scss */
   --win32-scroll-bar-size: 10px;

@@ -215,6 +272,14 @@
   --popup-overlay-z-index: calc(var(--popup-z-index) - 1);
   --foldout-z-index: calc(var(--popup-z-index) - 2);

+  /**
+   * Toast notifications are shown temporarily for things like the zoom
+   * percentage changing or the app toggling between full screen and normal
+   * window mode.
+   */
+  --toast-notification-color: $gray-000;
+  --toast-notification-background-color: rgba($gray-900, 0.6);
+
   /** The highlight color used for focus rings and focus box shadows */
   --focus-color: $blue;

@@ -233,6 +298,7 @@
   --diff-text-color: $gray-900;
   --diff-border-color: $gray-200;
   --diff-gutter-color: $gray-200;
+  --diff-gutter-background-color: var(--background-color);

   --diff-line-number-color: $gray-700;
   --diff-line-number-column-width: 50px;
@@ -277,30 +343,45 @@
   --diff-delete-hover-gutter-color: $red-300;
   --diff-delete-hover-text-color: var(--text-color);

+  // Syntax highlighting text colors
+  --syntax-variable-color: #6f42c1;
+  --syntax-alt-variable-color: #24292e;
+  --syntax-keyword-color: #d73a49;
+  --syntax-atom-color: #005cc5;
+  --syntax-string-color: #032f62;
+  --syntax-qualifier-color: #6f42c1;
+  --syntax-type-color: #d73a49;
+  --syntax-comment-color: $gray-500;
+  --syntax-tag-color: #22863a;
+  --syntax-attribute-color: #6f42c1;
+  --syntax-link-color: #032f62;
+
   // Note that this duration *must* match the `UndoCommitAnimationTimeout`
   // specified in `changes/index.tsx`.
   --undo-animation-duration: 500ms;

-  /**
-   * Ahead/behind view
-   */
-  --ahead-behind-background-color: $gray-500;
-
   // Colors for form errors
   --error-color: $red;
   --form-error-background: $red-100;
   --form-error-border-color: $red-200;
   --form-error-text-color: $red-800;

+  /** Overlay is used as a background for both modals and foldouts */
+  --overlay-background-color: $overlay-background-color;
+
   /** Dialog */
   --dialog-warning-color: $yellow-600;
-  --dialog-warning-text-color: $yellow-800;
   --dialog-error-color: $red;

   /** Inline paths and code */
   --path-segment-background: $blue-000;
   --path-segment-padding: var(--spacing-third);

+  /** Diverging notification banner colors */
+  --notification-banner-background: $blue-000;
+  --notification-banner-border-color: $blue-200;
+  --notification-ref-background: rgba(255, 255, 255, 0.75);
+
   // http://easings.net/#easeOutBack
   --easing-ease-out-back: cubic-bezier(0.175, 0.885, 0.32, 1.275);

@@ -310,3 +391,7 @@
   // http://easings.net/#easeOutQuint
   --easing-ease-out-quint: cubic-bezier(0.23, 1, 0.32, 1);
 }
+
+::backdrop {
+  --overlay-background-color: $overlay-background-color;
+}
merged
  result 100644 3a8c3b0ce9abb4b883fdc4f28ada9ac3a70b2f2e app/styles/desktop.scss
  our    100644 4a9623e6216173633dc9aa838abbce73b361f6bb app/styles/desktop.scss
@@ -1,6 +1,8 @@
 @import 'vendor';

 @import 'variables';
+@import 'themes/dark';
+
 @import 'mixins';

 @import 'globals';
added in remote
  their  100644 e0bf14cbb8dd2a3366da0ad586f3b2bbb7cb1165 app/styles/mixins/_close-button.scss
@@ -0,0 +1,35 @@
+@mixin close-button {
+  .close {
+    flex-shrink: 0;
+
+    border: 0;
+    height: 16px;
+    width: 16px;
+
+    // Set the left margin to auto so that flexbox positions the button
+    // on the right hand side of the dialog and add a -10px right hand
+    // side margin to put the button where it should be (we use a double
+    // margin for the header itself).
+    margin: 0 calc(var(--spacing) * -1) 0 auto;
+    padding: 0;
+    background: transparent;
+
+    color: var(--text-secondary-color);
+    cursor: pointer;
+
+    // Let the button deal with all mouse events.
+    // Without this the octicon resets the cursor when
+    // hovering over the <path>.
+    .octicon {
+      pointer-events: none;
+    }
+
+    &:hover {
+      color: var(--text-color);
+    }
+
+    &:focus {
+      outline: 0;
+    }
+  }
+}
merged
  result 100644 f470c0de0fc68ce5dbe838698274008bdd827ff1 app/styles/mixins/_textboxish.scss
  our    100644 37764480c283ce673dca3c64fa4e317a88804cfc app/styles/mixins/_textboxish.scss
@@ -7,6 +7,7 @@
 @mixin textboxish {
   border: 1px solid var(--box-border-color);
   border-radius: var(--border-radius);
+  background: var(--box-background-color);
   color: currentColor;
   font-size: var(--font-size);
   font-family: var(--font-family-sans-serif);
added in remote
  their  100644 e26d91d058178a03378c4c4761703355f1aaff81 app/styles/themes/_dark.scss
@@ -0,0 +1,305 @@
+// Variables
+//
+// This files contains CSS variables accessible to all selectors
+
+// Primer colors, see https://github.com/primer/primer-css/blob/master/modules/primer-support/lib/variables/color-system.scss
+@import '~primer-support/lib/variables/color-system.scss';
+
+body.theme-dark {
+  --color-new: $green;
+  --color-deleted: $red;
+  --color-modified: $yellow-700;
+  --color-renamed: $blue;
+  --color-conflicted: $orange;
+
+  --text-color: $gray-300;
+  --text-secondary-color: $gray-400;
+  --background-color: $gray-900;
+
+  --button-background: $blue;
+  --button-hover-background: lighten($blue, 5%);
+  --button-text-color: $white;
+  --button-focus-border-color: $blue-600;
+
+  --link-button-color: lighten($blue-400, 3%);
+  --link-button-hover-color: $blue-400;
+
+  --secondary-button-background: $gray-800;
+  --secondary-button-hover-background: var(--secondary-button-background);
+  --secondary-button-text-color: var(--text-color);
+  --secondary-button-focus-shadow-color: rgba($gray-200, 0.75);
+  --secondary-button-focus-border-color: $gray-300;
+
+  /**
+   * Background color for custom scroll bars.
+   * The color is applied to the thumb part of the scrollbar.
+   *
+   * Note: Only applies to win32 platforms
+   */
+  --scroll-bar-thumb-background-color: rgba(0, 0, 0, 0.7);
+
+  /**
+   * Background color for custom scroll bars in their active state.
+   * The color is applied to the thumb part of the scrollbar.
+   *
+   * Note: Only applies to win32 platforms
+   */
+  --scroll-bar-thumb-background-color-active: rgba(0, 0, 0, 0.8);
+
+  // Box
+  //
+  // We use the term 'box' here to refer to a very high-level generic
+  // component that fits many use cases. A 'box' might be a list item
+  // or an item in a tab control header. It's up to each implementation
+  // to decide what states to support (active selection, selection, etc).
+
+  --box-background-color: darken($gray-900, 3%);
+  --box-alt-background-color: $gray-800;
+
+  /**
+   * Background color for skeleton or "loading" boxes
+   */
+  --box-skeleton-background-color: $gray-700;
+  --skeleton-background-gradient: -webkit-linear-gradient(left, rgba(36, 41, 46, 0) 0%, rgba(36, 41, 46, 0.5) 50%, rgba(36, 41, 46, 0) 100%);
+
+  /**
+   * Border color for boxes.
+   */
+  --box-border-color: #141414;
+  --box-border-accent-color: $blue;
+
+  /**
+   * Background color for selected boxes without keyboard focus
+   */
+  --box-selected-background-color: $gray-700;
+
+  /**
+   * Text color for when a user hovers over a boxe with a
+   * pointing device. Should not be used by boxes that doesn't
+   * implement a hover state since this will conflict with
+   * selection and active selection
+   */
+  --box-hover-text-color: var(--text-color);
+
+  /**
+   * Background color for when a user hovers over a boxe with a
+   * pointing device. Should not be used by boxes that doesn't
+   * implement a hover state since this will conflict with
+   * selection and active selection
+   */
+
+  /**
+   * Text color for selected boxes without keyboard focus
+   */
+  --box-selected-text-color: var(--text-color);
+
+  /**
+   * Border color for selected boxes without keyboard focus
+   */
+  --box-selected-border-color: $gray-400;
+
+  /**
+   * Background color for selected boxes with active keyboard focus
+   */
+  --box-selected-active-background-color: $blue;
+
+  /**
+   * Text color for selected boxes with active keyboard focus
+   */
+  --box-selected-active-text-color: $white;
+
+  /**
+   * Border color for selected boxes with active keyboard focus
+   */
+  --box-selected-active-border-color: $gray-400;
+
+  /**
+   * Gradient used to indicate that content is overflowing, intended
+   * for use when content can be expanded through other means than
+   * scrolling.
+   */
+  --box-overflow-shadow-background: linear-gradient(180deg, rgba($gray-900, 0) 0%, rgba($gray-900, 1) 90%, rgba($gray-900, 1) 100%);
+
+  /**
+   * Author input (co-authors)
+   */
+  --co-author-tag-background-color: $blue-800;
+  --co-author-tag-border-color: $blue-700;
+
+  --base-border: 1px solid var(--box-border-color);
+
+  --shadow-color: rgba(black, 0.5);
+  --base-box-shadow: 0 2px 7px var(--shadow-color);
+
+  --toolbar-background-color: darken($gray-900, 3%);
+  --toolbar-border-color: var(--box-border-color);
+  --toolbar-text-color: var(--text-color);
+  --toolbar-text-secondary-color: var(--text-secondary-color);
+
+  --toolbar-button-color: var(--toolbar-text-color);
+  --toolbar-button-background-color: transparent;
+  --toolbar-button-border-color: var(--box-border-color);
+  --toolbar-button-secondary-color: var(--toolbar-text-secondary-color);
+
+  --toolbar-button-hover-color: $white;
+  --toolbar-button-hover-background-color: $gray-800;
+  --toolbar-button-hover-border-color: var(--toolbar-button-border-color);
+
+  --toolbar-button-focus-background-color: $gray-800;
+
+  --toolbar-button-active-color: var(--text-color);
+  --toolbar-button-active-background-color: var(--background-color);
+  --toolbar-button-active-border-color: var(--box-border-color);
+
+  --toolbar-button-progress-color: $gray-800;
+  --toolbar-button-focus-progress-color: $gray-700;
+  --toolbar-button-hover-progress-color: $gray-700;
+  --toolbar-dropdown-open-progress-color: $gray-200;
+
+  /**
+    * App menu bar colors (Windows/Linux only)
+    */
+  --app-menu-button-color: var(--toolbar-text-color);
+  --app-menu-button-hover-color: var(--toolbar-button-hover-color);
+  --app-menu-button-hover-background-color: var(--toolbar-button-hover-background-color);
+  --app-menu-button-active-color: var(--text-color);
+  --app-menu-button-active-background-color: $gray-800;
+  --app-menu-pane-color: var(--text-color);
+  --app-menu-pane-secondary-color: var(--text-secondary-color);
+  --app-menu-pane-background-color: $gray-800;
+  --app-menu-divider-color: $gray-600;
+
+  /**
+   * Background color for badges inside of toolbar buttons.
+   * Examples of badges are the ahead/behind bubble in the
+   * push/pull button and the PR badge in the branch drop
+   * down button.
+   */
+  --toolbar-badge-background-color: $gray-700;
+  --toolbar-badge-active-background-color: $gray-700;
+
+  --tab-bar-active-color: $blue;
+  --tab-bar-background-color: var(--box-background-color);
+
+  /** Count bubble colors when used inside of a tab bar item */
+  --tab-bar-count-color: var(--text-color);
+  --tab-bar-count-background-color: $gray-700;
+
+  /**
+    * Badge colors when used inside of list items.
+    * Example of this is the ahead/behind indicators inside
+    * of the repository list.
+    */
+  --list-item-badge-color: var(--text-color);
+  --list-item-badge-background-color: $gray-600;
+  --list-item-selected-badge-color: $white;
+  --list-item-selected-badge-background-color: $gray-500;
+  --list-item-selected-active-badge-color: $gray-900;
+  --list-item-selected-active-badge-background-color: $white;
+
+  /**
+   * Toast notifications are shown temporarily for things like the zoom
+   * percentage changing or the app toggling between full screen and normal
+   * window mode.
+   */
+  --toast-notification-color: var(--text-color);
+  --toast-notification-background-color: rgba(black, 0.8);
+
+  /** The highlight color used for focus rings and focus box shadows */
+  --focus-color: $blue;
+
+  /**
+   * Variables for form elements
+   */
+  --text-field-focus-shadow-color: rgba($blue, 0.25);
+
+  /**
+   * Diff view
+   */
+
+  --diff-text-color: var(--text-color);
+  --diff-border-color: $gray-800;
+  --diff-gutter-color: $gray-800;
+  --diff-gutter-background-color: darken($gray-900, 3%);
+
+  --diff-line-number-color: var(--text-secondary-color);
+  --diff-line-number-column-width: 50px;
+
+  --diff-selected-background-color: $blue-700;
+  --diff-selected-border-color: $blue-600;
+  --diff-selected-gutter-color: $blue-600;
+  --diff-selected-text-color: var(--text-color);
+
+  --diff-add-background-color: darken($green-900, 10%);
+  --diff-add-border-color: darken($green-900, 10%);
+  --diff-add-gutter-color: darken($green-900, 10%);
+  --diff-add-gutter-background-color: darken($green-900, 13%);
+  --diff-add-inner-background-color: $green-900;
+  --diff-add-text-color: var(--diff-text-color);
+
+  --diff-delete-background-color: darken($red-900, 15%);
+  --diff-delete-border-color: darken($red-900, 10%);
+  --diff-delete-gutter-color: darken($red-900, 10%);
+  --diff-delete-gutter-background-color: darken($red-900, 20%);
+  --diff-delete-inner-background-color: $red-700;
+  --diff-delete-text-color: $red-100;
+
+  --diff-hunk-background-color: darken($gray-900, 3%);
+  --diff-hunk-border-color: lighten($gray-900, 3%);
+  --diff-hunk-gutter-color: lighten($gray-900, 3%);
+  --diff-hunk-gutter-background-color: darken($gray-900, 6%);
+  --diff-hunk-text-color: var(--text-secondary-color);
+
+  --diff-hover-background-color: $blue-500;
+  --diff-hover-border-color: $blue-400;
+  --diff-hover-gutter-color: $blue-400;
+  --diff-hover-text-color: var(--diff-text-color);
+
+  --diff-add-hover-background-color: $green-900;
+  --diff-add-hover-border-color: $green-700;
+  --diff-add-hover-gutter-color: $green-700;
+  --diff-add-hover-text-color: var(--text-color);
+
+  --diff-delete-hover-background-color: $red-800;
+  --diff-delete-hover-border-color: $red-700;
+  --diff-delete-hover-gutter-color: $red-700;
+  --diff-delete-hover-text-color: var(--text-color);
+
+  // Syntax highlighting text colors
+  --syntax-variable-color: $purple-300;
+  --syntax-alt-variable-color: $blue-300;
+  --syntax-keyword-color: $red-300;
+  --syntax-atom-color: $blue-300;
+  --syntax-string-color: $orange-300;
+  --syntax-qualifier-color: $purple-300;
+  --syntax-type-color: $red-300;
+  --syntax-comment-color: $gray-400;
+  --syntax-tag-color: $green-400;
+  --syntax-attribute-color: $purple-300;
+  --syntax-link-color: $blue-300;
+
+  // Colors for form errors
+  --error-color: $red;
+  --form-error-background: darken($red-900, 3%);
+  --form-error-border-color: $red-900;
+  --form-error-text-color: var(--text-color);
+
+  /** Overlay is used as a background for both modals and foldouts */
+  --overlay-background-color: rgba(0, 0, 0, 0.5);
+
+  /** Dialog */
+  --dialog-warning-color: $yellow-600;
+  --dialog-error-color: $red-600;
+
+  /** Inline paths and code */
+  --path-segment-background: $gray-700;
+
+  .blankslate-image {
+    filter: #{'invert()'} grayscale(1) brightness(8) contrast(0.6);
+  }
+
+  /** Diverging notification banner colors */
+  --notification-banner-background: $gray-800;
+  --notification-banner-border-color: $gray-700;
+  --notification-ref-background: $gray-700;
+}
merged
  result 100644 118f40d4344ca7c4768e080dc7c5efb558a6e508 app/styles/ui/_app-menu.scss
  our    100644 3e0f853f19041341b3f99da4a54a9198c68956ba app/styles/ui/_app-menu.scss
@@ -116,6 +116,6 @@
     width: 100%;
     border: none;
     height: 1px;
-    border-bottom: var(--base-border);
+    border-bottom: 1px solid var(--app-menu-divider-color);
   }
 }
merged
  result 100644 c1acae40fa98cefd4b9acd874bc3f9564610a6b3 app/styles/ui/_author-input.scss
  our    100644 7f410ba422cc224a1bf1a644770a555b04eacd29 app/styles/ui/_author-input.scss
@@ -24,8 +24,8 @@

     .handle {
       border-radius: 3px;
-      border: 1px solid #c3e1ff;
-      background: #f0f8ff;
+      border: 1px solid var(--co-author-tag-border-color);
+      background: var(--co-author-tag-background-color);
       padding: 1px 1px;
       margin: 0px 2px;

merged
  result 100644 b9a9ae211132ba7784f37322c2cb317e9c2aa871 app/styles/ui/_branches.scss
  our    100644 8b437422d7971232a5209b075f6a7a4aac650780 app/styles/ui/_branches.scss
@@ -24,8 +24,8 @@
   .count {
     display: flex;

-    background: $gray-200;
-    color: var(--text-color);
+    background: var(--tab-bar-count-background-color);
+    color: var(--tab-bar-count-color);

     margin-left: var(--spacing-half);

@@ -162,12 +162,7 @@
       }

       &::after {
-        background: -webkit-linear-gradient(
-          left,
-          rgba(255, 255, 255, 0) 0%,
-          rgba(255, 255, 255, 0.5) 50%,
-          rgba(255, 255, 255, 0) 100%
-        );
+        background: var(--skeleton-background-gradient);
         content: '';
         display: block;
         height: 100%;
merged
  result 100644 97ca39a21b639ebe4d0b8aa70608843319f304fb app/styles/ui/_button.scss
  our    100644 584328bba42bf1267b5fc2b72da5863699ebe8e3 app/styles/ui/_button.scss
@@ -1,4 +1,7 @@
+@import '../mixins';
+
 .button-component {
+  @include ellipsis;
   // Chrome on Windows ignores the body element
   // font-family and uses Arial so we redefine
   // it here
merged
  result 100644 64c4ffecb0394f2d298707dc3791dd719539172b app/styles/ui/_codemirror.scss
  our    100644 aa9c9bb39f6132a7a359f95ab612ed96c6442e09 app/styles/ui/_codemirror.scss
@@ -25,6 +25,15 @@
   background: inherit;
 }

+.CodeMirror-simplescroll-horizontal,
+.CodeMirror-simplescroll-vertical {
+  background: var(--box-alt-background-color);
+  div {
+    background: var(--scroll-bar-thumb-background-color);
+    border: none;
+  }
+}
+
 // Windows has custom scroll bars, see _scroll.scss
 @include win32-context {
   .CodeMirror {
merged
  result 100644 94b86d54fb9b0314deb1ef48cc9e1466578ed390 app/styles/ui/_dialog.scss
  our    100644 e496a16bd915366f9b11d9d0e63a21a8732099f4 app/styles/ui/_dialog.scss
@@ -53,7 +53,7 @@
       transition: transform 250ms var(--easing-ease-out-back);

       &::backdrop {
-        opacity: 0.4;
+        opacity: 1;
         transition: opacity 100ms ease-in;
       }
     }
@@ -64,15 +64,14 @@
       pointer-events: none;

       &::backdrop {
-        opacity: 0.4;
+        opacity: 1;
       }
     }

     &-leave-active {
       opacity: 0.01;
       transform: scale(0.25);
-      transition: opacity 100ms ease-in,
-        transform 100ms var(--easing-ease-in-back);
+      transition: opacity 100ms ease-in, transform 100ms var(--easing-ease-in-back);

       &::backdrop {
         opacity: 0.01;
@@ -82,8 +81,8 @@
   }

   &::backdrop {
-    background: #000;
-    opacity: 0.4;
+    background: var(--overlay-background-color);
+    opacity: 1;
   }

   // The dialog embeds a fieldset as the first child of the form element
@@ -120,39 +119,7 @@
       @include ellipsis;
     }

-    .close {
-      flex-shrink: 0;
-
-      border: 0;
-      height: 16px;
-      width: 16px;
-
-      // Set the left margin to auto so that flexbox positions the button
-      // on the right hand side of the dialog and add a -10px right hand
-      // side margin to put the button where it should be (we use a double
-      // margin for the header itself).
-      margin: 0 calc(var(--spacing) * -1) 0 auto;
-      padding: 0;
-      background: transparent;
-
-      color: var(--text-secondary-color);
-      cursor: pointer;
-
-      // Let the button deal with all mouse events.
-      // Without this the octicon resets the cursor when
-      // hovering over the <path>.
-      .octicon {
-        pointer-events: none;
-      }
-
-      &:hover {
-        color: var(--text-color);
-      }
-
-      &:focus {
-        outline: 0;
-      }
-    }
+    @include close-button;
   }

   &.warning,
@@ -168,10 +135,7 @@
       // Ensure that the dialog contents always have room for the icon,
       // account for two double spacers at top and bottom plus the 5px
       // icon offset (margin-top) and the size of the icon itself.
-      min-height: calc(
-        var(--spacing-double) * 2 + var(--spacing-half) +
-          var(--dialog-icon-size)
-      );
+      min-height: calc(var(--spacing-double) * 2 + var(--spacing-half) + var(--dialog-icon-size));

       // We're creating an opaque 24 by 24px div with the background color
       // that we want the icon to appear in and then apply the icon path
merged
  result 100644 8b9383b267f661b394b29143bae31d8f6d73aa73 app/styles/ui/_diff.scss
  our    100644 3dca4de7170d06beb799c8fa23c07c350ca0afa9 app/styles/ui/_diff.scss
@@ -9,6 +9,7 @@
 .diff-code-mirror .CodeMirror {
   height: 100%;
   color: var(--diff-text-color);
+  background: var(--background-color);
   font-size: var(--font-size-sm);
   font-family: var(--font-family-monospace);

@@ -61,6 +62,7 @@
 .diff-line-gutter {
   display: flex;
   height: 100%;
+  background: var(--diff-gutter-background-color);

   &.diff-add {
     background: var(--diff-add-gutter-background-color);
@@ -95,8 +97,25 @@
   text-align: right;
 }

-.diff-add {
-  background: var(--diff-add-background-color);
+.CodeMirror-linebackground {
+  &.diff-add {
+    background: var(--diff-add-background-color);
+  }
+
+  &.diff-delete {
+    background: var(--diff-delete-background-color);
+  }
+
+  &.diff-context {
+    background: var(--background-color);
+  }
+
+  &.diff-hunk {
+    background: var(--diff-hunk-background-color);
+  }
+}
+
+.CodeMirror pre.diff-add {
   color: var(--diff-add-text-color);
   padding: 0;

@@ -109,8 +128,7 @@
   }
 }

-.diff-delete {
-  background: var(--diff-delete-background-color);
+.CodeMirror pre.diff-delete {
   color: var(--diff-delete-text-color);
   padding: 0;

@@ -123,9 +141,8 @@
   }
 }

-.diff-context {
-  background: var(--background-color);
-  color: var(--diff-context-text-color);
+.CodeMirror pre.diff-context {
+  color: var(--diff-text-color);
   padding: 0;

   .diff-line-number {
@@ -159,11 +176,10 @@
 }

 .cm-diff-context {
-  color: var(--diff-context-text-color);
+  color: var(--diff-text-color);
 }

-.diff-hunk {
-  background: var(--diff-hunk-background-color);
+.CodeMirror pre.diff-hunk {
   color: var(--diff-hunk-text-color);
   padding: 0;

@@ -176,7 +192,7 @@
   }
 }

-.diff-line-selected {
+.CodeMirror pre.CodeMirror-line .diff-line-selected {
   .diff-line-number {
     background: var(--diff-selected-background-color);
     border-color: var(--diff-selected-border-color);
@@ -188,7 +204,7 @@
   }
 }

-.diff-line-hover {
+.CodeMirror pre.CodeMirror-line .diff-line-hover {
   .diff-line-number {
     background: var(--diff-hover-background-color);
     border-color: var(--diff-hover-border-color);
@@ -246,15 +262,6 @@
   padding: 0;
 }
 // ***************************************************************************************************************************
-#diff a {
-  text-decoration: none;
-  margin-left: var(--spacing-half);
-}
-
-#diff a:link {
-  color: (orange);
-}
-
 .panel.image {
   display: flex;
   flex: 1;
@@ -295,17 +302,36 @@
   }
 }

-.image-diff-two-up {
+.image-diff-container {
   display: flex;
   flex: 1;
   justify-content: center;
   align-items: center;
+  flex-direction: column;

-  .image-diff-previous {
-    margin-right: 7.5px;
+  .image-diff-two-up {
+    display: flex;
+    align-items: center;
+
+    .image-diff-previous {
+      margin-right: var(--spacing-half);
+      margin-bottom: var(--spacing-half);
+    }
+    .image-diff-current {
+      margin-left: var(--spacing-half);
+      margin-bottom: var(--spacing-half);
+    }
   }
-  .image-diff-current {
-    margin-left: 7.5px;
+
+  .image-diff-summary {
+    color: var(--text-secondary-color);
+    font-weight: var(--font-weight-semibold);
+    .added {
+      color: var(--color-new);
+    }
+    .removed {
+      color: var(--color-deleted);
+    }
   }
 }

@@ -436,15 +462,15 @@
 // https://github.com/primer/github-syntax-light/blob/5aeffad2559647286080328436156c4904a9785b/lib/github-light.css
 .cm-s-default {
   .cm-variable {
-    color: #6f42c1;
+    color: var(--syntax-variable-color);
   }

   .cm-keyword {
-    color: #d73a49;
+    color: var(--syntax-keyword-color);
   }

   .cm-atom {
-    color: #005cc5;
+    color: var(--syntax-atom-color);
   }
   .cm-number {
     color: inherit;
@@ -456,25 +482,25 @@

   .cm-variable-2,
   .cm-variable-3 {
-    color: #24292e;
+    color: var(--syntax-alt-variable-color);
   }
   .cm-comment,
   .cm-meta {
-    color: $gray-500;
+    color: var(--syntax-comment-color);
   }
   .cm-string,
   .cm-string-2 {
-    color: #032f62;
+    color: var(--syntax-string-color);

     &.cm-property {
       color: inherit;
     }
   }
   .cm-qualifier {
-    color: #6f42c1;
+    color: var(--syntax-qualifier-color);
   }
   .cm-type {
-    color: #d73a49;
+    color: var(--syntax-type-color);
   }
   .cm-builtin {
     color: inherit;
@@ -483,17 +509,17 @@
     color: inherit;
   }
   .cm-tag {
-    color: #22863a;
+    color: var(--syntax-tag-color);
   }
   .cm-attribute {
-    color: #6f42c1;
+    color: var(--syntax-attribute-color);
   }
   .cm-hr {
     color: inherit;
   }
   .cm-link {
     text-decoration: underline;
-    color: #032f62;
+    color: var(--syntax-link-color);
   }

   // Intra line markings takes precedence over syntax highlighting.
@@ -507,19 +533,19 @@

   .cm-m-css {
     &.cm-property {
-      color: #005cc5;
+      color: var(--syntax-atom-color);
     }
   }

   .cm-m-shell {
     &.cm-builtin {
-      color: #005cc5;
+      color: var(--syntax-atom-color);
     }
   }

   .cm-m-javascript {
     &.cm-type {
-      color: #6f42c1;
+      color: var(--syntax-variable-color);
     }
   }
 }
added in remote
  their  100644 479e9f6732ddc2b29c19b24585f4bb315001226a app/styles/ui/_fancy-text-box.scss
@@ -0,0 +1,41 @@
+@import '../mixins';
+
+.fancy-text-box-component {
+  background: var(--box-background-color);
+  display: flex;
+  align-items: center;
+  border: var(--base-border);
+  border-radius: var(--border-radius);
+
+  .fancy-octicon {
+    height: var(--text-field-height);
+    padding: var(--spacing-half) 0 var(--spacing-half) 7px;
+    border-right: none;
+    border-radius: var(--border-radius) 0 0 var(--border-radius);
+    opacity: 0.5;
+    transition: opacity 0.2s ease;
+  }
+
+  &.focused {
+    @include textboxish-focus-styles;
+
+    .fancy-octicon {
+      opacity: 1;
+    }
+  }
+
+  input {
+    border-left: none;
+    border-radius: 0 var(--border-radius) var(--border-radius) 0;
+    border: none;
+    box-shadow: none;
+
+    &:focus {
+      box-shadow: none;
+    }
+  }
+
+  &.disabled {
+    background: var(--box-alt-background-color);
+  }
+}
merged
  result 100644 8d0a73f26a35a260372d33c7dfe4ff8b5d1339a8 app/styles/ui/_file-list.scss
  our    100644 e144976834ba00ee6d0a7f0840de601c6361830e app/styles/ui/_file-list.scss
@@ -11,12 +11,15 @@
     border-bottom: var(--base-border);
   }

-  // Only use special colors for the change type icons when
-  // the list item doesn't have active focus. If it does we
-  // fall back to using the ambient foreground color of the
-  // list item.
-  .list-item:not(:focus) {
-    @include octicon-status;
+  .list-focus-container {
+    // Default to using status aware colors for the change type
+    // octicons (i.e. green for added, yellowish for modified etc)
+    // but fall back to picking up the ambient text color when the
+    // list item is both focused and selected.
+    &.focus-within .list-item:not(.selected),
+    &:not(.focus-within) .list-item {
+      @include octicon-status;
+    }
   }

   .file {
merged
  result 100644 6d566f094b0851eb8e5875fc9b74a6ec847985e2 app/styles/ui/_foldout.scss
  our    100644 862730a600bd4c8f8550cc85c363796164440dfa app/styles/ui/_foldout.scss
@@ -12,8 +12,7 @@
       box-shadow: none;
     }

-    background: black;
-    opacity: 0.4;
+    background: var(--overlay-background-color);
     height: 100%;
   }

merged
  result 100644 7b3fc84057d9f29f2c281fa3e52cb7eb6e066501 app/styles/ui/_list.scss
  our    100644 1caa93d31e19fb970d33836afcdb72aebca4aad6 app/styles/ui/_list.scss
@@ -62,6 +62,17 @@
   }
 }

+.list-focus-container {
+  // The selected items must act as the focused element when inside
+  &.focus-within .list-item.selected {
+    --text-color: var(--box-selected-active-text-color);
+    --text-secondary-color: var(--box-selected-active-text-color);
+
+    color: var(--text-color);
+    background-color: var(--box-selected-active-background-color);
+  }
+}
+
 .list-item {
   display: flex;
   flex-direction: row;
@@ -76,14 +87,6 @@

     color: var(--text-color);
     background-color: var(--box-selected-background-color);
-
-    &:focus {
-      --text-color: var(--box-selected-active-text-color);
-      --text-secondary-color: var(--box-selected-active-text-color);
-
-      color: var(--text-color);
-      background-color: var(--box-selected-active-background-color);
-    }
   }

   &:focus {
added in remote
  their  100644 ec2aae86b8d44d23f35f56cb9684489301016d6b app/styles/ui/_notification-banner.scss
@@ -0,0 +1,102 @@
+@import '../mixins';
+
+.notification-banner + .compare-form {
+  border-top: var(--base-border);
+}
+
+.notification-banner {
+  background: var(--notification-banner-background);
+  border: var(--base-border);
+  border-color: var(--notification-banner-border-color);
+  border-radius: var(--border-radius);
+  display: flex;
+  padding: var(--spacing);
+  position: relative;
+
+  .notification-icon {
+    margin-right: var(--spacing-half);
+  }
+
+  &-content {
+    display: flex;
+    flex-wrap: wrap;
+
+    p {
+      flex-grow: 1;
+      font-size: var(--font-size-sm);
+      margin: 0;
+      padding-right: var(--spacing-double); // Extra space for the close button
+
+      & + p {
+        margin-top: var(--spacing-half);
+      }
+    }
+  }
+
+  @include close-button;
+
+  .ref-component {
+    background: var(--notification-ref-background);
+    word-break: normal;
+  }
+
+  .close {
+    position: absolute;
+    margin: 0;
+    top: var(--spacing);
+    right: var(--spacing);
+    text-align: center;
+
+    .octicon {
+      height: 12px;
+    }
+  }
+}
+
+.diverge-banner {
+  margin: var(--spacing-half);
+  overflow: hidden;
+
+  &-enter {
+    max-height: 0;
+    opacity: 0;
+
+    &-active {
+      max-height: 200px;
+      opacity: 1;
+      transition: all var(--undo-animation-duration) cubic-bezier(0, 0, 0.2, 1);
+    }
+  }
+
+  &-leave {
+    max-height: 200px;
+
+    &-active {
+      max-height: 0;
+      opacity: 1;
+      transition: max-height 300ms cubic-bezier(0.4, 0, 0.2, 1);
+
+      .diverge-banner {
+        transform: translateX(-102%);
+        opacity: 0;
+        transition: all 180ms cubic-bezier(0.4, 0, 1, 1);
+      }
+    }
+  }
+
+  &-wrapper {
+    overflow: hidden;
+    box-shadow: inset 0 -1px var(--box-border-color);
+  }
+}
+
+.notification-banner-content-body {
+  margin-bottom: var(--spacing-half);
+}
+
+.notification-banner-content {
+  .button-component {
+    margin-top: var(--spacing-half);
+    margin-right: var(--spacing-half);
+  }
+}
merged
  result 100644 8f546e403848d75eee71d9c9cfadf10861721ea0 app/styles/ui/_octicons.scss
  our    100644 215063877dc976dfb22c47f98829eb38c20d9bd1 app/styles/ui/_octicons.scss
@@ -6,4 +6,6 @@
   Forcing a width of 16px would result in some blurry icons showing up.
   Instead, let's imply width: auto; instead. */
   height: 16px;
+
+  flex-shrink: 0;
 }
merged
  result 100644 7a372fc2ba926c3532af77143dd008fa32fb4d3a app/styles/ui/_progress.scss
  our    100644 0f1d4611ca18a0222d8408f2fba2f066fc73e2a5 app/styles/ui/_progress.scss
@@ -12,13 +12,7 @@
   }

   &:indeterminate {
-    background-image: -webkit-linear-gradient(
-      -45deg,
-      transparent 33%,
-      var(--text-color) 33%,
-      var(--text-color) 66%,
-      transparent 66%
-    );
+    background-image: -webkit-linear-gradient(-45deg, transparent 33%, var(--text-color) 33%, var(--text-color) 66%, transparent 66%);
     background-size: 25px 10px, 100% 100%, 100% 100%;

     -webkit-animation: progress-indeterminate-animation 5s linear infinite;
merged
  result 100644 babfdd92b2ced6ebdff2052231e4dea8a3d3b576 app/styles/ui/_pull-request-badge.scss
  our    100644 479c5dc5f32bef83b9e68e7b8f2739733f4da45f app/styles/ui/_pull-request-badge.scss
@@ -1,9 +1,9 @@
 .toolbar-dropdown.open .pr-badge {
-  background: $gray-200;
+  background: var(--toolbar-badge-active-background-color);
 }

 .toolbar-dropdown:not(.open) .pr-badge {
-  background: $gray-700;
+  background: var(--toolbar-badge-background-color);
 }

 .pr-badge {
merged
  result 100644 eddec3b4d0f749f111f14d559b64cb6d06e2a97f app/styles/ui/_ref.scss
  our    100644 6c6ae06ccf808f2fbe03949d3ac21f696563a97d app/styles/ui/_ref.scss
@@ -5,4 +5,5 @@
   border: var(--path-segment-background);
   border-radius: var(--border-radius);
   padding: var(--path-segment-padding);
+  word-break: break-all;
 }
merged
  result 100644 157e36f8a6d1951007c2c6c8f17b69d30f96b0c7 app/styles/ui/_repository-list.scss
  our    100644 14dc39f723c7e6750bd1aeb7eca236863e48a320 app/styles/ui/_repository-list.scss
@@ -50,7 +50,7 @@
       @include ellipsis;

       .prefix {
-        color: var(--text-tertiary-color);
+        color: var(--text-secondary-color);
       }

       /* Used to highlight substring matches in filtered lists */
@@ -61,6 +61,43 @@
         color: currentColor;
       }
     }
+
+    .change-indicator {
+      color: var(--tab-bar-active-color);
+      margin-right: 0;
+      width: auto;
+    }
+
+    .change-indicator-wrapper {
+      display: flex;
+      min-width: 12px;
+    }
+
+    .ahead-behind {
+      height: 16px;
+      background: var(--list-item-badge-background-color);
+      color: var(--list-item-badge-color);
+      align-items: center;
+      margin-left: auto;
+
+      // Perfectly round semi circle ends with real tight
+      // padding on either side. Now in two flavors!
+      @include darwin {
+        height: 12px;
+        line-height: 12px;
+      }
+
+      @include win32 {
+        height: 13px;
+        line-height: 13px;
+      }
+
+      .octicon {
+        margin: 0;
+        height: 20px;
+        width: 12px;
+      }
+    }
   }

   .sidebar-message {
@@ -71,3 +108,31 @@
     text-align: center;
   }
 }
+
+.list-focus-container {
+  /** Ahead/behind badge colors when list item is selected but not focused */
+  .list-item.selected {
+    .repository-list-item {
+      .ahead-behind {
+        background: var(--list-item-selected-badge-background-color);
+        color: var(--list-item-selected-badge-color);
+      }
+    }
+  }
+
+  &.focus-within {
+    /** Ahead/behind badge colors when list item is selected and focused */
+    .list-item.selected {
+      .repository-list-item {
+        .ahead-behind {
+          background: var(--list-item-selected-active-badge-background-color);
+          color: var(--list-item-selected-active-badge-color);
+        }
+      }
+    }
+
+    .change-indicator {
+      color: var(--text-color);
+    }
+  }
+}
merged
  result 100644 19452e95365b7649095eb5dec6929dfbcf0a56ed app/styles/ui/_repository.scss
  our    100644 7bc7ca7f0af55bf92b7abef8be065dadcfe5e06e app/styles/ui/_repository.scss
@@ -6,6 +6,10 @@
   flex-direction: row;
   flex: 1;

+  > .focus-container {
+    display: flex;
+  }
+
   &-sidebar {
     display: flex;
     flex-direction: column;
merged
  result 100644 d03e102280205b3d5932443b87f86ae495b967c8 app/styles/ui/_select.scss
  our    100644 49aaeff05480031aef8493b66d05c59ae970ecc0 app/styles/ui/_select.scss
@@ -10,27 +10,16 @@
     margin-bottom: var(--spacing-third);
   }

-  // Select boxes look absolutely horrible on Windows so we'll make them
-  // look as good as we possibly can. There's nothing we can do about the
-  // drop down itself but at least we can style the base element a bit.
-  @include win32 {
-    select {
-      // Get rid of all default UA styling, we can do better
-      -webkit-appearance: none;
+  // Custom styles for select components because a) they look horrible
+  // on Windows and b) because we need them to inherit colors and other
+  // appearance from our global variables. Therefore we treat them more
+  // or less exactly as a text box.
+  select {
+    // Make the select look like a text box.
+    @include textboxish;
+    @include textboxish-disabled;

-      // Make the select look like a text box.
-      @include textboxish;
-      @include textboxish-disabled;
-
-      // Add back the arrow that got removed with appearance: none.
-      // This is a custom version of the triangle-down octicon that was
-      // adapted to be 8 by 5px. The gif is in 2x and the background-size
-      // scales it back down so that we can have crisp arrows on high-dpi
-      // displays. The path is M 0,0 4,5 8,0 Z and the color is #6a737d.
-      background-image: url('data:image/gif;base64,R0lGODlhEAAKAMQAAGpzff///8PHy6arsXqCi46UnN7g4vHy8/v7+253gYuSmm12gO/w8dve4Pz8/KassniAicfLzwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAAAAAAALAAAAAAQAAoAAAUw4ACMZFk+TmGugIIEB8GSEBPcRjIvze1HM4FvKDI9hsNUyYUcxka1JjLHkzYFwmYIADs=');
-      background-size: 8px 5px;
-      background-repeat: no-repeat;
-      background-position: right var(--spacing-half) center;
-    }
+    // Don't include the default padding from textboxish, it's too much
+    padding: 0;
   }
 }
merged
  result 100644 43d02373aff313ef9b39f22eb06c69042edeae78 app/styles/ui/_tab-bar.scss
  our    100644 1bffcaff9a286153de4d40b1384bc42499839078 app/styles/ui/_tab-bar.scss
@@ -51,6 +51,17 @@
       margin-left: 4px;
       margin-top: 1px;
     }
+
+    .counter {
+      color: var(--tab-bar-count-color);
+      background-color: var(--tab-bar-count-background-color);
+      margin-left: 4px;
+      padding: 2px 5px;
+      font-size: var(--font-size-xs);
+      font-weight: var(--font-weight-semibold);
+      border-radius: 20px;
+      line-height: 1;
+    }
   }

   &.switch &-item {
merged
  result 100644 94ed12c8ef668212eaa0f41d6f741a8cc444b2da app/styles/ui/changes/_changes-view.scss
  our    100644 65c5af2ea88cf23e747e2b83a4de02734e02ec5a app/styles/ui/changes/_changes-view.scss
@@ -59,6 +59,10 @@
       margin: var(--spacing-double);
       text-align: center;
       justify-content: initial;
+
+      .blankslate-image {
+        max-height: 150px;
+      }
     }
   }
 }
merged
  result 100644 44b4d80ba3b31ba74550bd24a221b8b5a30b162c app/styles/ui/changes/_commit-message.scss
  our    100644 68a0917a3d144cf8e5d26609b5abc54013f7d66e app/styles/ui/changes/_commit-message.scss
@@ -45,18 +45,18 @@
   }

   .co-authors-toggle {
-    color: $gray-500;
+    color: var(--text-secondary-color);

     &:hover {
-      color: $gray-900;
+      color: var(--text-color);
     }
   }

   &.with-co-authors .co-authors-toggle {
-    color: $blue-400;
+    color: var(--link-button-color);

     &:hover {
-      color: $blue-600;
+      color: var(--link-button-hover-color);
     }
   }

@@ -91,11 +91,7 @@
         width: 100%;
         bottom: 0px;
         height: 5px;
-        background: linear-gradient(
-          to bottom,
-          rgba(0, 0, 0, 0) 0%,
-          rgba(0, 0, 0, 0.1) 100%
-        );
+        background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 100%);
         border-bottom: var(--base-border);
       }
     }
@@ -119,6 +115,7 @@

     .action-bar {
       padding: var(--spacing-half);
+      background: var(--box-background-color);

       // We're not faking being a textbox any more
       cursor: default;
merged
  result 100644 afc47457356923945b1b56e34a7eb176b19e7adb app/styles/ui/history/_commit-summary.scss
  our    100644 da6d9942c041f863fd8e5aa0dc74a2e8a8788277 app/styles/ui/history/_commit-summary.scss
@@ -41,6 +41,21 @@
     .commit-summary-description {
       padding-right: 100px;
     }
+
+    // When the description area can be, but isn't yet, expanded
+    // we'll add a small shadow towards the bottom to hint that
+    // there's more content available.
+    &:not(.expanded) {
+      .commit-summary-description:before {
+        content: '';
+        background: var(--box-overflow-shadow-background);
+        position: absolute;
+        height: 30px;
+        bottom: 0px;
+        width: 100%;
+        pointer-events: none;
+      }
+    }
   }
 }

@@ -76,21 +91,6 @@
     // The extra pixel makes the space align up with the commit list.
     max-height: 61px;
     flex: 1;
-
-    &:before {
-      content: '';
-      background: linear-gradient(
-        180deg,
-        rgba(255, 255, 255, 0) 0px,
-        rgba(255, 255, 255, 0) 40px,
-        rgba(255, 255, 255, 0.5) 40px,
-        white 60px
-      );
-      position: absolute;
-      height: 100%;
-      width: 100%;
-      pointer-events: none;
-    }
   }

   // Enable text selection inside the title and description elements.
merged
  result 100644 58cea508b02182fa4f45daf88643d33c3b2dd020 app/styles/ui/history/_history.scss
  our    100644 4e36c11fb44d43f2f8a8cb661820f2143f0f513c app/styles/ui/history/_history.scss
@@ -46,6 +46,114 @@
       margin: var(--spacing-double);
       text-align: center;
       justify-content: initial;
+
+      .blankslate-image {
+        max-height: 150px;
+      }
+    }
+  }
+}
+
+#compare-view {
+  display: flex;
+  flex-direction: column;
+  flex: 1;
+
+  .compare-form {
+    background: var(--box-alt-background-color);
+    flex: initial;
+    padding: var(--spacing-half);
+    border-bottom: var(--base-border);
+  }
+
+  .compare-commit-list {
+    flex: 1;
+    display: flex;
+    flex-direction: column;
+  }
+
+  .merge-cta {
+    border-top: var(--base-border);
+    display: flex;
+    flex-direction: column;
+    font-size: var(--font-size-sm);
+    text-align: center;
+    padding: var(--spacing);
+  }
+
+  .merge-message {
+    margin-top: var(--spacing);
+  }
+
+  .no-branches {
+    color: var(--text-secondary-color);
+    margin-top: var(--spacing-double);
+  }
+
+  .branch-commit-counter {
+    color: var(--text-secondary-color);
+    display: flex;
+    justify-content: flex-end;
+    flex: 1;
+    font-size: var(--font-size-sm);
+
+    &-item {
+      display: flex;
+      align-items: center;
+
+      &:first-child {
+        margin-right: var(--spacing-half);
+      }
+    }
+
+    .octicon {
+      fill: var(--text-secondary-color);
+      width: 8px;
+      margin-left: 1px;
+
+      &:last-child {
+        margin-right: 0;
+      }
+    }
+  }
+
+  .tab-bar {
+    padding: var(--spacing-half);
+    border-bottom: var(--base-border);
+    height: initial;
+
+    &-item {
+      box-shadow: none;
+      background: var(--tab-bar-background-color);
+      border: var(--base-border);
+
+      &:first-of-type {
+        border-radius: var(--border-radius) 0 0 var(--border-radius);
+      }
+
+      &:last-of-type {
+        border-radius: 0 var(--border-radius) var(--border-radius) 0;
+      }
+
+      &.selected {
+        background: var(--box-selected-active-background-color);
+        border-color: var(--box-border-accent-color);
+        color: var(--box-selected-active-text-color);
+      }
+    }
+  }
+
+  .select-component {
+    flex-grow: 0;
+  }
+
+  .compare-content {
+    display: flex;
+    height: 100%;
+    flex-direction: column;
+
+    .ref-component {
+      word-break: break-word;
     }
   }
 }
merged
  result 100644 5cf34011a143e1112e833a2ba33f5d35a182088a app/styles/ui/toolbar/_toolbar.scss
  our    100644 15433dbad68211b728ccfe0accfc3dc90955c1cf app/styles/ui/toolbar/_toolbar.scss
@@ -3,6 +3,7 @@
 /** A React component holding the main application toolbar component. */
 #desktop-app-toolbar {
   height: var(--toolbar-height);
+  border-bottom: 1px solid var(--toolbar-border-color);

   display: flex;
   flex-direction: row;
@@ -63,7 +64,7 @@
 .ahead-behind {
   display: flex;

-  background: var(--ahead-behind-background-color);
+  background: var(--toolbar-badge-background-color);

   // Perfectly round semi circle ends with real tight
   // padding on either side. Now in two flavors!
merged
  result 100644 419ec0bccd48a36eeace41e2a86c10861ebb2943 app/styles/ui/window/_app-menu-bar.scss
  our    100644 dee56f6f0fff77036d78caa38bafeb385e572bf4 app/styles/ui/window/_app-menu-bar.scss
@@ -10,12 +10,19 @@
     }
   }

+  .toolbar-dropdown.open > .toolbar-button > button {
+    background-color: var(--app-menu-button-active-background-color);
+    color: var(--app-menu-button-active-color);
+  }
+
   .toolbar-dropdown:not(.open) > .toolbar-button > button {
-    color: var(--toolbar-text-color);
+    color: var(--app-menu-button-color);
+    background: transparent;

     &:hover,
     &:focus {
-      color: var(--toolbar-button-color);
+      color: var(--app-menu-button-hover-color);
+      background: var(--app-menu-button-hover-background-color);
     }
   }

@@ -39,8 +46,25 @@
     pointer-events: none;

     .menu-pane {
+      --background-color: var(--app-menu-pane-background-color);
       background: var(--background-color);
+
+      --text-color: var(--app-menu-pane-color);
+      color: var(--text-color);
+
+      --text-secondary-color: var(--app-menu-pane-secondary-color);
+
       pointer-events: all;
     }
+
+    .menu-item:hover {
+      &:not(.disabled) {
+        --text-color: var(--box-selected-active-text-color);
+        --text-secondary-color: var(--box-selected-active-text-color);
+
+        color: var(--text-color);
+        background-color: var(--box-selected-active-background-color);
+      }
+    }
   }
 }
merged
  result 100644 69f1e178d8523dc79986e345766ace7b3aa278c2 app/styles/ui/window/_toast-notification.scss
  our    100644 965026fe769810b727cc768025c568ede86e918b app/styles/ui/window/_toast-notification.scss
@@ -14,8 +14,8 @@
   .toast-notification {
     padding: var(--spacing) var(--spacing-double);
     min-width: 100px;
-    background: rgba($gray-900, 0.6);
-    color: $gray-000;
+    background: var(--toast-notification-background-color);
+    color: var(--toast-notification-color);
     text-align: center;
     border-radius: 100px;
     font-size: var(--font-size-md);
merged
  result 100644 0e9a54a357e4abc1b90c957b3f2b5b9d770d63a9 app/styles/ui/window/_zoom-info.scss
  our    100644 0c6db84cbb5f535dedef4192e2e914f5ab4ce20d app/styles/ui/window/_zoom-info.scss
@@ -14,8 +14,8 @@
   & > div {
     padding: var(--spacing);
     min-width: 100px;
-    background: rgba($gray-900, 0.6);
-    color: $gray-000;
+    background: var(--toast-notification-background-color);
+    color: var(--toast-notification-color);
     text-align: center;
     border-radius: 100px;
     font-size: var(--font-size-md);
removed in remote
  base   100755 a5d7b84a673458d14d9aab082183a1968c2c7492 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/applypatch-msg.sample
  our    100755 a5d7b84a673458d14d9aab082183a1968c2c7492 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/applypatch-msg.sample
@@ -1,15 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to check the commit log message taken by
-# applypatch from an e-mail message.
-#
-# The hook should exit with non-zero status after issuing an
-# appropriate message if it wants to stop the commit.  The hook is
-# allowed to edit the commit message file.
-#
-# To enable this hook, rename this file to "applypatch-msg".
-
-. git-sh-setup
-commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
-test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
-:
removed in remote
  base   100755 b58d1184a9d43a39c0d95f32453efc78581877d6 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/commit-msg.sample
  our    100755 b58d1184a9d43a39c0d95f32453efc78581877d6 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/commit-msg.sample
@@ -1,24 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to check the commit log message.
-# Called by "git commit" with one argument, the name of the file
-# that has the commit message.  The hook should exit with non-zero
-# status after issuing an appropriate message if it wants to stop the
-# commit.  The hook is allowed to edit the commit message file.
-#
-# To enable this hook, rename this file to "commit-msg".
-
-# Uncomment the below to add a Signed-off-by line to the message.
-# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
-# hook is more suited to it.
-#
-# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
-# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"
-
-# This example catches duplicate Signed-off-by lines.
-
-test "" = "$(grep '^Signed-off-by: ' "$1" |
-	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
-	echo >&2 Duplicate Signed-off-by lines.
-	exit 1
-}
removed in remote
  base   100755 ec17ec1939b7c3e86b7cb6c0c4de6b0818a7e75e app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/post-update.sample
  our    100755 ec17ec1939b7c3e86b7cb6c0c4de6b0818a7e75e app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/post-update.sample
@@ -1,8 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to prepare a packed repository for use over
-# dumb transports.
-#
-# To enable this hook, rename this file to "post-update".
-
-exec git update-server-info
removed in remote
  base   100755 4142082bcb939bbc17985a69ba748491ac6b62a5 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-applypatch.sample
  our    100755 4142082bcb939bbc17985a69ba748491ac6b62a5 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-applypatch.sample
@@ -1,14 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to verify what is about to be committed
-# by applypatch from an e-mail message.
-#
-# The hook should exit with non-zero status after issuing an
-# appropriate message if it wants to stop the commit.
-#
-# To enable this hook, rename this file to "pre-applypatch".
-
-. git-sh-setup
-precommit="$(git rev-parse --git-path hooks/pre-commit)"
-test -x "$precommit" && exec "$precommit" ${1+"$@"}
-:
removed in remote
  base   100755 68d62d5446d963dc69006ad9a83907c6690f92c1 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-commit.sample
  our    100755 68d62d5446d963dc69006ad9a83907c6690f92c1 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-commit.sample
@@ -1,49 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to verify what is about to be committed.
-# Called by "git commit" with no arguments.  The hook should
-# exit with non-zero status after issuing an appropriate message if
-# it wants to stop the commit.
-#
-# To enable this hook, rename this file to "pre-commit".
-
-if git rev-parse --verify HEAD >/dev/null 2>&1
-then
-	against=HEAD
-else
-	# Initial commit: diff against an empty tree object
-	against=4b825dc642cb6eb9a060e54bf8d69288fbee4904
-fi
-
-# If you want to allow non-ASCII filenames set this variable to true.
-allownonascii=$(git config --bool hooks.allownonascii)
-
-# Redirect output to stderr.
-exec 1>&2
-
-# Cross platform projects tend to avoid non-ASCII filenames; prevent
-# them from being added to the repository. We exploit the fact that the
-# printable range starts at the space character and ends with tilde.
-if [ "$allownonascii" != "true" ] &&
-	# Note that the use of brackets around a tr range is ok here, (it's
-	# even required, for portability to Solaris 10's /usr/bin/tr), since
-	# the square bracket bytes happen to fall in the designated range.
-	test $(git diff --cached --name-only --diff-filter=A -z $against |
-	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
-then
-	cat <<\EOF
-Error: Attempt to add a non-ASCII file name.
-
-This can cause problems if you want to work with people on other platforms.
-
-To be portable it is advisable to rename the file.
-
-If you know what you are doing you can disable this check using:
-
-  git config hooks.allownonascii true
-EOF
-	exit 1
-fi
-
-# If there are whitespace errors, print the offending file names and fail.
-exec git diff-index --check --cached $against --
removed in remote
  base   100755 6187dbf4390fc6e28445dd3d988aefb9d1111988 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-push.sample
  our    100755 6187dbf4390fc6e28445dd3d988aefb9d1111988 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-push.sample
@@ -1,53 +0,0 @@
-#!/bin/sh
-
-# An example hook script to verify what is about to be pushed.  Called by "git
-# push" after it has checked the remote status, but before anything has been
-# pushed.  If this script exits with a non-zero status nothing will be pushed.
-#
-# This hook is called with the following parameters:
-#
-# $1 -- Name of the remote to which the push is being done
-# $2 -- URL to which the push is being done
-#
-# If pushing without using a named remote those arguments will be equal.
-#
-# Information about the commits which are being pushed is supplied as lines to
-# the standard input in the form:
-#
-#   <local ref> <local sha1> <remote ref> <remote sha1>
-#
-# This sample shows how to prevent push of commits where the log message starts
-# with "WIP" (work in progress).
-
-remote="$1"
-url="$2"
-
-z40=0000000000000000000000000000000000000000
-
-while read local_ref local_sha remote_ref remote_sha
-do
-	if [ "$local_sha" = $z40 ]
-	then
-		# Handle delete
-		:
-	else
-		if [ "$remote_sha" = $z40 ]
-		then
-			# New branch, examine all commits
-			range="$local_sha"
-		else
-			# Update to existing branch, examine new commits
-			range="$remote_sha..$local_sha"
-		fi
-
-		# Check for WIP commit
-		commit=`git rev-list -n 1 --grep '^WIP' "$range"`
-		if [ -n "$commit" ]
-		then
-			echo >&2 "Found WIP commit in $local_ref, not pushing"
-			exit 1
-		fi
-	fi
-done
-
-exit 0
removed in remote
  base   100755 6cbef5c370d8c3486ca85423dd70440c5e0a2aa2 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-rebase.sample
  our    100755 6cbef5c370d8c3486ca85423dd70440c5e0a2aa2 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-rebase.sample
@@ -1,169 +0,0 @@
-#!/bin/sh
-#
-# Copyright (c) 2006, 2008 Junio C Hamano
-#
-# The "pre-rebase" hook is run just before "git rebase" starts doing
-# its job, and can prevent the command from running by exiting with
-# non-zero status.
-#
-# The hook is called with the following parameters:
-#
-# $1 -- the upstream the series was forked from.
-# $2 -- the branch being rebased (or empty when rebasing the current branch).
-#
-# This sample shows how to prevent topic branches that are already
-# merged to 'next' branch from getting rebased, because allowing it
-# would result in rebasing already published history.
-
-publish=next
-basebranch="$1"
-if test "$#" = 2
-then
-	topic="refs/heads/$2"
-else
-	topic=`git symbolic-ref HEAD` ||
-	exit 0 ;# we do not interrupt rebasing detached HEAD
-fi
-
-case "$topic" in
-refs/heads/??/*)
-	;;
-*)
-	exit 0 ;# we do not interrupt others.
-	;;
-esac
-
-# Now we are dealing with a topic branch being rebased
-# on top of master.  Is it OK to rebase it?
-
-# Does the topic really exist?
-git show-ref -q "$topic" || {
-	echo >&2 "No such branch $topic"
-	exit 1
-}
-
-# Is topic fully merged to master?
-not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
-if test -z "$not_in_master"
-then
-	echo >&2 "$topic is fully merged to master; better remove it."
-	exit 1 ;# we could allow it, but there is no point.
-fi
-
-# Is topic ever merged to next?  If so you should not be rebasing it.
-only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
-only_next_2=`git rev-list ^master           ${publish} | sort`
-if test "$only_next_1" = "$only_next_2"
-then
-	not_in_topic=`git rev-list "^$topic" master`
-	if test -z "$not_in_topic"
-	then
-		echo >&2 "$topic is already up to date with master"
-		exit 1 ;# we could allow it, but there is no point.
-	else
-		exit 0
-	fi
-else
-	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
-	/usr/bin/perl -e '
-		my $topic = $ARGV[0];
-		my $msg = "* $topic has commits already merged to public branch:\n";
-		my (%not_in_next) = map {
-			/^([0-9a-f]+) /;
-			($1 => 1);
-		} split(/\n/, $ARGV[1]);
-		for my $elem (map {
-				/^([0-9a-f]+) (.*)$/;
-				[$1 => $2];
-			} split(/\n/, $ARGV[2])) {
-			if (!exists $not_in_next{$elem->[0]}) {
-				if ($msg) {
-					print STDERR $msg;
-					undef $msg;
-				}
-				print STDERR " $elem->[1]\n";
-			}
-		}
-	' "$topic" "$not_in_next" "$not_in_master"
-	exit 1
-fi
-
-<<\DOC_END
-
-This sample hook safeguards topic branches that have been
-published from being rewound.
-
-The workflow assumed here is:
-
- * Once a topic branch forks from "master", "master" is never
-   merged into it again (either directly or indirectly).
-
- * Once a topic branch is fully cooked and merged into "master",
-   it is deleted.  If you need to build on top of it to correct
-   earlier mistakes, a new topic branch is created by forking at
-   the tip of the "master".  This is not strictly necessary, but
-   it makes it easier to keep your history simple.
-
- * Whenever you need to test or publish your changes to topic
-   branches, merge them into "next" branch.
-
-The script, being an example, hardcodes the publish branch name
-to be "next", but it is trivial to make it configurable via
-$GIT_DIR/config mechanism.
-
-With this workflow, you would want to know:
-
-(1) ... if a topic branch has ever been merged to "next".  Young
-    topic branches can have stupid mistakes you would rather
-    clean up before publishing, and things that have not been
-    merged into other branches can be easily rebased without
-    affecting other people.  But once it is published, you would
-    not want to rewind it.
-
-(2) ... if a topic branch has been fully merged to "master".
-    Then you can delete it.  More importantly, you should not
-    build on top of it -- other people may already want to
-    change things related to the topic as patches against your
-    "master", so if you need further changes, it is better to
-    fork the topic (perhaps with the same name) afresh from the
-    tip of "master".
-
-Let's look at this example:
-
-		   o---o---o---o---o---o---o---o---o---o "next"
-		  /       /           /           /
-		 /   a---a---b A     /           /
-		/   /               /           /
-	       /   /   c---c---c---c B         /
-	      /   /   /             \         /
-	     /   /   /   b---b C     \       /
-	    /   /   /   /             \     /
-    ---o---o---o---o---o---o---o---o---o---o---o "master"
-
-
-A, B and C are topic branches.
-
- * A has one fix since it was merged up to "next".
-
- * B has finished.  It has been fully merged up to "master" and "next",
-   and is ready to be deleted.
-
- * C has not merged to "next" at all.
-
-We would want to allow C to be rebased, refuse A, and encourage
-B to be deleted.
-
-To compute (1):
-
-	git rev-list ^master ^topic next
-	git rev-list ^master        next
-
-	if these match, topic has not merged in next at all.
-
-To compute (2):
-
-	git rev-list master..topic
-
-	if this is empty, it is fully merged to "master".
-
-DOC_END
removed in remote
  base   100755 a1fd29ec14823d8bc4a8d1a2cfe35451580f5118 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-receive.sample
  our    100755 a1fd29ec14823d8bc4a8d1a2cfe35451580f5118 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/pre-receive.sample
@@ -1,24 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to make use of push options.
-# The example simply echoes all push options that start with 'echoback='
-# and rejects all pushes when the "reject" push option is used.
-#
-# To enable this hook, rename this file to "pre-receive".
-
-if test -n "$GIT_PUSH_OPTION_COUNT"
-then
-	i=0
-	while test "$i" -lt "$GIT_PUSH_OPTION_COUNT"
-	do
-		eval "value=\$GIT_PUSH_OPTION_$i"
-		case "$value" in
-		echoback=*)
-			echo "echo from the pre-receive-hook: ${value#*=}" >&2
-			;;
-		reject)
-			exit 1
-		esac
-		i=$((i + 1))
-	done
-fi
removed in remote
  base   100755 10fa14c5ab0134436e2ae435138bf921eb477c60 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/prepare-commit-msg.sample
  our    100755 10fa14c5ab0134436e2ae435138bf921eb477c60 app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/prepare-commit-msg.sample
@@ -1,42 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to prepare the commit log message.
-# Called by "git commit" with the name of the file that has the
-# commit message, followed by the description of the commit
-# message's source.  The hook's purpose is to edit the commit
-# message file.  If the hook fails with a non-zero status,
-# the commit is aborted.
-#
-# To enable this hook, rename this file to "prepare-commit-msg".
-
-# This hook includes three examples. The first one removes the
-# "# Please enter the commit message..." help message.
-#
-# The second includes the output of "git diff --name-status -r"
-# into the message, just before the "git status" output.  It is
-# commented because it doesn't cope with --amend or with squashed
-# commits.
-#
-# The third example adds a Signed-off-by line to the message, that can
-# still be edited.  This is rarely a good idea.
-
-COMMIT_MSG_FILE=$1
-COMMIT_SOURCE=$2
-SHA1=$3
-
-/usr/bin/perl -i.bak -ne 'print unless(m/^. Please enter the commit message/..m/^#$/)' "$COMMIT_MSG_FILE"
-
-# case "$COMMIT_SOURCE,$SHA1" in
-#  ,|template,)
-#    /usr/bin/perl -i.bak -pe '
-#       print "\n" . `git diff --cached --name-status -r`
-# 	 if /^#/ && $first++ == 0' "$COMMIT_MSG_FILE" ;;
-#  *) ;;
-# esac
-
-# SOB=$(git var GIT_COMMITTER_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
-# git interpret-trailers --in-place --trailer "$SOB" "$COMMIT_MSG_FILE"
-# if test -z "$COMMIT_SOURCE"
-# then
-#   /usr/bin/perl -i.bak -pe 'print "\n" if !$first_line++' "$COMMIT_MSG_FILE"
-# fi
removed in remote
  base   100755 80ba94135cc378364af9d3cb2450df48e51faf2c app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/update.sample
  our    100755 80ba94135cc378364af9d3cb2450df48e51faf2c app/test/fixtures/submodule-basic-setup/_git/modules/foo/submodule/hooks/update.sample
@@ -1,128 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to block unannotated tags from entering.
-# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
-#
-# To enable this hook, rename this file to "update".
-#
-# Config
-# ------
-# hooks.allowunannotated
-#   This boolean sets whether unannotated tags will be allowed into the
-#   repository.  By default they won't be.
-# hooks.allowdeletetag
-#   This boolean sets whether deleting tags will be allowed in the
-#   repository.  By default they won't be.
-# hooks.allowmodifytag
-#   This boolean sets whether a tag may be modified after creation. By default
-#   it won't be.
-# hooks.allowdeletebranch
-#   This boolean sets whether deleting branches will be allowed in the
-#   repository.  By default they won't be.
-# hooks.denycreatebranch
-#   This boolean sets whether remotely creating branches will be denied
-#   in the repository.  By default this is allowed.
-#
-
-# --- Command line
-refname="$1"
-oldrev="$2"
-newrev="$3"
-
-# --- Safety check
-if [ -z "$GIT_DIR" ]; then
-	echo "Don't run this script from the command line." >&2
-	echo " (if you want, you could supply GIT_DIR then run" >&2
-	echo "  $0 <ref> <oldrev> <newrev>)" >&2
-	exit 1
-fi
-
-if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
-	echo "usage: $0 <ref> <oldrev> <newrev>" >&2
-	exit 1
-fi
-
-# --- Config
-allowunannotated=$(git config --bool hooks.allowunannotated)
-allowdeletebranch=$(git config --bool hooks.allowdeletebranch)
-denycreatebranch=$(git config --bool hooks.denycreatebranch)
-allowdeletetag=$(git config --bool hooks.allowdeletetag)
-allowmodifytag=$(git config --bool hooks.allowmodifytag)
-
-# check for no description
-projectdesc=$(sed -e '1q' "$GIT_DIR/description")
-case "$projectdesc" in
-"Unnamed repository"* | "")
-	echo "*** Project description file hasn't been set" >&2
-	exit 1
-	;;
-esac
-
-# --- Check types
-# if $newrev is 0000...0000, it's a commit to delete a ref.
-zero="0000000000000000000000000000000000000000"
-if [ "$newrev" = "$zero" ]; then
-	newrev_type=delete
-else
-	newrev_type=$(git cat-file -t $newrev)
-fi
-
-case "$refname","$newrev_type" in
-	refs/tags/*,commit)
-		# un-annotated tag
-		short_refname=${refname##refs/tags/}
-		if [ "$allowunannotated" != "true" ]; then
-			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
-			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
-			exit 1
-		fi
-		;;
-	refs/tags/*,delete)
-		# delete tag
-		if [ "$allowdeletetag" != "true" ]; then
-			echo "*** Deleting a tag is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/tags/*,tag)
-		# annotated tag
-		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
-		then
-			echo "*** Tag '$refname' already exists." >&2
-			echo "*** Modifying a tag is not allowed in this repository." >&2
-			exit 1
-		fi
-		;;
-	refs/heads/*,commit)
-		# branch
-		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
-			echo "*** Creating a branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/heads/*,delete)
-		# delete branch
-		if [ "$allowdeletebranch" != "true" ]; then
-			echo "*** Deleting a branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/remotes/*,commit)
-		# tracking branch
-		;;
-	refs/remotes/*,delete)
-		# delete tracking branch
-		if [ "$allowdeletebranch" != "true" ]; then
-			echo "*** Deleting a tracking branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	*)
-		# Anything else (is there anything else?)
-		echo "*** Update hook: unknown type of update to ref $refname of type $newrev_type" >&2
-		exit 1
-		;;
-esac
-
-# --- Finished
-exit 0
merged
  result 100644 c6c9857c1f579b979bb63020edfeee5cd8c1c3b2 app/test/helpers/repositories.ts
  our    100644 684c5668ef4b431203378ee88185530b2bb7cf6f app/test/helpers/repositories.ts
@@ -23,7 +23,9 @@
  *
  * @returns The path to the set up fixture repository.
  */
-export function setupFixtureRepository(repositoryName: string): string {
+export async function setupFixtureRepository(
+  repositoryName: string
+): Promise<string> {
   const testRepoFixturePath = Path.join(
     __dirname,
     '..',
@@ -31,9 +33,9 @@
     repositoryName
   )
   const testRepoPath = _temp.mkdirSync('desktop-git-test-')
-  FSE.copySync(testRepoFixturePath, testRepoPath)
+  await FSE.copy(testRepoFixturePath, testRepoPath)

-  FSE.renameSync(
+  await FSE.rename(
     Path.join(testRepoPath, '_git'),
     Path.join(testRepoPath, '.git')
   )
@@ -49,11 +51,11 @@
     entry => Path.basename(entry.path) === '_git'
   )

-  submodules.forEach(entry => {
-    const directory = Path.dirname(entry.path)
+  for (const submodule of submodules) {
+    const directory = Path.dirname(submodule.path)
     const newPath = Path.join(directory, '.git')
-    FSE.renameSync(entry.path, newPath)
-  })
+    await FSE.rename(submodule.path, newPath)
+  }

   return testRepoPath
 }
@@ -84,19 +86,19 @@
   const repo = await setupEmptyRepository()
   const filePath = Path.join(repo.path, 'foo')

-  FSE.writeFileSync(filePath, '')
+  await FSE.writeFile(filePath, '')
   await GitProcess.exec(['add', 'foo'], repo.path)
   await GitProcess.exec(['commit', '-m', 'Commit'], repo.path)

   await GitProcess.exec(['branch', 'other-branch'], repo.path)

-  FSE.writeFileSync(filePath, 'b1')
+  await FSE.writeFile(filePath, 'b1')
   await GitProcess.exec(['add', 'foo'], repo.path)
   await GitProcess.exec(['commit', '-m', 'Commit'], repo.path)

   await GitProcess.exec(['checkout', 'other-branch'], repo.path)

-  FSE.writeFileSync(filePath, 'b2')
+  await FSE.writeFile(filePath, 'b2')
   await GitProcess.exec(['add', 'foo'], repo.path)
   await GitProcess.exec(['commit', '-m', 'Commit'], repo.path)

merged
  result 100644 32e6cc0b6bac7d1adf6b538418ecc086354b1b67 app/test/unit/app-store-test.ts
  our    100644 bd8253abfa8404e42377b4b26ffe52f11269f273 app/test/unit/app-store-test.ts
@@ -1,9 +1,7 @@
-/* eslint-disable no-sync */
-
-import { expect } from 'chai'
+import { expect, AssertionError } from 'chai'

 import * as Path from 'path'
-import * as Fs from 'fs'
+import * as FSE from 'fs-extra'
 import { GitProcess } from 'dugite'

 import {
@@ -30,7 +28,7 @@
 import { StatsStore } from '../../src/lib/stats'

 import {
-  RepositorySection,
+  RepositorySectionTab,
   SelectionType,
   IRepositoryState,
 } from '../../src/lib/app-state'
@@ -91,15 +89,15 @@
   describe('undo first commit', () => {
     function getAppState(appStore: AppStore): IRepositoryState {
       const selectedState = appStore.getState().selectedState
-      if (!selectedState) {
-        throw new chai.AssertionError('No selected state for AppStore')
+      if (selectedState == null) {
+        throw new AssertionError('No selected state for AppStore')
       }

       switch (selectedState.type) {
         case SelectionType.Repository:
           return selectedState.state
         default:
-          throw new chai.AssertionError(
+          throw new AssertionError(
             `Got selected state of type ${
               selectedState.type
             } which is not supported.`
@@ -116,7 +114,7 @@
       const file = 'README.md'
       const filePath = Path.join(repo.path, file)

-      Fs.writeFileSync(filePath, 'SOME WORDS GO HERE\n')
+      await FSE.writeFile(filePath, 'SOME WORDS GO HERE\n')

       await GitProcess.exec(['add', file], repo.path)
       await GitProcess.exec(['commit', '-m', 'added file'], repo.path)
@@ -135,7 +133,7 @@
       await appStore._selectRepository(repository)
       await appStore._changeRepositorySection(
         repository,
-        RepositorySection.Changes
+        RepositorySectionTab.Changes
       )

       let state = getAppState(appStore)
added in remote
  their  100644 3b6e1598c0431836c3eb4416278702dcfb36fc7a app/test/unit/fuzzy-find-test.ts
@@ -0,0 +1,47 @@
+import { expect } from 'chai'
+
+import { match } from '../../src/lib/fuzzy-find'
+import { getText } from '../../src/ui/lib/filter-list'
+describe('fuzzy find', () => {
+  const items = [
+    {
+      id: '300',
+      text: ['add fix for ...', 'opened 5 days ago by bob'],
+    },
+    {
+      id: '500',
+      text: ['add support', '#4653 opened 3 days ago by damaneice '],
+    },
+    {
+      id: '500',
+      text: ['add an awesome feature', '#7564 opened 10 days ago by ... '],
+    },
+  ]
+
+  it('should find matching item when searching by pull request number', () => {
+    const results = match('4653', items, getText)
+
+    expect(results.length).to.equal(1)
+    expect(results[0].item['text'].join('')).to.include('4653')
+  })
+
+  it('should find matching item when searching by author', () => {
+    const results = match('damaneice', items, getText)
+
+    expect(results.length).to.equal(1)
+    expect(results[0].item['text'].join('')).to.include('damaneice')
+  })
+
+  it('should find matching item when by title', () => {
+    const results = match('awesome feature', items, getText)
+
+    expect(results.length).to.equal(1)
+    expect(results[0].item['text'].join('')).to.include('awesome feature')
+  })
+
+  it('should find nothing', () => {
+    const results = match('$%^', items, getText)
+
+    expect(results.length).to.equal(0)
+  })
+})
merged
  result 100644 e02161f0a2678543f55f2c71f1a61103faa56c1b app/test/unit/git-store-test.ts
  our    100644 b69dfb902e2537440f7b72b9537c1de1aaf8b113 app/test/unit/git-store-test.ts
@@ -1,7 +1,5 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'
-import * as Fs from 'fs'
+import * as FSE from 'fs-extra'
 import * as Path from 'path'
 import { GitProcess } from 'dugite'

@@ -26,18 +24,18 @@
     const readmeFile = 'README.md'
     const readmeFilePath = Path.join(repo.path, readmeFile)

-    Fs.writeFileSync(readmeFilePath, 'SOME WORDS GO HERE\n')
+    await FSE.writeFile(readmeFilePath, 'SOME WORDS GO HERE\n')

     const licenseFile = 'LICENSE.md'
     const licenseFilePath = Path.join(repo.path, licenseFile)

-    Fs.writeFileSync(licenseFilePath, 'SOME WORDS GO HERE\n')
+    await FSE.writeFile(licenseFilePath, 'SOME WORDS GO HERE\n')

     // commit the readme file but leave the license
     await GitProcess.exec(['add', readmeFile], repo.path)
     await GitProcess.exec(['commit', '-m', 'added readme file'], repo.path)

-    Fs.writeFileSync(readmeFilePath, 'WRITING SOME NEW WORDS\n')
+    await FSE.writeFile(readmeFilePath, 'WRITING SOME NEW WORDS\n')
     // setup requires knowing about the current tip
     await gitStore.loadStatus()

@@ -65,7 +63,7 @@
     const renamedFile = 'NEW-README.md'
     const filePath = Path.join(repo.path, file)

-    Fs.writeFileSync(filePath, 'SOME WORDS GO HERE\n')
+    await FSE.writeFile(filePath, 'SOME WORDS GO HERE\n')

     // commit the file, and then rename it
     await GitProcess.exec(['add', file], repo.path)
@@ -96,7 +94,7 @@
       const file = 'README.md'
       const filePath = Path.join(repo.path, file)

-      Fs.writeFileSync(filePath, 'SOME WORDS GO HERE\n')
+      await FSE.writeFile(filePath, 'SOME WORDS GO HERE\n')

       await GitProcess.exec(['add', file], repo.path)
       await GitProcess.exec(['commit', '-m', commitMessage], repo.path)
@@ -199,7 +197,7 @@
       const file = 'README.md'
       const filePath = Path.join(repo.path, file)

-      Fs.writeFileSync(filePath, 'SOME WORDS GO HERE\n')
+      await FSE.writeFile(filePath, 'SOME WORDS GO HERE\n')

       let status = await getStatus(repo!)
       let files = status.workingDirectory.files
merged
  result 100644 b8af7e5f1bcd0c13b909dfa237c7d3378bcc683f app/test/unit/git/commit-test.ts
  our    100644 b5ac688e52bb47f381388bb2ae97547c3766deb5 app/test/unit/git/commit-test.ts
@@ -1,6 +1,6 @@
-/* eslint-disable no-sync */
-
 import * as path from 'path'
+import * as FSE from 'fs-extra'
+
 import { expect } from 'chai'

 import { Repository } from '../../../src/models/repository'
@@ -31,8 +31,6 @@
   DiffType,
 } from '../../../src/models/diff'

-import * as fs from 'fs-extra'
-
 async function getTextDiff(
   repo: Repository,
   file: WorkingDirectoryFileChange
@@ -46,13 +44,16 @@
   let repository: Repository | null = null

   beforeEach(async () => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

   describe('createCommit normal', () => {
     it('commits the given files', async () => {
-      fs.writeFileSync(path.join(repository!.path, 'README.md'), 'Hi world\n')
+      await FSE.writeFile(
+        path.join(repository!.path, 'README.md'),
+        'Hi world\n'
+      )

       let status = await getStatus(repository!)
       let files = status.workingDirectory.files
@@ -70,7 +71,10 @@
     })

     it('commit does not strip commentary by default', async () => {
-      fs.writeFileSync(path.join(repository!.path, 'README.md'), 'Hi world\n')
+      await FSE.writeFile(
+        path.join(repository!.path, 'README.md'),
+        'Hi world\n'
+      )

       const status = await getStatus(repository!)
       const files = status.workingDirectory.files
@@ -91,8 +95,8 @@
     it('can commit for empty repository', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
-      fs.writeFileSync(path.join(repo.path, 'bar'), 'bar\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'bar'), 'bar\n')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -124,7 +128,7 @@
     it('can commit renames', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
@@ -147,7 +151,7 @@

   describe('createCommit partials', () => {
     beforeEach(async () => {
-      const testRepoPath = setupFixtureRepository('repo-with-changes')
+      const testRepoPath = await setupFixtureRepository('repo-with-changes')
       repository = new Repository(testRepoPath, -1, null, false)
     })

@@ -383,13 +387,13 @@
     it('can commit renames with modifications', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
       await GitProcess.exec(['mv', 'foo', 'bar'], repo.path)

-      fs.writeFileSync(path.join(repo.path, 'bar'), 'bar\n')
+      await FSE.writeFile(path.join(repo.path, 'bar'), 'bar\n')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -411,13 +415,13 @@
     it('can commit renames with partially selected modifications', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'line1\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'line1\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
       await GitProcess.exec(['mv', 'foo', 'bar'], repo.path)

-      fs.writeFileSync(path.join(repo.path, 'bar'), 'line1\nline2\nline3\n')
+      await FSE.writeFile(path.join(repo.path, 'bar'), 'line1\nline2\nline3\n')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -454,10 +458,12 @@
       const repo = await setupConflictedRepo()
       const filePath = path.join(repo.path, 'foo')

-      const inMerge = fs.existsSync(path.join(repo.path, '.git', 'MERGE_HEAD'))
+      const inMerge = await FSE.pathExists(
+        path.join(repo.path, '.git', 'MERGE_HEAD')
+      )
       expect(inMerge).to.equal(true)

-      fs.writeFileSync(filePath, 'b1b2')
+      await FSE.writeFile(filePath, 'b1b2')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -485,12 +491,12 @@
       const firstPath = path.join(repo.path, 'first')
       const secondPath = path.join(repo.path, 'second')

-      fs.writeFileSync(firstPath, 'line1\n')
-      fs.writeFileSync(secondPath, 'line2\n')
+      await FSE.writeFile(firstPath, 'line1\n')
+      await FSE.writeFile(secondPath, 'line2\n')

       await GitProcess.exec(['add', '.'], repo.path)

-      fs.unlinkSync(firstPath)
+      await FSE.unlink(firstPath)

       status = await getStatus(repo)
       files = status.workingDirectory.files
@@ -519,14 +525,14 @@
       const repo = await setupEmptyRepository()

       const firstPath = path.join(repo.path, 'first')
-      fs.writeFileSync(firstPath, 'line1\n')
+      await FSE.writeFile(firstPath, 'line1\n')

       await GitProcess.exec(['add', 'first'], repo.path)
       await GitProcess.exec(['commit', '-am', 'commit first file'], repo.path)
       await GitProcess.exec(['rm', '--cached', 'first'], repo.path)

       // if the text is now different, everything is fine
-      fs.writeFileSync(firstPath, 'line2\n')
+      await FSE.writeFile(firstPath, 'line2\n')

       status = await getStatus(repo)
       files = status.workingDirectory.files
merged
  result 100644 d72e598b34da70f1894844dffc261776e7134a67 app/test/unit/git/config-test.ts
  our    100644 15317f86c3ba7276aff4b60a3953977a2faeb366 app/test/unit/git/config-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import { Repository } from '../../../src/models/repository'
@@ -15,8 +13,8 @@
 describe('git/config', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

merged
  result 100644 9102d54e4ff407253f9f43fc45f7947c8e9bd28f app/test/unit/git/core-test.ts
  our    100644 31f49752ce15852eb636a19c18f289d48fa9e745 app/test/unit/git/core-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'
 import { GitError } from 'dugite'

@@ -10,8 +8,8 @@
 describe('git/core', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

added in remote
  their  100644 1ed66bd68f5c8720ca2034726118003654d19391 app/test/unit/git/description-test.ts
@@ -0,0 +1,35 @@
+import { expect } from 'chai'
+import * as FSE from 'fs-extra'
+import * as Path from 'path'
+
+import { getGitDescription } from '../../../src/lib/git'
+import { setupEmptyRepository } from '../../helpers/repositories'
+
+describe('git/description', () => {
+  describe('getGitDescription', () => {
+    it('returns empty for an initialized repository', async () => {
+      const repo = await setupEmptyRepository()
+      const actual = await getGitDescription(repo.path)
+      expect(actual).equals('')
+    })
+
+    it('returns empty when path is missing', async () => {
+      const repo = await setupEmptyRepository()
+      const path = Path.join(repo.path, '.git', 'description')
+      await FSE.unlink(path)
+
+      const actual = await getGitDescription(repo.path)
+      expect(actual).equals('')
+    })
+
+    it('reads the custom text', async () => {
+      const expected = 'this is a repository description'
+      const repo = await setupEmptyRepository()
+      const path = Path.join(repo.path, '.git', 'description')
+      await FSE.writeFile(path, expected)
+
+      const actual = await getGitDescription(repo.path)
+      expect(actual).equals(expected)
+    })
+  })
+})
merged
  result 100644 70828b75f4fb7701c613f210cfcd5a077c1e6160 app/test/unit/git/diff-test.ts
  our    100644 e51e778ec9c2cf88a9eeed5a4b7201e8ddbca64f app/test/unit/git/diff-test.ts
@@ -1,9 +1,7 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import * as path from 'path'
-import * as fs from 'fs-extra'
+import * as FSE from 'fs-extra'

 import { Repository } from '../../../src/models/repository'
 import {
@@ -43,8 +41,8 @@
 describe('git/diff', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('repo-with-image-changes')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('repo-with-image-changes')
     repository = new Repository(testRepoPath, -1, null, false)
   })

@@ -135,7 +133,7 @@
     })

     it('changes for text are not set', async () => {
-      const testRepoPath = setupFixtureRepository('repo-with-changes')
+      const testRepoPath = await setupFixtureRepository('repo-with-changes')
       repository = new Repository(testRepoPath, -1, null, false)

       const diffSelection = DiffSelection.fromInitialSelection(
@@ -153,8 +151,8 @@
   })

   describe('getWorkingDirectoryDiff', () => {
-    beforeEach(() => {
-      const testRepoPath = setupFixtureRepository('repo-with-changes')
+    beforeEach(async () => {
+      const testRepoPath = await setupFixtureRepository('repo-with-changes')
       repository = new Repository(testRepoPath, -1, null, false)
     })

@@ -260,7 +258,7 @@
     it('is empty for a renamed file', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
@@ -283,13 +281,13 @@
     it('only shows modifications after move for a renamed and modified file', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
       await GitProcess.exec(['mv', 'foo', 'bar'], repo.path)

-      fs.writeFileSync(path.join(repo.path, 'bar'), 'bar\n')
+      await FSE.writeFile(path.join(repo.path, 'bar'), 'bar\n')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -309,11 +307,14 @@
     it('handles unborn repository with mixed state', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'WRITING THE FIRST LINE\n')
+      await FSE.writeFile(
+        path.join(repo.path, 'foo'),
+        'WRITING THE FIRST LINE\n'
+      )

       await GitProcess.exec(['add', 'foo'], repo.path)

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'WRITING OVER THE TOP\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'WRITING OVER THE TOP\n')

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
@@ -337,7 +338,7 @@

       let lineEnding = '\r\n'

-      fs.writeFileSync(
+      await FSE.writeFile(
         filePath,
         `WRITING MANY LINES ${lineEnding} USING THIS LINE ENDING ${lineEnding} TO SHOW THAT GIT${lineEnding} WILL INSERT IT WITHOUT CHANGING THING ${lineEnding} HA HA BUSINESS`
       )
@@ -351,7 +352,7 @@
       await GitProcess.exec(['config', 'core.autocrlf', 'true'], repo.path)
       lineEnding = '\n\n'

-      fs.writeFileSync(
+      await FSE.writeFile(
         filePath,
         `WRITING MANY LINES ${lineEnding} USING THIS LINE ENDING ${lineEnding} TO SHOW THAT GIT${lineEnding} WILL INSERT IT WITHOUT CHANGING THING ${lineEnding} HA HA BUSINESS`
       )
@@ -375,7 +376,7 @@
       const filePath = path.join(repo.path, 'foo')

       const testString = 'here are some cool characters: ‚Ä¢ √©  Êº¢Â≠ó'
-      fs.writeFileSync(filePath, testString)
+      await FSE.writeFile(filePath, testString)

       const status = await getStatus(repo)
       const files = status.workingDirectory.files
merged
  result 100644 49b5c229ff03e3bb85d45773693b29bcf664cfa0 app/test/unit/git/for-each-ref-test.ts
  our    100644 489ff8c45295f4effd89131fe26c32b9caeb4686 app/test/unit/git/for-each-ref-test.ts
@@ -10,8 +10,8 @@
 describe('git/for-each-ref', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('repo-with-many-refs')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('repo-with-many-refs')
     repository = new Repository(testRepoPath, -1, null, false)
   })

added in remote
  their  100644 efa84e67645f24f1b4905d9815b78c84b1debcb5 app/test/unit/git/git-attributes-test.ts
@@ -0,0 +1,18 @@
+import { expect } from 'chai'
+import * as FSE from 'fs-extra'
+import * as Path from 'path'
+
+import { setupEmptyRepository } from '../../helpers/repositories'
+import { writeGitAttributes } from '../../../src/ui/add-repository/git-attributes'
+
+describe('git/git-attributes', () => {
+  describe('writeGitAttributes', () => {
+    it('initializes a .gitattributes file', async () => {
+      const repo = await setupEmptyRepository()
+      await writeGitAttributes(repo.path)
+      const expectedPath = Path.join(repo.path, '.gitattributes')
+      const contents = await FSE.readFile(expectedPath, 'utf8')
+      expect(contents).to.contain('* text=auto')
+    })
+  })
+})
merged
  result 100644 4b5b3f160a0264cf66886c0aa339b1fad38181b1 app/test/unit/git/log-test.ts
  our    100644 ad903fd317c8097f5cb62d13f559c282be3f0e55 app/test/unit/git/log-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import { Repository } from '../../../src/models/repository'
@@ -11,8 +9,8 @@
 describe('git/log', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

@@ -48,7 +46,9 @@
     })

     it('detects renames', async () => {
-      const testRepoPath = setupFixtureRepository('rename-history-detection')
+      const testRepoPath = await setupFixtureRepository(
+        'rename-history-detection'
+      )
       repository = new Repository(testRepoPath, -1, null, false)

       const first = await getChangedFiles(repository, '55bdecb')
@@ -65,7 +65,9 @@
     })

     it('detect copies', async () => {
-      const testRepoPath = setupFixtureRepository('copies-history-detection')
+      const testRepoPath = await setupFixtureRepository(
+        'copies-history-detection'
+      )
       repository = new Repository(testRepoPath, -1, null, false)

       // ensure the test repository is configured to detect copies
merged
  result 100644 26ef5a516cc51061106a84706a4b53aba7a4bae5 app/test/unit/git/reflog-test.ts
  our    100644 753f89bdff58df67c59ada62fd5318e25de1f0c9 app/test/unit/git/reflog-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import { Repository } from '../../../src/models/repository'
@@ -28,8 +26,8 @@
 describe('git/reflog', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

merged
  result 100644 ec4c2f0abae62b3b2e24b3d1f8d4c026202866ae app/test/unit/git/remote-test.ts
  our    100644 0c31a4654bc26c2af1888154faf1ed1c5b074f9e app/test/unit/git/remote-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import { Repository } from '../../../src/models/repository'
@@ -17,7 +15,9 @@
 describe('git/remote', () => {
   describe('getRemotes', () => {
     it('should return both remotes', async () => {
-      const testRepoPath = setupFixtureRepository('repo-with-multiple-remotes')
+      const testRepoPath = await setupFixtureRepository(
+        'repo-with-multiple-remotes'
+      )
       const repository = new Repository(testRepoPath, -1, null, false)

       // NB: We don't check for exact URL equality because CircleCI's git config
@@ -36,7 +36,9 @@

   describe('getDefaultRemote', () => {
     it('returns origin when multiple remotes found', async () => {
-      const testRepoPath = setupFixtureRepository('repo-with-multiple-remotes')
+      const testRepoPath = await setupFixtureRepository(
+        'repo-with-multiple-remotes'
+      )
       const repository = new Repository(testRepoPath, -1, null, false)

       const result = await getDefaultRemote(repository)
@@ -45,7 +47,9 @@
     })

     it('returns something when origin removed', async () => {
-      const testRepoPath = setupFixtureRepository('repo-with-multiple-remotes')
+      const testRepoPath = await setupFixtureRepository(
+        'repo-with-multiple-remotes'
+      )
       const repository = new Repository(testRepoPath, -1, null, false)
       await removeRemote(repository, 'origin')

merged
  result 100644 ae434a7ebf90e34582704265a7bee208e3ee30e1 app/test/unit/git/reset-test.ts
  our    100644 de0b8ecb1767d94f933eb81fdb46f8030e0ed0d1 app/test/unit/git/reset-test.ts
@@ -1,5 +1,3 @@
-/* eslint-disable no-sync */
-
 import * as path from 'path'
 import { expect } from 'chai'

@@ -9,13 +7,13 @@
 import { setupFixtureRepository } from '../../helpers/repositories'
 import { GitProcess } from 'dugite'

-import * as fs from 'fs-extra'
+import * as FSE from 'fs-extra'

 describe('git/reset', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

@@ -25,7 +23,7 @@
       const fileName = 'README.md'
       const filePath = path.join(repoPath, fileName)

-      fs.writeFileSync(filePath, 'Hi world\n')
+      await FSE.writeFile(filePath, 'Hi world\n')

       await reset(repository!, GitResetMode.Hard, 'HEAD')

@@ -35,17 +33,17 @@
   })

   describe('resetPaths', () => {
-    it('resets discarded staged file', async () => {
+    it.skip('resets discarded staged file', async () => {
       const repoPath = repository!.path
       const fileName = 'README.md'
       const filePath = path.join(repoPath, fileName)

       // modify the file
-      fs.writeFileSync(filePath, 'Hi world\n')
+      await FSE.writeFile(filePath, 'Hi world\n')

       // stage the file, then delete it to mimic discarding
       GitProcess.exec(['add', fileName], repoPath)
-      fs.unlinkSync(filePath)
+      await FSE.unlink(filePath)

       await resetPaths(repository!, GitResetMode.Mixed, 'HEAD', [filePath])

merged
  result 100644 9f59f8eafa96145f5a0182713ae312a61d5633c6 app/test/unit/git/rev-parse-test.ts
  our    100644 2fe66109a93a488e1d52f361aa11b5fd03ab6c4d app/test/unit/git/rev-parse-test.ts
@@ -1,7 +1,5 @@
-/* eslint-disable no-sync */
-
 import * as path from 'path'
-import * as Fs from 'fs'
+import * as FSE from 'fs-extra'
 import * as os from 'os'
 import { expect } from 'chai'

@@ -16,8 +14,8 @@
 describe('git/rev-parse', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

@@ -39,10 +37,7 @@
       expect(result).to.equal(repository!.path)

       const subdirPath = path.join(repository!.path, 'subdir')
-
-      await new Promise<void>((resolve, reject) => {
-        Fs.mkdir(subdirPath, e => (e ? reject(e) : resolve()))
-      })
+      await FSE.mkdir(subdirPath)

       const subDirResult = await getTopLevelWorkingDirectory(repository!.path)
       expect(subDirResult).to.equal(repository!.path)
merged
  result 100644 b70094de837ed6cb2305e65414cd7c4c3403edc0 app/test/unit/git/status-test.ts
  our    100644 59e49a131e79925c8b8307125053a59d2970ba4e app/test/unit/git/status-test.ts
@@ -1,7 +1,7 @@
-/* eslint-disable no-sync */
-
 import * as path from 'path'
 import { expect } from 'chai'
+import * as FSE from 'fs-extra'
+import { GitProcess } from 'dugite'

 import { Repository } from '../../../src/models/repository'
 import { getStatus } from '../../../src/lib/git/status'
@@ -10,21 +10,21 @@
   setupEmptyRepository,
 } from '../../helpers/repositories'
 import { AppFileStatus } from '../../../src/models/status'
-import { GitProcess } from 'dugite'
-
-import * as fs from 'fs-extra'

 describe('git/status', () => {
   let repository: Repository | null = null

-  beforeEach(() => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+  beforeEach(async () => {
+    const testRepoPath = await setupFixtureRepository('test-repo')
     repository = new Repository(testRepoPath, -1, null, false)
   })

   describe('getStatus', () => {
     it('parses changed files', async () => {
-      fs.writeFileSync(path.join(repository!.path, 'README.md'), 'Hi world\n')
+      await FSE.writeFile(
+        path.join(repository!.path, 'README.md'),
+        'Hi world\n'
+      )

       const status = await getStatus(repository!)
       const files = status.workingDirectory.files
@@ -44,7 +44,7 @@
     it('reflects renames', async () => {
       const repo = await setupEmptyRepository()

-      fs.writeFileSync(path.join(repo.path, 'foo'), 'foo\n')
+      await FSE.writeFile(path.join(repo.path, 'foo'), 'foo\n')

       await GitProcess.exec(['add', 'foo'], repo.path)
       await GitProcess.exec(['commit', '-m', 'Initial commit'], repo.path)
merged
  result 100644 458f70ab3e9d3c2a72710726ed0ccf67f9644e7c app/test/unit/git/submodule-test.ts
  our    100644 c03c4406fbdfec1ca3d327273d6fa3bf9fe4c17d app/test/unit/git/submodule-test.ts
@@ -12,7 +12,7 @@
 describe('git/submodule', () => {
   describe('listSubmodules', () => {
     it('returns the submodule entry', async () => {
-      const testRepoPath = setupFixtureRepository('submodule-basic-setup')
+      const testRepoPath = await setupFixtureRepository('submodule-basic-setup')
       const repository = new Repository(testRepoPath, -1, null, false)
       const result = await listSubmodules(repository)
       expect(result.length).to.equal(1)
@@ -22,7 +22,7 @@
     })

     it('returns the expected tag', async () => {
-      const testRepoPath = setupFixtureRepository('submodule-basic-setup')
+      const testRepoPath = await setupFixtureRepository('submodule-basic-setup')
       const repository = new Repository(testRepoPath, -1, null, false)

       const submodulePath = path.join(testRepoPath, 'foo', 'submodule')
@@ -49,7 +49,7 @@

   describe('resetSubmodulePaths', () => {
     it('update submodule to original commit', async () => {
-      const testRepoPath = setupFixtureRepository('submodule-basic-setup')
+      const testRepoPath = await setupFixtureRepository('submodule-basic-setup')
       const repository = new Repository(testRepoPath, -1, null, false)

       const submodulePath = path.join(testRepoPath, 'foo', 'submodule')
added in remote
  their  100644 b4f8bad4223c7ca09f796baa5b5bcc5da2d75cac app/test/unit/infer-comparison-branch-test.ts
@@ -0,0 +1,205 @@
+import { expect } from 'chai'
+import { inferComparisonBranch } from '../../src/lib/stores/helpers/infer-comparison-branch'
+import { Branch, BranchType } from '../../src/models/branch'
+import { Commit } from '../../src/models/commit'
+import { CommitIdentity } from '../../src/models/commit-identity'
+import { GitHubRepository } from '../../src/models/github-repository'
+import { Owner } from '../../src/models/owner'
+import { PullRequest, PullRequestRef } from '../../src/models/pull-request'
+import { Repository } from '../../src/models/repository'
+import { IRemote } from '../../src/models/remote'
+import { ComparisonCache } from '../../src/lib/comparison-cache'
+
+function createTestCommit(sha: string) {
+  return new Commit(
+    sha,
+    '',
+    '',
+    new CommitIdentity('tester', 'tester@test.com', new Date()),
+    new CommitIdentity('tester', 'tester@test.com', new Date()),
+    [],
+    []
+  )
+}
+
+function createTestBranch(
+  name: string,
+  sha: string,
+  remote: string | null = null
+) {
+  return new Branch(name, remote, createTestCommit(sha), BranchType.Local)
+}
+
+function createTestGhRepo(
+  name: string,
+  defaultBranch: string | null = null,
+  parent: GitHubRepository | null = null
+) {
+  return new GitHubRepository(
+    name,
+    new Owner('', '', null),
+    null,
+    false,
+    '',
+    `${
+      defaultBranch !== null && defaultBranch.indexOf('/') !== -1
+        ? defaultBranch.split('/')[1]
+        : defaultBranch
+    }`,
+    `${name.indexOf('/') !== -1 ? name.split('/')[1] : name}.git`,
+    parent
+  )
+}
+
+function createTestPrRef(
+  branch: Branch,
+  ghRepo: GitHubRepository | null = null
+) {
+  return new PullRequestRef(branch.name, branch.tip.sha, ghRepo)
+}
+
+function createTestPr(head: PullRequestRef, base: PullRequestRef) {
+  return new PullRequest(-1, new Date(), null, '', 1, head, base, '')
+}
+
+function createTestRepo(ghRepo: GitHubRepository | null = null) {
+  return new Repository('', -1, ghRepo, false)
+}
+
+function mockGetRemotes(repo: Repository): Promise<ReadonlyArray<IRemote>> {
+  return Promise.resolve([])
+}
+
+describe('inferComparisonBranch', () => {
+  const branches = [
+    createTestBranch('master', '0', 'origin'),
+    createTestBranch('dev', '1', 'origin'),
+    createTestBranch('staging', '2', 'origin'),
+    createTestBranch('default', '3', 'origin'),
+    createTestBranch('head', '4', 'origin'),
+    createTestBranch('upstream/base', '5', 'upstream'),
+    createTestBranch('fork', '6', 'origin'),
+  ]
+  const comparisonCache = new ComparisonCache()
+
+  beforeEach(() => {
+    comparisonCache.clear()
+  })
+
+  it('Returns the master branch when given unhosted repo', async () => {
+    const repo = createTestRepo()
+    const branch = await inferComparisonBranch(
+      repo,
+      branches,
+      null,
+      null,
+      mockGetRemotes,
+      comparisonCache
+    )
+
+    expect(branch).is.not.null
+    expect(branch!.tip.sha).to.equal('0')
+  })
+
+  it('Returns the default branch of a GitHub repository', async () => {
+    const ghRepo: GitHubRepository = createTestGhRepo('test', 'default')
+    const repo = createTestRepo(ghRepo)
+
+    const branch = await inferComparisonBranch(
+      repo,
+      branches,
+      null,
+      null,
+      mockGetRemotes,
+      comparisonCache
+    )
+
+    expect(branch).is.not.null
+    expect(branch!.name).to.equal('default')
+  })
+
+  it('Returns the branch associated with the PR', async () => {
+    const ghRepo: GitHubRepository = createTestGhRepo('test', 'default')
+    const repo = createTestRepo(ghRepo)
+    const head = createTestPrRef(branches[4])
+    const base = createTestPrRef(branches[5])
+    const pr: PullRequest = createTestPr(head, base)
+
+    const branch = await inferComparisonBranch(
+      repo,
+      branches,
+      pr,
+      null,
+      mockGetRemotes,
+      comparisonCache
+    )
+
+    expect(branch).is.not.null
+    expect(branch!.upstream).to.equal(branches[5].upstream)
+  })
+
+  it('Returns the default branch of the fork if it is ahead of the current branch', async () => {
+    const currentBranch = branches[3]
+    const defaultBranch = branches[6]
+    const parent = createTestGhRepo('parent', 'parent')
+    const fork = createTestGhRepo('fork', 'fork', parent)
+    const repo = createTestRepo(fork)
+
+    comparisonCache.set(currentBranch.tip.sha, defaultBranch.tip.sha, {
+      ahead: 1,
+      behind: 0,
+    })
+
+    const branch = await inferComparisonBranch(
+      repo,
+      branches,
+      null,
+      currentBranch,
+      mockGetRemotes,
+      comparisonCache
+    )
+
+    expect(branch).is.not.null
+    expect(branch!.name).to.equal(defaultBranch.name)
+  })
+
+  it("Returns the default branch of the fork's parent branch if the fork is not ahead of the current branch", async () => {
+    const defaultBranchOfParent = branches[5]
+    const defaultBranchOfFork = branches[4]
+    const parent = createTestGhRepo(
+      'parent',
+      defaultBranchOfParent.nameWithoutRemote
+    )
+    const fork = createTestGhRepo('fork', defaultBranchOfFork.name, parent)
+    const repo = createTestRepo(fork)
+    const mockGetRemotes = (repo: Repository) => {
+      const remotes: ReadonlyArray<IRemote> = [
+        { name: 'origin', url: fork.cloneURL! },
+        { name: 'upstream', url: parent.cloneURL! },
+      ]
+
+      return Promise.resolve(remotes)
+    }
+
+    comparisonCache.set(
+      defaultBranchOfParent.tip.sha,
+      defaultBranchOfFork.tip.sha,
+      {
+        ahead: 0,
+        behind: 0,
+      }
+    )
+
+    const branch = await inferComparisonBranch(
+      repo,
+      branches,
+      null,
+      defaultBranchOfParent,
+      mockGetRemotes,
+      comparisonCache
+    )
+
+    expect(branch).is.not.null
+    expect(branch!.upstream).to.equal(defaultBranchOfParent.upstream)
+  })
+})
added in remote
  their  100644 dcebafa9c3051466b9d3347eb6ae9d827c796b0d app/test/unit/list-selection-test.ts
@@ -0,0 +1,52 @@
+import { expect } from 'chai'
+
+import { findNextSelectableRow } from '../../src/ui/lib/list/selection'
+
+describe('list-selection', () => {
+  describe('findNextSelectableRow', () => {
+    const rowCount = 5
+
+    it('returns first row when selecting down outside list (filter text)', () => {
+      const selectedRow = findNextSelectableRow(rowCount, {
+        direction: 'down',
+        row: -1,
+      })
+      expect(selectedRow).to.equal(0)
+    })
+
+    it('returns first selectable row when header is first', () => {
+      const selectedRow = findNextSelectableRow(
+        rowCount,
+        {
+          direction: 'down',
+          row: -1,
+        },
+        row => {
+          if (row === 0) {
+            return false
+          } else {
+            return true
+          }
+        }
+      )
+      expect(selectedRow).to.equal(1)
+    })
+
+    it('returns first row when selecting down from last row', () => {
+      const lastRow = rowCount - 1
+      const selectedRow = findNextSelectableRow(rowCount, {
+        direction: 'down',
+        row: lastRow,
+      })
+      expect(selectedRow).to.equal(0)
+    })
+
+    it('returns last row when selecting up from top row', () => {
+      const selectedRow = findNextSelectableRow(rowCount, {
+        direction: 'up',
+        row: 0,
+      })
+      expect(selectedRow).to.equal(4)
+    })
+  })
+})
merged
  result 100644 c0b463a119f370007a15b53596eef661434e881a app/test/unit/patch-formatter-test.ts
  our    100644 6a71395ab06843a86f54daca408878c6e8c603c6 app/test/unit/patch-formatter-test.ts
@@ -1,9 +1,7 @@
-/* eslint-disable no-sync */
-
 import { expect } from 'chai'

 import * as Path from 'path'
-import * as FS from 'fs'
+import * as FSE from 'fs-extra'

 import { Repository } from '../../src/models/repository'
 import {
@@ -36,8 +34,8 @@
   let repository: Repository | null = null

   describe('formatPatchesForModifiedFile', () => {
-    beforeEach(() => {
-      const testRepoPath = setupFixtureRepository('repo-with-changes')
+    beforeEach(async () => {
+      const testRepoPath = await setupFixtureRepository('repo-with-changes')
       repository = new Repository(testRepoPath, -1, null, false)
     })

@@ -161,7 +159,7 @@

     it(`creates the right patch when an addition is selected but preceding deletions aren't`, async () => {
       const modifiedFile = 'modified-file.md'
-      FS.writeFileSync(Path.join(repository!.path, modifiedFile), 'line 1\n')
+      await FSE.writeFile(Path.join(repository!.path, modifiedFile), 'line 1\n')

       const unselectedFile = DiffSelection.fromInitialSelection(
         DiffSelectionType.None
merged
  result 100644 9cbf74cc7f09f42177a0ffa21b8dadf6a5cb408e app/test/unit/progress/clone-test.ts
  our    100644 7c54590d069085e654f33a1d2d57765c2bf0cf0a app/test/unit/progress/clone-test.ts
@@ -36,21 +36,21 @@
         'remote: Compressing objects:  45% (10/22)'
       )
       expect(compressing.kind).to.equal('progress')
-      expect(compressing.percent).to.be.closeTo(10 / 22 * 0.1, 0.01)
+      expect(compressing.percent).to.be.closeTo((10 / 22) * 0.1, 0.01)

       const receiving = parser.parse(
         'Receiving objects:  17% (4808/28282), 3.30 MiB | 1.29 MiB/s'
       )
       expect(receiving.kind).to.equal('progress')
-      expect(receiving.percent).to.be.closeTo(0.1 + 4808 / 28282 * 0.6, 0.01)
+      expect(receiving.percent).to.be.closeTo(0.1 + (4808 / 28282) * 0.6, 0.01)

       const resolving = parser.parse('Resolving deltas:  89% (18063/20263)')
       expect(resolving.kind).to.equal('progress')
-      expect(resolving.percent).to.be.closeTo(0.7 + 18063 / 20263 * 0.1, 0.01)
+      expect(resolving.percent).to.be.closeTo(0.7 + (18063 / 20263) * 0.1, 0.01)

       const checkingOut = parser.parse('Checking out files: 100% (579/579)')
       expect(checkingOut.kind).to.equal('progress')
-      expect(checkingOut.percent).to.be.closeTo(0.8 + 579 / 579 * 0.2, 0.01)
+      expect(checkingOut.percent).to.be.closeTo(0.8 + (579 / 579) * 0.2, 0.01)
     })

     it('ignores wrong order', () => {
added in remote
  their  100644 1e72cf509cf524cdf0acea77b04f2bd6298fc33e app/test/unit/pull-request-status-test.ts
@@ -0,0 +1,91 @@
+import { expect } from 'chai'
+
+import { APIRefState } from '../../src/lib/api'
+import { getPRStatusSummary } from '../../src/ui/branches/pull-request-status'
+
+const failure: APIRefState = 'failure'
+const pending: APIRefState = 'pending'
+const success: APIRefState = 'success'
+
+describe('pull request status', () => {
+  it('uses the state when no statuses found', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: success,
+      totalCount: 0,
+      sha: '',
+      statuses: [],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal('Commit status: success')
+  })
+
+  it('changes the failure message to something more friendly', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: failure,
+      totalCount: 0,
+      sha: '',
+      statuses: [],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal('Commit status: failed')
+  })
+
+  it('reads the statuses when they are populated', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: success,
+      totalCount: 2,
+      sha: '',
+      statuses: [
+        { id: 1, state: success, description: 'first' },
+        { id: 2, state: success, description: 'second' },
+      ],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal('2/2 checks OK')
+  })
+
+  it('a successful status shows the description', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: success,
+      totalCount: 2,
+      sha: '',
+      statuses: [
+        { id: 1, state: success, description: 'The Travis CI build passed' },
+      ],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal(
+      'Success: The Travis CI build passed'
+    )
+  })
+
+  it('an error status shows the description', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: success,
+      totalCount: 2,
+      sha: '',
+      statuses: [
+        { id: 1, state: failure, description: 'The Travis CI build failed' },
+      ],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal(
+      'Failure: The Travis CI build failed'
+    )
+  })
+
+  it('only counts the successful statuses', () => {
+    const prStatus = {
+      pullRequestNumber: 23,
+      state: success,
+      totalCount: 3,
+      sha: '',
+      statuses: [
+        { id: 1, state: success, description: 'first' },
+        { id: 2, state: pending, description: 'second' },
+        { id: 2, state: pending, description: 'third' },
+      ],
+    }
+    expect(getPRStatusSummary(prStatus)).to.equal('1/3 checks OK')
+  })
+})
merged
  result 100644 8c3c9ac4c1b7875569c8d7d44dec79ca7047423d app/test/unit/repositories-list-grouping-test.ts
  our    100644 8c87f50afeab077a2eec435baab02e4db2417b4f app/test/unit/repositories-list-grouping-test.ts
@@ -1,7 +1,7 @@
 import { expect } from 'chai'

 import { groupRepositories } from '../../src/ui/repositories-list/group-repositories'
-import { Repository } from '../../src/models/repository'
+import { Repository, ILocalRepositoryState } from '../../src/models/repository'
 import { GitHubRepository } from '../../src/models/github-repository'
 import { Owner } from '../../src/models/owner'
 import { getDotComAPIEndpoint } from '../../src/lib/api'
@@ -28,8 +28,10 @@
     ),
   ]

+  const cache = new Map<number, ILocalRepositoryState>()
+
   it('groups repositories by GitHub/Enterprise/Other', () => {
-    const grouped = groupRepositories(repositories)
+    const grouped = groupRepositories(repositories, cache)
     expect(grouped.length).to.equal(3)

     expect(grouped[0].identifier).to.equal('github')
@@ -68,7 +70,10 @@
     )
     const repoZ = new Repository('z', 3, null, false)

-    const grouped = groupRepositories([repoC, repoB, repoZ, repoD, repoA])
+    const grouped = groupRepositories(
+      [repoC, repoB, repoZ, repoD, repoA],
+      cache
+    )
     expect(grouped.length).to.equal(2)

     expect(grouped[0].identifier).to.equal('github')
@@ -119,20 +124,20 @@
       false
     )

-    const grouped = groupRepositories([repoA, repoB, repoC])
+    const grouped = groupRepositories([repoA, repoB, repoC], cache)
     expect(grouped.length).to.equal(1)

     expect(grouped[0].identifier).to.equal('github')
     expect(grouped[0].items.length).to.equal(3)

     const items = grouped[0].items
-    expect(items[0].text).to.equal('cool-repo')
+    expect(items[0].text[0]).to.equal('cool-repo')
     expect(items[0].needsDisambiguation).to.equal(false)

-    expect(items[1].text).to.equal('repo')
+    expect(items[1].text[0]).to.equal('repo')
     expect(items[1].needsDisambiguation).to.equal(true)

-    expect(items[2].text).to.equal('repo')
+    expect(items[2].text[0]).to.equal('repo')
     expect(items[2].needsDisambiguation).to.equal(true)
   })
 })
merged
  result 100644 2500924fc3357ff64eb65408ada24ec216b734ef app/test/unit/repository-settings-store-test.ts
  our    100644 a0af361ddcda5e966fcae87cfe23274833ff3095 app/test/unit/repository-settings-store-test.ts
@@ -1,6 +1,4 @@
-/* eslint-disable no-sync */
-
-import * as FS from 'fs'
+import * as FSE from 'fs-extra'
 import * as Path from 'path'
 import { GitProcess } from 'dugite'
 import { expect } from 'chai'
@@ -8,7 +6,6 @@
 import { RepositorySettingsStore } from '../../src/lib/stores'
 import { setupEmptyRepository } from '../helpers/repositories'
 import { getStatus } from '../../src/lib/git'
-import { pathExists } from '../../src/lib/file-system'

 describe('RepositorySettingsStore', () => {
   it('can create a gitignore file', async () => {
@@ -20,7 +17,7 @@
     await sut.saveGitIgnore('node_modules\n')

     // Make sure file exists on FS
-    const exists = await pathExists(`${path}/.gitignore`)
+    const exists = await FSE.pathExists(`${path}/.gitignore`)

     expect(exists).is.true
   })
@@ -30,14 +27,14 @@
     const path = repo.path

     const ignoreFile = `${path}/.gitignore`
-    FS.writeFileSync(ignoreFile, 'node_modules\n')
+    await FSE.writeFile(ignoreFile, 'node_modules\n')

     const sut = new RepositorySettingsStore(repo)

     // update gitignore file to be empty
     await sut.saveGitIgnore('')

-    const exists = await pathExists(ignoreFile)
+    const exists = await FSE.pathExists(ignoreFile)
     expect(exists).is.false
   })

@@ -54,7 +51,7 @@
     // Create a txt file
     const file = Path.join(repo.path, 'a.txt')

-    FS.writeFileSync(file, 'thrvbnmerkl;,iuw')
+    await FSE.writeFile(file, 'thrvbnmerkl;,iuw')

     // Check status of repo
     const status = await getStatus(repo)
merged
  result 100644 133e5af7e5501c236aeb4c8601f36046ad052609 app/test/unit/repository-test.ts
  our    100644 1d0e7171ba217432250ae87d691596276db579e9 app/test/unit/repository-test.ts
@@ -9,5 +9,11 @@
       const repository = new Repository(repoPath, -1, null, false)
       expect(repository.name).to.equal('path')
     })
+
+    it('handles repository at root of the drive', async () => {
+      const repoPath = 'T:\\'
+      const repository = new Repository(repoPath, -1, null, false)
+      expect(repository.name).to.equal('T:\\')
+    })
   })
 })
merged
  result 100644 bbcf0ab0fd2e7a0f0528335e7a18a965fb1a464b app/test/unit/validated-repository-path-test.ts
  our    100644 a8625f261275cbe39f142f52e51de14e1b1619fb app/test/unit/validated-repository-path-test.ts
@@ -7,7 +7,7 @@

 describe('validatedRepositoryPath', () => {
   it('returns the path to the repository', async () => {
-    const testRepoPath = setupFixtureRepository('test-repo')
+    const testRepoPath = await setupFixtureRepository('test-repo')
     const result = await validatedRepositoryPath(testRepoPath)
     expect(result).to.equal(testRepoPath)
   })
removed in remote
  base   100644 20da10ea8edc60b7201685b8ce2659593bc0dc0a app/webpack.common.js
  our    100644 20da10ea8edc60b7201685b8ce2659593bc0dc0a app/webpack.common.js
@@ -1,205 +0,0 @@
-'use strict'
-
-const path = require('path')
-const Fs = require('fs')
-const HtmlWebpackPlugin = require('html-webpack-plugin')
-const CleanWebpackPlugin = require('clean-webpack-plugin')
-const webpack = require('webpack')
-const merge = require('webpack-merge')
-const appInfo = require('./app-info')
-const packageInfo = require('./package-info')
-const distInfo = require('../script/dist-info')
-
-const channel = distInfo.getReleaseChannel()
-
-const externals = ['7zip']
-if (channel === 'development') {
-  externals.push('devtron')
-}
-
-const outputDir = 'out'
-const replacements = appInfo.getReplacements()
-
-const commonConfig = {
-  externals: externals,
-  output: {
-    filename: '[name].js',
-    path: path.resolve(__dirname, '..', outputDir),
-    libraryTarget: 'commonjs2',
-  },
-  module: {
-    rules: [
-      {
-        test: /\.tsx?$/,
-        include: path.resolve(__dirname, 'src'),
-        use: [
-          {
-            loader: 'awesome-typescript-loader',
-            options: {
-              useBabel: true,
-              useCache: true,
-            },
-          },
-        ],
-        exclude: /node_modules/,
-      },
-      {
-        test: /\.node$/,
-        use: [
-          { loader: 'node-native-loader', options: { name: '[name].[ext]' } },
-        ],
-      },
-    ],
-  },
-  plugins: [
-    new CleanWebpackPlugin([outputDir], { verbose: false }),
-    // This saves us a bunch of bytes by pruning locales (which we don't use)
-    // from moment.
-    new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/),
-    new webpack.NoEmitOnErrorsPlugin(),
-  ],
-  resolve: {
-    extensions: ['.js', '.ts', '.tsx'],
-    modules: [path.resolve(__dirname, 'node_modules/')],
-  },
-  node: {
-    __dirname: false,
-    __filename: false,
-  },
-}
-
-const mainConfig = merge({}, commonConfig, {
-  entry: { main: path.resolve(__dirname, 'src/main-process/main') },
-  target: 'electron-main',
-  plugins: [
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('main'),
-      })
-    ),
-  ],
-})
-
-const rendererConfig = merge({}, commonConfig, {
-  entry: { renderer: path.resolve(__dirname, 'src/ui/index') },
-  target: 'electron-renderer',
-  module: {
-    rules: [
-      {
-        test: /\.(jpe?g|png|gif|ico)$/,
-        use: ['file?name=[path][name].[ext]'],
-      },
-    ],
-  },
-  plugins: [
-    new HtmlWebpackPlugin({
-      template: path.join(__dirname, 'static', 'index.html'),
-      chunks: ['renderer'],
-    }),
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('ui'),
-      })
-    ),
-  ],
-})
-
-const askPassConfig = merge({}, commonConfig, {
-  entry: { 'ask-pass': path.resolve(__dirname, 'src/ask-pass/main') },
-  target: 'node',
-  plugins: [
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('askpass'),
-      })
-    ),
-  ],
-})
-
-const crashConfig = merge({}, commonConfig, {
-  entry: { crash: path.resolve(__dirname, 'src/crash/index') },
-  target: 'electron-renderer',
-  plugins: [
-    new HtmlWebpackPlugin({
-      title: 'GitHub Desktop',
-      filename: 'crash.html',
-      chunks: ['crash'],
-    }),
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('crash'),
-      })
-    ),
-  ],
-})
-
-const cliConfig = merge({}, commonConfig, {
-  entry: { cli: path.resolve(__dirname, 'src/cli/main') },
-  target: 'node',
-  plugins: [
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('cli'),
-      })
-    ),
-  ],
-})
-
-const highlighterConfig = merge({}, commonConfig, {
-  entry: { highlighter: path.resolve(__dirname, 'src/highlighter/index') },
-  output: { libraryTarget: 'var' },
-  target: 'webworker',
-  plugins: [
-    new webpack.DefinePlugin(
-      Object.assign({}, replacements, {
-        __PROCESS_KIND__: JSON.stringify('highlighter'),
-      })
-    ),
-  ],
-  resolve: {
-    // We don't want to bundle all of CodeMirror in the highlighter. A web
-    // worker doesn't have access to the DOM and most of CodeMirror's core
-    // code is useless to us in that context. So instead we use this super
-    // nifty subset of codemirror that defines the minimal context needed
-    // to run a mode inside of node. Now, we're not running in node
-    // but CodeMirror doesn't have to know about that.
-    alias: {
-      codemirror$: 'codemirror/addon/runmode/runmode.node.js',
-      '../lib/codemirror$': '../addon/runmode/runmode.node.js',
-      '../../lib/codemirror$': '../../addon/runmode/runmode.node.js',
-      '../../addon/runmode/runmode$': '../../addon/runmode/runmode.node.js',
-    },
-  },
-})
-
-highlighterConfig.module.rules = [
-  {
-    test: /\.ts$/,
-    include: path.resolve(__dirname, 'src/highlighter'),
-    use: [
-      {
-        loader: 'awesome-typescript-loader',
-        options: {
-          useBabel: true,
-          useCache: true,
-          configFileName: path.resolve(
-            __dirname,
-            'src/highlighter/tsconfig.json'
-          ),
-        },
-      },
-    ],
-    exclude: /node_modules/,
-  },
-]
-
-module.exports = {
-  main: mainConfig,
-  renderer: rendererConfig,
-  askPass: askPassConfig,
-  crash: crashConfig,
-  cli: cliConfig,
-  highlighter: highlighterConfig,
-  replacements: replacements,
-  externals: commonConfig.externals,
-}
added in remote
  their  100644 1022f36fa215969400d025fd13ce117793d98ddd app/webpack.common.ts
@@ -0,0 +1,219 @@
+import * as path from 'path'
+import * as HtmlWebpackPlugin from 'html-webpack-plugin'
+import * as CleanWebpackPlugin from 'clean-webpack-plugin'
+import * as webpack from 'webpack'
+import * as merge from 'webpack-merge'
+import { getReleaseChannel } from '../script/dist-info'
+import { getReplacements } from './app-info'
+
+const channel = getReleaseChannel()
+
+export const externals = ['7zip']
+if (channel === 'development') {
+  externals.push('devtron')
+}
+
+const outputDir = 'out'
+export const replacements = getReplacements()
+
+const commonConfig: webpack.Configuration = {
+  externals: externals,
+  output: {
+    filename: '[name].js',
+    path: path.resolve(__dirname, '..', outputDir),
+    libraryTarget: 'commonjs2',
+  },
+  module: {
+    rules: [
+      {
+        test: /\.tsx?$/,
+        include: path.resolve(__dirname, 'src'),
+        use: [
+          {
+            loader: 'awesome-typescript-loader',
+            options: {
+              useBabel: true,
+              useCache: true,
+            },
+          },
+        ],
+        exclude: /node_modules/,
+      },
+      {
+        test: /\.node$/,
+        loader: 'awesome-node-loader',
+        options: {
+          name: '[name].[ext]',
+        },
+      },
+    ],
+  },
+  plugins: [
+    new CleanWebpackPlugin([outputDir], { verbose: false }),
+    // This saves us a bunch of bytes by pruning locales (which we don't use)
+    // from moment.
+    new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/),
+    new webpack.NoEmitOnErrorsPlugin(),
+  ],
+  resolve: {
+    extensions: ['.js', '.ts', '.tsx'],
+    modules: [path.resolve(__dirname, 'node_modules/')],
+  },
+  node: {
+    __dirname: false,
+    __filename: false,
+  },
+}
+
+export const main = merge({}, commonConfig, {
+  entry: { main: path.resolve(__dirname, 'src/main-process/main') },
+  target: 'electron-main',
+  plugins: [
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('main'),
+      })
+    ),
+  ],
+})
+
+export const renderer = merge({}, commonConfig, {
+  entry: { renderer: path.resolve(__dirname, 'src/ui/index') },
+  target: 'electron-renderer',
+  module: {
+    rules: [
+      {
+        test: /\.(jpe?g|png|gif|ico)$/,
+        use: ['file?name=[path][name].[ext]'],
+      },
+    ],
+  },
+  plugins: [
+    new HtmlWebpackPlugin({
+      template: path.join(__dirname, 'static', 'index.html'),
+      chunks: ['renderer'],
+    }),
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('ui'),
+      })
+    ),
+  ],
+})
+
+export const askPass = merge({}, commonConfig, {
+  entry: { 'ask-pass': path.resolve(__dirname, 'src/ask-pass/main') },
+  target: 'node',
+  plugins: [
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('askpass'),
+      })
+    ),
+  ],
+})
+
+export const crash = merge({}, commonConfig, {
+  entry: { crash: path.resolve(__dirname, 'src/crash/index') },
+  target: 'electron-renderer',
+  plugins: [
+    new HtmlWebpackPlugin({
+      title: 'GitHub Desktop',
+      filename: 'crash.html',
+      chunks: ['crash'],
+    }),
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('crash'),
+      })
+    ),
+  ],
+})
+
+export const cli = merge({}, commonConfig, {
+  entry: { cli: path.resolve(__dirname, 'src/cli/main') },
+  target: 'node',
+  plugins: [
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('cli'),
+      })
+    ),
+  ],
+})
+
+export const highlighter = merge({}, commonConfig, {
+  entry: { highlighter: path.resolve(__dirname, 'src/highlighter/index') },
+  output: {
+    libraryTarget: 'var',
+    chunkFilename: 'highlighter/[name].js',
+  },
+  optimization: {
+    namedChunks: true,
+    splitChunks: {
+      cacheGroups: {
+        modes: {
+          enforce: true,
+          name: (mod, chunks) => {
+            const builtInMode = /node_modules\/codemirror\/mode\/(\w+)\//.exec(
+              mod.resource
+            )
+            if (builtInMode) {
+              return `mode/${builtInMode[1]}`
+            }
+            const external = /node_modules\/codemirror-mode-(\w+)\//.exec(
+              mod.resource
+            )
+            if (external) {
+              return `ext/${external[1]}`
+            }
+            return 'common'
+          },
+        },
+      },
+    },
+  },
+  target: 'webworker',
+  plugins: [
+    new webpack.DefinePlugin(
+      Object.assign({}, replacements, {
+        __PROCESS_KIND__: JSON.stringify('highlighter'),
+      })
+    ),
+  ],
+  resolve: {
+    // We don't want to bundle all of CodeMirror in the highlighter. A web
+    // worker doesn't have access to the DOM and most of CodeMirror's core
+    // code is useless to us in that context. So instead we use this super
+    // nifty subset of codemirror that defines the minimal context needed
+    // to run a mode inside of node. Now, we're not running in node
+    // but CodeMirror doesn't have to know about that.
+    alias: {
+      codemirror$: 'codemirror/addon/runmode/runmode.node.js',
+      '../lib/codemirror$': '../addon/runmode/runmode.node.js',
+      '../../lib/codemirror$': '../../addon/runmode/runmode.node.js',
+      '../../addon/runmode/runmode$': '../../addon/runmode/runmode.node.js',
+    },
+  },
+})
+
+highlighter.module!.rules = [
+  {
+    test: /\.ts$/,
+    include: path.resolve(__dirname, 'src/highlighter'),
+    use: [
+      {
+        loader: 'awesome-typescript-loader',
+        options: {
+          useBabel: true,
+          useCache: true,
+          configFileName: path.resolve(
+            __dirname,
+            'src/highlighter/tsconfig.json'
+          ),
+        },
+      },
+    ],
+    exclude: /node_modules/,
+  },
+]
removed in remote
  base   100644 aab57ac31250a9a96cd3297a5df761e08ec7c180 app/webpack.development.js
  our    100644 aab57ac31250a9a96cd3297a5df761e08ec7c180 app/webpack.development.js
@@ -1,62 +0,0 @@
-'use strict'
-
-const common = require('./webpack.common')
-
-const webpack = require('webpack')
-const merge = require('webpack-merge')
-
-const config = {
-  devtool: 'source-map',
-}
-
-const mainConfig = merge({}, common.main, config)
-const askPassConfig = merge({}, common.askPass, config)
-const cliConfig = merge({}, common.cli, config)
-const highlighterConfig = merge({}, common.highlighter, config)
-
-const rendererConfig = merge({}, common.renderer, config, {
-  entry: {
-    renderer: [
-      'webpack-hot-middleware/client?path=http://localhost:3000/__webpack_hmr',
-      common.renderer.entry.renderer,
-    ],
-  },
-  output: {
-    publicPath: 'http://localhost:3000/build/',
-  },
-  module: {
-    rules: [
-      // This will cause the compiled CSS (and sourceMap) to be
-      // embedded within the compiled javascript bundle and added
-      // as a blob:// uri at runtime.
-      {
-        test: /\.(scss|css)$/,
-        use: ['style-loader', 'css-loader?sourceMap', 'sass-loader?sourceMap'],
-      },
-    ],
-  },
-  plugins: [new webpack.HotModuleReplacementPlugin()],
-})
-
-const crashConfig = merge({}, common.crash, config, {
-  module: {
-    rules: [
-      // This will cause the compiled CSS (and sourceMap) to be
-      // embedded within the compiled javascript bundle and added
-      // as a blob:// uri at runtime.
-      {
-        test: /\.(scss|css)$/,
-        use: ['style-loader', 'css-loader?sourceMap', 'sass-loader?sourceMap'],
-      },
-    ],
-  },
-})
-
-module.exports = [
-  mainConfig,
-  rendererConfig,
-  askPassConfig,
-  crashConfig,
-  cliConfig,
-  highlighterConfig,
-]
added in remote
  their  100644 85601e4b9f45f7a6177f1598e7e42f8f9f2563d8 app/webpack.development.ts
@@ -0,0 +1,77 @@
+import * as common from './webpack.common'
+
+import * as webpack from 'webpack'
+import * as merge from 'webpack-merge'
+
+const config: webpack.Configuration = {
+  mode: 'development',
+  devtool: 'source-map',
+}
+
+const mainConfig = merge({}, common.main, config)
+const askPassConfig = merge({}, common.askPass, config)
+const cliConfig = merge({}, common.cli, config)
+const highlighterConfig = merge({}, common.highlighter, config)
+
+// TODO:
+// if we have a PORT environment variable set and running `yarn start` we also
+// need to update this script to use the same port when building because this
+// is currently hard-coded.
+
+const webpackHotModuleReloadUrl =
+  'webpack-hot-middleware/client?path=http://localhost:3000/__webpack_hmr'
+
+const getRendererEntryPoint = () => {
+  const entry = common.renderer.entry as webpack.Entry
+  if (entry == null) {
+    throw new Error(
+      `Unable to resolve entry point. Check webpack.common.ts and try again`
+    )
+  }
+
+  return entry.renderer as string
+}
+
+const rendererConfig = merge({}, common.renderer, config, {
+  entry: {
+    renderer: [webpackHotModuleReloadUrl, getRendererEntryPoint()],
+  },
+  output: {
+    publicPath: 'http://localhost:3000/build/',
+  },
+  module: {
+    rules: [
+      // This will cause the compiled CSS (and sourceMap) to be
+      // embedded within the compiled javascript bundle and added
+      // as a blob:// uri at runtime.
+      {
+        test: /\.(scss|css)$/,
+        use: ['style-loader', 'css-loader?sourceMap', 'sass-loader?sourceMap'],
+      },
+    ],
+  },
+  plugins: [new webpack.HotModuleReplacementPlugin()],
+})
+
+const crashConfig = merge({}, common.crash, config, {
+  module: {
+    rules: [
+      // This will cause the compiled CSS (and sourceMap) to be
+      // embedded within the compiled javascript bundle and added
+      // as a blob:// uri at runtime.
+      {
+        test: /\.(scss|css)$/,
+        use: ['style-loader', 'css-loader?sourceMap', 'sass-loader?sourceMap'],
+      },
+    ],
+  },
+})
+
+export = [
+  mainConfig,
+  rendererConfig,
+  askPassConfig,
+  crashConfig,
+  cliConfig,
+  highlighterConfig,
+]
removed in remote
  base   100644 1d053b4165d86beb66a65a0cc983e3c6433e6096 app/webpack.production.js
  our    100644 1d053b4165d86beb66a65a0cc983e3c6433e6096 app/webpack.production.js
@@ -1,86 +0,0 @@
-'use strict'
-
-const common = require('./webpack.common')
-
-const webpack = require('webpack')
-const merge = require('webpack-merge')
-const ExtractTextPlugin = require('extract-text-webpack-plugin')
-const BabelPlugin = require('babel-webpack-plugin')
-
-const config = {
-  devtool: 'source-map',
-  plugins: [
-    new BabelPlugin({
-      test: /\.js$/,
-      sourceMaps: true,
-      compact: true,
-      minified: true,
-      comments: false,
-      presets: [
-        [
-          'minify',
-          {
-            evaluate: false,
-          },
-        ],
-      ],
-    }),
-    new webpack.optimize.ModuleConcatenationPlugin(),
-  ],
-}
-
-const mainConfig = merge({}, common.main, config)
-const askPassConfig = merge({}, common.askPass, config)
-const cliConfig = merge({}, common.cli, config)
-const highlighterConfig = merge({}, common.highlighter, config)
-
-const rendererConfig = merge({}, common.renderer, config, {
-  module: {
-    rules: [
-      // This will cause the compiled CSS to be output to a
-      // styles.css and a <link rel="stylesheet"> tag to be
-      // appended to the index.html HEAD at compile time
-      {
-        test: /\.(scss|css)$/,
-        use: ExtractTextPlugin.extract({
-          fallback: 'style-loader',
-          use: ['css-loader', 'sass-loader'],
-        }),
-      },
-    ],
-  },
-  plugins: [
-    // Necessary to be able to use ExtractTextPlugin as a loader.
-    new ExtractTextPlugin('ui.css'),
-  ],
-})
-
-const crashConfig = merge({}, common.crash, config, {
-  module: {
-    rules: [
-      // This will cause the compiled CSS to be output to a
-      // styles.css and a <link rel="stylesheet"> tag to be
-      // appended to the index.html HEAD at compile time
-      {
-        test: /\.(scss|css)$/,
-        use: ExtractTextPlugin.extract({
-          fallback: 'style-loader',
-          use: ['css-loader', 'sass-loader'],
-        }),
-      },
-    ],
-  },
-  plugins: [
-    // Necessary to be able to use ExtractTextPlugin as a loader.
-    new ExtractTextPlugin('crash.css'),
-  ],
-})
-
-module.exports = [
-  mainConfig,
-  rendererConfig,
-  askPassConfig,
-  crashConfig,
-  cliConfig,
-  highlighterConfig,
-]
added in remote
  their  100644 5ceca0028e592b33b03c18605f4eb67a3c69ecaf app/webpack.production.ts
@@ -0,0 +1,75 @@
+import * as common from './webpack.common'
+
+import * as webpack from 'webpack'
+import * as merge from 'webpack-merge'
+import * as MiniCssExtractPlugin from 'mini-css-extract-plugin'
+import { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'
+const MinifyPlugin = require('babel-minify-webpack-plugin')
+
+const config: webpack.Configuration = {
+  mode: 'production',
+  devtool: 'source-map',
+  optimization: {
+    minimizer: [new MinifyPlugin()],
+  },
+}
+
+const mainConfig = merge({}, common.main, config)
+const askPassConfig = merge({}, common.askPass, config)
+const cliConfig = merge({}, common.cli, config)
+const highlighterConfig = merge({}, common.highlighter, config)
+
+const rendererConfig = merge({}, common.renderer, config, {
+  module: {
+    rules: [
+      // This will cause the compiled CSS to be output to a
+      // styles.css and a <link rel="stylesheet"> tag to be
+      // appended to the index.html HEAD at compile time
+      {
+        test: /\.(scss|css)$/,
+        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],
+      },
+    ],
+  },
+  plugins: [
+    // Necessary to be able to use MiniCssExtractPlugin as a loader.
+    new MiniCssExtractPlugin({ filename: 'renderer.css' }),
+    new BundleAnalyzerPlugin({
+      // this generates the static HTML file to view afterwards, rather
+      // than disrupting the user
+      analyzerMode: 'static',
+      openAnalyzer: false,
+      // we can't emit this directly to the dist directory because the
+      // build script immediately blows away dist after webpack is done
+      // compiling the source into bundles
+      reportFilename: 'renderer.report.html',
+    }),
+  ],
+})
+
+const crashConfig = merge({}, common.crash, config, {
+  module: {
+    rules: [
+      // This will cause the compiled CSS to be output to a
+      // styles.css and a <link rel="stylesheet"> tag to be
+      // appended to the index.html HEAD at compile time
+      {
+        test: /\.(scss|css)$/,
+        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],
+      },
+    ],
+  },
+  plugins: [
+    // Necessary to be able to use MiniCssExtractPlugin as a loader.
+    new MiniCssExtractPlugin({ filename: 'crash.css' }),
+  ],
+})
+
+export = [
+  mainConfig,
+  rendererConfig,
+  askPassConfig,
+  crashConfig,
+  cliConfig,
+  highlighterConfig,
+]
merged
  result 100644 1bfea3d3a8c831597a2bba1db9d15bdf1f470765 app/yarn.lock
  our    100644 32c446515d5906010e9d52842742a9a913e42c16 app/yarn.lock
@@ -43,12 +43,6 @@
   dependencies:
     execa "^0.4.0"

-argparse@^1.0.7:
-  version "1.0.9"
-  resolved "https://registry.yarnpkg.com/argparse/-/argparse-1.0.9.tgz#73d83bc263f86e97f8cc4f6bae1b0e90a7d22c86"
-  dependencies:
-    sprintf-js "~1.0.2"
-
 asap@~2.0.3:
   version "2.0.6"
   resolved "https://registry.yarnpkg.com/asap/-/asap-2.0.6.tgz#e50347611d7e690943208bbdafebcbc2fb866d46"
@@ -94,22 +88,6 @@
   dependencies:
     tweetnacl "^0.14.3"

-big.js@^3.1.3:
-  version "3.2.0"
-  resolved "https://registry.yarnpkg.com/big.js/-/big.js-3.2.0.tgz#a5fc298b81b9e0dca2e458824784b65c52ba588e"
-
-boom@4.x.x:
-  version "4.3.1"
-  resolved "https://registry.yarnpkg.com/boom/-/boom-4.3.1.tgz#4f8a3005cb4a7e3889f749030fd25b96e01d2e31"
-  dependencies:
-    hoek "4.x.x"
-
-boom@5.x.x:
-  version "5.2.0"
-  resolved "https://registry.yarnpkg.com/boom/-/boom-5.2.0.tgz#5dd9da6ee3a5f302077436290cb717d3f4a54e02"
-  dependencies:
-    hoek "4.x.x"
-
 brace-expansion@^1.1.7:
   version "1.1.8"
   resolved "https://registry.yarnpkg.com/brace-expansion/-/brace-expansion-1.1.8.tgz#c07b211c7c952ec1f8efd51a77ef0d1d3990a292"
@@ -212,12 +190,6 @@
   version "0.0.2"
   resolved "https://registry.yarnpkg.com/cross-unzip/-/cross-unzip-0.0.2.tgz#5183bc47a09559befcf98cc4657964999359372f"

-cryptiles@3.x.x:
-  version "3.1.2"
-  resolved "https://registry.yarnpkg.com/cryptiles/-/cryptiles-3.1.2.tgz#a89fbb220f5ce25ec56e8c4aa8a4fd7b5b0d29fe"
-  dependencies:
-    boom "5.x.x"
-
 cycle@1.0.x:
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/cycle/-/cycle-1.0.3.tgz#21e80b2be8580f98b468f379430662b046c34ad2"
@@ -266,14 +238,14 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/dom-matches/-/dom-matches-2.0.0.tgz#d2728b416a87533980eb089b848d253cf23a758c"

-dugite@1.61.0:
-  version "1.61.0"
-  resolved "https://registry.yarnpkg.com/dugite/-/dugite-1.61.0.tgz#d5dad047af478c1312f8b791eb56d9935e6fc47d"
+dugite@^1.67.0:
+  version "1.67.0"
+  resolved "https://registry.yarnpkg.com/dugite/-/dugite-1.67.0.tgz#389f95051aa1fb2bc78dcee4294f913ae3438c47"
   dependencies:
     checksum "^0.1.1"
     mkdirp "^0.5.1"
     progress "^2.0.0"
-    request "^2.83.0"
+    request "^2.86.0"
     rimraf "^2.5.4"
     tar "^4.0.2"

@@ -324,10 +296,6 @@
     jsonfile "^2.2.3"
     mkdirp "^0.5.1"

-emojis-list@^2.0.0:
-  version "2.1.0"
-  resolved "https://registry.yarnpkg.com/emojis-list/-/emojis-list-2.1.0.tgz#4daa4d9db00f9819880c79fa457ae5b09a1fd389"
-
 encoding@^0.1.11:
   version "0.1.12"
   resolved "https://registry.yarnpkg.com/encoding/-/encoding-0.1.12.tgz#538b66f3ee62cd1ab51ec323829d1f9480c74beb"
@@ -338,10 +306,6 @@
   version "1.0.5"
   resolved "https://registry.yarnpkg.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz#1b61c0562190a8dff6ae3bb2cf0200ca130b86d4"

-esprima@^4.0.0:
-  version "4.0.0"
-  resolved "https://registry.yarnpkg.com/esprima/-/esprima-4.0.0.tgz#4499eddcd1110e0b218bacf2fa7f7f59f55ca804"
-
 event-kit@^2.0.0:
   version "2.4.0"
   resolved "https://registry.yarnpkg.com/event-kit/-/event-kit-2.4.0.tgz#718aaf22df76670024ad66922483e1bba0544f33"
@@ -409,18 +373,13 @@
     combined-stream "^1.0.5"
     mime-types "^2.1.12"

-front-matter@^2.1.2:
-  version "2.2.0"
-  resolved "https://registry.yarnpkg.com/front-matter/-/front-matter-2.2.0.tgz#35205f67522430b1213ef26149ecb068579fe38a"
-  dependencies:
-    js-yaml "^3.4.6"
-
-fs-extra@^2.1.2:
-  version "2.1.2"
-  resolved "https://registry.yarnpkg.com/fs-extra/-/fs-extra-2.1.2.tgz#046c70163cef9aad46b0e4a7fa467fb22d71de35"
+fs-extra@^6.0.0:
+  version "6.0.0"
+  resolved "https://registry.yarnpkg.com/fs-extra/-/fs-extra-6.0.0.tgz#0f0afb290bb3deb87978da816fcd3c7797f3a817"
   dependencies:
     graceful-fs "^4.1.2"
-    jsonfile "^2.1.0"
+    jsonfile "^4.0.0"
+    universalify "^0.1.0"

 fs-minipass@^1.2.3:
   version "1.2.3"
@@ -472,23 +431,10 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/has-flag/-/has-flag-2.0.0.tgz#e8207af1cc7b30d446cc70b734b5e8be18f88d51"

-hawk@~6.0.2:
-  version "6.0.2"
-  resolved "https://registry.yarnpkg.com/hawk/-/hawk-6.0.2.tgz#af4d914eb065f9b5ce4d9d11c1cb2126eecc3038"
-  dependencies:
-    boom "4.x.x"
-    cryptiles "3.x.x"
-    hoek "4.x.x"
-    sntp "2.x.x"
-
 highlight.js@^9.3.0:
   version "9.12.0"
   resolved "https://registry.yarnpkg.com/highlight.js/-/highlight.js-9.12.0.tgz#e6d9dbe57cbefe60751f02af336195870c90c01e"

-hoek@4.x.x:
-  version "4.2.0"
-  resolved "https://registry.yarnpkg.com/hoek/-/hoek-4.2.0.tgz#72d9d0754f7fe25ca2d01ad8f8f9a9449a89526d"
-
 html-entities@^1.2.0:
   version "1.2.1"
   resolved "https://registry.yarnpkg.com/html-entities/-/html-entities-1.2.1.tgz#0df29351f0721163515dfb9e5543e5f6eed5162f"
@@ -516,7 +462,7 @@
     once "^1.3.0"
     wrappy "1"

-inherits@2:
+inherits@2, inherits@~2.0.0:
   version "2.0.3"
   resolved "https://registry.yarnpkg.com/inherits/-/inherits-2.0.3.tgz#633c2c83e3da42a502f52466022480f4208261de"

@@ -547,13 +493,6 @@
   version "3.0.2"
   resolved "https://registry.yarnpkg.com/js-tokens/-/js-tokens-3.0.2.tgz#9866df395102130e38f7f996bceb65443209c25b"

-js-yaml@^3.4.6:
-  version "3.10.0"
-  resolved "https://registry.yarnpkg.com/js-yaml/-/js-yaml-3.10.0.tgz#2e78441646bd4682e963f22b6e92823c309c62dc"
-  dependencies:
-    argparse "^1.0.7"
-    esprima "^4.0.0"
-
 jsbn@~0.1.0:
   version "0.1.1"
   resolved "https://registry.yarnpkg.com/jsbn/-/jsbn-0.1.1.tgz#a5e654c2e5a2deb5f201d96cefbca80c0ef2f513"
@@ -570,16 +509,18 @@
   version "5.0.1"
   resolved "https://registry.yarnpkg.com/json-stringify-safe/-/json-stringify-safe-5.0.1.tgz#1296a2d58fd45f19a0f6ce01d65701e2c735b6eb"

-json5@^0.5.0:
-  version "0.5.1"
-  resolved "https://registry.yarnpkg.com/json5/-/json5-0.5.1.tgz#1eade7acc012034ad84e2396767ead9fa5495821"
-
-jsonfile@^2.1.0, jsonfile@^2.2.3:
+jsonfile@^2.2.3:
   version "2.4.0"
   resolved "https://registry.yarnpkg.com/jsonfile/-/jsonfile-2.4.0.tgz#3736a2b428b87bbda0cc83b53fa3d633a35c2ae8"
   optionalDependencies:
     graceful-fs "^4.1.6"

+jsonfile@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/jsonfile/-/jsonfile-4.0.0.tgz#8771aae0799b64076b76640fca058f9c10e33ecb"
+  optionalDependencies:
+    graceful-fs "^4.1.6"
+
 jsprim@^1.2.2:
   version "1.4.1"
   resolved "https://registry.yarnpkg.com/jsprim/-/jsprim-1.4.1.tgz#313e66bc1e5cc06e438bc1b7499c2e5c56acb6a2"
@@ -603,14 +544,6 @@
   dependencies:
     nan "2.5.1"

-loader-utils@^1.0.2:
-  version "1.1.0"
-  resolved "https://registry.yarnpkg.com/loader-utils/-/loader-utils-1.1.0.tgz#c98aef488bcceda2ffb5e2de646d6a754429f5cd"
-  dependencies:
-    big.js "^3.1.3"
-    emojis-list "^2.0.0"
-    json5 "^0.5.0"
-
 loose-envify@^1.0.0, loose-envify@^1.1.0, loose-envify@^1.3.0, loose-envify@^1.3.1:
   version "1.3.1"
   resolved "https://registry.yarnpkg.com/loose-envify/-/loose-envify-1.3.1.tgz#d1a8ad33fa9ce0e713d65fdd0ac8b748d478c848"
@@ -777,6 +710,12 @@
   version "0.2.0"
   resolved "https://registry.yarnpkg.com/querystring/-/querystring-0.2.0.tgz#b209849203bb25df820da756e747005878521620"

+queue@^4.4.2:
+  version "4.4.2"
+  resolved "https://registry.yarnpkg.com/queue/-/queue-4.4.2.tgz#5a9733d9a8b8bd1b36e934bc9c55ab89b28e29c7"
+  dependencies:
+    inherits "~2.0.0"
+
 react-addons-shallow-compare@^15.6.2:
   version "15.6.2"
   resolved "https://registry.yarnpkg.com/react-addons-shallow-compare/-/react-addons-shallow-compare-15.6.2.tgz#198a00b91fc37623db64a28fd17b596ba362702f"
@@ -784,15 +723,19 @@
     fbjs "^0.8.4"
     object-assign "^4.1.0"

-react-dom@^16.2.0:
-  version "16.2.0"
-  resolved "https://registry.yarnpkg.com/react-dom/-/react-dom-16.2.0.tgz#69003178601c0ca19b709b33a83369fe6124c044"
+react-dom@^16.3.2:
+  version "16.3.2"
+  resolved "https://registry.yarnpkg.com/react-dom/-/react-dom-16.3.2.tgz#cb90f107e09536d683d84ed5d4888e9640e0e4df"
   dependencies:
     fbjs "^0.8.16"
     loose-envify "^1.1.0"
     object-assign "^4.1.1"
     prop-types "^15.6.0"

+react-lifecycles-compat@^3.0.4:
+  version "3.0.4"
+  resolved "https://registry.yarnpkg.com/react-lifecycles-compat/-/react-lifecycles-compat-3.0.4.tgz#4f1a273afdfc8f3488a8c516bfda78f872352362"
+
 react-transition-group@^1.2.0:
   version "1.2.1"
   resolved "https://registry.yarnpkg.com/react-transition-group/-/react-transition-group-1.2.1.tgz#e11f72b257f921b213229a774df46612346c7ca6"
@@ -803,19 +746,20 @@
     prop-types "^15.5.6"
     warning "^3.0.0"

-react-virtualized@^9.18.5:
-  version "9.18.5"
-  resolved "https://registry.yarnpkg.com/react-virtualized/-/react-virtualized-9.18.5.tgz#42dd390ebaa7ea809bfcaf775d39872641679b89"
+react-virtualized@^9.20.0:
+  version "9.20.0"
+  resolved "https://registry.yarnpkg.com/react-virtualized/-/react-virtualized-9.20.0.tgz#b024992cc857c1a1b2884a019ac52ed686cd690b"
   dependencies:
     babel-runtime "^6.26.0"
     classnames "^2.2.3"
     dom-helpers "^2.4.0 || ^3.0.0"
     loose-envify "^1.3.0"
     prop-types "^15.6.0"
+    react-lifecycles-compat "^3.0.4"

-react@^16.2.0:
-  version "16.2.0"
-  resolved "https://registry.yarnpkg.com/react/-/react-16.2.0.tgz#a31bd2dab89bff65d42134fa187f24d054c273ba"
+react@^16.3.2:
+  version "16.3.2"
+  resolved "https://registry.yarnpkg.com/react/-/react-16.3.2.tgz#fdc8420398533a1e58872f59091b272ce2f91ea9"
   dependencies:
     fbjs "^0.8.16"
     loose-envify "^1.1.0"
@@ -832,9 +776,9 @@
   dependencies:
     nan "^2.8.0"

-request@^2.83.0:
-  version "2.83.0"
-  resolved "https://registry.yarnpkg.com/request/-/request-2.83.0.tgz#ca0b65da02ed62935887808e6f510381034e3356"
+request@^2.86.0:
+  version "2.87.0"
+  resolved "https://registry.yarnpkg.com/request/-/request-2.87.0.tgz#32f00235cd08d482b4d0d68db93a829c0ed5756e"
   dependencies:
     aws-sign2 "~0.7.0"
     aws4 "^1.6.0"
@@ -844,7 +788,6 @@
     forever-agent "~0.6.1"
     form-data "~2.3.1"
     har-validator "~5.0.3"
-    hawk "~6.0.2"
     http-signature "~1.2.0"
     is-typedarray "~1.0.0"
     isstream "~0.1.2"
@@ -854,7 +797,6 @@
     performance-now "^2.1.0"
     qs "~6.5.1"
     safe-buffer "^5.1.1"
-    stringstream "~0.0.5"
     tough-cookie "~2.3.3"
     tunnel-agent "^0.6.0"
     uuid "^3.1.0"
@@ -887,12 +829,6 @@
   version "1.0.5"
   resolved "https://registry.yarnpkg.com/setimmediate/-/setimmediate-1.0.5.tgz#290cbb232e306942d7d7ea9b83732ab7856f8285"

-sntp@2.x.x:
-  version "2.1.0"
-  resolved "https://registry.yarnpkg.com/sntp/-/sntp-2.1.0.tgz#2c6cec14fedc2222739caf9b5c3d85d1cc5a2cc8"
-  dependencies:
-    hoek "4.x.x"
-
 source-map-support@^0.4.15:
   version "0.4.18"
   resolved "https://registry.yarnpkg.com/source-map-support/-/source-map-support-0.4.18.tgz#0286a6de8be42641338594e97ccea75f0a2c585f"
@@ -903,10 +839,6 @@
   version "0.5.7"
   resolved "https://registry.yarnpkg.com/source-map/-/source-map-0.5.7.tgz#8a039d2d1021d22d1ea14c80d8ea468ba2ef3fcc"

-sprintf-js@~1.0.2:
-  version "1.0.3"
-  resolved "https://registry.yarnpkg.com/sprintf-js/-/sprintf-js-1.0.3.tgz#04e6926f662895354f3dd015203633b857297e2c"
-
 sshpk@^1.7.0:
   version "1.13.1"
   resolved "https://registry.yarnpkg.com/sshpk/-/sshpk-1.13.1.tgz#512df6da6287144316dc4c18fe1cf1d940739be3"
@@ -925,10 +857,6 @@
   version "0.0.10"
   resolved "https://registry.yarnpkg.com/stack-trace/-/stack-trace-0.0.10.tgz#547c70b347e8d32b4e108ea1a2a159e5fdde19c0"

-stringstream@~0.0.5:
-  version "0.0.5"
-  resolved "https://registry.yarnpkg.com/stringstream/-/stringstream-0.0.5.tgz#4e484cd4de5a0bbbee18e46307710a8a81621878"
-
 strip-ansi@^3.0.0:
   version "3.0.1"
   resolved "https://registry.yarnpkg.com/strip-ansi/-/strip-ansi-3.0.1.tgz#6a385fb8853d952d5ff05d0e8aaf94278dc63dcf"
@@ -945,12 +873,6 @@
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/strip-eof/-/strip-eof-1.0.0.tgz#bb43ff5598a6eb05d89b59fcd129c983313606bf"

-style-loader@^0.13.2:
-  version "0.13.2"
-  resolved "https://registry.yarnpkg.com/style-loader/-/style-loader-0.13.2.tgz#74533384cf698c7104c7951150b49717adc2f3bb"
-  dependencies:
-    loader-utils "^1.0.2"
-
 supports-color@^4.0.0:
   version "4.4.0"
   resolved "https://registry.yarnpkg.com/supports-color/-/supports-color-4.4.0.tgz#883f7ddabc165142b2a61427f3352ded195d1a3e"
@@ -999,6 +921,10 @@
   version "0.7.14"
   resolved "https://registry.yarnpkg.com/ua-parser-js/-/ua-parser-js-0.7.14.tgz#110d53fa4c3f326c121292bbeac904d2e03387ca"

+universalify@^0.1.0:
+  version "0.1.1"
+  resolved "https://registry.yarnpkg.com/universalify/-/universalify-0.1.1.tgz#fa71badd4437af4c148841e3b3b165f9e9e590b7"
+
 untildify@^3.0.2:
   version "3.0.2"
   resolved "https://registry.yarnpkg.com/untildify/-/untildify-3.0.2.tgz#7f1f302055b3fea0f3e81dc78eb36766cb65e3f1"
merged
  result 100644 5185c7d6e7e86cafdb3aec94115c1120c9e776a2 appveyor.yml
  our    100644 e9a9426356bf8465dbdc277c0ee9a2fb876e5e67 appveyor.yml
@@ -4,7 +4,7 @@
   - x64

 environment:
-  nodejs_version: "8.9.0"
+  nodejs_version: "8.11"

 cache:
   - .eslintcache
merged
  result 100644 6e0feab6683b3ff164dfee68d69eb6fdd5478b53 changelog.json
  our    100644 061dd96a1d5f2e461c954e4a3e42398dfd8fc837 changelog.json
@@ -1,5 +1,194 @@
 {
   "releases": {
+    "1.2.7-test1": [
+      "Sanity check deployment for refactored scripts"
+    ],
+    "1.2.7-beta0": [
+      "[Fixed] Visual indicator for upcoming feature should not be shown - #5026"
+    ],
+    "1.2.6": [
+      "[Fixed] Visual indicator for upcoming feature should not be shown - #5026"
+    ],
+    "1.2.6-beta0": [
+      "[Fixed] Feature flag for upcoming feature not applied correctly - #5024"
+    ],
+    "1.2.5": [
+      "[Fixed] Feature flag for upcoming feature not applied correctly - #5024"
+    ],
+    "1.2.4": [
+      "[New] Dark Theme preview - #4849",
+      "[Added] Syntax highlighting for Cake files - #4935. Thanks @say25!",
+      "[Added] WebStorm support for macOS - #4841. Thanks @mrsimonfletcher!",
+      "[Fixed] Compare tab appends older commits when scrolling to bottom of list - #4964",
+      "[Fixed] Remove temporary directory after Git LFS operation completes - #4414",
+      "[Fixed] Unable to compare when two branches exist - #4947 #4730",
+      "[Fixed] Unhandled errors when refreshing pull requests fails - #4844 #4866",
+      "[Improved] Remove context menu needs to hint if a dialog will be shown - #4975",
+      "[Improved] Upgrade embedded Git LFS - #4602 #4745",
+      "[Improved] Update banner message clarifies that only Desktop needs to be restarted - #4891. Thanks @KennethSweezy!",
+      "[Improved] Discard Changes context menu entry should contain ellipses when user needs to confirm - #4846. Thanks @yongdamsh!",
+      "[Improved] Initializing syntax highlighting components - #4764",
+      "[Improved] Only show overflow shadow when description overflows - #4898",
+      "[Improved] Changes tab displays number of changed files instead of dot - #4772. Thanks @yongdamsh!"
+    ],
+    "1.2.4-beta5": [
+
+    ],
+    "1.2.4-beta4": [
+      "[Fixed] Compare tab appends older commits when scrolling to bottom of list - #4964",
+      "[Fixed] Remove temporary directory after Git LFS operation completes - #4414",
+      "[Improved] Remove context menu needs to hint if a dialog will be shown - #4975",
+      "[Improved] Upgrade embedded Git LFS - #4602 #4745"
+    ],
+    "1.2.4-test1": [
+      "Confirming latest Git LFS version addresses reported issues"
+    ],
+    "1.2.4-beta3": [
+      "[Added] WebStorm support for macOS - #4841. Thanks @mrsimonfletcher!",
+      "[Improved] Update banner message clarifies that only Desktop needs to be restarted - #4891. Thanks @KennethSweezy!"
+    ],
+    "1.2.4-beta2": [
+    ],
+    "1.2.4-beta1": [
+      "[New] Dark Theme preview - #4849",
+      "[Added] Syntax highlighting for Cake files - #4935. Thanks @say25!",
+      "[Fixed] Unable to compare when two branches exist - #4947 #4730",
+      "[Fixed] Unhandled errors when refreshing pull requests fails - #4844 #4866",
+      "[Improved] Discard Changes context menu entry should contain ellipses when user needs to confirm - #4846. Thanks @yongdamsh!",
+      "[Improved] Initializing syntax highlighting components - #4764",
+      "[Improved] Only show overflow shadow when description overflows - #4898",
+      "[Improved] Changes tab displays number of changed files instead of dot - #4772. Thanks @yongdamsh!"
+    ],
+    "1.2.3": [
+      "[Fixed] No autocomplete when searching for co-authors - #4847",
+      "[Fixed] Error when checking out a PR from a fork - #4842"
+    ],
+    "1.2.3-beta1": [
+      "[Fixed] No autocomplete when searching for co-authors - #4847",
+      "[Fixed] Error when checking out a PR from a fork - #4842"
+    ],
+    "1.2.3-test1": [
+      "Confirming switch from uglify-es to babel-minify addresses minification issue - #4871"
+    ],
+    "1.2.2": [
+      "[Fixed] Make cURL/schannel default to using the Windows certificate store - #4817",
+      "[Fixed] Restore text selection highlighting in diffs - #4818"
+    ],
+    "1.2.2-beta1": [
+      "[Fixed] Make cURL/schannel default to using the Windows certificate store - #4817",
+      "[Fixed] Text selection highlighting in diffs is back - #4818"
+    ],
+    "1.2.1": [
+      "[Added] Brackets support for macOS - #4608. Thanks @3raxton!",
+      "[Added] Pull request number and author are included in fuzzy-find filtering - #4653. Thanks @damaneice!",
+      "[Fixed] Decreased the max line length limit - #3740. Thanks @sagaragarwal94!",
+      "[Fixed] Updated embedded Git to 2.17.1 to address upstream security issue - #4791",
+      "[Improved] Display the difference in file size of an image in the diff view - #4380. Thanks @ggajos!"
+    ],
+    "1.2.1-test1": [
+      "Upgraded embedded Git to 2.17.0"
+    ],
+    "1.2.1-beta1": [
+      "[Added] Brackets support for macOS - #4608. Thanks @3raxton!",
+      "[Added] Pull request number and author are included in fuzzy-find filtering - #4653. Thanks @damaneice!",
+      "[Fixed] Decreased the max line length limit - #3740. Thanks @sagaragarwal94!",
+      "[Fixed] Updated embedded Git to 2.17.1 to address upstream security issue - #4791",
+      "[Improved] Display the difference in file size of an image in the diff view - #4380. Thanks @ggajos!"
+    ],
+    "1.2.1-beta0": [
+
+    ],
+    "1.1.2-test6": [
+      "Testing the Webpack v4 output from the project"
+    ],
+    "1.2.0": [
+      "[New] History now has ability to compare to another branch and merge outstanding commits",
+      "[New] Support for selecting more than one file in the changes list - #1712. Thanks @icosamuel!",
+      "[New] Render bitmap images in diffs - #4367. Thanks @MagicMarvMan!",
+      "[Added] Add PowerShell Core support for Windows and macOS - #3791. Thanks @saschanaz!",
+      "[Added] Add MacVim support for macOS - #4532. Thanks @johnelliott!",
+      "[Added] Syntax highlighting for JavaServer Pages (JSP) - #4470. Thanks @damaneice!",
+      "[Added] Syntax highlighting for Haxe files - #4445. Thanks @Gama11!",
+      "[Added] Syntax highlighting for R files - #4455. Thanks @say25!",
+      "[Fixed] 'Open in Shell' on Linux ensures Git is on PATH - #4619. Thanks @ziggy42!",
+      "[Fixed] Pressing 'Enter' on filtered Pull Request does not checkout - #4673",
+      "[Fixed] Alert icon shrinks in rename dialog when branch name is long - #4566",
+      "[Fixed] 'Open in Desktop' performs fetch to ensure branch exists before checkout - #3006",
+      "[Fixed] 'Open in Default Program' on Windows changes the window title - #4446",
+      "[Fixed] Skip fast-forwarding when there are many eligible local branches - #4392",
+      "[Fixed] Image diffs not working for files with upper-case file extension - #4466",
+      "[Fixed] Syntax highlighting not working for files with upper-case file extension - #4462. Thanks @say25!",
+      "[Fixed] Error when creating Git LFS progress causes clone to fail - #4307. Thanks @MagicMarvMan!",
+      "[Fixed] 'Open File in External Editor' always opens a new instance - #4381",
+      "[Fixed] 'Select All' shortcut now works for changes list - #3821",
+      "[Improved] Automatically add valid repository when using command line interface - #4513. Thanks @ggajos!",
+      "[Improved] Always fast-forward the default branch - #4506",
+      "[Improved] Warn when trying to rename a published branch - #4035. Thanks @agisilaos!",
+      "[Improved] Added context menu for files in commit history - #2845. Thanks @crea7or",
+      "[Improved] Discarding all changes always prompts for confirmation - #4459",
+      "[Improved] Getting list of changed files is now more efficient when dealing with thousands of files - #4443",
+      "[Improved] Checking out a Pull Request may skip unnecessary fetch - #4068. Thanks @agisilaos!",
+      "[Improved] Commit summary now has a hint to indicate why committing is disabled - #4429.",
+      "[Improved] Pull request status text now matches format on GitHub - #3521",
+      "[Improved] Add escape hatch to disable hardware acceleration when launching - #3921"
+    ],
+    "1.1.2-beta7": [
+    ],
+    "1.1.2-beta6": [
+      "[Added] Add MacVim support for macOS - #4532. Thanks @johnelliott!",
+      "[Fixed] Open in Shell on Linux ensures Git is available on the user's PATH - #4619. Thanks @ziggy42!",
+      "[Fixed] Keyboard focus issues when navigating Pull Request list - #4673",
+      "[Improved] Automatically add valid repository when using command line interface - #4513. Thanks @ggajos!"
+    ],
+    "1.1.2-test5": [
+      "Actually upgrading fs-extra to v6 in the app"
+    ],
+    "1.1.2-test4": [
+      "Upgrading fs-extra to v6"
+    ],
+    "1.1.2-beta5": [
+      "[Added] Syntax highlighting for JavaServer Pages (JSP) - #4470. Thanks @damaneice!",
+      "[Fixed] Prevent icon from shrinking in rename dialog - #4566"
+    ],
+    "1.1.2-beta4": [
+      "[New] New Compare tab allowing visualization of the relationship between branches",
+      "[New] Support for selecting more than one file in the changes list - #1712. Thanks @icosamuel!",
+      "[Fixed] 'Select All' shortcut now works for changes list - #3821",
+      "[Improved] Always fast-forward the default branch - #4506",
+      "[Improved] Warn when trying to rename a published branch - #4035. Thanks @agisilaos!",
+      "[Improved] Added context menu for files in commit history - #2845. Thanks @crea7or",
+      "[Improved] Discarding all changes always prompts for confirmation - #4459"
+    ],
+    "1.1.2-beta3": [
+      "[Added] Syntax highlighting for Haxe files - #4445. Thanks @Gama11!",
+      "[Added] Syntax highlighting for R files - #4455. Thanks @say25!",
+      "[Fixed] Fetch to ensure \"Open in Desktop\" has a branch to checkout - #3006",
+      "[Fixed] Handle the click event when opening a binary file - #4446",
+      "[Fixed] Skip fast-forwarding when there are a lot of eligible local branches - #4392",
+      "[Fixed] Image diffs not working for files with upper-case file extension - #4466",
+      "[Fixed] Syntax highlighting not working for files with upper-case file extension - #4462. Thanks @say25!",
+      "[Improved] Getting list of changed files is now more efficient when dealing with thousands of files - #4443",
+      "[Improved] Checking out a Pull Request may skip unnecessary fetch - #4068. Thanks @agisilaos!",
+      "[Improved] Commit summary now has a hint to indicate why committing is disabled - #4429."
+    ],
+    "1.1.2-test3": [
+      "[New] Comparison Branch demo build"
+    ],
+    "1.1.2-test2": [
+      "Refactoring the diff internals to potentially land some SVG improvements"
+    ],
+    "1.1.2-test1": [
+      "Refactoring the diff internals to potentially land some SVG improvements"
+    ],
+    "1.1.2-beta2": [
+      "[New] Render bitmap images in diffs - #4367. Thanks @MagicMarvMan!",
+      "[New] Add PowerShell Core support for Windows and macOS - #3791. Thanks @saschanaz!",
+      "[Fixed] Error when creating Git LFS progress causes clone to fail - #4307. Thanks @MagicMarvMan!",
+      "[Fixed] 'Open File in External Editor' does not use existing window - #4381",
+      "[Fixed] Always ask for confirmation when discarding all changes - #4423",
+      "[Improved] Pull request status text now matches format on GitHub - #3521",
+      "[Improved] Add escape hatch to disable hardware acceleration when launching - #3921"
+    ],
     "1.1.2-beta1": [

     ],
merged
  result 100644 19865d13f3ab50d13c233da23115035bf423212e circle.yml
  our    100644 6dc532103b44f2896468ac6d61f4b4db4d2394f7 circle.yml
@@ -20,12 +20,12 @@
     - brew update
     # uninstall Node 6 which is shipped by default on Circle
     - brew uninstall node
-    # install latest Node LTS (8.9.3 as of writing)
+    # install latest Node LTS (8.11.* as of writing)
     - brew install node@8 --force
     # everything is terrible, but we must march on
     - brew link --overwrite node@8 --force
     # workaround for yarn installation issue
-    - curl -o- -L https://yarnpkg.com/install.sh | TERM=xterm bash
+    - curl -o- -L https://yarnpkg.com/install.sh | TERM=xterm bash -s -- --version 1.5.1

   override:
     - yarn install --force
merged
  result 100644 85f2237dba6b5f8296b3fe7c9214125fb1ab8291 docs/README.md
  our    100644 1b5837911492e094338cbe0808ba278c35d4ed08 docs/README.md
@@ -28,7 +28,7 @@
     releases
  - **[Issue Triage](process/issue-triage.md)** - how we address issues reported
     by users
- - **[Review Process](process/reviews.md)** - how we review contributions
+ - **[Pull Request Triage](process/pull-request-triage.md)** - how contributions are reviewed
  - **[Releasing Updates](process/releasing-updates.md)** - how we deploy things

 ## Technical
merged
  result 100644 e6d7547da4874c319f72d7264d11e060f2270d41 docs/contributing/setup.md
  our    100644 5b9cda4685280976fbfceb7265cab922d7b508b3 docs/contributing/setup.md
@@ -6,13 +6,13 @@

 ### macOS

- - [Node.js v8.9.0](https://nodejs.org/dist/v8.9.0/)
+ - [Node.js v8.11.2](https://nodejs.org/dist/v8.11.2/)
  - [Python 2.7](https://www.python.org/downloads/mac-osx/)
  - Xcode and Xcode Command Line Tools (Xcode -> Preferences -> Downloads)

 ### Windows

- - [Node.js v8.9.0](https://nodejs.org/dist/v8.9.0/)
+ - [Node.js v8.11.2](https://nodejs.org/dist/v8.11.2/)
     - *Make sure you allow the Node.js installer to add node to the PATH.*
  - [Python 2.7](https://www.python.org/downloads/windows/)
     - *Let Python install into the default suggested path (`c:\Python27`), otherwise you'll have
@@ -32,7 +32,7 @@

 ### Fedora 26

-First, add the NodeJS package repository.
+First, add the NodeJS package repository for 8.x.

 ```shellsession
 $ curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
@@ -67,7 +67,7 @@
 $ sudo apt install curl
 ```

-Then add the NodeJS package repository:
+Then add the NodeJS package repository for 8.x:

 ```shellsession
 $ curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
@@ -95,35 +95,45 @@
 on setup there.
 * Instead of running `yarn` to get all required dependencies on your machine, you will
 instead need to run `script/install-arm64-deps.sh`.
+* Before building with `yarn build:dev` or `yarn build:prod`, you will need to
+set the environment variable `TARGET_ARCH` to `arm64` eg:
+```shellsession
+export TARGET_ARCH=arm64
+```

-## Verification
+## Install Yarn

-With these things installed, open a shell and install `yarn` (you might need
-to `sudo` here depending on how Node was installed):
+After doing this setup, you also need to install `yarn` as Desktop uses
+this for managing packages instead of NPM. **Do not install `yarn` through
+NPM**. Refer to the [install instructions](https://yarnpkg.com/en/docs/install)
+for your OS.

-```shellsession
-$ npm install -g yarn@1.3.2
-```
+This is important because `yarn` uses lock files to pin dependencies. If you
+find yourself changing packages, this will prevent mismatches in versions
+between machines.
+
+If you're not familiar with `yarn`, please read [this document](./working-with-packages.md)
+to help familiarize yourself with how to do the common package tasks that are
+relevant to Desktop.

-This is important because yarn uses lock files to pin dependencies. If you find
-yourself changing packages, this will prevent mismatches in versions between machines.
+## Verification

-Then validate you have these commands available and that the versions look similar:
+Then verify you have these commands available in your shell and that the found
+versions look similar to the below output:

 ```shellsession
 $ node -v
-v7.8.0
+v8.11.2

 $ yarn -v
-1.2.0
+1.5.1

 $ python --version
 Python 2.7.13
 ```

-There are also [additional resources](tooling.md) to
-configure your favorite editor to work nicely with the GitHub Desktop
-repository.
+There are also [additional resources](tooling.md) to configure your favorite
+editor to work nicely with the GitHub Desktop repository.

 ## Building Desktop

@@ -133,7 +143,7 @@
 * Run `yarn` to get all required dependencies on your machine.
 * Run `yarn build:dev` to create a development build of the app.
 * Run `yarn start` to launch the application. Changes will be compiled in the
-  background. The app can then be reloaded to see the changes (Ctrl/Command+R).
+  background. The app can then be reloaded to see the changes (<kbd>Ctrl/Command+Alt+R</kbd>).

 **Optional Tip**: On macOS and Linux, you can use `screen` to avoid filling your terminal with logging output:

@@ -156,25 +166,15 @@
 ## Running tests

 - `yarn test` - Runs all unit and integration tests
-- `yarn test:unit` - Runs all unit tests
+- `yarn test:unit` - Runs all unit tests (add `--debug` to open Chrome Dev Tools while running tests)
 - `yarn test:integration` - Runs all integration tests

-**Pro Tip:** If you're only interested in the results of a single test and don't
-wish to run the entire test suite to see it you can pass along a search string
-in order to only run the tests that match that string.
-
-```shellsession
-$ yarn test:unit -- --grep CloneProgressParser
-```
-
-This example will run all test names containing `CloneProgressParser`.
-
 ## Debugging

 Electron ships with Chrome Dev Tools to assist with debugging, profiling and
 other measurement tools.

-1. Run the command `npm start` to launch the app
+1. Run the command `yarn start` to launch the app
 2. Under the **View** menu, select **Toggle Developer Tools**

 When running the app in development mode,
@@ -193,7 +193,7 @@

 You're almost there! Here's a couple of things we recommend you read next:

- - [Help Wanted](../../.github/CONTRIBUTING.md#help-wanted) - we've marked some tasks in
-   the backlog that are ideal for external contributors
- - [Code Reviews](../process/reviews.md) - some notes on how the team does
-   code reviews
+ - [Help Wanted](../../.github/CONTRIBUTING.md#help-wanted) - we've marked some
+   tasks in the backlog that are ideal for external contributors
+ - [Notes for Contributors](../process/notes-for-contributors.md) - some notes
+   for new contributors getting started
merged
  result 100644 68616f214de0f1dfb283dee8a0d503eabf3374f2 docs/contributing/styleguide.md
  our    100644 3dd9587dfcc10f13be634b635aa26bee01b894ea docs/contributing/styleguide.md
@@ -41,7 +41,7 @@

 The [`Dispatcher`](https://github.com/desktop/desktop/blob/master/app/src/lib/dispatcher/dispatcher.ts)
 is the entry point for most interactions with the application which update state,
-and for most usages this work is then delegated to the [`AppStore`](https://github.com/desktop/desktop/blob/master/app/src/lib/dispatcher/app-store.ts).
+and for most usages this work is then delegated to the [`AppStore`](https://github.com/desktop/desktop/blob/master/app/src/lib/stores/app-store.ts).
 Due to this coupling, we need to discourage callers directly manipulating
 specific methods in the `AppStore` unless there's a compelling reason.

merged
  result 100644 265fc7e708fdeb51902542f01f6dc5ab7fcf1272 docs/known-issues.md
  our    100644 6260d6cfcc30bb19e986dc534dd64471b05506a3 docs/known-issues.md
@@ -14,7 +14,7 @@

 ### My issue is not listed here?

-Please check the [open](https://github.com/desktop/desktop/labels/bug) and [closed](https://github.com/desktop/desktop/issues?q=is%3Aclosed+label%3Abug) bugs in the issue tracker for the details of your bug. If you can't find it, or if you're not sure, open a [new issue](https://github.com/desktop/desktop/issues/new).
+Please check the [open](https://github.com/desktop/desktop/labels/bug) and [closed](https://github.com/desktop/desktop/issues?q=is%3Aclosed+label%3Abug) bugs in the issue tracker for the details of your bug. If you can't find it, or if you're not sure, open a [new issue](https://github.com/desktop/desktop/issues/new?template=bug_report.md).

 ## macOS

@@ -118,3 +118,9 @@
 Enabling Mandatory ASLR affects the MSYS2 core library, which is relied upon by Git for Windows to emulate process forking.

 **Not supported:** this is an upstream limitation of MSYS2, and it is recommend that you either disable Mandatory ASLR or whitelist all executables under `<Git>\usr\bin` which depend on MSYS2.
+
+### I get a black screen when launching Desktop
+
+Electron enables hardware accelerated graphics by default, but some graphics cards have issues with hardware acceleration which means the application will launch successfully but it will be a black screen.
+
+**Workaround:** if you set the `GITHUB_DESKTOP_DISABLE_HARDWARE_ACCELERATION` environment variable to any value and launch Desktop again it will disable hardware acceleration on launch, so the application is usable.
\ No newline at end of file
added in remote
  their  100644 1fd166574ae526e79f25a6163285059d9f837946 docs/process/notes-for-contributors.md
@@ -0,0 +1,37 @@
+## Notes for Contributors
+
+### Work-in-Progress
+
+We recommend open pull requests early - ideally as soon as you have something to
+show. This is especially helpful for large pieces of work, as continuous
+integration tests are run earlier on, and regressions can be caught before
+humans get involved.
+
+Until the code is ready for review, you can prefix the PR title with [WIP] to
+indicate that it's under development.
+
+### Use Task Lists
+
+If you are working through a list of tasks as part of a pull request, listing
+those tasks and indicating when they have been completed helps reviewers to
+understand quickly what's changed.
+
+### Keep The Commit History Tidy
+
+We're not that fussy about the history, but to make reviewing easier here's
+some general tips:
+
+ - make small, meaningful and logical commits - these make the review process easier
+ - [write good commit messages](https://chris.beams.io/posts/git-commit/) -
+   these help the reviewer to understand the changes
+ - keep up to date with `master` - not only does this address potential merge
+   conflicts, it ensures you're integrating with the latest code
+
+When merging, we prefer you merge `master` into your branch, but for small
+PRs a rebase is fine.
+
+### These Things Take Time
+
+Our team is distributed around the world, and often we like to get their
+feedback for specific areas of the codebase. And even with minor changes, we often like to let
+them sit for a while and give everyone a chance to provide their input.
added in remote
  their  100644 4c2d1f5be688335f169fe3e3b466e96883b2913f docs/process/pull-request-triage.md
@@ -0,0 +1,100 @@
+# Pull Request Triage
+
+This document outlines how the Desktop team handles pull requests, to ensure
+a consistent process for contributions from the core team and the community.
+
+## The Review Process
+
+1. **Contributor** opens pull request.
+1. When it's ready for review, add a comment to the pull request.
+1. A member of the reviewer team will give it a quick look over and
+   add the `ready-for-review` label.
+1. A **reviewer** with bandwidth will appear.
+1. **Reviewer** assigns the PR to themselves.
+1. **Reviewer** leaves line comments with suggestions or questions.
+1. When the **reviewer** is done they comment on the PR with an emoji, meme,
+   pok√©mon, or words to that effect.
+1. The **contributor** responds to feedback, makes changes, etc.
+1. When the **contributor** is ready for the **reviewer** to re-review, they
+   comment on the PR with an emoji, meme, pok√©mon or words to that effect.
+1. Goto 6 until both parties are happy with the PR.
+1. The **reviewer** hits the big green merge button and deletes the branch (if
+    applicable).
+
+Merged contributions are first published to the beta channel (we aim to publish
+new versions weekly if contributions are availlable) before then being
+published to the production channel (we aim to publish new versions on a monthly
+cadence).
+
+### When The Review Is Done
+
+We're using GitHub's review tools to co-ordinate feedback, and we like to be
+methodical with our reviews, so you'll probably end up with one of two results:
+
+ - **Approved**: nothing else to do; the contribution is great! :gem:
+ - **Request Changes**: there are things to address; reviewer provides details :memo:
+
+Reviews can take a few iterations, especially for large contributions. Don't
+be disheartened if you feel it takes time - we just want to ensure each
+contribution is high-quality and that any outstanding questions are resolved,
+captured or documented for posterity.
+
+### Assignees
+
+The reviewers team uses the **Assignee** field to indicate who "owns" the review
+process for a contribution. While others can add their reviews to a pull request -
+and large features will likely have multiple reviewers - it's up to the assignee
+to take charge of the process and see it through to the end.
+
+If a reviewer is feeling overloaded, or if a review has stalled, the reviewer may
+remove themselves from a pull request. This helps others know where they can help
+out to share the load.
+
+### Everyone Reviews
+
+While everyone has their own domain expertise around the codebase, we encourage
+people to share the load of reviews and reviewing areas of the codebase that
+aren't as familiar. This spreads knowledge across the team
+
+### 24 Hours Cooling Off
+
+After being approved, most contributions will remain in this state for at least
+24 hours before merging. The review team does this to ensure everyone on the team,
+who are normally spread around the world, has a chance to provide feedback about
+the changes.
+
+### No Self-Merges
+
+We encourage a strong review culture, and contributors should not merge their
+own PRs unless there are exceptional reasons.
+
+Examples of exceptional situations:
+
+- [#2733](https://github.com/desktop/desktop/pull/2733) was pinning a dependency
+  that affected our continuous integration tests by installing the incorrect
+  version
+
+- [#4319](https://github.com/desktop/desktop/pull/4319) was a minor packaging
+  change introduced unexpectedly on `master` but would affect everyone when they
+  updated their local repositories.
+
+These should be called out by the merging person with a `#jolo` - "Josh Only
+Lives Once" - to acknowledge to everyone that they're bypassing the review
+process, and the reasons for doing that.
+
+### Stale Pull Requests
+
+A reviewer will return to an **open and reviewed** pull request if, after 14
+days:
+
+ - no response has been received from the contributor, or
+ - no new commits have been made to the pull request
+
+This is done to ensure we keep the number of reviews under control.
+
+The reviewer should ask if the contributor is still interested in working on
+this, and indicate that they are welcome to open a fresh pull request later if
+they lack the time currently to continue on.
+
+If it's agreed to put this contribution on hold, or if no feedback is
+received after 3 days, the pull request will be closed.
merged
  result 100644 268eeb03374d21788fd404ce2b1398f8fafd53a2 docs/process/releasing-updates.md
  our    100644 bf564284a648d40cfd836cff85fe41a788edd31a docs/process/releasing-updates.md
@@ -135,7 +135,7 @@

 We're using `.release` with a bang so that we don't have to wait for any current CI on the branch to finish. This might feel a little wrong, but it's OK since making the release itself will also run CI.

-If you're releasing a `production` update, release a `beta` update for the next version too, so that beta users are on the latest release.
+If you're releasing a `production` update, release a `beta` update for the next version too, so that beta users are on the latest release. For example, if the version just released to production is `1.2.0` then the beta release should be `1.2.1-beta0` to indicate there are no new changes on top of what's currently on `production`.

 ### 4. Check for Completed Release

removed in remote
  base   100644 bac857303b48b6efb4fd0ddf4c8b07d6d3b64477 docs/process/reviews.md
  our    100644 bac857303b48b6efb4fd0ddf4c8b07d6d3b64477 docs/process/reviews.md
@@ -1,93 +0,0 @@
-# The Review Process
-
-This is the typical flow:
-
-1. **Contributor** opens pull request.
-1. When it's ready for review, they comment on it saying so.
-1. A member of the maintainer team will give it a quick look over and
-   add the `ready-for-review` label.
-1. Suddenly a wild **reviewer** appears!
-1. **Reviewer** assigns the PR to themselves.
-1. **Reviewer** leaves line comments with suggestions or questions.
-1. When the **reviewer** is done they comment on the PR with an emoji, meme,
-   pok√©mon, or words to that effect.
-1. The **contributor** responds to feedback, makes changes, etc.
-1. When the **contributor** is ready for the **reviewer** to re-review, they
-   comment on the PR with an emoji, meme, pok√©mon or words to that effect.
-1. Goto 6 until both parties are happy with the PR.
-1. The **reviewer** hits the big green merge button and deletes the branch (if
-    applicable).
-
-The rest of this document goes into more details around this flow.
-
-## Notes for Contributors
-
-### Work-in-Progress
-
-We recommend open pull requests early - ideally as soon as you have something to
-show. This is especially helpful for large pieces of work, as continuous
-integration tests are run earlier on, and regressions can be caught before
-humans get involved.
-
-Until the code is ready for review, you can prefix the PR title with [WIP] to
-indicate that it's under development.
-
-### Use Task Lists
-
-If you are working through a list of tasks as part of a pull request, listing
-those tasks and indicating when they have been completed helps reviewers to
-understand quickly what's changed.
-
-### Keep The Commit History Tidy
-
-We're not that fussy about the history, but to make reviewing easier here's
-some general tips:
-
- - make small, meaningful and logical commits - these make the review process easier
- - [write good commit messages](https://chris.beams.io/posts/git-commit/) -
-   these help the reviewer to understand the changes
- - keep up to date with `master` - not only does this address potential merge
-   conflicts, it ensures you're integrating with the latest code
-
-When merging, we prefer you merge `master` into your branch, but for small
-PRs a rebase is fine.
-
-### At Least One Assignee
-
-While many people can be involved with a review, there's generally one person
-who eventually approves the pull request and merges. They'll be assigned to the
-pull request early on, so we can easily verify every active pull request has a
-reviewer.
-
-### When The Review Is Done
-
-We're using GitHub's review tools to co-ordinate feedback, and we like to be
-methodical with our reviews, so you'll probably end up with one of two results:
-
- - **Approved**: nothing else to do; the reviewer merges
- - **Request Changes**: there are things to address; reviewer provides details
-
-Reviews can take a few iterations, especially for large contributions. Don't
-be disheartened if you feel it takes time - we just want to ensure each
-contribution is high-quality and that any outstanding questions are resolved,
-captured or documented for posterity.
-
-### These Things Take Time
-
-Our team is distributed around the world, and often we like to get their
-feedback for specific areas. And even with minor changes, we often like to let
-them sit for a while and give everyone a chance to provide their input.
-
-## Other Rules
-
-## No Self-Merges
-
-Even for minor changes, we discourage people from merging their own pull
-requests.
-
-## Everyone Reviews
-
-While everyone has their own domain expertise around the codebase, we encourage
-people to share the load of reviews and reviewing areas of the codebase that
-aren't as familiar. This spreads knowledge across the team
-
merged
  result 100644 8e82f6aa314a7abf83144610e658942287d27eb4 docs/process/testing.md
  our    100644 28e3af154f93357a29a5f0e0321ef13332ca957b docs/process/testing.md
@@ -215,6 +215,8 @@
     - [ ] `Cancel` button closes modal
     - [ ] Protected branches cannot be deleted
   - [ ] Update from Default Branch (cannot be master; Mac: `‚áß‚åòU`; Windows: `Ctrl+Shift+U`)
+  - [ ] Compare to Branch (Mac: `‚áß‚åòB`; Windows: `Ctrl+Shift+B`)
+    - [ ] Takes you to the history tab with the input selected so you can directly choose a branch
   - [ ] Merge into Current Branch (Mac: `‚áß‚åòM`; Windows: `Ctrl+Shift+M`)
     - [ ] Use can filter existing branches
     - [ ] User can select branch, other than current
@@ -272,8 +274,8 @@
   - [ ] Panes can be resized horizontally, and contents resize to take the full width
     - [ ] Quitting Desktop and relaunching remembers sizes

-### Compare tab
-  - [ ] Compare (was History) tab shows commits on your current branch by default
+### History tab
+  - [ ] History tab shows commits on your current branch by default
     - [ ] All commits listed in chronological order, with avatar, date and name; list is scrollable with arrow keys enabled
       - [ ] Right clicking any commit shows options: Revert, Copy SHA, View on GitHub
       - [ ] Hover shows file name in tooltip
@@ -285,6 +287,20 @@
         - [ ] After successful merge, tab counts update and merge button is disabled
         - [ ] Merge conflict results in dialog shown directing user to commit view

+### Relationship between branches
+  - [ ] Clicking in field with placeholder text `Select Branch to Compare‚Ä¶` shows a list of all branches and their number of commits ahead and behind the currently checked out branch
+  - [ ] Pressing `esc` key clears the current filter
+  - [ ] Filtering for branch name that doesn't exist shows "Sorry, I can't find that branch"
+  - [ ] Selecting a branch from the list populates the tab with that branch comparison data
+    - [ ] Behind tab is shown by default
+      - [ ] See number of commits behind in tab header
+      - [ ] If more than 0 commits behind, a list of commits are shown in reverse chronological order
+      - [ ] See button to merge into current branch (button disabled if 0 commits behind)
+      - [ ] Clicking the merge button shows merge conflicts if any, or successfully merges the commit(s)
+      - [ ] After merging, the comparison branch is 0 commits behind
+    - [ ] Ahead tab is on the right-hand side
+      - [ ] If more than 0 commits ahead, a list of commits are shown in reverse chronological order
+
 ### Diffs tab
   - [ ] All commits have avatar, selectable SHA, # of files changed, commit message, commit description (optional)
     - [ ] Long commit descriptions can be toggled with expand/collapse icon
@@ -310,7 +326,8 @@
     - [ ] `Push` with number of commits badge is decremented or reverts to `Fetch origin`
   - [ ] `Undo` button disabled if user is pushing commit
   - [ ] User can publish a new repo with no commits (aka unborn repo/branch)
-  - [ ] User can make new branch the default branch, by making the intial commit on the new branch.
+  - [ ] User can make new branch the default branch, by making the intial commit on the new branch.
+  - [ ] User can select individual files to commit at a time

 ### Co-authoring
   - [ ] clicking co-author icon toggles co-author field; or right-click within commit area
@@ -373,7 +390,7 @@
 ### Github.com
   - [ ] If Desktop linked to .com (/settings/applications), the Desktop icon should show on File Revisions tab for all Pull Requests.
     - [ ] Clicking the "computer icon" opens from a Pull Request page opens the branch on Desktop
-  - [ ] `Open is Desktop` button under a repo's `Clone and Download` button should open repo in Desktop
+  - [ ] `Open in Desktop` button under a repo's `Clone and Download` button should open repo in Desktop
   - [ ] If private email is enabled (http://github.com/settings/emails), user is blocked from pushing to all associated repositories on Desktop?
   - [ ] If user updates name in Settings, change should reflect in Preferences

@@ -393,17 +410,9 @@
 ### Security
  - [ ] `Untrusted server` warning surfaced if GitHub cannot verify the identity of `api.github.com`; user can `Cancel` or `Continue`

+
 ### TBD placeholder (WIP)
-- Merge tool for conflicted files
-- Conflicted files vs changed files
-- Relationship between branches
-  - Commit/Compare tabs now occupy left pane
-    - Compare tab shows branch dropdown
-      - Choose a branch from the list (same order as branch list? current branch present?) or user filter; `ESC` clears filter
-       - Once branch selected, quantity of commits behind surfaced; matches commits shown
-         - `Merge X commits` button is activated
-           - Merge conflict count surfaced below button if relevant
-           - Clicking `Merge` button merges all shown commits
-    - Commit history present, chronological order, descending
-- Show Git LFS (Cloning, Committing, Checking out, Reverting, Switching branches)
-- Report Git LFS (Cloning, Pushing, Pulling, Switching branches, Reverting)
+  - Merge tool for conflicted files
+  - Conflicted files vs changed files
+  - Show Git LFS (Cloning, Committing, Checking out, Reverting, Switching branches)
+  - Report Git LFS (Cloning, Pushing, Pulling, Switching branches, Reverting)
added in remote
  their  100644 10459559490b110ff84127440cbbc8070a71f320 docs/technical/discard-changes.md
@@ -0,0 +1,41 @@
+# Discard Changes
+
+The `Discard Changes` feature allows users to clean up uncommitted changes from
+a repository, and has evolved over time to support different workflows.
+
+## Implementation
+
+As the implementation details of this may change over time, this section will
+instead describe the high-level flow of the implementation.
+
+You can view a reference of this function [here](https://github.com/desktop/desktop/blob/2b111155914cb44824b39ee197deed23bb825a1a/app/src/lib/stores/git-store.ts#L1066).
+
+The `Discard Changes` flow is composed of multiple steps.
+
+### Moving Files to Trash
+
+Electron provides the [`shell.moveItemToTrash(fullPath)`](https://electronjs.org/docs/api/shell#shellmoveitemtotrashfullpath)
+API to manage moving files into the OS-specific trash.
+
+Desktop uses this API to move _all new or modified files_ out from the
+repository as a way to preserve changes, in case the user wishes to recover
+them later. Files moved to the Trash are moved over as-is, so ensure you have
+the ability to view hidden files if you wish to recover files that are prefixed
+with `.`.
+
+### Reset Paths
+
+The next step is identifying any files that have been listed for discard that
+are also staged in the index. While Desktop doesn't stage files itself, a user
+might be using other tools alongside Desktop, so this is a sanity check before
+proceeding to the next stage.
+
+**Git CLI equivalent**: `git reset HEAD -- [path]`
+
+### Checkout Paths
+
+The last step is to replace the modified files in the working directory with
+whatever is currently in the index - this ensures that Desktop only replaces
+files that the user has chosen to discard.
+
+**Git CLI equivalent**: `git checkout-index -f -u -- [path]`
merged
  result 100644 29e7d36057950d884bd046bbe958c6329d2bf877 docs/technical/editor-integration.md
  our    100644 7eae1dc4e64282e2f51e3012da408314bb28d269 docs/technical/editor-integration.md
@@ -1,7 +1,7 @@
 # "Open External Editor" integration

 GitHub Desktop supports the user choosing an external program to open their
-local repositories, and this is available from the top-level **Repository** menu
+local repositories, and this is available from the top-level **Repository** menu
 or when right-clicking on a repository in the sidebar.

 ### My favourite editor XYZ isn't supported!
@@ -205,12 +205,17 @@
 These editors are currently supported:

  - [Atom](https://atom.io/)
+ - [MacVim](https://macvim-dev.github.io/macvim/)
  - [Visual Studio Code](https://code.visualstudio.com/) - both stable and Insiders channel
  - [Sublime Text](https://www.sublimetext.com/)
  - [BBEdit](http://www.barebones.com/products/bbedit/)
  - [PhpStorm](https://www.jetbrains.com/phpstorm/)
  - [RubyMine](https://www.jetbrains.com/rubymine/)
  - [TextMate](https://macromates.com)
+ - [Brackets](http://brackets.io/)
+     - To use Brackets the Command Line shortcut must be installed.
+       - This can be done by opening Brackets, choosing File > Install Command Line Shortcut
+ - [WebStorm](https://www.jetbrains.com/webstorm/)

 These are defined in an enum at the top of the file:

@@ -218,6 +223,7 @@

 export enum ExternalEditor {
   Atom = 'Atom',
+  MacVim = 'MacVim',
   VisualStudioCode = 'Visual Studio Code',
   VisualStudioCodeInsiders = 'Visual Studio Code (Insiders)',
   SublimeText = 'Sublime Text',
@@ -225,6 +231,8 @@
   PhpStorm = 'PhpStorm',
   RubyMine = 'RubyMine',
   TextMate = 'TextMate',
+  Brackets = 'Brackets',
+  WebStorm = 'WebStorm',
 }
 ```

merged
  result 100644 7d8f4be31c11ad21552dbebfde4c9e7fe02c50c9 docs/technical/feature-flagging.md
  our    100644 3528b827f8657b3ef30659605b96356d36362ced docs/technical/feature-flagging.md
@@ -50,10 +50,10 @@
 ## How to test

 **Opting-in for preview features**
-1. Set the `GITHUB_DESKTOP_PREVIEW_FEATURES` environment variable to any value
+1. Set the `GITHUB_DESKTOP_PREVIEW_FEATURES` environment variable to `1`
 1. Restart GitHub Desktop

-Don't have that environment variable?
+Don't have that environment variable?
 No worries, simply create it. (here's a [handy guide](https://www.schrodinger.com/kb/1842) for doing that on most major OSs).

 **Opting-out for preview features**
merged
  result 100644 348333d12c84aba9cf5ec7404d91e9a8c2816d07 docs/technical/placeholders.md
  our    100644 3264bc826adeac79be5573e87f2765c1dd8a4f60 docs/technical/placeholders.md
@@ -29,7 +29,7 @@

 ### Replacements

-The replacements defined for Desktop are found in [`app/app-info.js`](https://github.com/desktop/desktop/blob/master/app/app-info.js)
+The replacements defined for Desktop are found in [`app/app-info.ts`](https://github.com/desktop/desktop/blob/master/app/app-info.ts)
 as a hash of key-value pairs.

 ```ts
merged
  result 100644 ec1f940bd847054000a5e38f06e6b665799e8c10 docs/technical/shell-integration.md
  our    100644 9ddeb7ae5be00a841b49590b1966b84660000a77 docs/technical/shell-integration.md
@@ -25,6 +25,7 @@

  - Command Prompt (cmd)
  - PowerShell
+ - [PowerShell Core](https://github.com/powershell/powershell/)
  - [Hyper](https://hyper.sh/)
  - Git Bash (from [Git for Windows](https://git-for-windows.github.io/))

@@ -34,6 +35,7 @@
 export enum Shell {
   Cmd = 'Command Prompt',
   PowerShell = 'PowerShell',
+  PowerShellCore = 'PowerShell Core',
   Hyper = 'Hyper',
   GitBash = 'Git Bash',
 }
@@ -117,13 +119,14 @@

 ## macOS

-The source for the macOS shell integration is found in [`app/src/lib/shells/darwin.ts`](https://github.com/desktop/desktop/blob/master/app/src/lib/shell/darwin.ts).
+The source for the macOS shell integration is found in [`app/src/lib/shells/darwin.ts`](https://github.com/desktop/desktop/blob/master/app/src/lib/shells/darwin.ts).

 These shells are currently supported:

  - Terminal
  - [Hyper](https://hyper.sh/)
  - [iTerm2](https://www.iterm2.com/)
+ - [PowerShell Core](https://github.com/powershell/powershell/)

 These are defined in an enum at the top of the file:

@@ -132,6 +135,7 @@
   Terminal = 'Terminal',
   Hyper = 'Hyper',
   iTerm2 = 'iTerm2',
+  PowerShellCore = 'PowerShell Core',
 }
 ```

@@ -159,10 +163,16 @@
 export async function getAvailableShells(): Promise<
   ReadonlyArray<IFoundShell<Shell>>
 > {
-  const [terminalPath, hyperPath, iTermPath] = await Promise.all([
+  const [
+    terminalPath,
+    hyperPath,
+    iTermPath,
+    powerShellCorePath,
+  ] = await Promise.all([
     getShellPath(Shell.Terminal),
     getShellPath(Shell.Hyper),
     getShellPath(Shell.iTerm2),
+    getShellPath(Shell.PowerShellCore),
   ])

   // other code
@@ -194,7 +204,7 @@

 ## Linux

-The source for the Linux shell integration is found in [`app/src/lib/shells/linux.ts`](https://github.com/desktop/desktop/blob/master/app/src/lib/shell/linux.ts).
+The source for the Linux shell integration is found in [`app/src/lib/shells/linux.ts`](https://github.com/desktop/desktop/blob/master/app/src/lib/shells/linux.ts).

 These shells are currently supported:

@@ -238,7 +248,13 @@
 export async function getAvailableShells(): Promise<
   ReadonlyArray<IFoundShell<Shell>>
 > {
-  const [gnomeTerminalPath, tilixPath] = await Promise.all([
+  const [
+    gnomeTerminalPath,
+    tilixPath,
+    urxvtPath,
+    konsolePath,
+    xtermPath,
+  ] = await Promise.all([
     getShellPath(Shell.Gnome),
     getShellPath(Shell.Tilix),
     getShellPath(Shell.Urxvt),
merged
  result 100644 51b1541b7f0f67eef996aa5e53e8cc204767184f docs/technical/syntax-highlighting.md
  our    100644 35f4bc1d7dc42db2bcfe7ba638f3b5eaa4a7ec1f docs/technical/syntax-highlighting.md
@@ -8,7 +8,7 @@

 We currently support syntax highlighting for the following languages.

-JavaScript, JSON, TypeScript, Coffeescript, HTML, CSS, SCSS, LESS, VUE, Markdown, Yaml, XML, Objective-C, Scala, C#, Java, C, C++, Kotlin, Ocaml, F#, sh/bash, Swift, SQL, CYPHER, Go, Perl, PHP, Python, Ruby, Clojure, Rust, Elixir
+JavaScript, JSON, TypeScript, Coffeescript, HTML, CSS, SCSS, LESS, VUE, Markdown, Yaml, XML, Objective-C, Scala, C#, Java, C, C++, Kotlin, Ocaml, F#, sh/bash, Swift, SQL, CYPHER, Go, Perl, PHP, Python, Ruby, Clojure, Rust, Elixir, Haxe, R, JavaServer Pages, PowerShell

 This list was never meant to be exhaustive, we expect to add more languages going forward but this seemed like a good first step.

merged
  result 100644 24218535cd0fa338ea3b7a8a32e7b458b6811b44 eslint-rules/insecure-random.js
  our    100644 710ff6f58b2b9abf091c4353b1264456baeb1fb3 eslint-rules/insecure-random.js
@@ -1,5 +1,6 @@
-// strings from https://github.com/Microsoft/tslint-microsoft-contrib/blob/b720cd9/src/insecureRandomRule.ts
+'use strict'

+// strings from https://github.com/Microsoft/tslint-microsoft-contrib/blob/b720cd9/src/insecureRandomRule.ts
 const MATH_FAIL_STRING =
   'Math.random produces insecure random numbers. ' +
   'Use crypto.randomBytes() or window.crypto.getRandomValues() instead'
changed in both
  base   100644 dc892d10739ef87c70391aedcfdc3241753eebbb package.json
  our    100644 a230a49de70c920a24d34b1af9952a17b72e7a1c package.json
  their  100644 461f60af798d32097510dcd519c5cdd4b860771e package.json
@@ -5,11 +5,12 @@
   },
   "description": "GitHub Desktop build dependencies",
   "scripts": {
-    "cli": "ts-node --require ./app/test/globals.ts --require ./app/src/cli/dev-commands-global.js app/src/cli/main.ts",
-    "test:integration": "cross-env TEST_ENV=1 ELECTRON_NO_ATTACH_CONSOLE=1 xvfb-maybe mocha -t 30000 --require ts-node/register app/test/integration/*.ts",
-    "test:unit": "cross-env GIT_AUTHOR_NAME=\"Joe Bloggs\" GIT_AUTHOR_EMAIL=\"joe.bloggs@somewhere.com\" GIT_COMMITTER_NAME=\"Joe Bloggs\" GIT_COMMITTER_EMAIL=\"joe.bloggs@somewhere.com\" TEST_ENV=1 ELECTRON_NO_ATTACH_CONSOLE=1 xvfb-maybe electron-mocha -t 10000 --renderer --require ts-node/register --require ./app/test/globals.ts app/test/unit/*.{ts,tsx} app/test/unit/**/*.{ts,tsx}",
+    "cli": "ts-node --require ./app/test/globals.ts --require ./app/src/cli/dev-commands-global.ts app/src/cli/main.ts",
+    "test:integration": "cross-env TEST_ENV=1 ELECTRON_NO_ATTACH_CONSOLE=1 xvfb-maybe --auto-servernum -- mocha -t 30000 --require ts-node/register app/test/integration/*.ts",
+    "test:unit": "ts-node script/unit-tests.ts",
     "test:script": "mocha -t 10000 --require ts-node/register script/changelog/test/*.ts",
     "test": "yarn test:unit && yarn test:script && yarn test:integration",
+<<<<<<< .our
     "test:setup": "ts-node script/test-setup.ts",
     "test:review": "ts-node script/test-review.ts",
     "postinstall": "yarn install-app && yarn install-changelog && yarn update-submodules && yarn compile:tslint",
@@ -23,20 +24,31 @@
     "compile:prod": "cross-env NODE_ENV=production parallel-webpack --config app/webpack.production.js",
     "build:dev": "yarn compile:dev && cross-env NODE_ENV=development ts-node script/build.ts",
     "build:prod": "yarn compile:prod && cross-env NODE_ENV=production ts-node script/build.ts",
+=======
+    "test:setup": "ts-node -P script/tsconfig.json script/test-setup.ts",
+    "test:review": "ts-node  -P script/tsconfig.json script/test-review.ts",
+    "postinstall": "cd app && yarn install --force && cd .. && git submodule update --recursive --init && yarn compile:tslint && yarn compile:script",
+    "start": "cross-env NODE_ENV=development ts-node -P script/tsconfig.json script/start.ts",
+    "start:prod": "cross-env NODE_ENV=production ts-node -P script/tsconfig.json script/start.ts",
+    "compile:dev": "cross-env NODE_ENV=development parallel-webpack --config app/webpack.development.ts",
+    "compile:prod": "cross-env NODE_ENV=production parallel-webpack --config app/webpack.production.ts",
+    "build:dev": "yarn compile:dev && cross-env NODE_ENV=development ts-node -P script/tsconfig.json script/build.ts",
+    "build:prod": "yarn compile:prod && cross-env NODE_ENV=production ts-node -P script/tsconfig.json script/build.ts",
+>>>>>>> .their
     "package": "ts-node -P script/tsconfig.json script/package.ts",
-    "generate-octicons": "ts-node script/generate-octicons.ts",
+    "generate-octicons": "ts-node -P script/tsconfig.json script/generate-octicons.ts",
     "clean:tslint": "rimraf tslint-rules/*.js",
-    "compile:tslint": "tsc -p tslint-rules",
-    "compile:script": "tsc -p script",
+    "compile:tslint": "tsc -P tslint-rules",
+    "compile:script": "tsc -P script/tsconfig.json",
     "lint": "yarn lint:src && yarn lint:prettier",
     "lint:fix": "yarn lint:src:fix && yarn lint:prettier --fix",
     "lint:prettier": "ts-node script/prettier.ts",
     "lint:src": "yarn tslint && yarn eslint-check && yarn eslint",
     "lint:src:fix": "yarn tslint --fix && yarn eslint --fix",
-    "tslint": "tslint ./{script,tslint-rules}/*.ts ./app/{src,typings,test}/**/*.{ts,tsx}",
-    "eslint": "ts-node script/eslint.ts",
+    "tslint": "tslint -p .",
+    "eslint": "ts-node -P script/tsconfig.json script/eslint.ts",
     "eslint-check": "eslint --print-config .eslintrc.* | eslint-config-prettier-check",
-    "publish": "node script/publish",
+    "publish": "ts-node -P script/tsconfig.json script/publish.ts",
     "clean-slate": "rimraf out node_modules app/node_modules && yarn",
     "rebuild-hard:dev": "yarn clean-slate && yarn build:dev",
     "rebuild-hard:prod": "yarn clean-slate && yarn build:prod",
@@ -51,61 +63,63 @@
   },
   "license": "MIT",
   "engines": {
-    "node": ">= 7",
-    "yarn": ">= 1.2.0"
+    "node": ">= 8.10",
+    "yarn": ">= 1.5.0"
   },
   "dependencies": {
     "ajv": "^6.4.0",
-    "awesome-typescript-loader": "^3.4.0",
+    "awesome-node-loader": "^1.1.0",
+    "awesome-typescript-loader": "^5.0.0",
     "aws-sdk": "^2.23.0",
-    "babel-core": "^6.24.1",
-    "babel-minify": "^0.2.0",
-    "babel-webpack-plugin": "^0.1.1",
+    "babel-core": "^6.26.3",
+    "babel-minify-webpack-plugin": "^0.3.1",
+    "babel-plugin-syntax-dynamic-import": "^6.18.0",
     "chai": "^4.1.1",
     "chai-as-promised": "^7.1.1",
     "chai-datetime": "^1.4.1",
     "chalk": "^2.2.0",
-    "clean-webpack-plugin": "^0.1.16",
+    "clean-webpack-plugin": "^0.1.19",
     "cross-env": "^5.0.5",
-    "css-loader": "^0.28.5",
+    "css-loader": "^0.28.11",
     "eslint": "^4.19.1",
     "eslint-config-prettier": "^2.9.0",
     "eslint-plugin-babel": "^4.1.2",
     "eslint-plugin-json": "^1.2.0",
     "eslint-plugin-prettier": "^2.6.0",
     "eslint-plugin-react": "^7.7.0",
-    "eslint-plugin-typescript": "^0.10.0",
+    "eslint-plugin-typescript": "^0.12.0",
     "express": "^4.15.0",
-    "extract-text-webpack-plugin": "^3.0.0",
-    "fs-extra": "^2.1.2",
-    "html-webpack-plugin": "^2.30.1",
+    "front-matter": "^2.3.0",
+    "fs-extra": "^6.0.0",
+    "html-webpack-plugin": "^3.2.0",
     "json-pretty": "^0.0.1",
     "klaw-sync": "^3.0.0",
     "legal-eagle": "0.15.0",
+    "mini-css-extract-plugin": "^0.4.0",
     "mocha": "^5.0.4",
-    "node-native-loader": "^1.1.1",
     "node-sass": "^4.7.2",
     "octicons": "^7.0.1",
-    "parallel-webpack": "^2.1.0",
-    "prettier": "1.11.1",
+    "parallel-webpack": "^2.3.0",
+    "prettier": "1.13.0",
     "request": "^2.72.0",
     "rimraf": "^2.5.2",
-    "sass-loader": "^6.0.6",
+    "sass-loader": "^7.0.1",
     "semver": "^5.5.0",
     "spectron": "^3.8.0",
-    "style-loader": "^0.19.1",
+    "style-loader": "^0.21.0",
     "to-camel-case": "^1.0.0",
     "ts-node": "^5.0.1",
     "tslint": "^5.9.1",
     "tslint-config-prettier": "^1.10.0",
     "tslint-microsoft-contrib": "^5.0.3",
     "tslint-react": "^3.5.1",
-    "typescript": "^2.8.1",
-    "typescript-eslint-parser": "^14.0.0",
-    "webpack": "^3.10.0",
-    "webpack-dev-middleware": "^2.0.3",
-    "webpack-hot-middleware": "^2.21.0",
-    "webpack-merge": "^4.1.0",
+    "typescript": "^2.9.1",
+    "typescript-eslint-parser": "^16.0.0",
+    "webpack": "^4.8.3",
+    "webpack-bundle-analyzer": "^2.13.0",
+    "webpack-dev-middleware": "^3.1.3",
+    "webpack-hot-middleware": "^2.22.2",
+    "webpack-merge": "^4.1.2",
     "xml2js": "^0.4.16",
     "xvfb-maybe": "^0.2.1"
   },
@@ -114,21 +128,28 @@
     "@types/chai": "^4.1.2",
     "@types/chai-datetime": "^0.0.31",
     "@types/classnames": "^2.2.2",
+    "@types/clean-webpack-plugin": "^0.1.2",
     "@types/codemirror": "0.0.55",
     "@types/electron-packager": "^10.1.0",
     "@types/electron-winstaller": "^2.6.0",
     "@types/event-kit": "^1.2.28",
+    "@types/express": "^4.11.0",
+    "@types/extract-text-webpack-plugin": "^3.0.3",
     "@types/file-url": "^2.0.0",
-    "@types/fs-extra": "2.1.0",
+    "@types/fs-extra": "^5.0.2",
     "@types/fuzzaldrin-plus": "^0.0.1",
+    "@types/html-webpack-plugin": "^2.30.3",
     "@types/keytar": "^4.0.0",
+    "@types/legal-eagle": "^0.15.0",
+    "@types/mini-css-extract-plugin": "^0.2.0",
     "@types/mocha": "^2.2.48",
     "@types/mri": "^1.1.0",
-    "@types/node": "^7.0.18",
-    "@types/react": "^16.0.40",
-    "@types/react-dom": "^16.0.4",
+    "@types/node": "^8.10.4",
+    "@types/react": "^16.3.16",
+    "@types/react-dom": "^16.0.5",
     "@types/react-transition-group": "1.1.1",
     "@types/react-virtualized": "^9.7.12",
+    "@types/request": "^2.0.9",
     "@types/semver": "^5.5.0",
     "@types/strip-ansi": "^3.0.0",
     "@types/temp": "^0.8.29",
@@ -137,9 +158,14 @@
     "@types/ua-parser-js": "^0.7.30",
     "@types/untildify": "^3.0.0",
     "@types/uuid": "^3.4.0",
+    "@types/webpack": "^4.4.0",
+    "@types/webpack-bundle-analyzer": "^2.9.2",
+    "@types/webpack-dev-middleware": "^2.0.1",
+    "@types/webpack-hot-middleware": "^2.16.3",
+    "@types/webpack-merge": "^4.1.3",
     "@types/winston": "^2.2.0",
     "@types/xml2js": "^0.4.0",
-    "electron": "1.8.3",
+    "electron": "1.8.7",
     "electron-builder": "20.2.0",
     "electron-mocha": "^6.0.1",
     "electron-packager": "^11.0.0",
merged
  result 100644 793329336d0e4e7086d8a4856cc3e404b6d33528 script/.eslintrc.yml
  our    100644 cb8912301f224a449793498cd95802cb6161ee31 script/.eslintrc.yml
@@ -1,4 +1,3 @@
 rules:
   unicorn/no-process-exit: off
   import/no-commonjs: off
-  no-sync: off
merged
  result 100755 a76c37cc7ddbf18efa4c1cbbd3e5aba7f4ce6678 script/build.ts
  our    100755 c1e7dfd7e04705645c003fc4d315617e68abc846 script/build.ts
@@ -1,4 +1,3 @@
-/* tslint:disable:no-sync-functions */
 /* eslint-disable no-sync */
 /// <reference path="./globals.d.ts" />

@@ -7,7 +6,34 @@
 import * as fs from 'fs-extra'
 import * as packager from 'electron-packager'

-const legalEagle: LegalEagle = require('legal-eagle')
+import { licenseOverrides } from './license-overrides'
+
+import { externals } from '../app/webpack.common'
+
+import * as legalEagle from 'legal-eagle'
+
+interface IFrontMatterResult<T> {
+  readonly attributes: T
+  readonly body: string
+}
+
+interface IChooseALicense {
+  readonly title: string
+  readonly nickname?: string
+  readonly featured?: boolean
+  readonly hidden?: boolean
+}
+
+export interface ILicense {
+  readonly name: string
+  readonly featured: boolean
+  readonly body: string
+  readonly hidden: boolean
+}
+
+const frontMatter: <T>(
+  path: string
+) => IFrontMatterResult<T> = require('front-matter')

 import {
   getBundleID,
@@ -37,6 +63,11 @@
 console.log('Copying static resources‚Ä¶')
 copyStaticResources()

+console.log('Parsing license metadata‚Ä¶')
+generateLicenseMetadata(outRoot)
+
+moveAnalysisFiles()
+
 const isFork = process.env.CIRCLE_PR_USERNAME
 if (process.platform === 'darwin' && process.env.CIRCLECI && !isFork) {
   console.log('Setting up keychain‚Ä¶')
@@ -95,10 +126,24 @@
     )
   }

+  const toPackageArch = (targetArch: string | undefined): packager.arch => {
+    if (targetArch === undefined) {
+      return 'x64'
+    }
+
+    if (targetArch === 'arm64' || targetArch === 'x64') {
+      return targetArch
+    }
+
+    throw new Error(
+      `Building Desktop for architecture '${targetArch}'  is not supported`
+    )
+  }
+
   const options: packager.Options & IPackageAdditionalOptions = {
     name: getExecutableName(),
     platform: toPackagePlatform(process.platform),
-    arch: process.env.TARGET_ARCH || 'x64',
+    arch: toPackageArch(process.env.TARGET_ARCH),
     asar: false, // TODO: Probably wanna enable this down the road.
     out: getDistRoot(),
     icon: path.join(projectRoot, 'app', 'static', 'logos', 'icon-logo'),
@@ -175,7 +220,23 @@
   if (fs.existsSync(platformSpecific)) {
     fs.copySync(platformSpecific, destination)
   }
-  fs.copySync(common, destination, { clobber: false })
+  fs.copySync(common, destination, { overwrite: false })
+}
+
+function moveAnalysisFiles() {
+  const rendererReport = 'renderer.report.html'
+  const analysisSource = path.join(outRoot, rendererReport)
+  if (fs.existsSync(analysisSource)) {
+    const distRoot = getDistRoot()
+    const destination = path.join(distRoot, rendererReport)
+    fs.mkdirpSync(distRoot)
+    // there's no moveSync API here, so let's do it the old fashioned way
+    //
+    // unlinkSync below ensures that the analysis file isn't bundled into
+    // the app by accident
+    fs.copySync(analysisSource, destination, { overwrite: true })
+    fs.unlinkSync(analysisSource)
+  }
 }

 function copyDependencies() {
@@ -186,9 +247,6 @@
     'package.json'
   ))

-  // eslint-disable-next-line import/no-dynamic-require
-  const commonConfig = require(path.resolve(__dirname, '../app/webpack.common'))
-  const externals = commonConfig.externals
   const oldDependencies = originalPackage.dependencies
   const newDependencies: PackageLookup = {}

@@ -296,7 +354,6 @@
 function updateLicenseDump(callback: (err: Error | null) => void) {
   const appRoot = path.join(projectRoot, 'app')
   const outPath = path.join(outRoot, 'static', 'licenses.json')
-  const licenseOverrides: LicenseLookup = require('./license-overrides')

   legalEagle(
     { path: appRoot, overrides: licenseOverrides, omitPermissive: true },
@@ -353,3 +410,54 @@
     }
   )
 }
+
+function generateLicenseMetadata(outRoot: string) {
+  const chooseALicense = path.join(outRoot, 'static', 'choosealicense.com')
+  const licensesDir = path.join(chooseALicense, '_licenses')
+
+  const files = fs.readdirSync(licensesDir)
+
+  const licenses = new Array<ILicense>()
+  for (const file of files) {
+    const fullPath = path.join(licensesDir, file)
+    const contents = fs.readFileSync(fullPath, 'utf8')
+    const result = frontMatter<IChooseALicense>(contents)
+    const license: ILicense = {
+      name: result.attributes.nickname || result.attributes.title,
+      featured: result.attributes.featured || false,
+      hidden:
+        result.attributes.hidden === undefined || result.attributes.hidden,
+      body: result.body.trim(),
+    }
+
+    if (!license.hidden) {
+      licenses.push(license)
+    }
+  }
+
+  const licensePayload = path.join(outRoot, 'static', 'available-licenses.json')
+  const text = JSON.stringify(licenses)
+  fs.writeFileSync(licensePayload, text, 'utf8')
+
+  // embed the license alongside the generated license payload
+  const chooseALicenseLicense = path.join(chooseALicense, 'LICENSE.md')
+  const licenseDestination = path.join(
+    outRoot,
+    'static',
+    'LICENSE.choosealicense.md'
+  )
+
+  const licenseText = fs.readFileSync(chooseALicenseLicense, 'utf8')
+  const licenseWithHeader = `GitHub Desktop uses licensing information provided by choosealicense.com.
+
+The bundle in available-licenses.json has been generated from a source list provided at https://github.com/github/choosealicense.com, which is made available under the below license:
+
+------------
+
+${licenseText}`
+
+  fs.writeFileSync(licenseDestination, licenseWithHeader, 'utf8')
+
+  // sweep up the choosealicense directory as the important bits have been bundled in the app
+  fs.removeSync(chooseALicense)
+}
changed in both
  base   100644 b0a88cf77391d915e28566a1695cbf31c2ab7bbb script/changelog/parser.ts
  our    100644 ff08e0ef253ffb980b0ed57114f9fefea05d7fc1 script/changelog/parser.ts
  their  100644 aad3c838c2d7931127adbc843bdd83ccda5968a1 script/changelog/parser.ts
@@ -116,6 +116,7 @@
   const root = Path.dirname(Path.dirname(__dirname))
   const changelogPath = Path.join(root, 'changelog.json')

+  // eslint-disable-next-line no-sync
   const buffer = Fs.readFileSync(changelogPath)
   const changelogText = buffer.toString()

removed in remote
  base   100644 ad4855567fb5e193b74292af394786561793577f script/debug
  our    100644 ad4855567fb5e193b74292af394786561793577f script/debug
@@ -1,29 +0,0 @@
-#!/usr/bin/env node
-
-'use strict'
-
-const express = require('express')
-const webpack = require('webpack')
-const config = require('../app/webpack.development')
-const server = express()
-const compiler = webpack(config)
-const port = process.env.PORT || 3000
-
-server.use(
-  require('webpack-dev-middleware')(compiler, {
-    publicPath: config.output.publicPath,
-    noInfo: true,
-  })
-)
-
-server.use(require('webpack-hot-middleware')(compiler))
-
-server.listen(port, 'localhost', err => {
-  if (err) {
-    console.log(err)
-    process.exit(1)
-    return
-  }
-
-  console.log(`Server running at http://localhost:${port}`)
-})
removed in remote
  base   100644 761dea8563e41854304fb72b473ef14d0ead525f script/dist-info.d.ts
  our    100644 761dea8563e41854304fb72b473ef14d0ead525f script/dist-info.d.ts
@@ -1,20 +0,0 @@
-export function getDistRoot(): string
-export function getDistPath(): string
-export function getOSXZipName(): string
-export function getOSXZipPath(): string
-export function getWindowsInstallerName(): string
-export function getWindowsInstallerPath(): string
-export function getWindowsStandaloneName(): string
-export function getWindowsStandalonePath(): string
-export function getWindowsFullNugetPackageName(): string
-export function getWindowsFullNugetPackagePath(): string
-export function getWindowsIdentifierName(): string
-export function getBundleSizes(): { rendererSize: number; mainSize: number }
-export function getReleaseChannel(): string | null
-export function getReleaseSHA(): string | null
-export function getUpdatesURL(): string
-export function getWindowsDeltaNugetPackageName(): string
-export function getWindowsDeltaNugetPackagePath(): string
-export function shouldMakeDelta(): boolean
-export function getReleaseBranchName(): string
-export function getExecutableName(): string
removed in remote
  base   100644 b516179431c4275fa3a02610faa699fab1241710 script/dist-info.js
  our    100644 b516179431c4275fa3a02610faa699fab1241710 script/dist-info.js
@@ -1,163 +0,0 @@
-'use strict'
-
-const path = require('path')
-const fs = require('fs')
-const os = require('os')
-
-const packageInfo = require('../app/package-info')
-const productName = packageInfo.getProductName()
-const version = packageInfo.getVersion()
-
-const projectRoot = path.join(__dirname, '..')
-
-function getDistRoot() {
-  return path.join(projectRoot, 'dist')
-}
-
-function getDistPath() {
-  return path.join(
-    getDistRoot(),
-    `${getExecutableName()}-${process.platform}-${os.arch()}`
-  )
-}
-
-function getExecutableName() {
-  const suffix = process.env.NODE_ENV === 'development' ? '-dev' : ''
-
-  if (process.platform === 'win32') {
-    return `${getWindowsIdentifierName()}${suffix}`
-  } else if (process.platform === 'linux') {
-    return 'desktop'
-  } else {
-    return productName
-  }
-}
-
-function getOSXZipName() {
-  return `${productName}.zip`
-}
-
-function getOSXZipPath() {
-  return path.join(getDistPath(), '..', getOSXZipName())
-}
-
-function getWindowsInstallerName() {
-  const productName = getExecutableName()
-  return `${productName}Setup.msi`
-}
-
-function getWindowsInstallerPath() {
-  return path.join(getDistPath(), '..', 'installer', getWindowsInstallerName())
-}
-
-function getWindowsStandaloneName() {
-  const productName = getExecutableName()
-  return `${productName}Setup.exe`
-}
-
-function getWindowsStandalonePath() {
-  return path.join(getDistPath(), '..', 'installer', getWindowsStandaloneName())
-}
-
-function getWindowsFullNugetPackageName() {
-  return `${getWindowsIdentifierName()}-${version}-full.nupkg`
-}
-
-function getWindowsFullNugetPackagePath() {
-  return path.join(
-    getDistPath(),
-    '..',
-    'installer',
-    getWindowsFullNugetPackageName()
-  )
-}
-
-function getWindowsDeltaNugetPackageName() {
-  return `${getWindowsIdentifierName()}-${version}-delta.nupkg`
-}
-
-function getWindowsDeltaNugetPackagePath() {
-  return path.join(
-    getDistPath(),
-    '..',
-    'installer',
-    getWindowsDeltaNugetPackageName()
-  )
-}
-
-function getWindowsIdentifierName() {
-  return 'GitHubDesktop'
-}
-
-function getBundleSizes() {
-  const rendererStats = fs.statSync(
-    path.join(projectRoot, 'out', 'renderer.js')
-  )
-  const mainStats = fs.statSync(path.join(projectRoot, 'out', 'main.js'))
-  return { rendererSize: rendererStats.size, mainSize: mainStats.size }
-}
-
-function getReleaseBranchName() {
-  let branchName
-  if (process.platform === 'darwin') {
-    branchName = process.env.CIRCLE_BRANCH
-  } else if (process.platform === 'win32') {
-    branchName = process.env.APPVEYOR_REPO_BRANCH
-  }
-
-  return branchName || ''
-}
-
-function getReleaseChannel() {
-  // Branch name format: __release-CHANNEL-DEPLOY_ID
-  const pieces = getReleaseBranchName().split('-')
-  if (pieces.length < 3 || pieces[0] !== '__release') {
-    return process.env.NODE_ENV || 'development'
-  }
-
-  return pieces[1]
-}
-
-function getReleaseSHA() {
-  // Branch name format: __release-CHANNEL-DEPLOY_ID
-  const pieces = getReleaseBranchName().split('-')
-  if (pieces.length < 3 || pieces[0] !== '__release') {
-    return null
-  }
-
-  return pieces[2]
-}
-
-function getUpdatesURL() {
-  return `https://central.github.com/api/deployments/desktop/desktop/latest?version=${version}&env=${getReleaseChannel()}`
-}
-
-function shouldMakeDelta() {
-  // Only production and beta channels include deltas. Test releases aren't
-  // necessarily sequential so deltas wouldn't make sense.
-  const channelsWithDeltas = ['production', 'beta']
-  return channelsWithDeltas.indexOf(getReleaseChannel()) > -1
-}
-
-module.exports = {
-  getDistRoot,
-  getDistPath,
-  getOSXZipName,
-  getOSXZipPath,
-  getWindowsInstallerName,
-  getWindowsInstallerPath,
-  getWindowsStandaloneName,
-  getWindowsStandalonePath,
-  getWindowsFullNugetPackageName,
-  getWindowsFullNugetPackagePath,
-  getWindowsIdentifierName,
-  getBundleSizes,
-  getReleaseChannel,
-  getReleaseSHA,
-  getUpdatesURL,
-  getWindowsDeltaNugetPackageName,
-  getWindowsDeltaNugetPackagePath,
-  shouldMakeDelta,
-  getReleaseBranchName,
-  getExecutableName,
-}
added in remote
  their  100644 8661aa1a9becdd6f0f77dc9101c6eb665295544d script/dist-info.ts
@@ -0,0 +1,137 @@
+import * as Path from 'path'
+import * as Fs from 'fs'
+
+import { getProductName, getVersion } from '../app/package-info'
+
+const productName = getProductName()
+const version = getVersion()
+
+const projectRoot = Path.join(__dirname, '..')
+
+export function getDistRoot() {
+  return Path.join(projectRoot, 'dist')
+}
+
+export function getDistPath() {
+  return Path.join(
+    getDistRoot(),
+    `${getExecutableName()}-${process.platform}-x64`
+  )
+}
+
+export function getExecutableName() {
+  const suffix = process.env.NODE_ENV === 'development' ? '-dev' : ''
+
+  if (process.platform === 'win32') {
+    return `${getWindowsIdentifierName()}${suffix}`
+  } else if (process.platform === 'linux') {
+    return 'desktop'
+  } else {
+    return productName
+  }
+}
+
+export function getOSXZipName() {
+  return `${productName}.zip`
+}
+
+export function getOSXZipPath() {
+  return Path.join(getDistPath(), '..', getOSXZipName())
+}
+
+export function getWindowsInstallerName() {
+  const productName = getExecutableName()
+  return `${productName}Setup.msi`
+}
+
+export function getWindowsInstallerPath() {
+  return Path.join(getDistPath(), '..', 'installer', getWindowsInstallerName())
+}
+
+export function getWindowsStandaloneName() {
+  const productName = getExecutableName()
+  return `${productName}Setup.exe`
+}
+
+export function getWindowsStandalonePath() {
+  return Path.join(getDistPath(), '..', 'installer', getWindowsStandaloneName())
+}
+
+export function getWindowsFullNugetPackageName() {
+  return `${getWindowsIdentifierName()}-${version}-full.nupkg`
+}
+
+export function getWindowsFullNugetPackagePath() {
+  return Path.join(
+    getDistPath(),
+    '..',
+    'installer',
+    getWindowsFullNugetPackageName()
+  )
+}
+
+export function getWindowsDeltaNugetPackageName() {
+  return `${getWindowsIdentifierName()}-${version}-delta.nupkg`
+}
+
+export function getWindowsDeltaNugetPackagePath() {
+  return Path.join(
+    getDistPath(),
+    '..',
+    'installer',
+    getWindowsDeltaNugetPackageName()
+  )
+}
+
+export function getWindowsIdentifierName() {
+  return 'GitHubDesktop'
+}
+
+export function getBundleSizes() {
+  // eslint-disable-next-line no-sync
+  const rendererStats = Fs.statSync(
+    Path.join(projectRoot, 'out', 'renderer.js')
+  )
+  // eslint-disable-next-line no-sync
+  const mainStats = Fs.statSync(Path.join(projectRoot, 'out', 'main.js'))
+  return { rendererSize: rendererStats.size, mainSize: mainStats.size }
+}
+
+export function getReleaseBranchName(): string {
+  return (
+    process.env.CIRCLE_BRANCH || // macOS
+    process.env.APPVEYOR_REPO_BRANCH || // Windows
+    ''
+  )
+}
+
+export function getReleaseChannel() {
+  // Branch name format: __release-CHANNEL-DEPLOY_ID
+  const pieces = getReleaseBranchName().split('-')
+  if (pieces.length < 3 || pieces[0] !== '__release') {
+    return process.env.NODE_ENV || 'development'
+  }
+
+  return pieces[1]
+}
+
+export function getReleaseSHA() {
+  // Branch name format: __release-CHANNEL-DEPLOY_ID
+  const pieces = getReleaseBranchName().split('-')
+  if (pieces.length < 3 || pieces[0] !== '__release') {
+    return null
+  }
+
+  return pieces[2]
+}
+
+export function getUpdatesURL() {
+  return `https://central.github.com/api/deployments/desktop/desktop/latest?version=${version}&env=${getReleaseChannel()}`
+}
+
+export function shouldMakeDelta() {
+  // Only production and beta channels include deltas. Test releases aren't
+  // necessarily sequential so deltas wouldn't make sense.
+  const channelsWithDeltas = ['production', 'beta']
+  return channelsWithDeltas.indexOf(getReleaseChannel()) > -1
+}
merged
  result 100644 c71f2850346b76957d6eb4312308b15714d08361 script/eslint.ts
  our    100644 953deb6d112573e32a78fd54bc428c723508a788 script/eslint.ts
@@ -16,7 +16,7 @@
 const report = eslint.executeOnFiles([
   './{script,eslint-rules}/**/*.{j,t}s?(x)',
   './tslint-rules/**/*.ts',
-  './app/*.js',
+  './app/*.ts',
   './app/{src,typings,test}/**/*.{j,t}s?(x)',
   './changelog.json',
 ])
merged
  result 100644 bb3b7645eac13fe68f14a1e2b6b95e522d234648 script/globals.d.ts
  our    100644 d9ee18180f09bbb636b084a49eac223aa170eb71 script/globals.d.ts
@@ -6,63 +6,6 @@
   devDependencies: PackageLookup
 }

-// type declarations for legal-eagle
-type LicenseLookup = {
-  [key: string]: LicenseEntry
-}
-
-type LegalEagleOptions = {
-  path: string
-  overrides: LicenseLookup
-  omitPermissive?: boolean
-}
-
-type LicenseEntry = {
-  license: string
-  source: string
-  repository: string
-  sourceText: string
-}
-
-type LegalEagle = (
-  options: LegalEagleOptions,
-  callback: (error: Error | null, summary: LicenseLookup) => void
-) => void
-
-// type declarations for electron-installer-redhat
-type RedhatOptions = {
-  src: string
-  dest: string
-  arch: string
-}
-
-type ElectronInstallerRedhat = (
-  options: RedhatOptions,
-  callback: (error: Error | null) => void
-) => void
-
-// type declarations for electron-installer-debian
-type DebianOptions = {
-  src: string
-  dest: string
-  arch: string
-}
-
-type ElectronInstallerDebian = (
-  options: DebianOptions,
-  callback: (error: Error | null) => void
-) => void
-
-// type declarations for electron-installer-appimage
-type AppImageOptions = {
-  dir: string
-  targetArch: string
-}
-
-type ElectronInstallerAppImage = {
-  default: (options: AppImageOptions) => Promise<void>
-}
-
 declare namespace NodeJS {
   // eslint-disable-next-line typescript/interface-name-prefix
   interface Process extends EventEmitter {
removed in remote
  base   100644 92a4128288d1d86d9eca15d695a8cb8d846bcb58 script/license-overrides.js
  our    100644 92a4128288d1d86d9eca15d695a8cb8d846bcb58 script/license-overrides.js
@@ -1,45 +0,0 @@
-module.exports = {
-  'cycle@1.0.3': {
-    repository: 'git+ssh://git@github.com/dscape/cycle',
-    license: 'Public Domain',
-    source:
-      'cycle.js header comment at https://github.com/dscape/cycle/blob/ab67ce90e8fa2efdb8f21074661366ec56f6a724/cycle.js',
-    sourceText:
-      'Public Domain.\n\nNO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.',
-  },
-
-  'json-schema@0.2.3': {
-    repository: 'git+ssh://git@github.com/kriszyp/json-schema',
-    license: 'BSD',
-    source:
-      'README.md at https://github.com/kriszyp/json-schema/tree/24c4ed1b2359ab457a00e90606a777c2962ecd3b',
-    sourceText:
-      'Code is licensed under the AFL or BSD 3-Clause license as part of the Persevere project which is administered under the Dojo foundation, and all contributions require a Dojo CLA.',
-  },
-
-  'wicg-focus-ring@1.0.1': {
-    repository: 'git+https://github.com/WICG/focus-ring',
-    license: 'MIT',
-    source:
-      'https://github.com/WICG/focus-ring/blob/4df78f379e4c7dbaa1a5e4ff25cf1b56700b24ee/LICENSE.md',
-    sourceText: `This work is being provided by the copyright holders under the following license.
-
-License
-
-By obtaining and/or copying this work, you (the licensee) agree that you have read, understood, and will comply with the following terms and conditions.
-
-Permission to copy, modify, and distribute this work, with or without modification, for any purpose and without fee or royalty is hereby granted, provided that you include the following on ALL copies of the work or portions thereof, including modifications:
-
-* The full text of this NOTICE in a location viewable to users of the redistributed or derivative work.
-* Any pre-existing intellectual property disclaimers, notices, or terms and conditions. If none exist, the W3C Software and Document Short Notice should be included.
-* Notice of any changes or modifications, through a copyright statement on the new code or document such as "This software or document includes material copied from or derived from [title and URI of the W3C document]. Copyright ¬© [YEAR] W3C¬Æ (MIT, ERCIM, Keio, Beihang)."
-
-Disclaimers
-
-THIS WORK IS PROVIDED "AS IS," AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS.
-
-COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.
-
-The name and trademarks of copyright holders may NOT be used in advertising or publicity pertaining to the work without specific, written prior permission. Title to copyright in this work will at all times remain with copyright holders.`,
-  },
-}
added in remote
  their  100644 03fdf69fd8b91f2bd0d89f4f124473a4f2affff5 script/license-overrides.ts
@@ -0,0 +1,47 @@
+import { LicenseLookup } from 'legal-eagle'
+
+export const licenseOverrides: LicenseLookup = {
+  'cycle@1.0.3': {
+    repository: 'git+ssh://git@github.com/dscape/cycle',
+    license: 'Public Domain',
+    source:
+      'cycle.js header comment at https://github.com/dscape/cycle/blob/ab67ce90e8fa2efdb8f21074661366ec56f6a724/cycle.js',
+    sourceText:
+      'Public Domain.\n\nNO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.',
+  },
+
+  'json-schema@0.2.3': {
+    repository: 'git+ssh://git@github.com/kriszyp/json-schema',
+    license: 'BSD',
+    source:
+      'README.md at https://github.com/kriszyp/json-schema/tree/24c4ed1b2359ab457a00e90606a777c2962ecd3b',
+    sourceText:
+      'Code is licensed under the AFL or BSD 3-Clause license as part of the Persevere project which is administered under the Dojo foundation, and all contributions require a Dojo CLA.',
+  },
+
+  'wicg-focus-ring@1.0.1': {
+    repository: 'git+https://github.com/WICG/focus-ring',
+    license: 'MIT',
+    source:
+      'https://github.com/WICG/focus-ring/blob/4df78f379e4c7dbaa1a5e4ff25cf1b56700b24ee/LICENSE.md',
+    sourceText: `This work is being provided by the copyright holders under the following license.
+
+License
+
+By obtaining and/or copying this work, you (the licensee) agree that you have read, understood, and will comply with the following terms and conditions.
+
+Permission to copy, modify, and distribute this work, with or without modification, for any purpose and without fee or royalty is hereby granted, provided that you include the following on ALL copies of the work or portions thereof, including modifications:
+
+* The full text of this NOTICE in a location viewable to users of the redistributed or derivative work.
+* Any pre-existing intellectual property disclaimers, notices, or terms and conditions. If none exist, the W3C Software and Document Short Notice should be included.
+* Notice of any changes or modifications, through a copyright statement on the new code or document such as "This software or document includes material copied from or derived from [title and URI of the W3C document]. Copyright ¬© [YEAR] W3C¬Æ (MIT, ERCIM, Keio, Beihang)."
+
+Disclaimers
+
+THIS WORK IS PROVIDED "AS IS," AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS.
+
+COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.
+
+The name and trademarks of copyright holders may NOT be used in advertising or publicity pertaining to the work without specific, written prior permission. Title to copyright in this work will at all times remain with copyright holders.`,
+  },
+}
merged
  result 100644 4f340bd02953a3f1dbcadde80836e441a1d4c69c script/prettier.ts
  our    100644 146c1fcc48a0541fe8d79bf5245d94c06b3b832e script/prettier.ts
@@ -11,7 +11,12 @@
 const prettier = process.platform === 'win32' ? 'prettier.cmd' : 'prettier'
 const prettierPath = Path.join(root, 'node_modules', '.bin', prettier)

-const args = ['**/*.scss', '--list-different']
+const args = [
+  '**/*.scss',
+  'app/**/*.{ts,tsx}',
+  'script/**/*.ts',
+  '--list-different',
+]

 if (shouldFix) {
   args.push('--write')
removed in remote
  base   100644 68800a13155c68afc965da100c263aad461916a8 script/publish
  our    100644 68800a13155c68afc965da100c263aad461916a8 script/publish
@@ -1,200 +0,0 @@
-#!/usr/bin/env node
-
-'use strict'
-
-const TEST_PUBLISH = false
-const PUBLISH_CHANNELS = ['production', 'test', 'beta']
-const distInfo = require('./dist-info')
-const gitInfo = require('../app/git-info')
-const packageInfo = require('../app/package-info')
-
-if (PUBLISH_CHANNELS.indexOf(distInfo.getReleaseChannel()) < 0) {
-  console.log('Not a publishable build. Skipping publish.')
-  process.exit(0)
-}
-
-const releaseSHA = distInfo.getReleaseSHA()
-if (!releaseSHA) {
-  console.log(`No release SHA found for build. Skipping publish.`)
-  process.exit(0)
-}
-
-const currentTipSHA = gitInfo.getSHA()
-if (
-  !currentTipSHA ||
-  !currentTipSHA.toUpperCase().startsWith(releaseSHA.toUpperCase())
-) {
-  console.log(
-    `Current tip '${currentTipSHA}' does not match release SHA '${releaseSHA}'. Skipping publish.`
-  )
-  process.exit(0)
-}
-
-const fs = require('fs')
-const cp = require('child_process')
-const AWS = require('aws-sdk')
-const crypto = require('crypto')
-const request = require('request')
-
-console.log('Packaging‚Ä¶')
-cp.execSync('yarn package')
-
-let sha = ''
-if (process.platform === 'darwin') {
-  sha = process.env.CIRCLE_SHA1
-} else if (process.platform === 'win32') {
-  sha = process.env.APPVEYOR_REPO_COMMIT
-}
-
-sha = sha.substr(0, 8)
-
-console.log('Uploading‚Ä¶')
-
-let uploadPromise = null
-if (process.platform === 'darwin') {
-  uploadPromise = uploadOSXAssets()
-} else if (process.platform === 'win32') {
-  uploadPromise = uploadWindowsAssets()
-} else {
-  console.error(`I dunno how to publish a release for ${process.platform} :(`)
-  process.exit(1)
-}
-
-uploadPromise
-  .then(artifacts => {
-    const names = artifacts.map(function(item, index) {
-      return item.name
-    })
-    console.log(`Uploaded artifacts: ${names}`)
-    return updateDeploy(artifacts)
-  })
-  .catch(e => {
-    console.error(`Publishing failed: ${e}`)
-    process.exit(1)
-  })
-
-function uploadOSXAssets() {
-  const uploads = [upload(distInfo.getOSXZipName(), distInfo.getOSXZipPath())]
-  return Promise.all(uploads)
-}
-
-function uploadWindowsAssets() {
-  const uploads = [
-    upload(
-      distInfo.getWindowsInstallerName(),
-      distInfo.getWindowsInstallerPath()
-    ),
-    upload(
-      distInfo.getWindowsStandaloneName(),
-      distInfo.getWindowsStandalonePath()
-    ),
-    upload(
-      distInfo.getWindowsFullNugetPackageName(),
-      distInfo.getWindowsFullNugetPackagePath()
-    ),
-  ]
-
-  if (distInfo.shouldMakeDelta()) {
-    uploads.push(
-      upload(
-        distInfo.getWindowsDeltaNugetPackageName(),
-        distInfo.getWindowsDeltaNugetPackagePath()
-      )
-    )
-  }
-
-  return Promise.all(uploads)
-}
-
-function upload(assetName, assetPath) {
-  const s3Info = {
-    accessKeyId: process.env.S3_KEY,
-    secretAccessKey: process.env.S3_SECRET,
-  }
-  const s3 = new AWS.S3(s3Info)
-
-  const bucket = process.env.S3_BUCKET
-  const key = `releases/${packageInfo.getVersion()}-${sha}/${assetName.replace(
-    / /g,
-    ''
-  )}`
-  const url = `https://s3.amazonaws.com/${bucket}/${key}`
-
-  const uploadParams = {
-    Bucket: bucket,
-    ACL: 'public-read',
-    Key: key,
-    Body: fs.createReadStream(assetPath),
-  }
-
-  return new Promise((resolve, reject) => {
-    s3.upload(uploadParams, (error, data) => {
-      if (error) {
-        reject(error)
-      } else {
-        const stats = fs.statSync(assetPath)
-        const hash = crypto.createHash('sha1')
-        const input = fs.createReadStream(assetPath)
-
-        hash.on('finish', () => {
-          const sha = hash.read().toString('hex')
-          resolve({ name: assetName, url, size: stats['size'], sha })
-        })
-
-        input.pipe(hash)
-      }
-    })
-  })
-}
-
-function createSignature(body) {
-  const hmac = crypto.createHmac('sha1', process.env.DEPLOYMENT_SECRET)
-  hmac.update(JSON.stringify(body))
-  return `sha1=${hmac.digest('hex')}`
-}
-
-function updateDeploy(artifacts) {
-  const { rendererSize, mainSize } = distInfo.getBundleSizes()
-  const body = {
-    context: process.platform,
-    branch_name: distInfo.getReleaseBranchName(),
-    artifacts,
-    stats: {
-      platform: process.platform,
-      rendererBundleSize: rendererSize,
-      mainBundleSize: mainSize,
-    },
-  }
-  const signature = createSignature(body)
-  const options = {
-    method: 'POST',
-    url: 'https://central.github.com/api/deploy_built',
-    headers: {
-      'X-Hub-Signature': signature,
-    },
-    json: true,
-    body,
-  }
-
-  return new Promise((resolve, reject) => {
-    request(options, (error, response, body) => {
-      if (error) {
-        reject(error)
-        return
-      }
-
-      if (response.statusCode !== 200) {
-        reject(
-          new Error(
-            `Received a non-200 response (${response.statusCode}): ${JSON.stringify(
-              body
-            )}`
-          )
-        )
-        return
-      }
-
-      resolve()
-    })
-  })
-}
added in remote
  their  100644 4d6fbd455197c1eaf2b4279aa43467b07e669937 script/publish.ts
@@ -0,0 +1,222 @@
+const PUBLISH_CHANNELS = ['production', 'test', 'beta']
+import * as distInfo from './dist-info'
+import * as gitInfo from '../app/git-info'
+import * as packageInfo from '../app/package-info'
+
+if (PUBLISH_CHANNELS.indexOf(distInfo.getReleaseChannel()) < 0) {
+  console.log('Not a publishable build. Skipping publish.')
+  process.exit(0)
+}
+
+const releaseSHA = distInfo.getReleaseSHA()
+if (releaseSHA == null) {
+  console.log(`No release SHA found for build. Skipping publish.`)
+  process.exit(0)
+}
+
+const currentTipSHA = gitInfo.getSHA()
+if (!currentTipSHA.toUpperCase().startsWith(releaseSHA!.toUpperCase())) {
+  console.log(
+    `Current tip '${currentTipSHA}' does not match release SHA '${releaseSHA}'. Skipping publish.`
+  )
+  process.exit(0)
+}
+
+import * as Fs from 'fs'
+import { execSync } from 'child_process'
+import * as AWS from 'aws-sdk'
+import * as Crypto from 'crypto'
+import * as request from 'request'
+
+console.log('Packaging‚Ä¶')
+execSync('yarn package')
+
+function getSha() {
+  if (process.platform === 'darwin' && process.env.CIRCLE_SHA1 != null) {
+    return process.env.CIRCLE_SHA1
+  } else if (
+    process.platform === 'win32' &&
+    process.env.APPVEYOR_REPO_COMMIT != null
+  ) {
+    return process.env.APPVEYOR_REPO_COMMIT
+  }
+
+  throw new Error(
+    `Unable to get the SHA for the current platform. Check the vendor docs for the desired environment variables.`
+  )
+}
+
+const sha = getSha().substr(0, 8)
+
+function getSecret() {
+  if (process.env.DEPLOYMENT_SECRET != null) {
+    return process.env.DEPLOYMENT_SECRET
+  }
+
+  throw new Error(
+    `Unable to get deployment seret environment variable. Deployment aborting...`
+  )
+}
+
+console.log('Uploading‚Ä¶')
+
+let uploadPromise = null
+if (process.platform === 'darwin') {
+  uploadPromise = uploadOSXAssets()
+} else if (process.platform === 'win32') {
+  uploadPromise = uploadWindowsAssets()
+} else {
+  console.error(`I dunno how to publish a release for ${process.platform} :(`)
+  process.exit(1)
+}
+
+uploadPromise!
+  .then(artifacts => {
+    const names = artifacts.map(function(item, index) {
+      return item.name
+    })
+    console.log(`Uploaded artifacts: ${names}`)
+    return updateDeploy(artifacts, getSecret())
+  })
+  .catch(e => {
+    console.error(`Publishing failed: ${e}`)
+    process.exit(1)
+  })
+
+function uploadOSXAssets() {
+  const uploads = [upload(distInfo.getOSXZipName(), distInfo.getOSXZipPath())]
+  return Promise.all(uploads)
+}
+
+function uploadWindowsAssets() {
+  const uploads = [
+    upload(
+      distInfo.getWindowsInstallerName(),
+      distInfo.getWindowsInstallerPath()
+    ),
+    upload(
+      distInfo.getWindowsStandaloneName(),
+      distInfo.getWindowsStandalonePath()
+    ),
+    upload(
+      distInfo.getWindowsFullNugetPackageName(),
+      distInfo.getWindowsFullNugetPackagePath()
+    ),
+  ]
+
+  if (distInfo.shouldMakeDelta()) {
+    uploads.push(
+      upload(
+        distInfo.getWindowsDeltaNugetPackageName(),
+        distInfo.getWindowsDeltaNugetPackagePath()
+      )
+    )
+  }
+
+  return Promise.all(uploads)
+}
+
+interface IUploadResult {
+  name: string
+  url: string
+  size: number
+  sha: string
+}
+
+function upload(assetName: string, assetPath: string) {
+  const s3Info = {
+    accessKeyId: process.env.S3_KEY,
+    secretAccessKey: process.env.S3_SECRET,
+  }
+  const s3 = new AWS.S3(s3Info)
+
+  const bucket = process.env.S3_BUCKET || ''
+  const key = `releases/${packageInfo.getVersion()}-${sha}/${assetName.replace(
+    / /g,
+    ''
+  )}`
+  const url = `https://s3.amazonaws.com/${bucket}/${key}`
+
+  const uploadParams = {
+    Bucket: bucket,
+    ACL: 'public-read',
+    Key: key,
+    Body: Fs.createReadStream(assetPath),
+  }
+
+  return new Promise<IUploadResult>((resolve, reject) => {
+    s3.upload(
+      uploadParams,
+      (error: Error, data: AWS.S3.ManagedUpload.SendData) => {
+        if (error != null) {
+          reject(error)
+        } else {
+          // eslint-disable-next-line no-sync
+          const stats = Fs.statSync(assetPath)
+          const hash = Crypto.createHash('sha1')
+          hash.setEncoding('hex')
+          const input = Fs.createReadStream(assetPath)
+
+          hash.on('finish', () => {
+            const sha = hash.read() as string
+            resolve({ name: assetName, url, size: stats['size'], sha })
+          })
+
+          input.pipe(hash)
+        }
+      }
+    )
+  })
+}
+
+function createSignature(body: any, secret: string) {
+  const hmac = Crypto.createHmac('sha1', secret)
+  hmac.update(JSON.stringify(body))
+  return `sha1=${hmac.digest('hex')}`
+}
+
+function updateDeploy(artifacts: ReadonlyArray<IUploadResult>, secret: string) {
+  const { rendererSize, mainSize } = distInfo.getBundleSizes()
+  const body = {
+    context: process.platform,
+    branch_name: distInfo.getReleaseBranchName(),
+    artifacts,
+    stats: {
+      platform: process.platform,
+      rendererBundleSize: rendererSize,
+      mainBundleSize: mainSize,
+    },
+  }
+  const signature = createSignature(body, secret)
+  const options = {
+    method: 'POST',
+    url: 'https://central.github.com/api/deploy_built',
+    headers: {
+      'X-Hub-Signature': signature,
+    },
+    json: true,
+    body,
+  }
+
+  return new Promise((resolve, reject) => {
+    request(options, (error, response, body) => {
+      if (error) {
+        reject(error)
+        return
+      }
+
+      if (response.statusCode !== 200) {
+        reject(
+          new Error(
+            `Received a non-200 response (${
+              response.statusCode
+            }): ${JSON.stringify(body)}`
+          )
+        )
+        return
+      }
+
+      resolve()
+    })
+  })
+}
merged
  result 100644 903faa6e50dc2fafc46924b0438baa3b9e6f634b script/review-logs.ts
  our    100644 68ca321f41b2e29ff3393e3d9a6abd62c560c699 script/review-logs.ts
@@ -8,7 +8,13 @@

 function getUserDataPath() {
   if (process.platform === 'win32') {
-    return path.join(process.env.APPDATA, getExecutableName())
+    if (process.env.APPDATA) {
+      return path.join(process.env.APPDATA, getExecutableName())
+    } else {
+      throw new Error(
+        `Unable to find the application data directory on Windows :(`
+      )
+    }
   } else if (process.platform === 'darwin') {
     const home = os.homedir()
     return path.join(home, 'Library', 'Application Support', getProductName())
removed in remote
  base   100644 77bf79b8ff282fb277c0f780772d8f30eca82e7d script/run.js
  our    100644 77bf79b8ff282fb277c0f780772d8f30eca82e7d script/run.js
@@ -1,46 +0,0 @@
-'use strict'
-
-const path = require('path')
-const cp = require('child_process')
-const fs = require('fs')
-const distInfo = require('./dist-info')
-
-const distPath = distInfo.getDistPath()
-const productName = distInfo.getExecutableName()
-
-let binaryPath = ''
-if (process.platform === 'darwin') {
-  binaryPath = path.join(
-    distPath,
-    `${productName}.app`,
-    'Contents',
-    'MacOS',
-    `${productName}`
-  )
-} else if (process.platform === 'win32') {
-  binaryPath = path.join(distPath, `${productName}.exe`)
-} else if (process.platform === 'linux') {
-  binaryPath = path.join(distPath, productName)
-} else {
-  console.error(`I dunno how to run on ${process.platform} ${process.arch} :(`)
-  process.exit(1)
-}
-
-module.exports = function(spawnOptions) {
-  try {
-    const stats = fs.statSync(binaryPath)
-    if (!stats.isFile()) {
-      return null
-    }
-  } catch (e) {
-    return null
-  }
-
-  const opts = Object.assign({}, spawnOptions)
-
-  opts.env = Object.assign(opts.env || {}, process.env, {
-    NODE_ENV: 'development',
-  })
-
-  return cp.spawn(binaryPath, [], opts)
-}
added in remote
  their  100644 6551aefb22d8539c0c733a0a3dbd436b4e88fa51 script/run.ts
@@ -0,0 +1,45 @@
+import { join } from 'path'
+import { spawn, SpawnOptions } from 'child_process'
+import * as Fs from 'fs'
+import { getDistPath, getExecutableName } from './dist-info'
+
+const distPath = getDistPath()
+const productName = getExecutableName()
+
+let binaryPath = ''
+if (process.platform === 'darwin') {
+  binaryPath = join(
+    distPath,
+    `${productName}.app`,
+    'Contents',
+    'MacOS',
+    `${productName}`
+  )
+} else if (process.platform === 'win32') {
+  binaryPath = join(distPath, `${productName}.exe`)
+} else if (process.platform === 'linux') {
+  binaryPath = join(distPath, productName)
+} else {
+  console.error(`I dunno how to run on ${process.platform} ${process.arch} :(`)
+  process.exit(1)
+}
+
+export function run(spawnOptions: SpawnOptions) {
+  try {
+    // eslint-disable-next-line no-sync
+    const stats = Fs.statSync(binaryPath)
+    if (!stats.isFile()) {
+      return null
+    }
+  } catch (e) {
+    return null
+  }
+
+  const opts = Object.assign({}, spawnOptions)
+
+  opts.env = Object.assign(opts.env || {}, process.env, {
+    NODE_ENV: 'development',
+  })
+
+  return spawn(binaryPath, [], opts)
+}
removed in remote
  base   100644 e2fdac76cfc9f9f60ad2e6163a08a7da7cc6a336 script/start
  our    100644 e2fdac76cfc9f9f60ad2e6163a08a7da7cc6a336 script/start
@@ -1,53 +0,0 @@
-#!/usr/bin/env node
-
-'use strict'
-
-const run = require('./run')
-const express = require('express')
-const webpack = require('webpack')
-const configs = require('../app/webpack.development')
-
-function startApp() {
-  const runningApp = run({ stdio: 'inherit' })
-  if (!runningApp) {
-    console.error(
-      "Couldn't launch the app. You probably need to build it first. Run `yarn build:dev`."
-    )
-    process.exit(1)
-  }
-
-  runningApp.on('close', () => {
-    process.exit(0)
-  })
-}
-
-if (process.env.NODE_ENV === 'production') {
-  startApp()
-  return
-}
-
-const [mainConfig, rendererConfig, askPassConfig] = configs
-
-const server = express()
-const compiler = webpack(rendererConfig)
-const port = process.env.PORT || 3000
-
-server.use(
-  require('webpack-dev-middleware')(compiler, {
-    publicPath: rendererConfig.output.publicPath,
-    noInfo: true,
-  })
-)
-
-server.use(require('webpack-hot-middleware')(compiler))
-
-server.listen(port, 'localhost', err => {
-  if (err) {
-    console.log(err)
-    process.exit(1)
-    return
-  }
-
-  console.log(`Server running at http://localhost:${port}`)
-  startApp()
-})
added in remote
  their  100644 96fdc173cf1566aef93aff0b05bdbe08daa597ef script/start.ts
@@ -0,0 +1,72 @@
+import * as express from 'express'
+import * as webpack from 'webpack'
+import * as devMiddleware from 'webpack-dev-middleware'
+import * as hotMiddleware from 'webpack-hot-middleware'
+
+import { forceUnwrap as u } from '../app/src/lib/fatal-error'
+
+import configs = require('../app/webpack.development')
+
+import { run } from './run'
+
+function getPortOrDefault() {
+  const port = process.env.PORT
+  if (port != null) {
+    const result = parseInt(port)
+    if (isNaN(result)) {
+      throw new Error(`Unable to parse '${port}' into valid number`)
+    }
+    return result
+  }
+
+  return 3000
+}
+
+function startApp() {
+  const runningApp = run({ stdio: 'inherit' })
+  if (runningApp == null) {
+    console.error(
+      "Couldn't launch the app. You probably need to build it first. Run `yarn build:dev`."
+    )
+    process.exit(1)
+    return
+  }
+
+  runningApp.on('close', () => {
+    process.exit(0)
+  })
+}
+
+if (process.env.NODE_ENV === 'production') {
+  startApp()
+} else {
+  const rendererConfig = configs[1]
+
+  const server = express()
+  const compiler = webpack(rendererConfig)
+  const port = getPortOrDefault()
+
+  const message = 'Could not find public path from configuration'
+  server.use(
+    devMiddleware(compiler, {
+      publicPath: u(
+        message,
+        u(message, u(message, rendererConfig).output).publicPath
+      ),
+      logLevel: 'error',
+    })
+  )
+
+  server.use(hotMiddleware(compiler))
+
+  server.listen(port, 'localhost', (err: Error | null) => {
+    if (err) {
+      console.log(err)
+      process.exit(1)
+      return
+    }
+
+    console.log(`Server running at http://localhost:${port}`)
+    startApp()
+  })
+}
merged
  result 100644 5542fdd0d59adecb94be7f9b26f60659a899a77f script/tsconfig.json
  our    100644 14dd9e3066f9076b88a5096328332f218696513d script/tsconfig.json
@@ -3,14 +3,12 @@
     "module": "commonjs",
     "moduleResolution": "node",
     "target": "es6",
-    "noImplicitAny": true,
     "noImplicitReturns": true,
-    "noImplicitThis": true,
     "noFallthroughCasesInSwitch": true,
     "noUnusedLocals": true,
-    "strictNullChecks": true,
     "sourceMap": false,
-    "noEmit": true
+    "noEmit": true,
+    "strict": true,
   },
   "compileOnSave": false
 }
added in remote
  their  100644 67afebf6479af930fa36dc6216880f9810e08abe script/unit-tests.ts
@@ -0,0 +1,98 @@
+#!/usr/bin/env ts-node
+
+import * as Path from 'path'
+import { spawnSync, SpawnSyncOptions } from 'child_process'
+
+const environmentVariables = {
+  // setting commit information so that tests don't need to rely on global config
+  GIT_AUTHOR_NAME: 'Joe Bloggs',
+  GIT_AUTHOR_EMAIL: 'joe.bloggs@somewhere.com',
+  GIT_COMMITTER_NAME: 'Joe Bloggs',
+  GIT_COMMITTER_EMAIL: 'joe.bloggs@somewhere.com',
+  // signalling to dugite to use the bundled Git environment
+  TEST_ENV: '1',
+  // ensuring Electron doesn't attach to the current console session (Windows only)
+  ELECTRON_NO_ATTACH_CONSOLE: '1',
+}
+
+const env = { ...process.env, ...environmentVariables }
+
+// ensure commands are executed from the root of the repository
+const repositoryRoot = Path.dirname(__dirname)
+
+const options: SpawnSyncOptions = {
+  cwd: repositoryRoot,
+  env,
+  // ensure stdout/stderr is propagated to the parent process so the test results
+  // are displayed to the user
+  stdio: 'inherit',
+}
+
+const electronMocha =
+  process.platform === 'win32' ? 'electron-mocha.cmd' : 'electron-mocha'
+
+const electronMochaPath = Path.join(
+  repositoryRoot,
+  'node_modules',
+  '.bin',
+  electronMocha
+)
+
+const electronMochaArgs = [
+  // timeout for 10s
+  '-t',
+  '10000',
+  // ensure tests are run within a renderer process
+  '--renderer',
+  '--require',
+  'ts-node/register',
+  '--require',
+  './app/test/globals.ts',
+  'app/test/unit/*.{ts,tsx}',
+  'app/test/unit/**/*.{ts,tsx}',
+]
+
+const shouldDebug = process.argv.indexOf('--debug') > -1
+
+if (shouldDebug) {
+  electronMochaArgs.push('--debug')
+}
+
+let exitCode = -1
+
+if (process.platform === 'linux') {
+  // xvfb-maybe wraps xvfb-run to ensure Electron tests are run within the
+  // context where the DISPLAY environment variable is set. It only runs on
+  // Linux and is designed for CI scenarios, but this is making the whole
+  // thing more explicit than the previous inline usage in package.json
+  const xvfbMaybe = Path.join(
+    repositoryRoot,
+    'node_modules',
+    '.bin',
+    'xvfb-maybe'
+  )
+
+  const args = [
+    // on Travis there may be a problem with the default display being
+    // unavailable -  this ensures we use a free server number
+    '--auto-servernum',
+    '--',
+    // and then we pass through the test runner commands
+    electronMochaPath,
+    ...electronMochaArgs,
+  ]
+
+  console.log(`spawing xvfb-maybe with args: ${args.join(' ')}`)
+
+  const { status } = spawnSync(xvfbMaybe, args, options)
+  exitCode = status
+} else {
+  console.log(
+    `spawing electron-mocha with args: ${electronMochaArgs.join(' ')}`
+  )
+
+  const { status } = spawnSync(electronMochaPath, electronMochaArgs, options)
+  exitCode = status
+}
+
+process.exitCode = exitCode
merged
  result 100644 d9481a63e89bd672307df8f1048caa69ee6276a9 script/validate-changelog.ts
  our    100644 99d3cf95c36c9a4c5fa58f5c5e2138fb7c281dec script/validate-changelog.ts
@@ -36,6 +36,7 @@
 const repositoryRoot = Path.dirname(__dirname)
 const changelogPath = Path.join(repositoryRoot, 'changelog.json')

+// eslint-disable-next-line no-sync
 const changelog = Fs.readFileSync(changelogPath, 'utf8')

 let changelogObj = null
merged
  result 100644 3162be12e327f202d1aab8c198ad93c33ff738c9 tsconfig.json
  our    100644 277ed46c185a8c539e2c44a06c4c539a248d2577 tsconfig.json
@@ -9,9 +9,14 @@
     "sourceMap": true,
     "jsx": "react",
     "strict": true,
+    "noEmit": true,
     "outDir": "./out"
   },
-  "include": ["app/**/*.ts", "app/**/*.tsx", "app/**/*.d.tsx"],
+  "include": [
+    "app/**/*.ts",
+    "app/**/*.tsx",
+    "app/**/*.d.tsx"
+  ],
   "exclude": [
     "node_modules",
     "app/node_modules",
added in remote
  their  100644 cea9476153ecf2e440e28d7b84dc334a433fd12d vsts.yml
@@ -0,0 +1,62 @@
+phases:
+- phase: Windows
+  queue: Hosted VS2017
+  steps:
+  - task: NodeTool@0
+    inputs:
+      versionSpec: "8.11.1"
+  - task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
+    inputs:
+      versionSpec: "1.5.1"
+  - script: |
+       yarn install --force
+    name: Install
+  - script: |
+      yarn lint && yarn build:prod
+    name: Build
+  - script: |
+      yarn test:setup && yarn test
+    name: Test
+
+- phase: Linux
+  queue: Hosted Linux Preview
+  steps:
+  - script: |
+      apt-get update
+      apt-get install -y --no-install-recommends libsecret-1-dev xvfb fakeroot dpkg rpm xz-utils xorriso zsync libxss1 libgconf2-4
+  - task: NodeTool@0
+    inputs:
+      versionSpec: "8.11.1"
+  - task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
+    inputs:
+      versionSpec: "1.5.1"
+  - script: |
+       yarn install --force
+    name: Install
+  - script: |
+       yarn lint && yarn build:prod
+    name: Build
+  - script: |
+       export DISPLAY=':99.0'
+       Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
+       yarn test:setup && yarn test
+    name: Test
+
+- phase: macOS
+  queue: Hosted macOS Preview
+  steps:
+  - task: NodeTool@0
+    inputs:
+      versionSpec: "8.11.1"
+  - task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
+    inputs:
+      versionSpec: "1.5.1"
+  - script: |
+      yarn install --force
+    name: Install
+  - script: |
+       yarn lint && yarn build:prod
+    name: Build
+  - script: |
+      yarn test:setup && yarn test
+    name: Test
merged
  result 100644 518ebd962c3152899bf04a5ae668a826085179c5 yarn.lock
  our    100644 b62b02a9d580648aaf19776890ce70c967670310 yarn.lock
@@ -22,6 +22,13 @@
     "7zip-bin-mac" "~1.0.1"
     "7zip-bin-win" "~2.2.0"

+"@types/body-parser@*":
+  version "1.16.8"
+  resolved "https://registry.yarnpkg.com/@types/body-parser/-/body-parser-1.16.8.tgz#687ec34140624a3bec2b1a8ea9268478ae8f3be3"
+  dependencies:
+    "@types/express" "*"
+    "@types/node" "*"
+
 "@types/byline@^4.2.31":
   version "4.2.31"
   resolved "https://registry.yarnpkg.com/@types/byline/-/byline-4.2.31.tgz#0e61fcb9c03e047d21c4496554c7116297ab60cd"
@@ -46,10 +53,26 @@
   version "2.2.3"
   resolved "https://registry.yarnpkg.com/@types/classnames/-/classnames-2.2.3.tgz#3f0ff6873da793870e20a260cada55982f38a9e5"

+"@types/clean-css@*":
+  version "3.4.30"
+  resolved "https://registry.yarnpkg.com/@types/clean-css/-/clean-css-3.4.30.tgz#0052c136f5248002428e3638b37de4a39818641d"
+
+"@types/clean-webpack-plugin@^0.1.2":
+  version "0.1.2"
+  resolved "https://registry.yarnpkg.com/@types/clean-webpack-plugin/-/clean-webpack-plugin-0.1.2.tgz#f3c9d97dd397a9db86ba6b9b245ca0eedf88f3b2"
+  dependencies:
+    "@types/webpack" "*"
+
 "@types/codemirror@0.0.55":
   version "0.0.55"
   resolved "https://registry.yarnpkg.com/@types/codemirror/-/codemirror-0.0.55.tgz#f4292b7a5f33b2aab509501c3db7e45d19a7c057"

+"@types/connect@*":
+  version "3.4.31"
+  resolved "https://registry.yarnpkg.com/@types/connect/-/connect-3.4.31.tgz#1f92d6b117ecc05076c49ecd024f7976e528bad9"
+  dependencies:
+    "@types/node" "*"
+
 "@types/electron-packager@^10.1.0":
   version "10.1.0"
   resolved "https://registry.yarnpkg.com/@types/electron-packager/-/electron-packager-10.1.0.tgz#8d61ef76a2676936c59d14392a9c0c1853405953"
@@ -64,13 +87,39 @@
   version "1.2.32"
   resolved "https://registry.yarnpkg.com/@types/event-kit/-/event-kit-1.2.32.tgz#068cbdc69e8c969afae8c9f6e3a51ea4b1b5522e"

+"@types/express-serve-static-core@*":
+  version "4.11.0"
+  resolved "https://registry.yarnpkg.com/@types/express-serve-static-core/-/express-serve-static-core-4.11.0.tgz#aaaf472777191c3e56ec7aa160034c6b55ebdd59"
+  dependencies:
+    "@types/node" "*"
+
+"@types/express@*", "@types/express@^4.11.0":
+  version "4.11.0"
+  resolved "https://registry.yarnpkg.com/@types/express/-/express-4.11.0.tgz#234d65280af917cb290634b7a8d6bcac24aecbad"
+  dependencies:
+    "@types/body-parser" "*"
+    "@types/express-serve-static-core" "*"
+    "@types/serve-static" "*"
+
+"@types/extract-text-webpack-plugin@^3.0.3":
+  version "3.0.3"
+  resolved "https://registry.yarnpkg.com/@types/extract-text-webpack-plugin/-/extract-text-webpack-plugin-3.0.3.tgz#b4ef831c7ea7bc0585ccabc61e8b0d6cd69fccc3"
+  dependencies:
+    "@types/webpack" "*"
+
 "@types/file-url@^2.0.0":
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/@types/file-url/-/file-url-2.0.0.tgz#23d00a219b5064d903d4baa0cf7558692ea0eeb6"

-"@types/fs-extra@2.1.0":
-  version "2.1.0"
-  resolved "https://registry.yarnpkg.com/@types/fs-extra/-/fs-extra-2.1.0.tgz#8b350239c0455d92b8d3c626edac193860ff395f"
+"@types/form-data@*":
+  version "2.2.1"
+  resolved "https://registry.yarnpkg.com/@types/form-data/-/form-data-2.2.1.tgz#ee2b3b8eaa11c0938289953606b745b738c54b1e"
+  dependencies:
+    "@types/node" "*"
+
+"@types/fs-extra@^5.0.2":
+  version "5.0.2"
+  resolved "https://registry.yarnpkg.com/@types/fs-extra/-/fs-extra-5.0.2.tgz#235a7e2b56452cc0a6a4809b53e1d1eaffff9c96"
   dependencies:
     "@types/node" "*"

@@ -78,10 +127,49 @@
   version "0.0.1"
   resolved "https://registry.yarnpkg.com/@types/fuzzaldrin-plus/-/fuzzaldrin-plus-0.0.1.tgz#bfe5e25bc5b4066848171baf7a8aaf30e267d30a"

+"@types/html-minifier@*":
+  version "1.1.30"
+  resolved "https://registry.yarnpkg.com/@types/html-minifier/-/html-minifier-1.1.30.tgz#3b3817c27df23922f7b5aa87eff45b3ab934aec9"
+  dependencies:
+    "@types/clean-css" "*"
+    "@types/relateurl" "*"
+    "@types/uglify-js" "*"
+
+"@types/html-webpack-plugin@^2.30.3":
+  version "2.30.3"
+  resolved "https://registry.yarnpkg.com/@types/html-webpack-plugin/-/html-webpack-plugin-2.30.3.tgz#848baba8e35010c6ef6d36b04174820b9d884583"
+  dependencies:
+    "@types/html-minifier" "*"
+    "@types/webpack" "*"
+
 "@types/keytar@^4.0.0":
   version "4.0.1"
   resolved "https://registry.yarnpkg.com/@types/keytar/-/keytar-4.0.1.tgz#e2cf6405dc33861424e59b67516c66d2cf7bc21b"

+"@types/legal-eagle@^0.15.0":
+  version "0.15.0"
+  resolved "https://registry.yarnpkg.com/@types/legal-eagle/-/legal-eagle-0.15.0.tgz#3a3cf08edca425ffaf9518304c4f1efddea36e42"
+
+"@types/loglevel@*":
+  version "1.5.3"
+  resolved "https://registry.yarnpkg.com/@types/loglevel/-/loglevel-1.5.3.tgz#adfce55383edc5998a2170ad581b3e23d6adb5b8"
+
+"@types/memory-fs@*":
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/@types/memory-fs/-/memory-fs-0.3.0.tgz#847596a94f9a9688a2e342f4017fcc0050e8e2da"
+  dependencies:
+    "@types/node" "*"
+
+"@types/mime@*":
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/@types/mime/-/mime-2.0.0.tgz#5a7306e367c539b9f6543499de8dd519fac37a8b"
+
+"@types/mini-css-extract-plugin@^0.2.0":
+  version "0.2.0"
+  resolved "https://registry.yarnpkg.com/@types/mini-css-extract-plugin/-/mini-css-extract-plugin-0.2.0.tgz#afb037dbbd76f6c13803927c2751d194188b5d47"
+  dependencies:
+    "@types/webpack" "*"
+
 "@types/mocha@^2.2.48":
   version "2.2.48"
   resolved "https://registry.yarnpkg.com/@types/mocha/-/mocha-2.2.48.tgz#3523b126a0b049482e1c3c11877460f76622ffab"
@@ -94,21 +182,21 @@
   version "8.0.47"
   resolved "https://registry.yarnpkg.com/@types/node/-/node-8.0.47.tgz#968e596f91acd59069054558a00708c445ca30c2"

-"@types/node@^7.0.18":
-  version "7.0.46"
-  resolved "https://registry.yarnpkg.com/@types/node/-/node-7.0.46.tgz#c3dedd25558c676b3d6303e51799abb9c3f8f314"
-
 "@types/node@^8.0.24":
-  version "8.5.10"
-  resolved "https://registry.yarnpkg.com/@types/node/-/node-8.5.10.tgz#49bd3637125dea5f55d7d1e8f51efd6cb835e1f7"
+  version "8.10.1"
+  resolved "https://registry.yarnpkg.com/@types/node/-/node-8.10.1.tgz#aac98b810c50568054486f2bb8c486d824713be8"
+
+"@types/node@^8.10.4":
+  version "8.10.4"
+  resolved "https://registry.yarnpkg.com/@types/node/-/node-8.10.4.tgz#d3ca40ee884c853e2b786ee73096726ec59a5b31"

 "@types/prop-types@*":
   version "15.5.2"
   resolved "https://registry.yarnpkg.com/@types/prop-types/-/prop-types-15.5.2.tgz#3c6b8dceb2906cc87fe4358e809f9d20c8d59be1"

-"@types/react-dom@^16.0.4":
-  version "16.0.4"
-  resolved "https://registry.yarnpkg.com/@types/react-dom/-/react-dom-16.0.4.tgz#2e8fd45f5443780ed49bf2cdd9809e6091177a7d"
+"@types/react-dom@^16.0.5":
+  version "16.0.6"
+  resolved "https://registry.yarnpkg.com/@types/react-dom/-/react-dom-16.0.6.tgz#f1a65a4e7be8ed5d123f8b3b9eacc913e35a1a3c"
   dependencies:
     "@types/node" "*"
     "@types/react" "*"
@@ -120,24 +208,52 @@
     "@types/react" "*"

 "@types/react-virtualized@^9.7.12":
-  version "9.7.12"
-  resolved "https://registry.yarnpkg.com/@types/react-virtualized/-/react-virtualized-9.7.12.tgz#3dc212c0f94c9e9eab2fe7cb5a23db18ba2d1ee1"
+  version "9.7.14"
+  resolved "https://registry.yarnpkg.com/@types/react-virtualized/-/react-virtualized-9.7.14.tgz#4ce4b1f4a8d242edf317c7f798852788150a0040"
   dependencies:
     "@types/prop-types" "*"
     "@types/react" "*"

-"@types/react@*", "@types/react@^16.0.40":
-  version "16.0.40"
-  resolved "https://registry.yarnpkg.com/@types/react/-/react-16.0.40.tgz#caabc2296886f40b67f6fc80f0f3464476461df9"
+"@types/react@*", "@types/react@^16.3.16":
+  version "16.3.16"
+  resolved "https://registry.yarnpkg.com/@types/react/-/react-16.3.16.tgz#78fc44a90b45701f50c8a7008f733680ba51fc86"
+  dependencies:
+    csstype "^2.2.0"
+
+"@types/relateurl@*":
+  version "0.2.28"
+  resolved "https://registry.yarnpkg.com/@types/relateurl/-/relateurl-0.2.28.tgz#6bda7db8653fa62643f5ee69e9f69c11a392e3a6"
+
+"@types/request@^2.0.9":
+  version "2.0.9"
+  resolved "https://registry.yarnpkg.com/@types/request/-/request-2.0.9.tgz#125b8a60d8a439e8d87e6d1335c61cccdc18343a"
+  dependencies:
+    "@types/form-data" "*"
+    "@types/node" "*"

 "@types/semver@^5.5.0":
   version "5.5.0"
   resolved "https://registry.yarnpkg.com/@types/semver/-/semver-5.5.0.tgz#146c2a29ee7d3bae4bf2fcb274636e264c813c45"

+"@types/serve-static@*":
+  version "1.13.1"
+  resolved "https://registry.yarnpkg.com/@types/serve-static/-/serve-static-1.13.1.tgz#1d2801fa635d274cd97d4ec07e26b21b44127492"
+  dependencies:
+    "@types/express-serve-static-core" "*"
+    "@types/mime" "*"
+
+"@types/source-map@*":
+  version "0.5.1"
+  resolved "https://registry.yarnpkg.com/@types/source-map/-/source-map-0.5.1.tgz#7e74db5d06ab373a712356eebfaea2fad0ea2367"
+
 "@types/strip-ansi@^3.0.0":
   version "3.0.0"
   resolved "https://registry.yarnpkg.com/@types/strip-ansi/-/strip-ansi-3.0.0.tgz#9b63d453a6b54aa849182207711a08be8eea48ae"

+"@types/tapable@*":
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/@types/tapable/-/tapable-1.0.2.tgz#e13182e1b69871a422d7863e11a4a6f5b814a4bd"
+
 "@types/temp@^0.8.29":
   version "0.8.31"
   resolved "https://registry.yarnpkg.com/@types/temp/-/temp-0.8.31.tgz#8518b6fb4c7d7cf106c78e5d88d3cff88d508f97"
@@ -156,6 +272,12 @@
   version "0.7.32"
   resolved "https://registry.yarnpkg.com/@types/ua-parser-js/-/ua-parser-js-0.7.32.tgz#8827d451d6702307248073b5d98aa9293d02b5e5"

+"@types/uglify-js@*":
+  version "2.6.29"
+  resolved "https://registry.yarnpkg.com/@types/uglify-js/-/uglify-js-2.6.29.tgz#521347f69e20201d218f5991ae66e10878afcf1a"
+  dependencies:
+    "@types/source-map" "*"
+
 "@types/untildify@^3.0.0":
   version "3.0.0"
   resolved "https://registry.yarnpkg.com/@types/untildify/-/untildify-3.0.0.tgz#cd3e6624e46ccf292d3823fb48fa90dda0deaec0"
@@ -166,6 +288,43 @@
   dependencies:
     "@types/node" "*"

+"@types/webpack-bundle-analyzer@^2.9.2":
+  version "2.9.2"
+  resolved "https://registry.yarnpkg.com/@types/webpack-bundle-analyzer/-/webpack-bundle-analyzer-2.9.2.tgz#a3f9f4dd8bc3025550001a1704cfd31125773f40"
+  dependencies:
+    "@types/webpack" "*"
+
+"@types/webpack-dev-middleware@^2.0.1":
+  version "2.0.1"
+  resolved "https://registry.yarnpkg.com/@types/webpack-dev-middleware/-/webpack-dev-middleware-2.0.1.tgz#516d953602d9e8ac72ca1196969969d580d4b0a6"
+  dependencies:
+    "@types/connect" "*"
+    "@types/loglevel" "*"
+    "@types/memory-fs" "*"
+    "@types/webpack" "*"
+
+"@types/webpack-hot-middleware@^2.16.3":
+  version "2.16.3"
+  resolved "https://registry.yarnpkg.com/@types/webpack-hot-middleware/-/webpack-hot-middleware-2.16.3.tgz#c262ab826afae16030c15049e3c997849f9c8461"
+  dependencies:
+    "@types/connect" "*"
+    "@types/webpack" "*"
+
+"@types/webpack-merge@^4.1.3":
+  version "4.1.3"
+  resolved "https://registry.yarnpkg.com/@types/webpack-merge/-/webpack-merge-4.1.3.tgz#e6af0f2a0f20a86ac83d7da84a2e454063121ad4"
+  dependencies:
+    "@types/webpack" "*"
+
+"@types/webpack@*", "@types/webpack@^4.4.0":
+  version "4.4.0"
+  resolved "https://registry.yarnpkg.com/@types/webpack/-/webpack-4.4.0.tgz#c0551b772be241d786c0548812dd75a932f8efb4"
+  dependencies:
+    "@types/node" "*"
+    "@types/tapable" "*"
+    "@types/uglify-js" "*"
+    source-map "^0.6.0"
+
 "@types/winston@^2.2.0":
   version "2.3.7"
   resolved "https://registry.yarnpkg.com/@types/winston/-/winston-2.3.7.tgz#2ea18b2dc772d459b6af0f587447704df31afec2"
@@ -178,6 +337,122 @@
   dependencies:
     "@types/node" "*"

+"@webassemblyjs/ast@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/ast/-/ast-1.4.3.tgz#3b3f6fced944d8660273347533e6d4d315b5934a"
+  dependencies:
+    "@webassemblyjs/helper-wasm-bytecode" "1.4.3"
+    "@webassemblyjs/wast-parser" "1.4.3"
+    debug "^3.1.0"
+    webassemblyjs "1.4.3"
+
+"@webassemblyjs/floating-point-hex-parser@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/floating-point-hex-parser/-/floating-point-hex-parser-1.4.3.tgz#f5aee4c376a717c74264d7bacada981e7e44faad"
+
+"@webassemblyjs/helper-buffer@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/helper-buffer/-/helper-buffer-1.4.3.tgz#0434b55958519bf503697d3824857b1dea80b729"
+  dependencies:
+    debug "^3.1.0"
+
+"@webassemblyjs/helper-code-frame@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/helper-code-frame/-/helper-code-frame-1.4.3.tgz#f1349ca3e01a8e29ee2098c770773ef97af43641"
+  dependencies:
+    "@webassemblyjs/wast-printer" "1.4.3"
+
+"@webassemblyjs/helper-fsm@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/helper-fsm/-/helper-fsm-1.4.3.tgz#65a921db48fb43e868f17b27497870bdcae22b79"
+
+"@webassemblyjs/helper-wasm-bytecode@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/helper-wasm-bytecode/-/helper-wasm-bytecode-1.4.3.tgz#0e5b4b5418e33f8a26e940b7809862828c3721a5"
+
+"@webassemblyjs/helper-wasm-section@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/helper-wasm-section/-/helper-wasm-section-1.4.3.tgz#9ceedd53a3f152c3412e072887ade668d0b1acbf"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/helper-buffer" "1.4.3"
+    "@webassemblyjs/helper-wasm-bytecode" "1.4.3"
+    "@webassemblyjs/wasm-gen" "1.4.3"
+    debug "^3.1.0"
+
+"@webassemblyjs/leb128@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/leb128/-/leb128-1.4.3.tgz#5a5e5949dbb5adfe3ae95664d0439927ac557fb8"
+  dependencies:
+    leb "^0.3.0"
+
+"@webassemblyjs/validation@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/validation/-/validation-1.4.3.tgz#9e66c9b3079d7bbcf2070c1bf52a54af2a09aac9"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+
+"@webassemblyjs/wasm-edit@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wasm-edit/-/wasm-edit-1.4.3.tgz#87febd565e0ffb5ae25f6495bb3958d17aa0a779"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/helper-buffer" "1.4.3"
+    "@webassemblyjs/helper-wasm-bytecode" "1.4.3"
+    "@webassemblyjs/helper-wasm-section" "1.4.3"
+    "@webassemblyjs/wasm-gen" "1.4.3"
+    "@webassemblyjs/wasm-opt" "1.4.3"
+    "@webassemblyjs/wasm-parser" "1.4.3"
+    "@webassemblyjs/wast-printer" "1.4.3"
+    debug "^3.1.0"
+
+"@webassemblyjs/wasm-gen@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wasm-gen/-/wasm-gen-1.4.3.tgz#8553164d0154a6be8f74d653d7ab355f73240aa4"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/helper-wasm-bytecode" "1.4.3"
+    "@webassemblyjs/leb128" "1.4.3"
+
+"@webassemblyjs/wasm-opt@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wasm-opt/-/wasm-opt-1.4.3.tgz#26c7a23bfb136aa405b1d3410e63408ec60894b8"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/helper-buffer" "1.4.3"
+    "@webassemblyjs/wasm-gen" "1.4.3"
+    "@webassemblyjs/wasm-parser" "1.4.3"
+    debug "^3.1.0"
+
+"@webassemblyjs/wasm-parser@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wasm-parser/-/wasm-parser-1.4.3.tgz#7ddd3e408f8542647ed612019cfb780830993698"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/helper-wasm-bytecode" "1.4.3"
+    "@webassemblyjs/leb128" "1.4.3"
+    "@webassemblyjs/wasm-parser" "1.4.3"
+    webassemblyjs "1.4.3"
+
+"@webassemblyjs/wast-parser@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wast-parser/-/wast-parser-1.4.3.tgz#3250402e2c5ed53dbe2233c9de1fe1f9f0d51745"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/floating-point-hex-parser" "1.4.3"
+    "@webassemblyjs/helper-code-frame" "1.4.3"
+    "@webassemblyjs/helper-fsm" "1.4.3"
+    long "^3.2.0"
+    webassemblyjs "1.4.3"
+
+"@webassemblyjs/wast-printer@1.4.3":
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/@webassemblyjs/wast-printer/-/wast-printer-1.4.3.tgz#3d59aa8d0252d6814a3ef4e6d2a34c9ded3904e0"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/wast-parser" "1.4.3"
+    long "^3.2.0"
+
 abbrev@1:
   version "1.1.1"
   resolved "https://registry.yarnpkg.com/abbrev/-/abbrev-1.1.1.tgz#f8f2c887ad10bf67f634f005b6987fed3179aac8"
@@ -189,11 +464,18 @@
     mime-types "~2.1.16"
     negotiator "0.6.1"

-acorn-dynamic-import@^2.0.0:
-  version "2.0.2"
-  resolved "https://registry.yarnpkg.com/acorn-dynamic-import/-/acorn-dynamic-import-2.0.2.tgz#c752bd210bef679501b6c6cb7fc84f8f47158cc4"
+accepts@~1.3.5:
+  version "1.3.5"
+  resolved "https://registry.yarnpkg.com/accepts/-/accepts-1.3.5.tgz#eb777df6011723a3b14e8a72c0805c8e86746bd2"
+  dependencies:
+    mime-types "~2.1.18"
+    negotiator "0.6.1"
+
+acorn-dynamic-import@^3.0.0:
+  version "3.0.0"
+  resolved "https://registry.yarnpkg.com/acorn-dynamic-import/-/acorn-dynamic-import-3.0.0.tgz#901ceee4c7faaef7e07ad2a47e890675da50a278"
   dependencies:
-    acorn "^4.0.3"
+    acorn "^5.0.0"

 acorn-jsx@^3.0.0:
   version "3.0.1"
@@ -205,23 +487,15 @@
   version "3.3.0"
   resolved "https://registry.yarnpkg.com/acorn/-/acorn-3.3.0.tgz#45e37fb39e8da3f25baee3ff5369e2bb5f22017a"

-acorn@^4.0.3:
-  version "4.0.13"
-  resolved "https://registry.yarnpkg.com/acorn/-/acorn-4.0.13.tgz#105495ae5361d697bd195c825192e1ad7f253787"
-
 acorn@^5.0.0:
   version "5.2.1"
   resolved "https://registry.yarnpkg.com/acorn/-/acorn-5.2.1.tgz#317ac7821826c22c702d66189ab8359675f135d7"

-acorn@^5.5.0:
+acorn@^5.3.0, acorn@^5.5.0:
   version "5.5.3"
   resolved "https://registry.yarnpkg.com/acorn/-/acorn-5.5.3.tgz#f473dd47e0277a08e28e9bec5aeeb04751f0b8c9"

-ajv-keywords@^1.1.1:
-  version "1.5.1"
-  resolved "https://registry.yarnpkg.com/ajv-keywords/-/ajv-keywords-1.5.1.tgz#314dd0a4b3368fad3dfcdc54ede6171b886daf3c"
-
-ajv-keywords@^2.0.0, ajv-keywords@^2.1.0:
+ajv-keywords@^2.1.0:
   version "2.1.1"
   resolved "https://registry.yarnpkg.com/ajv-keywords/-/ajv-keywords-2.1.1.tgz#617997fc5f60576894c435f940d819e135b80762"

@@ -229,14 +503,14 @@
   version "3.1.0"
   resolved "https://registry.yarnpkg.com/ajv-keywords/-/ajv-keywords-3.1.0.tgz#ac2b27939c543e95d2c06e7f7f5c27be4aa543be"

-ajv@^4.7.0, ajv@^4.9.1, ajv@^4.9.2:
+ajv@^4.9.1, ajv@^4.9.2:
   version "4.11.8"
   resolved "https://registry.yarnpkg.com/ajv/-/ajv-4.11.8.tgz#82ffb02b29e662ae53bdc20af15947706739c536"
   dependencies:
     co "^4.6.0"
     json-stable-stringify "^1.0.1"

-ajv@^5.0.0, ajv@^5.1.0, ajv@^5.1.5, ajv@^5.2.3:
+ajv@^5.1.0, ajv@^5.2.3:
   version "5.3.0"
   resolved "https://registry.yarnpkg.com/ajv/-/ajv-5.3.0.tgz#4414ff74a50879c208ee5fdc826e32c303549eda"
   dependencies:
@@ -254,6 +528,15 @@
     fast-json-stable-stringify "^2.0.0"
     json-schema-traverse "^0.3.0"

+ajv@^6.1.0:
+  version "6.5.0"
+  resolved "https://registry.yarnpkg.com/ajv/-/ajv-6.5.0.tgz#4c8affdf80887d8f132c9c52ab8a2dc4d0b7b24c"
+  dependencies:
+    fast-deep-equal "^2.0.1"
+    fast-json-stable-stringify "^2.0.0"
+    json-schema-traverse "^0.3.0"
+    uri-js "^4.2.1"
+
 ajv@^6.1.1:
   version "6.2.0"
   resolved "https://registry.yarnpkg.com/ajv/-/ajv-6.2.0.tgz#afac295bbaa0152449e522742e4547c1ae9328d2"
@@ -271,14 +554,6 @@
     json-schema-traverse "^0.3.0"
     uri-js "^3.0.2"

-align-text@^0.1.1, align-text@^0.1.3:
-  version "0.1.4"
-  resolved "https://registry.yarnpkg.com/align-text/-/align-text-0.1.4.tgz#0cd90a561093f35d0a99256c22b7069433fad117"
-  dependencies:
-    kind-of "^3.0.2"
-    longest "^1.0.1"
-    repeat-string "^1.5.2"
-
 alphanum-sort@^1.0.1, alphanum-sort@^1.0.2:
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/alphanum-sort/-/alphanum-sort-1.0.2.tgz#97a1119649b211ad33691d9f9f486a8ec9fbe0a3"
@@ -323,29 +598,59 @@
   dependencies:
     color-convert "^1.9.0"

+ansi-styles@^3.2.1:
+  version "3.2.1"
+  resolved "https://registry.yarnpkg.com/ansi-styles/-/ansi-styles-3.2.1.tgz#41fbb20243e50b12be0f04b8dedbf07520ce841d"
+  dependencies:
+    color-convert "^1.9.0"
+
 any-promise@^1.0.0:
   version "1.3.0"
   resolved "https://registry.yarnpkg.com/any-promise/-/any-promise-1.3.0.tgz#abc6afeedcea52e809cdc0376aed3ce39635d17f"

-anymatch@^1.3.0:
-  version "1.3.2"
-  resolved "https://registry.yarnpkg.com/anymatch/-/anymatch-1.3.2.tgz#553dcb8f91e3c889845dfdba34c77721b90b9d7a"
+anymatch@^2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/anymatch/-/anymatch-2.0.0.tgz#bcb24b4f37934d9aa7ac17b4adaf89e7c76ef2eb"
   dependencies:
-    micromatch "^2.1.5"
-    normalize-path "^2.0.0"
+    micromatch "^3.1.4"
+    normalize-path "^2.1.1"

 app-builder-bin-linux@1.5.0:
   version "1.5.0"
   resolved "https://registry.yarnpkg.com/app-builder-bin-linux/-/app-builder-bin-linux-1.5.0.tgz#c22df1ab9ee7fb0270ec27a3c8a6993966ea4220"

+app-builder-bin-linux@1.6.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-linux/-/app-builder-bin-linux-1.6.0.tgz#d7731d7988b8a740e74d591cbd565f168a266111"
+
+app-builder-bin-linux@1.8.4:
+  version "1.8.4"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-linux/-/app-builder-bin-linux-1.8.4.tgz#9fa4f4f6af21f147cdedc69279940134c77d297f"
+
 app-builder-bin-mac@1.5.0:
   version "1.5.0"
   resolved "https://registry.yarnpkg.com/app-builder-bin-mac/-/app-builder-bin-mac-1.5.0.tgz#40821128a1f20e0559f1fca71a59ecab81bb59b5"

+app-builder-bin-mac@1.6.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-mac/-/app-builder-bin-mac-1.6.0.tgz#c976da70796d67aeb7134a57899636f2581d1c67"
+
+app-builder-bin-mac@1.8.4:
+  version "1.8.4"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-mac/-/app-builder-bin-mac-1.8.4.tgz#abd35353167b037a15353fe44c84b0b17045d12f"
+
 app-builder-bin-win@1.5.0:
   version "1.5.0"
   resolved "https://registry.yarnpkg.com/app-builder-bin-win/-/app-builder-bin-win-1.5.0.tgz#0a12437d825ac89fc2357e8be0ba855f54c083e9"

+app-builder-bin-win@1.6.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-win/-/app-builder-bin-win-1.6.0.tgz#528ef96430d519c270b4de260bea0ddc70df1733"
+
+app-builder-bin-win@1.8.4:
+  version "1.8.4"
+  resolved "https://registry.yarnpkg.com/app-builder-bin-win/-/app-builder-bin-win-1.8.4.tgz#ba5f7a7d8ae48d32c400691b3c45f6f746c27748"
+
 app-builder-bin@1.5.0:
   version "1.5.0"
   resolved "https://registry.yarnpkg.com/app-builder-bin/-/app-builder-bin-1.5.0.tgz#dc768af9704876959c68af5456ef31f67a4663fe"
@@ -354,7 +659,23 @@
     app-builder-bin-mac "1.5.0"
     app-builder-bin-win "1.5.0"

-aproba@^1.0.3:
+app-builder-bin@1.6.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/app-builder-bin/-/app-builder-bin-1.6.0.tgz#c0e88a488d4c23c2e7fe0bbfb70c1d61165be206"
+  optionalDependencies:
+    app-builder-bin-linux "1.6.0"
+    app-builder-bin-mac "1.6.0"
+    app-builder-bin-win "1.6.0"
+
+app-builder-bin@1.8.4:
+  version "1.8.4"
+  resolved "https://registry.yarnpkg.com/app-builder-bin/-/app-builder-bin-1.8.4.tgz#ca8fd02209c2e0681de97fdb4c559d93381cc812"
+  optionalDependencies:
+    app-builder-bin-linux "1.8.4"
+    app-builder-bin-mac "1.8.4"
+    app-builder-bin-win "1.8.4"
+
+aproba@^1.0.3, aproba@^1.1.1:
   version "1.2.0"
   resolved "https://registry.yarnpkg.com/aproba/-/aproba-1.2.0.tgz#6802e6264efd18c790a1b0d517f0f2627bf2c94a"

@@ -396,17 +717,11 @@
   dependencies:
     sprintf-js "~1.0.2"

-arr-diff@^2.0.0:
-  version "2.0.0"
-  resolved "https://registry.yarnpkg.com/arr-diff/-/arr-diff-2.0.0.tgz#8f3b827f955a8bd669697e4a4256ac3ceae356cf"
-  dependencies:
-    arr-flatten "^1.0.1"
-
 arr-diff@^4.0.0:
   version "4.0.0"
   resolved "https://registry.yarnpkg.com/arr-diff/-/arr-diff-4.0.0.tgz#d6461074febfec71e7e15235761a329a5dc7c520"

-arr-flatten@^1.0.1, arr-flatten@^1.1.0:
+arr-flatten@^1.1.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/arr-flatten/-/arr-flatten-1.1.0.tgz#36048bbff4e7b47e136644316c99669ea5ae91f1"

@@ -439,10 +754,6 @@
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/array-uniq/-/array-uniq-1.0.3.tgz#af6ac877a25cc7f74e058894753858dfdb24fdb6"

-array-unique@^0.2.1:
-  version "0.2.1"
-  resolved "https://registry.yarnpkg.com/array-unique/-/array-unique-0.2.1.tgz#a1d97ccafcbc2625cc70fadceb36a50c58b01a53"
-
 array-unique@^0.3.2:
   version "0.3.2"
   resolved "https://registry.yarnpkg.com/array-unique/-/array-unique-0.3.2.tgz#a894b75d4bc4f6cd679ef3244a9fd8f46ae2d428"
@@ -510,6 +821,10 @@
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/assertion-error/-/assertion-error-1.0.2.tgz#13ca515d86206da0bac66e834dd397d87581094c"

+assign-symbols@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/assign-symbols/-/assign-symbols-1.0.0.tgz#59667f41fadd4f20ccbc2bb96b8d4f7f78ec0367"
+
 async-each@^1.0.0:
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/async-each/-/async-each-1.0.1.tgz#19d386a1d9edc6e7c1c85d388aedbcc56d33602d"
@@ -522,7 +837,11 @@
   version "0.1.3"
   resolved "https://registry.yarnpkg.com/async-foreach/-/async-foreach-0.1.3.tgz#36121f845c0578172de419a97dbeb1d16ec34542"

-async@^2.0.0, async@^2.1.2, async@^2.1.5, async@^2.4.1:
+async-limiter@~1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/async-limiter/-/async-limiter-1.0.0.tgz#78faed8c3d074ab81f22b4e985d79e8738f720f8"
+
+async@^2.0.0:
   version "2.5.0"
   resolved "https://registry.yarnpkg.com/async/-/async-2.5.0.tgz#843190fd6b7357a0b9e1c956edddd5ec8462b54d"
   dependencies:
@@ -555,18 +874,23 @@
     postcss "^5.2.16"
     postcss-value-parser "^3.2.3"

-awesome-typescript-loader@^3.4.0:
-  version "3.4.0"
-  resolved "https://registry.yarnpkg.com/awesome-typescript-loader/-/awesome-typescript-loader-3.4.0.tgz#aed2c83af614d617d11e3ec368ac3befb55d002f"
+awesome-node-loader@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/awesome-node-loader/-/awesome-node-loader-1.1.0.tgz#95cf054ec2fa233c38f29ce18cc59b0ef0c002db"
   dependencies:
-    colors "^1.1.2"
-    enhanced-resolve "3.3.0"
     loader-utils "^1.1.0"
-    lodash "^4.17.4"
-    micromatch "^3.0.3"
+
+awesome-typescript-loader@^5.0.0:
+  version "5.0.0"
+  resolved "https://registry.yarnpkg.com/awesome-typescript-loader/-/awesome-typescript-loader-5.0.0.tgz#130c304ae52a60933f15d93f7629003b483fa8b1"
+  dependencies:
+    chalk "^2.3.1"
+    enhanced-resolve "^4.0.0"
+    loader-utils "^1.1.0"
+    lodash "^4.17.5"
+    micromatch "^3.1.9"
     mkdirp "^0.5.1"
-    object-assign "^4.1.1"
-    source-map-support "^0.4.15"
+    source-map-support "^0.5.3"

 aws-sdk@^2.23.0:
   version "2.142.0"
@@ -595,7 +919,7 @@
   version "1.6.0"
   resolved "https://registry.yarnpkg.com/aws4/-/aws4-1.6.0.tgz#83ef5ca860b2b32e4a0deedee8c771b9db57471e"

-babel-code-frame@^6.11.0, babel-code-frame@^6.22.0, babel-code-frame@^6.26.0:
+babel-code-frame@^6.22.0, babel-code-frame@^6.26.0:
   version "6.26.0"
   resolved "https://registry.yarnpkg.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz#63fd43f7dc1e3bb7ce35947db8fe369a3f58c74b"
   dependencies:
@@ -603,7 +927,7 @@
     esutils "^2.0.2"
     js-tokens "^3.0.2"

-babel-core@^6.22.1, babel-core@^6.24.1, babel-core@^6.26.0:
+babel-core@^6.26.0:
   version "6.26.0"
   resolved "https://registry.yarnpkg.com/babel-core/-/babel-core-6.26.0.tgz#af32f78b31a6fcef119c87b0fd8d9753f03a0bb8"
   dependencies:
@@ -627,6 +951,30 @@
     slash "^1.0.0"
     source-map "^0.5.6"

+babel-core@^6.26.3:
+  version "6.26.3"
+  resolved "https://registry.yarnpkg.com/babel-core/-/babel-core-6.26.3.tgz#b2e2f09e342d0f0c88e2f02e067794125e75c207"
+  dependencies:
+    babel-code-frame "^6.26.0"
+    babel-generator "^6.26.0"
+    babel-helpers "^6.24.1"
+    babel-messages "^6.23.0"
+    babel-register "^6.26.0"
+    babel-runtime "^6.26.0"
+    babel-template "^6.26.0"
+    babel-traverse "^6.26.0"
+    babel-types "^6.26.0"
+    babylon "^6.18.0"
+    convert-source-map "^1.5.1"
+    debug "^2.6.9"
+    json5 "^0.5.1"
+    lodash "^4.17.4"
+    minimatch "^3.0.4"
+    path-is-absolute "^1.0.1"
+    private "^0.1.8"
+    slash "^1.0.0"
+    source-map "^0.5.7"
+
 babel-generator@^6.26.0:
   version "6.26.0"
   resolved "https://registry.yarnpkg.com/babel-generator/-/babel-generator-6.26.0.tgz#ac1ae20070b79f6e3ca1d3269613053774f20dc5"
@@ -640,33 +988,33 @@
     source-map "^0.5.6"
     trim-right "^1.0.1"

-babel-helper-evaluate-path@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-evaluate-path/-/babel-helper-evaluate-path-0.2.0.tgz#0bb2eb01996c0cef53c5e8405e999fe4a0244c08"
+babel-helper-evaluate-path@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-evaluate-path/-/babel-helper-evaluate-path-0.3.0.tgz#2439545e0b6eae5b7f49b790acbebd6b9a73df20"

-babel-helper-flip-expressions@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-flip-expressions/-/babel-helper-flip-expressions-0.2.0.tgz#160d2090a3d9f9c64a750905321a0bc218f884ec"
+babel-helper-flip-expressions@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-flip-expressions/-/babel-helper-flip-expressions-0.3.0.tgz#f5b6394bd5219b43cf8f7b201535ed540c6e7fa2"

 babel-helper-is-nodes-equiv@^0.0.1:
   version "0.0.1"
   resolved "https://registry.yarnpkg.com/babel-helper-is-nodes-equiv/-/babel-helper-is-nodes-equiv-0.0.1.tgz#34e9b300b1479ddd98ec77ea0bbe9342dfe39684"

-babel-helper-is-void-0@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-is-void-0/-/babel-helper-is-void-0-0.2.0.tgz#6ed0ada8a9b1c5b6e88af6b47c1b3b5c080860eb"
+babel-helper-is-void-0@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-is-void-0/-/babel-helper-is-void-0-0.3.0.tgz#95570d20bd27b2206f68083ae9980ee7003d8fe7"

-babel-helper-mark-eval-scopes@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-mark-eval-scopes/-/babel-helper-mark-eval-scopes-0.2.0.tgz#7648aaf2ec92aae9b09a20ad91e8df5e1fcc94b2"
+babel-helper-mark-eval-scopes@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-mark-eval-scopes/-/babel-helper-mark-eval-scopes-0.3.0.tgz#b4731314fdd7a89091271a5213b4e12d236e29e8"

-babel-helper-remove-or-void@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-remove-or-void/-/babel-helper-remove-or-void-0.2.0.tgz#8e46ad5b30560d57d7510b3fd93f332ee7c67386"
+babel-helper-remove-or-void@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-remove-or-void/-/babel-helper-remove-or-void-0.3.0.tgz#f43c86147c8fcc395a9528cbb31e7ff49d7e16e3"

-babel-helper-to-multiple-sequence-expressions@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-to-multiple-sequence-expressions/-/babel-helper-to-multiple-sequence-expressions-0.2.0.tgz#d1a419634c6cb301f27858c659167cfee0a9d318"
+babel-helper-to-multiple-sequence-expressions@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-helper-to-multiple-sequence-expressions/-/babel-helper-to-multiple-sequence-expressions-0.3.0.tgz#8da2275ccc26995566118f7213abfd9af7214427"

 babel-helpers@^6.24.1:
   version "6.24.1"
@@ -681,156 +1029,157 @@
   dependencies:
     babel-runtime "^6.22.0"

-babel-minify@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-minify/-/babel-minify-0.2.0.tgz#36d381fee4002d7949dd5d796e74800336057d67"
+babel-minify-webpack-plugin@^0.3.1:
+  version "0.3.1"
+  resolved "https://registry.yarnpkg.com/babel-minify-webpack-plugin/-/babel-minify-webpack-plugin-0.3.1.tgz#292aa240af190e2dcadf4f684d6d84d179b6d5a4"
   dependencies:
-    babel-core "^6.24.1"
-    babel-preset-minify "^0.2.0"
-    fs-readdir-recursive "^1.0.0"
-    mkdirp "^0.5.1"
-    util.promisify "^1.0.0"
-    yargs-parser "^5.0.0"
+    babel-core "^6.26.0"
+    babel-preset-minify "^0.3.0"
+    webpack-sources "^1.0.1"

-babel-plugin-minify-builtins@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-builtins/-/babel-plugin-minify-builtins-0.2.0.tgz#317f824b0907210b6348671bb040ca072e2e0c82"
+babel-plugin-minify-builtins@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-builtins/-/babel-plugin-minify-builtins-0.3.0.tgz#4740117a6a784063aaf8f092989cf9e4bd484860"
   dependencies:
-    babel-helper-evaluate-path "^0.2.0"
+    babel-helper-evaluate-path "^0.3.0"

-babel-plugin-minify-constant-folding@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-constant-folding/-/babel-plugin-minify-constant-folding-0.2.0.tgz#8c70b528b2eb7c13e94d95c8789077d4cdbc3970"
+babel-plugin-minify-constant-folding@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-constant-folding/-/babel-plugin-minify-constant-folding-0.3.0.tgz#687e40336bd4ddd921e0e197f0006235ac184bb9"
   dependencies:
-    babel-helper-evaluate-path "^0.2.0"
+    babel-helper-evaluate-path "^0.3.0"

-babel-plugin-minify-dead-code-elimination@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-dead-code-elimination/-/babel-plugin-minify-dead-code-elimination-0.2.0.tgz#e8025ee10a1e5e4f202633a6928ce892c33747e3"
+babel-plugin-minify-dead-code-elimination@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-dead-code-elimination/-/babel-plugin-minify-dead-code-elimination-0.3.0.tgz#a323f686c404b824186ba5583cf7996cac81719e"
   dependencies:
-    babel-helper-evaluate-path "^0.2.0"
-    babel-helper-mark-eval-scopes "^0.2.0"
-    babel-helper-remove-or-void "^0.2.0"
+    babel-helper-evaluate-path "^0.3.0"
+    babel-helper-mark-eval-scopes "^0.3.0"
+    babel-helper-remove-or-void "^0.3.0"
     lodash.some "^4.6.0"

-babel-plugin-minify-flip-comparisons@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-flip-comparisons/-/babel-plugin-minify-flip-comparisons-0.2.0.tgz#0c9c8e93155c8f09dedad8118b634c259f709ef5"
+babel-plugin-minify-flip-comparisons@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-flip-comparisons/-/babel-plugin-minify-flip-comparisons-0.3.0.tgz#6627893a409c9f30ef7f2c89e0c6eea7ee97ddc4"
   dependencies:
-    babel-helper-is-void-0 "^0.2.0"
+    babel-helper-is-void-0 "^0.3.0"

-babel-plugin-minify-guarded-expressions@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-guarded-expressions/-/babel-plugin-minify-guarded-expressions-0.2.0.tgz#8a8c950040fce3e258a12e6eb21eab94ad7235ab"
+babel-plugin-minify-guarded-expressions@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-guarded-expressions/-/babel-plugin-minify-guarded-expressions-0.3.0.tgz#2552d96189ef45d9a463f1a6b5e4fa110703ac8d"
   dependencies:
-    babel-helper-flip-expressions "^0.2.0"
+    babel-helper-flip-expressions "^0.3.0"

-babel-plugin-minify-infinity@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-infinity/-/babel-plugin-minify-infinity-0.2.0.tgz#30960c615ddbc657c045bb00a1d8eb4af257cf03"
+babel-plugin-minify-infinity@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-infinity/-/babel-plugin-minify-infinity-0.3.0.tgz#c5ec0edd433517cf31b3af17077c202beb48bbe7"

-babel-plugin-minify-mangle-names@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-mangle-names/-/babel-plugin-minify-mangle-names-0.2.0.tgz#719892297ff0106a6ec1a4b0fc062f1f8b6a8529"
+babel-plugin-minify-mangle-names@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-mangle-names/-/babel-plugin-minify-mangle-names-0.3.0.tgz#f28561bad0dd2f0380816816bb946e219b3b6135"
   dependencies:
-    babel-helper-mark-eval-scopes "^0.2.0"
+    babel-helper-mark-eval-scopes "^0.3.0"

-babel-plugin-minify-numeric-literals@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-numeric-literals/-/babel-plugin-minify-numeric-literals-0.2.0.tgz#5746e851700167a380c05e93f289a7070459a0d1"
+babel-plugin-minify-numeric-literals@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-numeric-literals/-/babel-plugin-minify-numeric-literals-0.3.0.tgz#b57734a612e8a592005407323c321119f27d4b40"

-babel-plugin-minify-replace@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-replace/-/babel-plugin-minify-replace-0.2.0.tgz#3c1f06bc4e6d3e301eacb763edc1be611efc39b0"
+babel-plugin-minify-replace@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-replace/-/babel-plugin-minify-replace-0.3.0.tgz#980125bbf7cbb5a637439de9d0b1b030a4693893"

-babel-plugin-minify-simplify@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-simplify/-/babel-plugin-minify-simplify-0.2.0.tgz#21ceec4857100c5476d7cef121f351156e5c9bc0"
+babel-plugin-minify-simplify@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-simplify/-/babel-plugin-minify-simplify-0.3.0.tgz#14574cc74d21c81d3060fafa041010028189f11b"
   dependencies:
-    babel-helper-flip-expressions "^0.2.0"
+    babel-helper-flip-expressions "^0.3.0"
     babel-helper-is-nodes-equiv "^0.0.1"
-    babel-helper-to-multiple-sequence-expressions "^0.2.0"
+    babel-helper-to-multiple-sequence-expressions "^0.3.0"

-babel-plugin-minify-type-constructors@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-minify-type-constructors/-/babel-plugin-minify-type-constructors-0.2.0.tgz#7f3b6458be0863cfd59e9985bed6d134aa7a2e17"
+babel-plugin-minify-type-constructors@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-minify-type-constructors/-/babel-plugin-minify-type-constructors-0.3.0.tgz#7f5a86ef322c4746364e3c591b8514eeafea6ad4"
   dependencies:
-    babel-helper-is-void-0 "^0.2.0"
+    babel-helper-is-void-0 "^0.3.0"

-babel-plugin-transform-inline-consecutive-adds@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-inline-consecutive-adds/-/babel-plugin-transform-inline-consecutive-adds-0.2.0.tgz#15dae78921057f4004f8eafd79e15ddc5f12f426"
+babel-plugin-syntax-dynamic-import@^6.18.0:
+  version "6.18.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-syntax-dynamic-import/-/babel-plugin-syntax-dynamic-import-6.18.0.tgz#8d6a26229c83745a9982a441051572caa179b1da"

-babel-plugin-transform-member-expression-literals@^6.8.5:
-  version "6.8.5"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-member-expression-literals/-/babel-plugin-transform-member-expression-literals-6.8.5.tgz#e06ae305cf48d819822e93a70d79269f04d89eec"
+babel-plugin-transform-inline-consecutive-adds@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-inline-consecutive-adds/-/babel-plugin-transform-inline-consecutive-adds-0.3.0.tgz#f07d93689c0002ed2b2b62969bdd99f734e03f57"
+
+babel-plugin-transform-member-expression-literals@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-member-expression-literals/-/babel-plugin-transform-member-expression-literals-6.9.4.tgz#37039c9a0c3313a39495faac2ff3a6b5b9d038bf"

-babel-plugin-transform-merge-sibling-variables@^6.8.6:
-  version "6.8.6"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-merge-sibling-variables/-/babel-plugin-transform-merge-sibling-variables-6.8.6.tgz#6d21efa5ee4981f71657fae716f9594bb2622aef"
+babel-plugin-transform-merge-sibling-variables@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-merge-sibling-variables/-/babel-plugin-transform-merge-sibling-variables-6.9.4.tgz#85b422fc3377b449c9d1cde44087203532401dae"

-babel-plugin-transform-minify-booleans@^6.8.3:
-  version "6.8.3"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-minify-booleans/-/babel-plugin-transform-minify-booleans-6.8.3.tgz#5906ed776d3718250519abf1bace44b0b613ddf9"
+babel-plugin-transform-minify-booleans@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-minify-booleans/-/babel-plugin-transform-minify-booleans-6.9.4.tgz#acbb3e56a3555dd23928e4b582d285162dd2b198"

-babel-plugin-transform-property-literals@^6.8.5:
-  version "6.8.5"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-property-literals/-/babel-plugin-transform-property-literals-6.8.5.tgz#67ed5930b34805443452c8b9690c7ebe1e206c40"
+babel-plugin-transform-property-literals@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-property-literals/-/babel-plugin-transform-property-literals-6.9.4.tgz#98c1d21e255736573f93ece54459f6ce24985d39"
   dependencies:
     esutils "^2.0.2"

-babel-plugin-transform-regexp-constructors@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-regexp-constructors/-/babel-plugin-transform-regexp-constructors-0.2.0.tgz#6aa5dd0acc515db4be929bbcec4ed4c946c534a3"
+babel-plugin-transform-regexp-constructors@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-regexp-constructors/-/babel-plugin-transform-regexp-constructors-0.3.0.tgz#9bb2c8dd082271a5cb1b3a441a7c52e8fd07e0f5"

-babel-plugin-transform-remove-console@^6.8.5:
-  version "6.8.5"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-console/-/babel-plugin-transform-remove-console-6.8.5.tgz#fde9d2d3d725530b0fadd8d31078402410386810"
+babel-plugin-transform-remove-console@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-console/-/babel-plugin-transform-remove-console-6.9.4.tgz#b980360c067384e24b357a588d807d3c83527780"

-babel-plugin-transform-remove-debugger@^6.8.5:
-  version "6.8.5"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-debugger/-/babel-plugin-transform-remove-debugger-6.8.5.tgz#809584d412bf918f071fdf41e1fdb15ea89cdcd5"
+babel-plugin-transform-remove-debugger@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-debugger/-/babel-plugin-transform-remove-debugger-6.9.4.tgz#42b727631c97978e1eb2d199a7aec84a18339ef2"

-babel-plugin-transform-remove-undefined@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-undefined/-/babel-plugin-transform-remove-undefined-0.2.0.tgz#94f052062054c707e8d094acefe79416b63452b1"
+babel-plugin-transform-remove-undefined@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-remove-undefined/-/babel-plugin-transform-remove-undefined-0.3.0.tgz#03f5f0071867781e9beabbc7b77bf8095fd3f3ec"
   dependencies:
-    babel-helper-evaluate-path "^0.2.0"
+    babel-helper-evaluate-path "^0.3.0"

-babel-plugin-transform-simplify-comparison-operators@^6.8.5:
-  version "6.8.5"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-simplify-comparison-operators/-/babel-plugin-transform-simplify-comparison-operators-6.8.5.tgz#a838786baf40cc33a93b95ae09e05591227e43bf"
+babel-plugin-transform-simplify-comparison-operators@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-simplify-comparison-operators/-/babel-plugin-transform-simplify-comparison-operators-6.9.4.tgz#f62afe096cab0e1f68a2d753fdf283888471ceb9"

-babel-plugin-transform-undefined-to-void@^6.8.3:
-  version "6.8.3"
-  resolved "https://registry.yarnpkg.com/babel-plugin-transform-undefined-to-void/-/babel-plugin-transform-undefined-to-void-6.8.3.tgz#fc52707f6ee1ddc71bb91b0d314fbefdeef9beb4"
+babel-plugin-transform-undefined-to-void@^6.9.0:
+  version "6.9.4"
+  resolved "https://registry.yarnpkg.com/babel-plugin-transform-undefined-to-void/-/babel-plugin-transform-undefined-to-void-6.9.4.tgz#be241ca81404030678b748717322b89d0c8fe280"

-babel-preset-minify@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/babel-preset-minify/-/babel-preset-minify-0.2.0.tgz#006566552d9b83834472273f306c0131062a0acc"
-  dependencies:
-    babel-plugin-minify-builtins "^0.2.0"
-    babel-plugin-minify-constant-folding "^0.2.0"
-    babel-plugin-minify-dead-code-elimination "^0.2.0"
-    babel-plugin-minify-flip-comparisons "^0.2.0"
-    babel-plugin-minify-guarded-expressions "^0.2.0"
-    babel-plugin-minify-infinity "^0.2.0"
-    babel-plugin-minify-mangle-names "^0.2.0"
-    babel-plugin-minify-numeric-literals "^0.2.0"
-    babel-plugin-minify-replace "^0.2.0"
-    babel-plugin-minify-simplify "^0.2.0"
-    babel-plugin-minify-type-constructors "^0.2.0"
-    babel-plugin-transform-inline-consecutive-adds "^0.2.0"
-    babel-plugin-transform-member-expression-literals "^6.8.5"
-    babel-plugin-transform-merge-sibling-variables "^6.8.6"
-    babel-plugin-transform-minify-booleans "^6.8.3"
-    babel-plugin-transform-property-literals "^6.8.5"
-    babel-plugin-transform-regexp-constructors "^0.2.0"
-    babel-plugin-transform-remove-console "^6.8.5"
-    babel-plugin-transform-remove-debugger "^6.8.5"
-    babel-plugin-transform-remove-undefined "^0.2.0"
-    babel-plugin-transform-simplify-comparison-operators "^6.8.5"
-    babel-plugin-transform-undefined-to-void "^6.8.3"
+babel-preset-minify@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/babel-preset-minify/-/babel-preset-minify-0.3.0.tgz#7db64afa75f16f6e06c0aa5f25195f6f36784d77"
+  dependencies:
+    babel-plugin-minify-builtins "^0.3.0"
+    babel-plugin-minify-constant-folding "^0.3.0"
+    babel-plugin-minify-dead-code-elimination "^0.3.0"
+    babel-plugin-minify-flip-comparisons "^0.3.0"
+    babel-plugin-minify-guarded-expressions "^0.3.0"
+    babel-plugin-minify-infinity "^0.3.0"
+    babel-plugin-minify-mangle-names "^0.3.0"
+    babel-plugin-minify-numeric-literals "^0.3.0"
+    babel-plugin-minify-replace "^0.3.0"
+    babel-plugin-minify-simplify "^0.3.0"
+    babel-plugin-minify-type-constructors "^0.3.0"
+    babel-plugin-transform-inline-consecutive-adds "^0.3.0"
+    babel-plugin-transform-member-expression-literals "^6.9.0"
+    babel-plugin-transform-merge-sibling-variables "^6.9.0"
+    babel-plugin-transform-minify-booleans "^6.9.0"
+    babel-plugin-transform-property-literals "^6.9.0"
+    babel-plugin-transform-regexp-constructors "^0.3.0"
+    babel-plugin-transform-remove-console "^6.9.0"
+    babel-plugin-transform-remove-debugger "^6.9.0"
+    babel-plugin-transform-remove-undefined "^0.3.0"
+    babel-plugin-transform-simplify-comparison-operators "^6.9.0"
+    babel-plugin-transform-undefined-to-void "^6.9.0"
     lodash.isplainobject "^4.0.6"

 babel-register@^6.26.0:
@@ -892,15 +1241,6 @@
     lodash "^4.17.4"
     to-fast-properties "^1.0.3"

-babel-webpack-plugin@^0.1.1:
-  version "0.1.1"
-  resolved "https://registry.yarnpkg.com/babel-webpack-plugin/-/babel-webpack-plugin-0.1.1.tgz#ab9f3c427d1574456caa33024f1bdb7b2848460c"
-  dependencies:
-    babel-core "^6.22.1"
-    source-map "^0.5.6"
-    webpack "^2.2.0"
-    webpack-sources "^0.1.4"
-
 babylon@^6.18.0:
   version "6.18.0"
   resolved "https://registry.yarnpkg.com/babylon/-/babylon-6.18.0.tgz#af2f3b88fa6f5c1e4c634d1a0f8eac4f55b395e3"
@@ -939,6 +1279,14 @@
   dependencies:
     tweetnacl "^0.14.3"

+bfj-node4@^5.2.0:
+  version "5.3.1"
+  resolved "https://registry.yarnpkg.com/bfj-node4/-/bfj-node4-5.3.1.tgz#e23d8b27057f1d0214fc561142ad9db998f26830"
+  dependencies:
+    bluebird "^3.5.1"
+    check-types "^7.3.0"
+    tryer "^1.0.0"
+
 big.js@^3.1.3:
   version "3.2.0"
   resolved "https://registry.yarnpkg.com/big.js/-/big.js-3.2.0.tgz#a5fc298b81b9e0dca2e458824784b65c52ba588e"
@@ -972,7 +1320,7 @@
   dependencies:
     bluebird "^3.5.1"

-bluebird@^3.0.6, bluebird@^3.1.1, bluebird@^3.3.4, bluebird@^3.4.7, bluebird@^3.5.0, bluebird@^3.5.1:
+bluebird@^3.0.6, bluebird@^3.1.1, bluebird@^3.3.4, bluebird@^3.5.0, bluebird@^3.5.1:
   version "3.5.1"
   resolved "https://registry.yarnpkg.com/bluebird/-/bluebird-3.5.1.tgz#d9551f9de98f1fcda1e683d17ee91a0602ee2eb9"

@@ -1036,14 +1384,6 @@
     balanced-match "^1.0.0"
     concat-map "0.0.1"

-braces@^1.8.2:
-  version "1.8.5"
-  resolved "https://registry.yarnpkg.com/braces/-/braces-1.8.5.tgz#ba77962e12dff969d6b76711e914b737857bf6a7"
-  dependencies:
-    expand-range "^1.8.1"
-    preserve "^0.2.0"
-    repeat-element "^1.1.2"
-
 braces@^2.3.0:
   version "2.3.0"
   resolved "https://registry.yarnpkg.com/braces/-/braces-2.3.0.tgz#a46941cb5fb492156b3d6a656e06c35364e3e66e"
@@ -1060,6 +1400,21 @@
     split-string "^3.0.2"
     to-regex "^3.0.1"

+braces@^2.3.1:
+  version "2.3.2"
+  resolved "https://registry.yarnpkg.com/braces/-/braces-2.3.2.tgz#5979fd3f14cd531565e5fa2df1abfff1dfaee729"
+  dependencies:
+    arr-flatten "^1.1.0"
+    array-unique "^0.3.2"
+    extend-shallow "^2.0.1"
+    fill-range "^4.0.0"
+    isobject "^3.0.1"
+    repeat-element "^1.1.2"
+    snapdragon "^0.8.1"
+    snapdragon-node "^2.0.1"
+    split-string "^3.0.2"
+    to-regex "^3.0.1"
+
 brorand@^1.0.1:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/brorand/-/brorand-1.1.0.tgz#12c25efe40a45e3c323eb8675a0a0ce57b22371f"
@@ -1131,6 +1486,10 @@
   version "0.2.13"
   resolved "https://registry.yarnpkg.com/buffer-crc32/-/buffer-crc32-0.2.13.tgz#0d333e3f00eac50aa1454abd30ef8c2a5d9a7242"

+buffer-from@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/buffer-from/-/buffer-from-1.0.0.tgz#4cb8832d23612589b0406e9e2956c17f06fdf531"
+
 buffer-xor@^1.0.3:
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/buffer-xor/-/buffer-xor-1.0.3.tgz#26e61ed1422fb70dd42e6e36729ed51d855fe8d9"
@@ -1147,7 +1506,7 @@
   version "0.1.1"
   resolved "https://registry.yarnpkg.com/buffers/-/buffers-0.1.1.tgz#b24579c3bed4d6d396aeee6d9a8ae7f5482ab7bb"

-builder-util-runtime@4.0.5, builder-util-runtime@^4.0.5:
+builder-util-runtime@4.0.5:
   version "4.0.5"
   resolved "https://registry.yarnpkg.com/builder-util-runtime/-/builder-util-runtime-4.0.5.tgz#5340cf9886b9283ea6e5b20dc09b5e3e461aef62"
   dependencies:
@@ -1156,7 +1515,16 @@
     fs-extra-p "^4.5.0"
     sax "^1.2.4"

-builder-util@5.6.0, builder-util@^5.6.0:
+builder-util-runtime@^4.0.5, builder-util-runtime@^4.2.0:
+  version "4.2.0"
+  resolved "https://registry.yarnpkg.com/builder-util-runtime/-/builder-util-runtime-4.2.0.tgz#c56aa18d34390143da031c418c9d3a055fbd3522"
+  dependencies:
+    bluebird-lst "^1.0.5"
+    debug "^3.1.0"
+    fs-extra-p "^4.5.2"
+    sax "^1.2.4"
+
+builder-util@5.6.0:
   version "5.6.0"
   resolved "https://registry.yarnpkg.com/builder-util/-/builder-util-5.6.0.tgz#c37c5207cd818531bda819ac836b6d51dfbccd4a"
   dependencies:
@@ -1175,6 +1543,44 @@
     stat-mode "^0.2.2"
     temp-file "^3.1.1"

+builder-util@5.6.1:
+  version "5.6.1"
+  resolved "https://registry.yarnpkg.com/builder-util/-/builder-util-5.6.1.tgz#ab90845cb8949ea4ac81da0ce87b8ec3424cdbf9"
+  dependencies:
+    "7zip-bin" "~3.1.0"
+    app-builder-bin "1.6.0"
+    bluebird-lst "^1.0.5"
+    builder-util-runtime "^4.0.5"
+    chalk "^2.3.2"
+    debug "^3.1.0"
+    fs-extra-p "^4.5.2"
+    is-ci "^1.1.0"
+    js-yaml "^3.10.0"
+    lazy-val "^1.0.3"
+    semver "^5.5.0"
+    source-map-support "^0.5.3"
+    stat-mode "^0.2.2"
+    temp-file "^3.1.1"
+
+builder-util@^5.6.0:
+  version "5.7.5"
+  resolved "https://registry.yarnpkg.com/builder-util/-/builder-util-5.7.5.tgz#58f8d2b7a35445c5fb45bff50b39bbed554c9863"
+  dependencies:
+    "7zip-bin" "~3.1.0"
+    app-builder-bin "1.8.4"
+    bluebird-lst "^1.0.5"
+    builder-util-runtime "^4.2.0"
+    chalk "^2.3.2"
+    debug "^3.1.0"
+    fs-extra-p "^4.5.2"
+    is-ci "^1.1.0"
+    js-yaml "^3.11.0"
+    lazy-val "^1.0.3"
+    semver "^5.5.0"
+    source-map-support "^0.5.4"
+    stat-mode "^0.2.2"
+    temp-file "^3.1.1"
+
 builtin-modules@^1.0.0, builtin-modules@^1.1.1:
   version "1.1.1"
   resolved "https://registry.yarnpkg.com/builtin-modules/-/builtin-modules-1.1.1.tgz#270f076c5a72c02f5b65a47df94c5fe3a278892f"
@@ -1187,6 +1593,24 @@
   version "3.0.0"
   resolved "https://registry.yarnpkg.com/bytes/-/bytes-3.0.0.tgz#d32815404d689699f85a4ea4fa8755dd13a96048"

+cacache@^10.0.4:
+  version "10.0.4"
+  resolved "https://registry.yarnpkg.com/cacache/-/cacache-10.0.4.tgz#6452367999eff9d4188aefd9a14e9d7c6a263460"
+  dependencies:
+    bluebird "^3.5.1"
+    chownr "^1.0.1"
+    glob "^7.1.2"
+    graceful-fs "^4.1.11"
+    lru-cache "^4.1.1"
+    mississippi "^2.0.0"
+    mkdirp "^0.5.1"
+    move-concurrently "^1.0.1"
+    promise-inflight "^1.0.1"
+    rimraf "^2.6.2"
+    ssri "^5.2.4"
+    unique-filename "^1.1.0"
+    y18n "^4.0.0"
+
 cache-base@^1.0.1:
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/cache-base/-/cache-base-1.0.1.tgz#0a7f46416831c8b662ee36fe4e7c59d76f666ab2"
@@ -1225,10 +1649,6 @@
     camelcase "^2.0.0"
     map-obj "^1.0.0"

-camelcase@^1.0.2:
-  version "1.2.1"
-  resolved "https://registry.yarnpkg.com/camelcase/-/camelcase-1.2.1.tgz#9bb5304d2e0b56698b2c758b08a3eaa9daa58a39"
-
 camelcase@^2.0.0:
   version "2.1.1"
   resolved "https://registry.yarnpkg.com/camelcase/-/camelcase-2.1.1.tgz#7c1d16d679a1bbe59ca02cacecfb011e201f5a1f"
@@ -1266,13 +1686,6 @@
   version "0.12.0"
   resolved "https://registry.yarnpkg.com/caseless/-/caseless-0.12.0.tgz#1b681c21ff84033c826543090689420d187151dc"

-center-align@^0.1.1:
-  version "0.1.3"
-  resolved "https://registry.yarnpkg.com/center-align/-/center-align-0.1.3.tgz#aa0d32629b6ee972200411cbd4461c907bc2b7ad"
-  dependencies:
-    align-text "^0.1.3"
-    lazy-cache "^1.0.3"
-
 chai-as-promised@^7.1.1:
   version "7.1.1"
   resolved "https://registry.yarnpkg.com/chai-as-promised/-/chai-as-promised-7.1.1.tgz#08645d825deb8696ee61725dbf590c012eb00ca0"
@@ -1320,24 +1733,55 @@
     escape-string-regexp "^1.0.5"
     supports-color "^4.0.0"

+chalk@^2.3.1:
+  version "2.4.1"
+  resolved "https://registry.yarnpkg.com/chalk/-/chalk-2.4.1.tgz#18c49ab16a037b6eb0152cc83e3471338215b66e"
+  dependencies:
+    ansi-styles "^3.2.1"
+    escape-string-regexp "^1.0.5"
+    supports-color "^5.3.0"
+
+chalk@^2.3.2:
+  version "2.3.2"
+  resolved "https://registry.yarnpkg.com/chalk/-/chalk-2.3.2.tgz#250dc96b07491bfd601e648d66ddf5f60c7a5c65"
+  dependencies:
+    ansi-styles "^3.2.1"
+    escape-string-regexp "^1.0.5"
+    supports-color "^5.3.0"
+
 check-error@^1.0.1, check-error@^1.0.2:
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/check-error/-/check-error-1.0.2.tgz#574d312edd88bb5dd8912e9286dd6c0aed4aac82"

-chokidar@^1.7.0:
-  version "1.7.0"
-  resolved "https://registry.yarnpkg.com/chokidar/-/chokidar-1.7.0.tgz#798e689778151c8076b4b360e5edd28cda2bb468"
+check-types@^7.3.0:
+  version "7.3.0"
+  resolved "https://registry.yarnpkg.com/check-types/-/check-types-7.3.0.tgz#468f571a4435c24248f5fd0cb0e8d87c3c341e7d"
+
+chokidar@^2.0.2:
+  version "2.0.3"
+  resolved "https://registry.yarnpkg.com/chokidar/-/chokidar-2.0.3.tgz#dcbd4f6cbb2a55b4799ba8a840ac527e5f4b1176"
   dependencies:
-    anymatch "^1.3.0"
+    anymatch "^2.0.0"
     async-each "^1.0.0"
-    glob-parent "^2.0.0"
+    braces "^2.3.0"
+    glob-parent "^3.1.0"
     inherits "^2.0.1"
     is-binary-path "^1.0.0"
-    is-glob "^2.0.0"
+    is-glob "^4.0.0"
+    normalize-path "^2.1.1"
     path-is-absolute "^1.0.0"
     readdirp "^2.0.0"
+    upath "^1.0.0"
   optionalDependencies:
-    fsevents "^1.0.0"
+    fsevents "^1.1.2"
+
+chownr@^1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/chownr/-/chownr-1.0.1.tgz#e2a75042a9551908bebd25b8523d5f9769d79181"
+
+chrome-trace-event@^0.1.1:
+  version "0.1.3"
+  resolved "https://registry.yarnpkg.com/chrome-trace-event/-/chrome-trace-event-0.1.3.tgz#d395af2d31c87b90a716c831fe326f69768ec084"

 chromium-pickle-js@^0.1.0:
   version "0.1.0"
@@ -1384,9 +1828,9 @@
   dependencies:
     source-map "0.5.x"

-clean-webpack-plugin@^0.1.16:
-  version "0.1.17"
-  resolved "https://registry.yarnpkg.com/clean-webpack-plugin/-/clean-webpack-plugin-0.1.17.tgz#71c57242e6d47204d46f809413176e7bed28ec49"
+clean-webpack-plugin@^0.1.19:
+  version "0.1.19"
+  resolved "https://registry.yarnpkg.com/clean-webpack-plugin/-/clean-webpack-plugin-0.1.19.tgz#ceda8bb96b00fe168e9b080272960d20fdcadd6d"
   dependencies:
     rimraf "^2.6.1"

@@ -1411,14 +1855,6 @@
     exit "0.1.2"
     glob "^7.1.1"

-cliui@^2.1.0:
-  version "2.1.0"
-  resolved "https://registry.yarnpkg.com/cliui/-/cliui-2.1.0.tgz#4b475760ff80264c762c3a1719032e91c7fea0d1"
-  dependencies:
-    center-align "^0.1.1"
-    right-align "^0.1.1"
-    wordwrap "0.0.2"
-
 cliui@^3.2.0:
   version "3.2.0"
   resolved "https://registry.yarnpkg.com/cliui/-/cliui-3.2.0.tgz#120601537a916d29940f934da3b48d585a39213d"
@@ -1435,14 +1871,14 @@
     strip-ansi "^4.0.0"
     wrap-ansi "^2.0.0"

-clone-deep@^0.3.0:
-  version "0.3.0"
-  resolved "https://registry.yarnpkg.com/clone-deep/-/clone-deep-0.3.0.tgz#348c61ae9cdbe0edfe053d91ff4cc521d790ede8"
+clone-deep@^2.0.1:
+  version "2.0.2"
+  resolved "https://registry.yarnpkg.com/clone-deep/-/clone-deep-2.0.2.tgz#00db3a1e173656730d1188c3d6aced6d7ea97713"
   dependencies:
     for-own "^1.0.0"
-    is-plain-object "^2.0.1"
-    kind-of "^3.2.2"
-    shallow-clone "^0.1.2"
+    is-plain-object "^2.0.4"
+    kind-of "^6.0.0"
+    shallow-clone "^1.0.0"

 clone@^1.0.2:
   version "1.0.2"
@@ -1505,7 +1941,7 @@
     css-color-names "0.0.4"
     has "^1.0.1"

-colors@^1.1.2, colors@~1.1.2:
+colors@~1.1.2:
   version "1.1.2"
   resolved "https://registry.yarnpkg.com/colors/-/colors-1.1.2.tgz#168a4701756b6a7f51a12ce0c97bfa28c084ed63"

@@ -1519,10 +1955,18 @@
   version "2.11.0"
   resolved "https://registry.yarnpkg.com/commander/-/commander-2.11.0.tgz#157152fd1e7a6c8d98a5b715cf376df928004563"

-commander@^2.12.1, commander@^2.14.1:
+commander@^2.12.1, commander@^2.13.0, commander@^2.14.1:
   version "2.15.1"
   resolved "https://registry.yarnpkg.com/commander/-/commander-2.15.1.tgz#df46e867d0fc2aec66a34662b406a9ccafff5b0f"

+commander@~2.13.0:
+  version "2.13.0"
+  resolved "https://registry.yarnpkg.com/commander/-/commander-2.13.0.tgz#6964bca67685df7c1f1430c584f07d7597885b9c"
+
+commondir@^1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/commondir/-/commondir-1.0.1.tgz#ddd800da0c66127393cca5950ea968a3aaf1253b"
+
 compare-version@^0.1.2:
   version "0.1.2"
   resolved "https://registry.yarnpkg.com/compare-version/-/compare-version-0.1.2.tgz#0162ec2d9351f5ddd59a9202cba935366a725080"
@@ -1552,6 +1996,15 @@
     readable-stream "^2.2.2"
     typedarray "^0.0.6"

+concat-stream@^1.5.0:
+  version "1.6.2"
+  resolved "https://registry.yarnpkg.com/concat-stream/-/concat-stream-1.6.2.tgz#904bdf194cd3122fc675c77fc4ac3d4ff0fd1a34"
+  dependencies:
+    buffer-from "^1.0.0"
+    inherits "^2.0.3"
+    readable-stream "^2.2.2"
+    typedarray "^0.0.6"
+
 configstore@^3.0.0:
   version "3.1.1"
   resolved "https://registry.yarnpkg.com/configstore/-/configstore-3.1.1.tgz#094ee662ab83fad9917678de114faaea8fcdca90"
@@ -1589,6 +2042,10 @@
   version "1.5.0"
   resolved "https://registry.yarnpkg.com/convert-source-map/-/convert-source-map-1.5.0.tgz#9acd70851c6d5dfdd93d9282e5edf94a03ff46b5"

+convert-source-map@^1.5.1:
+  version "1.5.1"
+  resolved "https://registry.yarnpkg.com/convert-source-map/-/convert-source-map-1.5.1.tgz#b8278097b9bc229365de5c62cf5fcaed8b5599e5"
+
 cookie-signature@1.0.6:
   version "1.0.6"
   resolved "https://registry.yarnpkg.com/cookie-signature/-/cookie-signature-1.0.6.tgz#e303a882b342cc3ee8ca513a79999734dab3ae2c"
@@ -1597,6 +2054,17 @@
   version "0.3.1"
   resolved "https://registry.yarnpkg.com/cookie/-/cookie-0.3.1.tgz#e7e0a1f9ef43b4c8ba925c5c5a96e806d16873bb"

+copy-concurrently@^1.0.0:
+  version "1.0.5"
+  resolved "https://registry.yarnpkg.com/copy-concurrently/-/copy-concurrently-1.0.5.tgz#92297398cae34937fcafd6ec8139c18051f0b5e0"
+  dependencies:
+    aproba "^1.1.1"
+    fs-write-stream-atomic "^1.0.8"
+    iferr "^0.1.5"
+    mkdirp "^0.5.1"
+    rimraf "^2.5.4"
+    run-queue "^1.0.0"
+
 copy-descriptor@^0.1.0:
   version "0.1.1"
   resolved "https://registry.yarnpkg.com/copy-descriptor/-/copy-descriptor-0.1.1.tgz#676f6eb3c39997c2ee1ac3a924fd6124748f578d"
@@ -1718,22 +2186,22 @@
   version "0.0.4"
   resolved "https://registry.yarnpkg.com/css-color-names/-/css-color-names-0.0.4.tgz#808adc2e79cf84738069b646cb20ec27beb629e0"

-css-loader@^0.28.5:
-  version "0.28.7"
-  resolved "https://registry.yarnpkg.com/css-loader/-/css-loader-0.28.7.tgz#5f2ee989dd32edd907717f953317656160999c1b"
+css-loader@^0.28.11:
+  version "0.28.11"
+  resolved "https://registry.yarnpkg.com/css-loader/-/css-loader-0.28.11.tgz#c3f9864a700be2711bb5a2462b2389b1a392dab7"
   dependencies:
-    babel-code-frame "^6.11.0"
+    babel-code-frame "^6.26.0"
     css-selector-tokenizer "^0.7.0"
-    cssnano ">=2.6.1 <4"
+    cssnano "^3.10.0"
     icss-utils "^2.1.0"
     loader-utils "^1.0.2"
     lodash.camelcase "^4.3.0"
-    object-assign "^4.0.1"
+    object-assign "^4.1.1"
     postcss "^5.0.6"
-    postcss-modules-extract-imports "^1.0.0"
-    postcss-modules-local-by-default "^1.0.1"
-    postcss-modules-scope "^1.0.0"
-    postcss-modules-values "^1.1.0"
+    postcss-modules-extract-imports "^1.2.0"
+    postcss-modules-local-by-default "^1.2.0"
+    postcss-modules-scope "^1.1.0"
+    postcss-modules-values "^1.3.0"
     postcss-value-parser "^3.3.0"
     source-list-map "^2.0.0"

@@ -1781,7 +2249,7 @@
   version "0.1.0"
   resolved "https://registry.yarnpkg.com/cssesc/-/cssesc-0.1.0.tgz#c814903e45623371a0477b40109aaafbeeaddbb4"

-"cssnano@>=2.6.1 <4":
+cssnano@^3.10.0:
   version "3.10.0"
   resolved "https://registry.yarnpkg.com/cssnano/-/cssnano-3.10.0.tgz#4f38f6cea2b9b17fa01490f23f1dc68ea65c1c38"
   dependencies:
@@ -1825,6 +2293,10 @@
     clap "^1.0.9"
     source-map "^0.5.3"

+csstype@^2.2.0:
+  version "2.3.0"
+  resolved "https://registry.yarnpkg.com/csstype/-/csstype-2.3.0.tgz#062e141c78345cf814da0e0b716ad777931b08af"
+
 cuint@^0.2.1:
   version "0.2.2"
   resolved "https://registry.yarnpkg.com/cuint/-/cuint-0.2.2.tgz#408086d409550c2631155619e9fa7bcadc3b991b"
@@ -1835,11 +2307,9 @@
   dependencies:
     array-find-index "^1.0.1"

-d@1:
-  version "1.0.0"
-  resolved "https://registry.yarnpkg.com/d/-/d-1.0.0.tgz#754bb5bfe55451da69a58b94d45f4c5b0462d58f"
-  dependencies:
-    es5-ext "^0.10.9"
+cyclist@~0.2.2:
+  version "0.2.2"
+  resolved "https://registry.yarnpkg.com/cyclist/-/cyclist-0.2.2.tgz#1b33792e11e914a2fd6d6ed6447464444e5fa640"

 dashdash@^1.12.0:
   version "1.14.1"
@@ -1851,7 +2321,7 @@
   version "0.1.4"
   resolved "https://registry.yarnpkg.com/date-now/-/date-now-0.1.4.tgz#eaf439fd4d4848ad74e5cc7dbef200672b9e345b"

-debug@2.6.9, debug@^2.1.3, debug@^2.2.0, debug@^2.3.3, debug@^2.6.8:
+debug@2.6.9, debug@^2.1.2, debug@^2.1.3, debug@^2.2.0, debug@^2.3.3, debug@^2.6.8, debug@^2.6.9:
   version "2.6.9"
   resolved "https://registry.yarnpkg.com/debug/-/debug-2.6.9.tgz#5d128515df134ff327e90a4c93f4e077a536341f"
   dependencies:
@@ -1867,7 +2337,7 @@
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/debuglog/-/debuglog-1.0.1.tgz#aa24ffb9ac3df9a2351837cfb2d279360cd78492"

-decamelize@^1.0.0, decamelize@^1.1.1, decamelize@^1.1.2:
+decamelize@^1.1.1, decamelize@^1.1.2:
   version "1.2.0"
   resolved "https://registry.yarnpkg.com/decamelize/-/decamelize-1.2.0.tgz#f6534d15148269b20352e7bee26f501f9a191290"

@@ -1924,6 +2394,13 @@
   dependencies:
     is-descriptor "^1.0.0"

+define-property@^2.0.2:
+  version "2.0.2"
+  resolved "https://registry.yarnpkg.com/define-property/-/define-property-2.0.2.tgz#d459689e8d654ba77e02a817f8710d702cb16e9d"
+  dependencies:
+    is-descriptor "^1.0.2"
+    isobject "^3.0.1"
+
 defined@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/defined/-/defined-1.0.0.tgz#c98d9bcef75674188e110969151199e39b1fa693"
@@ -1952,6 +2429,10 @@
   version "1.1.1"
   resolved "https://registry.yarnpkg.com/depd/-/depd-1.1.1.tgz#5783b4e1c459f06fa5ca27f991f3d06e7a310359"

+depd@~1.1.2:
+  version "1.1.2"
+  resolved "https://registry.yarnpkg.com/depd/-/depd-1.1.2.tgz#9bcd52e14c097763e749b274c4346ed2e560b5a9"
+
 des.js@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/des.js/-/des.js-1.0.0.tgz#c074d2e2aa6a8a9a07dbd61f9a15c2cd83ec8ecc"
@@ -1969,6 +2450,10 @@
   dependencies:
     repeating "^2.0.0"

+detect-libc@^1.0.2:
+  version "1.0.3"
+  resolved "https://registry.yarnpkg.com/detect-libc/-/detect-libc-1.0.3.tgz#fa137c4bd698edf55cd5cd02ac559f91a4c4ba9b"
+
 dev-null@^0.1.1:
   version "0.1.1"
   resolved "https://registry.yarnpkg.com/dev-null/-/dev-null-0.1.1.tgz#5a205ce3c2b2ef77b6238d6ba179eb74c6a0e818"
@@ -2009,7 +2494,13 @@
     parse-color "^1.0.0"
     sanitize-filename "^1.6.1"

-doctrine@^2.0.2, doctrine@^2.1.0:
+doctrine@^2.0.2:
+  version "2.0.2"
+  resolved "https://registry.yarnpkg.com/doctrine/-/doctrine-2.0.2.tgz#68f96ce8efc56cc42651f1faadb4f175273b0075"
+  dependencies:
+    esutils "^2.0.2"
+
+doctrine@^2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/doctrine/-/doctrine-2.1.0.tgz#5cd01fc101621b42c4cd7f5d1a66243716d3f39d"
   dependencies:
@@ -2083,6 +2574,19 @@
   version "0.1.4"
   resolved "https://registry.yarnpkg.com/duplexer3/-/duplexer3-0.1.4.tgz#ee01dd1cac0ed3cbc7fdbea37dc0a8f1ce002ce2"

+duplexer@^0.1.1:
+  version "0.1.1"
+  resolved "https://registry.yarnpkg.com/duplexer/-/duplexer-0.1.1.tgz#ace6ff808c1ce66b57d1ebf97977acb02334cfc1"
+
+duplexify@^3.4.2, duplexify@^3.5.3:
+  version "3.5.4"
+  resolved "https://registry.yarnpkg.com/duplexify/-/duplexify-3.5.4.tgz#4bb46c1796eabebeec4ca9a2e66b808cb7a3d8b4"
+  dependencies:
+    end-of-stream "^1.0.0"
+    inherits "^2.0.1"
+    readable-stream "^2.0.0"
+    stream-shift "^1.0.0"
+
 easy-stack@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/easy-stack/-/easy-stack-1.0.0.tgz#12c91b3085a37f0baa336e9486eac4bf94e3e788"
@@ -2101,7 +2605,7 @@
   version "2.5.7"
   resolved "https://registry.yarnpkg.com/ejs/-/ejs-2.5.7.tgz#cc872c168880ae3c7189762fd5ffc00896c9518a"

-electron-builder-lib@20.2.0, electron-builder-lib@~20.2.0:
+electron-builder-lib@20.2.0:
   version "20.2.0"
   resolved "https://registry.yarnpkg.com/electron-builder-lib/-/electron-builder-lib-20.2.0.tgz#e8dba288cf26858803eb1800da870d7312837bfa"
   dependencies:
@@ -2130,6 +2634,35 @@
     semver "^5.5.0"
     temp-file "^3.1.1"

+electron-builder-lib@~20.2.0:
+  version "20.2.1"
+  resolved "https://registry.yarnpkg.com/electron-builder-lib/-/electron-builder-lib-20.2.1.tgz#ff8dc6ac7f6f3c676fc370ddafb2aba464a17672"
+  dependencies:
+    "7zip-bin" "~3.1.0"
+    app-builder-bin "1.6.0"
+    async-exit-hook "^2.0.1"
+    bluebird-lst "^1.0.5"
+    builder-util "5.6.1"
+    builder-util-runtime "4.0.5"
+    chromium-pickle-js "^0.2.0"
+    debug "^3.1.0"
+    ejs "^2.5.7"
+    electron-osx-sign "0.4.8"
+    electron-publish "20.2.0"
+    fs-extra-p "^4.5.2"
+    hosted-git-info "^2.5.0"
+    is-ci "^1.1.0"
+    isbinaryfile "^3.0.2"
+    js-yaml "^3.10.0"
+    lazy-val "^1.0.3"
+    minimatch "^3.0.4"
+    normalize-package-data "^2.4.0"
+    plist "^2.1.0"
+    read-config-file "3.0.0"
+    sanitize-filename "^1.6.1"
+    semver "^5.5.0"
+    temp-file "^3.1.1"
+
 electron-builder@20.2.0:
   version "20.2.0"
   resolved "https://registry.yarnpkg.com/electron-builder/-/electron-builder-20.2.0.tgz#aaeaa439cb96c9a3d7ffda25b28130327c982982"
@@ -2231,8 +2764,8 @@
     plist "^2.1.0"

 electron-packager@^11.0.0:
-  version "11.0.0"
-  resolved "https://registry.yarnpkg.com/electron-packager/-/electron-packager-11.0.0.tgz#3150e0efb831b41df40b28186d9baa64bbb2cc52"
+  version "11.2.0"
+  resolved "https://registry.yarnpkg.com/electron-packager/-/electron-packager-11.2.0.tgz#facc17d2b92c10da1bfa1d7c5f58f13774571839"
   dependencies:
     asar "^0.14.0"
     debug "^3.0.0"
@@ -2247,11 +2780,11 @@
     pify "^3.0.0"
     plist "^2.0.0"
     pruner "^0.0.7"
-    rcedit "^0.9.0"
+    rcedit "^1.0.0"
     resolve "^1.1.6"
     sanitize-filename "^1.6.0"
     semver "^5.3.0"
-    yargs-parser "^8.0.0"
+    yargs-parser "^9.0.2"

 electron-publish@20.2.0:
   version "20.2.0"
@@ -2286,9 +2819,9 @@
     lodash.template "^4.2.2"
     temp "^0.8.3"

-electron@1.8.3:
-  version "1.8.3"
-  resolved "https://registry.yarnpkg.com/electron/-/electron-1.8.3.tgz#001416ea3a25ce594e317cb5531bc41eadd22f7f"
+electron@1.8.7:
+  version "1.8.7"
+  resolved "https://registry.yarnpkg.com/electron/-/electron-1.8.7.tgz#373c1dc4589d7ab4acd49aff8db4a1c0a6c3bcc1"
   dependencies:
     "@types/node" "^8.0.24"
     electron-download "^3.0.1"
@@ -2314,6 +2847,10 @@
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/encodeurl/-/encodeurl-1.0.1.tgz#79e3d58655346909fe6f0f45a5de68103b294d20"

+encodeurl@~1.0.2:
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/encodeurl/-/encodeurl-1.0.2.tgz#ad3ff4c86ec2d029322f5a02c3a9a606c95b3f59"
+
 encoding@^0.1.11:
   version "0.1.12"
   resolved "https://registry.yarnpkg.com/encoding/-/encoding-0.1.12.tgz#538b66f3ee62cd1ab51ec323829d1f9480c74beb"
@@ -2326,23 +2863,19 @@
   dependencies:
     once "^1.4.0"

-enhanced-resolve@3.3.0:
-  version "3.3.0"
-  resolved "https://registry.yarnpkg.com/enhanced-resolve/-/enhanced-resolve-3.3.0.tgz#950964ecc7f0332a42321b673b38dc8ff15535b3"
+end-of-stream@^1.1.0:
+  version "1.4.1"
+  resolved "https://registry.yarnpkg.com/end-of-stream/-/end-of-stream-1.4.1.tgz#ed29634d19baba463b6ce6b80a37213eab71ec43"
   dependencies:
-    graceful-fs "^4.1.2"
-    memory-fs "^0.4.0"
-    object-assign "^4.0.1"
-    tapable "^0.2.5"
+    once "^1.4.0"

-enhanced-resolve@^3.3.0, enhanced-resolve@^3.4.0:
-  version "3.4.1"
-  resolved "https://registry.yarnpkg.com/enhanced-resolve/-/enhanced-resolve-3.4.1.tgz#0421e339fd71419b3da13d129b3979040230476e"
+enhanced-resolve@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/enhanced-resolve/-/enhanced-resolve-4.0.0.tgz#e34a6eaa790f62fccd71d93959f56b2b432db10a"
   dependencies:
     graceful-fs "^4.1.2"
     memory-fs "^0.4.0"
-    object-assign "^4.0.1"
-    tapable "^0.2.7"
+    tapable "^1.0.0"

 entities@1.0:
   version "1.0.0"
@@ -2362,6 +2895,12 @@
   dependencies:
     prr "~0.0.0"

+errno@~0.1.7:
+  version "0.1.7"
+  resolved "https://registry.yarnpkg.com/errno/-/errno-0.1.7.tgz#4684d71779ad39af177e3f007996f7c67c852618"
+  dependencies:
+    prr "~1.0.1"
+
 error-ex@^1.2.0:
   version "1.3.1"
   resolved "https://registry.yarnpkg.com/error-ex/-/error-ex-1.3.1.tgz#f855a86ce61adc4e8621c3cda21e7a7612c3a8dc"
@@ -2386,62 +2925,10 @@
     is-date-object "^1.0.1"
     is-symbol "^1.0.1"

-es5-ext@^0.10.14, es5-ext@^0.10.35, es5-ext@^0.10.9, es5-ext@~0.10.14:
-  version "0.10.35"
-  resolved "https://registry.yarnpkg.com/es5-ext/-/es5-ext-0.10.35.tgz#18ee858ce6a3c45c7d79e91c15fcca9ec568494f"
-  dependencies:
-    es6-iterator "~2.0.1"
-    es6-symbol "~3.1.1"
-
-es6-iterator@^2.0.1, es6-iterator@~2.0.1:
-  version "2.0.3"
-  resolved "https://registry.yarnpkg.com/es6-iterator/-/es6-iterator-2.0.3.tgz#a7de889141a05a94b0854403b2d0a0fbfa98f3b7"
-  dependencies:
-    d "1"
-    es5-ext "^0.10.35"
-    es6-symbol "^3.1.1"
-
-es6-map@^0.1.3:
-  version "0.1.5"
-  resolved "https://registry.yarnpkg.com/es6-map/-/es6-map-0.1.5.tgz#9136e0503dcc06a301690f0bb14ff4e364e949f0"
-  dependencies:
-    d "1"
-    es5-ext "~0.10.14"
-    es6-iterator "~2.0.1"
-    es6-set "~0.1.5"
-    es6-symbol "~3.1.1"
-    event-emitter "~0.3.5"
-
 es6-promise@^4.0.5:
   version "4.1.1"
   resolved "https://registry.yarnpkg.com/es6-promise/-/es6-promise-4.1.1.tgz#8811e90915d9a0dba36274f0b242dbda78f9c92a"

-es6-set@~0.1.5:
-  version "0.1.5"
-  resolved "https://registry.yarnpkg.com/es6-set/-/es6-set-0.1.5.tgz#d2b3ec5d4d800ced818db538d28974db0a73ccb1"
-  dependencies:
-    d "1"
-    es5-ext "~0.10.14"
-    es6-iterator "~2.0.1"
-    es6-symbol "3.1.1"
-    event-emitter "~0.3.5"
-
-es6-symbol@3.1.1, es6-symbol@^3.1.1, es6-symbol@~3.1.1:
-  version "3.1.1"
-  resolved "https://registry.yarnpkg.com/es6-symbol/-/es6-symbol-3.1.1.tgz#bf00ef4fdab6ba1b46ecb7b629b4c7ed5715cc77"
-  dependencies:
-    d "1"
-    es5-ext "~0.10.14"
-
-es6-weak-map@^2.0.1:
-  version "2.0.2"
-  resolved "https://registry.yarnpkg.com/es6-weak-map/-/es6-weak-map-2.0.2.tgz#5e3ab32251ffd1538a1f8e5ffa1357772f92d96f"
-  dependencies:
-    d "1"
-    es5-ext "^0.10.14"
-    es6-iterator "^2.0.1"
-    es6-symbol "^3.1.1"
-
 escape-html@~1.0.3:
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/escape-html/-/escape-html-1.0.3.tgz#0258eae4d3d0c0974de1c169188ef0051d1d1988"
@@ -2450,15 +2937,6 @@
   version "1.0.5"
   resolved "https://registry.yarnpkg.com/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz#1b61c0562190a8dff6ae3bb2cf0200ca130b86d4"

-escope@^3.6.0:
-  version "3.6.0"
-  resolved "https://registry.yarnpkg.com/escope/-/escope-3.6.0.tgz#e01975e812781a163a6dadfdd80398dc64c889c3"
-  dependencies:
-    es6-map "^0.1.3"
-    es6-weak-map "^2.0.1"
-    esrecurse "^4.1.0"
-    estraverse "^4.1.1"
-
 eslint-config-prettier@^2.9.0:
   version "2.9.0"
   resolved "https://registry.yarnpkg.com/eslint-config-prettier/-/eslint-config-prettier-2.9.0.tgz#5ecd65174d486c22dff389fe036febf502d468a3"
@@ -2491,9 +2969,9 @@
     jsx-ast-utils "^2.0.1"
     prop-types "^15.6.0"

-eslint-plugin-typescript@^0.10.0:
-  version "0.10.0"
-  resolved "https://registry.yarnpkg.com/eslint-plugin-typescript/-/eslint-plugin-typescript-0.10.0.tgz#009a8fcaf0ec7bf68f6fb71576df0d84ebd0b114"
+eslint-plugin-typescript@^0.12.0:
+  version "0.12.0"
+  resolved "https://registry.yarnpkg.com/eslint-plugin-typescript/-/eslint-plugin-typescript-0.12.0.tgz#e23d58cb27fe28e89fc641a1f20e8d862cb99aef"
   dependencies:
     requireindex "~1.1.0"

@@ -2591,13 +3069,6 @@
   version "1.8.1"
   resolved "https://registry.yarnpkg.com/etag/-/etag-1.8.1.tgz#41ae2eeb65efa62268aebfea83ac7d79299b0887"

-event-emitter@~0.3.5:
-  version "0.3.5"
-  resolved "https://registry.yarnpkg.com/event-emitter/-/event-emitter-0.3.5.tgz#df8c69eef1647923c7157b9ce83840610b02cc39"
-  dependencies:
-    d "1"
-    es5-ext "~0.10.14"
-
 event-pubsub@4.3.0:
   version "4.3.0"
   resolved "https://registry.yarnpkg.com/event-pubsub/-/event-pubsub-4.3.0.tgz#f68d816bc29f1ec02c539dc58c8dd40ce72cb36e"
@@ -2629,12 +3100,6 @@
   version "0.1.2"
   resolved "https://registry.yarnpkg.com/exit/-/exit-0.1.2.tgz#0632638f8d877cc82107d30a0fff1a17cba1cd0c"

-expand-brackets@^0.1.4:
-  version "0.1.5"
-  resolved "https://registry.yarnpkg.com/expand-brackets/-/expand-brackets-0.1.5.tgz#df07284e342a807cd733ac5af72411e581d1177b"
-  dependencies:
-    is-posix-bracket "^0.1.0"
-
 expand-brackets@^2.1.4:
   version "2.1.4"
   resolved "https://registry.yarnpkg.com/expand-brackets/-/expand-brackets-2.1.4.tgz#b77735e315ce30f6b6eff0f83b04151a22449622"
@@ -2647,17 +3112,46 @@
     snapdragon "^0.8.1"
     to-regex "^3.0.1"

-expand-range@^1.8.1:
-  version "1.8.2"
-  resolved "https://registry.yarnpkg.com/expand-range/-/expand-range-1.8.2.tgz#a299effd335fe2721ebae8e257ec79644fc85337"
+express@^4.15.0:
+  version "4.16.2"
+  resolved "https://registry.yarnpkg.com/express/-/express-4.16.2.tgz#e35c6dfe2d64b7dca0a5cd4f21781be3299e076c"
   dependencies:
-    fill-range "^2.1.0"
+    accepts "~1.3.4"
+    array-flatten "1.1.1"
+    body-parser "1.18.2"
+    content-disposition "0.5.2"
+    content-type "~1.0.4"
+    cookie "0.3.1"
+    cookie-signature "1.0.6"
+    debug "2.6.9"
+    depd "~1.1.1"
+    encodeurl "~1.0.1"
+    escape-html "~1.0.3"
+    etag "~1.8.1"
+    finalhandler "1.1.0"
+    fresh "0.5.2"
+    merge-descriptors "1.0.1"
+    methods "~1.1.2"
+    on-finished "~2.3.0"
+    parseurl "~1.3.2"
+    path-to-regexp "0.1.7"
+    proxy-addr "~2.0.2"
+    qs "6.5.1"
+    range-parser "~1.2.0"
+    safe-buffer "5.1.1"
+    send "0.16.1"
+    serve-static "1.13.1"
+    setprototypeof "1.1.0"
+    statuses "~1.3.1"
+    type-is "~1.6.15"
+    utils-merge "1.0.1"
+    vary "~1.1.2"

-express@^4.15.0:
-  version "4.16.2"
-  resolved "https://registry.yarnpkg.com/express/-/express-4.16.2.tgz#e35c6dfe2d64b7dca0a5cd4f21781be3299e076c"
+express@^4.16.2:
+  version "4.16.3"
+  resolved "https://registry.yarnpkg.com/express/-/express-4.16.3.tgz#6af8a502350db3246ecc4becf6b5a34d22f7ed53"
   dependencies:
-    accepts "~1.3.4"
+    accepts "~1.3.5"
     array-flatten "1.1.1"
     body-parser "1.18.2"
     content-disposition "0.5.2"
@@ -2665,26 +3159,26 @@
     cookie "0.3.1"
     cookie-signature "1.0.6"
     debug "2.6.9"
-    depd "~1.1.1"
-    encodeurl "~1.0.1"
+    depd "~1.1.2"
+    encodeurl "~1.0.2"
     escape-html "~1.0.3"
     etag "~1.8.1"
-    finalhandler "1.1.0"
+    finalhandler "1.1.1"
     fresh "0.5.2"
     merge-descriptors "1.0.1"
     methods "~1.1.2"
     on-finished "~2.3.0"
     parseurl "~1.3.2"
     path-to-regexp "0.1.7"
-    proxy-addr "~2.0.2"
+    proxy-addr "~2.0.3"
     qs "6.5.1"
     range-parser "~1.2.0"
     safe-buffer "5.1.1"
-    send "0.16.1"
-    serve-static "1.13.1"
+    send "0.16.2"
+    serve-static "1.13.2"
     setprototypeof "1.1.0"
-    statuses "~1.3.1"
-    type-is "~1.6.15"
+    statuses "~1.4.0"
+    type-is "~1.6.16"
     utils-merge "1.0.1"
     vary "~1.1.2"

@@ -2694,6 +3188,13 @@
   dependencies:
     is-extendable "^0.1.0"

+extend-shallow@^3.0.2:
+  version "3.0.2"
+  resolved "https://registry.yarnpkg.com/extend-shallow/-/extend-shallow-3.0.2.tgz#26a71aaf073b39fb2127172746131c2704028db8"
+  dependencies:
+    assign-symbols "^1.0.0"
+    is-extendable "^1.0.1"
+
 extend@~3.0.0, extend@~3.0.1:
   version "3.0.1"
   resolved "https://registry.yarnpkg.com/extend/-/extend-3.0.1.tgz#a755ea7bc1adfcc5a31ce7e762dbaadc5e636444"
@@ -2706,15 +3207,9 @@
     jschardet "^1.4.2"
     tmp "^0.0.33"

-extglob@^0.3.1:
-  version "0.3.2"
-  resolved "https://registry.yarnpkg.com/extglob/-/extglob-0.3.2.tgz#2e18ff3d2f49ab2765cec9023f011daa8d8349a1"
-  dependencies:
-    is-extglob "^1.0.0"
-
-extglob@^2.0.2:
-  version "2.0.2"
-  resolved "https://registry.yarnpkg.com/extglob/-/extglob-2.0.2.tgz#3290f46208db1b2e8eb8be0c94ed9e6ad80edbe2"
+extglob@^2.0.4:
+  version "2.0.4"
+  resolved "https://registry.yarnpkg.com/extglob/-/extglob-2.0.4.tgz#ad00fe4dc612a9232e8718711dc5cb5ab0285543"
   dependencies:
     array-unique "^0.3.2"
     define-property "^1.0.0"
@@ -2725,15 +3220,6 @@
     snapdragon "^0.8.1"
     to-regex "^3.0.1"

-extract-text-webpack-plugin@^3.0.0:
-  version "3.0.2"
-  resolved "https://registry.yarnpkg.com/extract-text-webpack-plugin/-/extract-text-webpack-plugin-3.0.2.tgz#5f043eaa02f9750a9258b78c0a6e0dc1408fb2f7"
-  dependencies:
-    async "^2.4.1"
-    loader-utils "^1.1.0"
-    schema-utils "^0.3.0"
-    webpack-sources "^1.0.1"
-
 extract-zip@^1.0.3, extract-zip@^1.6.5:
   version "1.6.6"
   resolved "https://registry.yarnpkg.com/extract-zip/-/extract-zip-1.6.6.tgz#1290ede8d20d0872b429fd3f351ca128ec5ef85c"
@@ -2751,6 +3237,10 @@
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/fast-deep-equal/-/fast-deep-equal-1.0.0.tgz#96256a3bc975595eb36d82e9929d060d893439ff"

+fast-deep-equal@^2.0.1:
+  version "2.0.1"
+  resolved "https://registry.yarnpkg.com/fast-deep-equal/-/fast-deep-equal-2.0.1.tgz#7b05218ddf9667bf7f370bf7fdb2cb15fdd0aa49"
+
 fast-diff@^1.1.1:
   version "1.1.2"
   resolved "https://registry.yarnpkg.com/fast-diff/-/fast-diff-1.1.2.tgz#4b62c42b8e03de3f848460b639079920695d0154"
@@ -2798,19 +3288,9 @@
     flat-cache "^1.2.1"
     object-assign "^4.0.1"

-filename-regex@^2.0.0:
-  version "2.0.1"
-  resolved "https://registry.yarnpkg.com/filename-regex/-/filename-regex-2.0.1.tgz#c1c4b9bee3e09725ddb106b75c1e301fe2f18b26"
-
-fill-range@^2.1.0:
-  version "2.2.3"
-  resolved "https://registry.yarnpkg.com/fill-range/-/fill-range-2.2.3.tgz#50b77dfd7e469bc7492470963699fe7a8485a723"
-  dependencies:
-    is-number "^2.1.0"
-    isobject "^2.0.0"
-    randomatic "^1.1.3"
-    repeat-element "^1.1.2"
-    repeat-string "^1.5.2"
+filesize@^3.5.11:
+  version "3.6.1"
+  resolved "https://registry.yarnpkg.com/filesize/-/filesize-3.6.1.tgz#090bb3ee01b6f801a8a8be99d31710b3422bb317"

 fill-range@^4.0.0:
   version "4.0.0"
@@ -2833,6 +3313,26 @@
     statuses "~1.3.1"
     unpipe "~1.0.0"

+finalhandler@1.1.1:
+  version "1.1.1"
+  resolved "https://registry.yarnpkg.com/finalhandler/-/finalhandler-1.1.1.tgz#eebf4ed840079c83f4249038c9d703008301b105"
+  dependencies:
+    debug "2.6.9"
+    encodeurl "~1.0.2"
+    escape-html "~1.0.3"
+    on-finished "~2.3.0"
+    parseurl "~1.3.2"
+    statuses "~1.4.0"
+    unpipe "~1.0.0"
+
+find-cache-dir@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/find-cache-dir/-/find-cache-dir-1.0.0.tgz#9288e3e9e3cc3748717d39eade17cf71fc30ee6f"
+  dependencies:
+    commondir "^1.0.1"
+    make-dir "^1.0.0"
+    pkg-dir "^2.0.0"
+
 find-up@^1.0.0:
   version "1.1.2"
   resolved "https://registry.yarnpkg.com/find-up/-/find-up-1.1.2.tgz#6b2e9822b1a2ce0a60ab64d610eccad53cb24d0f"
@@ -2859,6 +3359,13 @@
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/flatten/-/flatten-1.0.2.tgz#dae46a9d78fbe25292258cc1e780a41d95c03782"

+flush-write-stream@^1.0.0:
+  version "1.0.3"
+  resolved "https://registry.yarnpkg.com/flush-write-stream/-/flush-write-stream-1.0.3.tgz#c5d586ef38af6097650b49bc41b55fabb19f35bd"
+  dependencies:
+    inherits "^2.0.1"
+    readable-stream "^2.0.4"
+
 for-in@^0.1.3:
   version "0.1.8"
   resolved "https://registry.yarnpkg.com/for-in/-/for-in-0.1.8.tgz#d8773908e31256109952b1fdb9b3fa867d2775e1"
@@ -2867,12 +3374,6 @@
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/for-in/-/for-in-1.0.2.tgz#81068d295a8142ec0ac726c6e2200c30fb6d5e80"

-for-own@^0.1.4:
-  version "0.1.5"
-  resolved "https://registry.yarnpkg.com/for-own/-/for-own-0.1.5.tgz#5265c681a4f294dabbf17c9509b6763aa84510ce"
-  dependencies:
-    for-in "^1.0.1"
-
 for-own@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/for-own/-/for-own-1.0.0.tgz#c63332f415cedc4b04dbfe70cf836494c53cb44b"
@@ -2917,6 +3418,19 @@
   version "0.5.2"
   resolved "https://registry.yarnpkg.com/fresh/-/fresh-0.5.2.tgz#3d8cadd90d976569fa835ab1f8e4b23a105605a7"

+from2@^2.1.0:
+  version "2.3.0"
+  resolved "https://registry.yarnpkg.com/from2/-/from2-2.3.0.tgz#8bfb5502bde4a4d36cfdeea007fcca21d7e382af"
+  dependencies:
+    inherits "^2.0.1"
+    readable-stream "^2.0.0"
+
+front-matter@^2.3.0:
+  version "2.3.0"
+  resolved "https://registry.yarnpkg.com/front-matter/-/front-matter-2.3.0.tgz#7203af896ce357ee04e2aa45169ea91ed7f67504"
+  dependencies:
+    js-yaml "^3.10.0"
+
 fs-extra-p@^4.5.0:
   version "4.5.0"
   resolved "https://registry.yarnpkg.com/fs-extra-p/-/fs-extra-p-4.5.0.tgz#b79f3f3fcc0b5e57b7e7caeb06159f958ef15fe8"
@@ -2951,7 +3465,7 @@
     path-is-absolute "^1.0.0"
     rimraf "^2.2.8"

-fs-extra@^2.0.0, fs-extra@^2.1.2:
+fs-extra@^2.0.0:
   version "2.1.2"
   resolved "https://registry.yarnpkg.com/fs-extra/-/fs-extra-2.1.2.tgz#046c70163cef9aad46b0e4a7fa467fb22d71de35"
   dependencies:
@@ -2982,30 +3496,41 @@
     jsonfile "^4.0.0"
     universalify "^0.1.0"

-fs-readdir-recursive@^1.0.0:
-  version "1.0.0"
-  resolved "https://registry.yarnpkg.com/fs-readdir-recursive/-/fs-readdir-recursive-1.0.0.tgz#8cd1745c8b4f8a29c8caec392476921ba195f560"
+fs-extra@^6.0.0:
+  version "6.0.0"
+  resolved "https://registry.yarnpkg.com/fs-extra/-/fs-extra-6.0.0.tgz#0f0afb290bb3deb87978da816fcd3c7797f3a817"
+  dependencies:
+    graceful-fs "^4.1.2"
+    jsonfile "^4.0.0"
+    universalify "^0.1.0"
+
+fs-minipass@^1.2.5:
+  version "1.2.5"
+  resolved "https://registry.yarnpkg.com/fs-minipass/-/fs-minipass-1.2.5.tgz#06c277218454ec288df77ada54a03b8702aacb9d"
+  dependencies:
+    minipass "^2.2.1"
+
+fs-write-stream-atomic@^1.0.8:
+  version "1.0.10"
+  resolved "https://registry.yarnpkg.com/fs-write-stream-atomic/-/fs-write-stream-atomic-1.0.10.tgz#b47df53493ef911df75731e70a9ded0189db40c9"
+  dependencies:
+    graceful-fs "^4.1.2"
+    iferr "^0.1.5"
+    imurmurhash "^0.1.4"
+    readable-stream "1 || 2"

 fs.realpath@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/fs.realpath/-/fs.realpath-1.0.0.tgz#1504ad2523158caa40db4a2787cb01411994ea4f"

-fsevents@^1.0.0:
-  version "1.1.2"
-  resolved "https://registry.yarnpkg.com/fsevents/-/fsevents-1.1.2.tgz#3282b713fb3ad80ede0e9fcf4611b5aa6fc033f4"
-  dependencies:
-    nan "^2.3.0"
-    node-pre-gyp "^0.6.36"
-
-fstream-ignore@^1.0.5:
-  version "1.0.5"
-  resolved "https://registry.yarnpkg.com/fstream-ignore/-/fstream-ignore-1.0.5.tgz#9c31dae34767018fe1d249b24dada67d092da105"
+fsevents@^1.1.2:
+  version "1.2.3"
+  resolved "https://registry.yarnpkg.com/fsevents/-/fsevents-1.2.3.tgz#08292982e7059f6674c93d8b829c1e8604979ac0"
   dependencies:
-    fstream "^1.0.0"
-    inherits "2"
-    minimatch "^3.0.0"
+    nan "^2.9.2"
+    node-pre-gyp "^0.9.0"

-fstream@^1.0.0, fstream@^1.0.10, fstream@^1.0.2:
+fstream@^1.0.0, fstream@^1.0.2:
   version "1.0.11"
   resolved "https://registry.yarnpkg.com/fstream/-/fstream-1.0.11.tgz#5c1fb1f117477114f0632a0eb4b71b3cb0fd3171"
   dependencies:
@@ -3098,18 +3623,12 @@
   version "1.0.2"
   resolved "https://registry.yarnpkg.com/github-url-from-username-repo/-/github-url-from-username-repo-1.0.2.tgz#7dd79330d2abe69c10c2cef79714c97215791dfa"

-glob-base@^0.3.0:
-  version "0.3.0"
-  resolved "https://registry.yarnpkg.com/glob-base/-/glob-base-0.3.0.tgz#dbb164f6221b1c0b1ccf82aea328b497df0ea3c4"
-  dependencies:
-    glob-parent "^2.0.0"
-    is-glob "^2.0.0"
-
-glob-parent@^2.0.0:
-  version "2.0.0"
-  resolved "https://registry.yarnpkg.com/glob-parent/-/glob-parent-2.0.0.tgz#81383d72db054fcccf5336daa902f182f6edbb28"
+glob-parent@^3.1.0:
+  version "3.1.0"
+  resolved "https://registry.yarnpkg.com/glob-parent/-/glob-parent-3.1.0.tgz#9e6af6299d8d3bd2bd40430832bd113df906c5ae"
   dependencies:
-    is-glob "^2.0.0"
+    is-glob "^3.1.0"
+    path-dirname "^1.0.0"

 glob@7.1.2, glob@^7.0.0, glob@^7.0.3, glob@^7.0.5, glob@^7.1.1, glob@^7.1.2, glob@~7.1.1:
   version "7.1.2"
@@ -3205,6 +3724,13 @@
   version "1.10.3"
   resolved "https://registry.yarnpkg.com/growl/-/growl-1.10.3.tgz#1926ba90cf3edfe2adb4927f5880bc22c66c790f"

+gzip-size@^4.1.0:
+  version "4.1.0"
+  resolved "https://registry.yarnpkg.com/gzip-size/-/gzip-size-4.1.0.tgz#8ae096257eabe7d69c45be2b67c448124ffb517c"
+  dependencies:
+    duplexer "^0.1.1"
+    pify "^3.0.0"
+
 har-schema@^1.0.5:
   version "1.0.5"
   resolved "https://registry.yarnpkg.com/har-schema/-/har-schema-1.0.5.tgz#d263135f43307c02c602afc8fe95970c0151369e"
@@ -3250,6 +3776,10 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/has-flag/-/has-flag-2.0.0.tgz#e8207af1cc7b30d446cc70b734b5e8be18f88d51"

+has-flag@^3.0.0:
+  version "3.0.0"
+  resolved "https://registry.yarnpkg.com/has-flag/-/has-flag-3.0.0.tgz#b5d454dc2199ae225699f3467e5a07f3b955bafd"
+
 has-unicode@^2.0.0:
   version "2.0.1"
   resolved "https://registry.yarnpkg.com/has-unicode/-/has-unicode-2.0.1.tgz#e0e6fe6a28cf51138855e086d1691e771de2a8b9"
@@ -3307,7 +3837,7 @@
     inherits "^2.0.3"
     minimalistic-assert "^1.0.0"

-hawk@3.1.3, hawk@~3.1.3:
+hawk@~3.1.3:
   version "3.1.3"
   resolved "https://registry.yarnpkg.com/hawk/-/hawk-3.1.3.tgz#078444bd7c1640b0fe540d2c9b73d59678e8e1c4"
   dependencies:
@@ -3381,16 +3911,17 @@
     relateurl "0.2.x"
     uglify-js "3.1.x"

-html-webpack-plugin@^2.30.1:
-  version "2.30.1"
-  resolved "https://registry.yarnpkg.com/html-webpack-plugin/-/html-webpack-plugin-2.30.1.tgz#7f9c421b7ea91ec460f56527d78df484ee7537d5"
+html-webpack-plugin@^3.2.0:
+  version "3.2.0"
+  resolved "https://registry.yarnpkg.com/html-webpack-plugin/-/html-webpack-plugin-3.2.0.tgz#b01abbd723acaaa7b37b6af4492ebda03d9dd37b"
   dependencies:
-    bluebird "^3.4.7"
     html-minifier "^3.2.3"
     loader-utils "^0.2.16"
     lodash "^4.17.3"
     pretty-error "^2.0.2"
+    tapable "^1.0.0"
     toposort "^1.0.0"
+    util.promisify "1.0.0"

 htmlparser2@3.8.x:
   version "3.8.3"
@@ -3444,6 +3975,12 @@
   version "0.4.19"
   resolved "https://registry.yarnpkg.com/iconv-lite/-/iconv-lite-0.4.19.tgz#f7468f60135f5e5dad3399c0a81be9a1603a082b"

+iconv-lite@^0.4.4:
+  version "0.4.21"
+  resolved "https://registry.yarnpkg.com/iconv-lite/-/iconv-lite-0.4.21.tgz#c47f8733d02171189ebc4a400f3218d348094798"
+  dependencies:
+    safer-buffer "^2.1.0"
+
 icss-replace-symbols@^1.1.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/icss-replace-symbols/-/icss-replace-symbols-1.1.0.tgz#06ea6f83679a7749e386cfe1fe812ae5db223ded"
@@ -3458,6 +3995,16 @@
   version "1.1.8"
   resolved "https://registry.yarnpkg.com/ieee754/-/ieee754-1.1.8.tgz#be33d40ac10ef1926701f6f08a2d86fbfd1ad3e4"

+iferr@^0.1.5:
+  version "0.1.5"
+  resolved "https://registry.yarnpkg.com/iferr/-/iferr-0.1.5.tgz#c60eed69e6d8fdb6b3104a1fcbca1c192dc5b501"
+
+ignore-walk@^3.0.1:
+  version "3.0.1"
+  resolved "https://registry.yarnpkg.com/ignore-walk/-/ignore-walk-3.0.1.tgz#a83e62e7d272ac0e3b551aaa82831a19b69f82f8"
+  dependencies:
+    minimatch "^3.0.4"
+
 ignore@^3.3.3:
   version "3.3.7"
   resolved "https://registry.yarnpkg.com/ignore/-/ignore-3.3.7.tgz#612289bfb3c220e186a58118618d5be8c1bab021"
@@ -3544,7 +4091,7 @@
     strip-ansi "^3.0.0"
     through "^2.3.6"

-interpret@^1.0.0, interpret@^1.0.1:
+interpret@^1.0.1:
   version "1.0.4"
   resolved "https://registry.yarnpkg.com/interpret/-/interpret-1.0.4.tgz#820cdd588b868ffb191a809506d6c9c8f212b1b0"

@@ -3562,6 +4109,10 @@
   version "1.5.2"
   resolved "https://registry.yarnpkg.com/ipaddr.js/-/ipaddr.js-1.5.2.tgz#d4b505bde9946987ccf0fc58d9010ff9607e3fa0"

+ipaddr.js@1.6.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/ipaddr.js/-/ipaddr.js-1.6.0.tgz#e3fa357b773da619f26e95f049d055c72796f86b"
+
 is-absolute-url@^2.0.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/is-absolute-url/-/is-absolute-url-2.1.0.tgz#50530dfb84fcc9aa7dbe7852e83a37b93b9f2aa6"
@@ -3572,6 +4123,12 @@
   dependencies:
     kind-of "^3.0.2"

+is-accessor-descriptor@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/is-accessor-descriptor/-/is-accessor-descriptor-1.0.0.tgz#169c2f6d3df1f992618072365c9b0ea1f6878656"
+  dependencies:
+    kind-of "^6.0.0"
+
 is-arrayish@^0.2.1:
   version "0.2.1"
   resolved "https://registry.yarnpkg.com/is-arrayish/-/is-arrayish-0.2.1.tgz#77c99840527aa8ecb1a8ba697b80645a7a926a9d"
@@ -3582,7 +4139,7 @@
   dependencies:
     binary-extensions "^1.0.0"

-is-buffer@^1.0.2, is-buffer@^1.1.5:
+is-buffer@^1.1.5:
   version "1.1.6"
   resolved "https://registry.yarnpkg.com/is-buffer/-/is-buffer-1.1.6.tgz#efaa2ea9daa0d7ab2ea13a97b2b8ad51fefbe8be"

@@ -3608,6 +4165,12 @@
   dependencies:
     kind-of "^3.0.2"

+is-data-descriptor@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/is-data-descriptor/-/is-data-descriptor-1.0.0.tgz#d84876321d0e7add03990406abbbbd36ba9268c7"
+  dependencies:
+    kind-of "^6.0.0"
+
 is-date-object@^1.0.1:
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/is-date-object/-/is-date-object-1.0.1.tgz#9aa20eb6aeebbff77fbd33e74ca01b33581d3a16"
@@ -3628,27 +4191,31 @@
     is-data-descriptor "^0.1.4"
     kind-of "^5.0.0"

-is-dotfile@^1.0.0:
-  version "1.0.3"
-  resolved "https://registry.yarnpkg.com/is-dotfile/-/is-dotfile-1.0.3.tgz#a6a2f32ffd2dfb04f5ca25ecd0f6b83cf798a1e1"
+is-descriptor@^1.0.2:
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/is-descriptor/-/is-descriptor-1.0.2.tgz#3b159746a66604b04f8c81524ba365c5f14d86ec"
+  dependencies:
+    is-accessor-descriptor "^1.0.0"
+    is-data-descriptor "^1.0.0"
+    kind-of "^6.0.2"

 is-electron-renderer@^2.0.0:
   version "2.0.1"
   resolved "https://registry.yarnpkg.com/is-electron-renderer/-/is-electron-renderer-2.0.1.tgz#a469d056f975697c58c98c6023eb0aa79af895a2"

-is-equal-shallow@^0.1.3:
-  version "0.1.3"
-  resolved "https://registry.yarnpkg.com/is-equal-shallow/-/is-equal-shallow-0.1.3.tgz#2238098fc221de0bcfa5d9eac4c45d638aa1c534"
-  dependencies:
-    is-primitive "^2.0.0"
-
 is-extendable@^0.1.0, is-extendable@^0.1.1:
   version "0.1.1"
   resolved "https://registry.yarnpkg.com/is-extendable/-/is-extendable-0.1.1.tgz#62b110e289a471418e3ec36a617d472e301dfc89"

-is-extglob@^1.0.0:
-  version "1.0.0"
-  resolved "https://registry.yarnpkg.com/is-extglob/-/is-extglob-1.0.0.tgz#ac468177c4943405a092fc8f29760c6ffc6206c0"
+is-extendable@^1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/is-extendable/-/is-extendable-1.0.1.tgz#a7470f9e426733d81bd81e1155264e3a3507cab4"
+  dependencies:
+    is-plain-object "^2.0.4"
+
+is-extglob@^2.1.0, is-extglob@^2.1.1:
+  version "2.1.1"
+  resolved "https://registry.yarnpkg.com/is-extglob/-/is-extglob-2.1.1.tgz#a88c02535791f02ed37c76a1b9ea9773c833f8c2"

 is-finite@^1.0.0:
   version "1.0.2"
@@ -3666,11 +4233,17 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/is-fullwidth-code-point/-/is-fullwidth-code-point-2.0.0.tgz#a3b30a5c4f199183167aaab93beefae3ddfb654f"

-is-glob@^2.0.0, is-glob@^2.0.1:
-  version "2.0.1"
-  resolved "https://registry.yarnpkg.com/is-glob/-/is-glob-2.0.1.tgz#d096f926a3ded5600f3fdfd91198cb0888c2d863"
+is-glob@^3.1.0:
+  version "3.1.0"
+  resolved "https://registry.yarnpkg.com/is-glob/-/is-glob-3.1.0.tgz#7ba5ae24217804ac70707b96922567486cc3e84a"
   dependencies:
-    is-extglob "^1.0.0"
+    is-extglob "^2.1.0"
+
+is-glob@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/is-glob/-/is-glob-4.0.0.tgz#9521c76845cc2610a85203ddf080a958c2ffabc0"
+  dependencies:
+    is-extglob "^2.1.1"

 is-installed-globally@^0.1.0:
   version "0.1.0"
@@ -3692,27 +4265,25 @@
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/is-npm/-/is-npm-1.0.0.tgz#f2fb63a65e4905b406c86072765a1a4dc793b9f4"

-is-number@^2.1.0:
-  version "2.1.0"
-  resolved "https://registry.yarnpkg.com/is-number/-/is-number-2.1.0.tgz#01fcbbb393463a548f2f466cce16dece49db908f"
-  dependencies:
-    kind-of "^3.0.2"
-
 is-number@^3.0.0:
   version "3.0.0"
   resolved "https://registry.yarnpkg.com/is-number/-/is-number-3.0.0.tgz#24fd6201a4782cf50561c810276afc7d12d71195"
   dependencies:
     kind-of "^3.0.2"

+is-number@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/is-number/-/is-number-4.0.0.tgz#0026e37f5454d73e356dfe6564699867c6a7f0ff"
+
 is-obj@^1.0.0:
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/is-obj/-/is-obj-1.0.1.tgz#3e4729ac1f5fde025cd7d83a896dab9f4f67db0f"

-is-odd@^1.0.0:
-  version "1.0.0"
-  resolved "https://registry.yarnpkg.com/is-odd/-/is-odd-1.0.0.tgz#3b8a932eb028b3775c39bb09e91767accdb69088"
+is-odd@^2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/is-odd/-/is-odd-2.0.0.tgz#7646624671fd7ea558ccd9a2795182f2958f1b24"
   dependencies:
-    is-number "^3.0.0"
+    is-number "^4.0.0"

 is-path-cwd@^1.0.0:
   version "1.0.0"
@@ -3734,20 +4305,12 @@
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/is-plain-obj/-/is-plain-obj-1.1.0.tgz#71a50c8429dfca773c92a390a4a03b39fcd51d3e"

-is-plain-object@^2.0.1, is-plain-object@^2.0.3:
+is-plain-object@^2.0.1, is-plain-object@^2.0.3, is-plain-object@^2.0.4:
   version "2.0.4"
   resolved "https://registry.yarnpkg.com/is-plain-object/-/is-plain-object-2.0.4.tgz#2c163b3fafb1b606d9d17928f05c2a1c38e07677"
   dependencies:
     isobject "^3.0.1"

-is-posix-bracket@^0.1.0:
-  version "0.1.1"
-  resolved "https://registry.yarnpkg.com/is-posix-bracket/-/is-posix-bracket-0.1.1.tgz#3334dc79774368e92f016e6fbc0a88f5cd6e6bc4"
-
-is-primitive@^2.0.0:
-  version "2.0.0"
-  resolved "https://registry.yarnpkg.com/is-primitive/-/is-primitive-2.0.0.tgz#207bab91638499c07b2adf240a41a87210034575"
-
 is-promise@^2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/is-promise/-/is-promise-2.1.0.tgz#79a2a9ece7f096e80f36d2b2f3bc16c1ff4bf3fa"
@@ -3806,6 +4369,10 @@
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/is-windows/-/is-windows-1.0.1.tgz#310db70f742d259a16a369202b51af84233310d9"

+is-windows@^1.0.2:
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/is-windows/-/is-windows-1.0.2.tgz#d1850eb9791ecd18e6182ce12a30f396634bb19d"
+
 isarray@0.0.1:
   version "0.0.1"
   resolved "https://registry.yarnpkg.com/isarray/-/isarray-0.0.1.tgz#8a18acfca9a8f4177e09abfc6038939b05d1eedf"
@@ -3880,7 +4447,7 @@
     argparse "^1.0.7"
     esprima "^4.0.0"

-js-yaml@^3.7.0:
+js-yaml@^3.11.0, js-yaml@^3.7.0:
   version "3.11.0"
   resolved "https://registry.yarnpkg.com/js-yaml/-/js-yaml-3.11.0.tgz#597c1a8bd57152f26d622ce4117851a51f5ebaef"
   dependencies:
@@ -3923,10 +4490,6 @@
     shelljs "0.3.x"
     strip-json-comments "1.0.x"

-json-loader@^0.5.4:
-  version "0.5.7"
-  resolved "https://registry.yarnpkg.com/json-loader/-/json-loader-0.5.7.tgz#dca14a70235ff82f0ac9a3abeb60d337a365185d"
-
 json-parse-helpfulerror@^1.0.2:
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/json-parse-helpfulerror/-/json-parse-helpfulerror-1.0.3.tgz#13f14ce02eed4e981297b64eb9e3b932e2dd13dc"
@@ -3998,13 +4561,7 @@
   dependencies:
     array-includes "^3.0.3"

-kind-of@^2.0.1:
-  version "2.0.1"
-  resolved "https://registry.yarnpkg.com/kind-of/-/kind-of-2.0.1.tgz#018ec7a4ce7e3a86cb9141be519d24c8faa981b5"
-  dependencies:
-    is-buffer "^1.0.2"
-
-kind-of@^3.0.2, kind-of@^3.0.3, kind-of@^3.2.0, kind-of@^3.2.2:
+kind-of@^3.0.2, kind-of@^3.0.3, kind-of@^3.2.0:
   version "3.2.2"
   resolved "https://registry.yarnpkg.com/kind-of/-/kind-of-3.2.2.tgz#31ea21a734bab9bbb0f32466d893aea51e4a3c64"
   dependencies:
@@ -4016,7 +4573,7 @@
   dependencies:
     is-buffer "^1.1.5"

-kind-of@^5.0.0, kind-of@^5.0.2:
+kind-of@^5.0.0:
   version "5.1.0"
   resolved "https://registry.yarnpkg.com/kind-of/-/kind-of-5.1.0.tgz#729c91e2d857b7a419a1f9aa65685c4c33f5845d"

@@ -4024,6 +4581,10 @@
   version "6.0.0"
   resolved "https://registry.yarnpkg.com/kind-of/-/kind-of-6.0.0.tgz#3606e9e2fa960e7ddaa8898c03804e47e5d66644"

+kind-of@^6.0.2:
+  version "6.0.2"
+  resolved "https://registry.yarnpkg.com/kind-of/-/kind-of-6.0.2.tgz#01146b36a6218e64e58f3a8d66de5d7fc6f6d051"
+
 klaw-sync@^3.0.0:
   version "3.0.2"
   resolved "https://registry.yarnpkg.com/klaw-sync/-/klaw-sync-3.0.2.tgz#bf3a5ca463af5aec007201dbe8be7088ef29d067"
@@ -4042,14 +4603,6 @@
   dependencies:
     package-json "^4.0.0"

-lazy-cache@^0.2.3:
-  version "0.2.7"
-  resolved "https://registry.yarnpkg.com/lazy-cache/-/lazy-cache-0.2.7.tgz#7feddf2dcb6edb77d11ef1d117ab5ffdf0ab1b65"
-
-lazy-cache@^1.0.3:
-  version "1.0.4"
-  resolved "https://registry.yarnpkg.com/lazy-cache/-/lazy-cache-1.0.4.tgz#a1d78fc3a50474cb80845d3b3b6e1da49a446e8e"
-
 lazy-cache@^2.0.2:
   version "2.0.2"
   resolved "https://registry.yarnpkg.com/lazy-cache/-/lazy-cache-2.0.2.tgz#b9190a4f913354694840859f8a8f7084d8822264"
@@ -4072,6 +4625,10 @@
   dependencies:
     invert-kv "^1.0.0"

+leb@^0.3.0:
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/leb/-/leb-0.3.0.tgz#32bee9fad168328d6aea8522d833f4180eed1da3"
+
 legal-eagle@0.15.0:
   version "0.15.0"
   resolved "https://registry.yarnpkg.com/legal-eagle/-/legal-eagle-0.15.0.tgz#826b47475c948543b803a82baa2907a350449e04"
@@ -4118,7 +4675,7 @@
     json5 "^0.5.0"
     object-assign "^4.0.1"

-loader-utils@^1.0.1, loader-utils@^1.0.2, loader-utils@^1.0.3, loader-utils@^1.1.0:
+loader-utils@^1.0.1, loader-utils@^1.0.2, loader-utils@^1.1.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/loader-utils/-/loader-utils-1.1.0.tgz#c98aef488bcceda2ffb5e2de646d6a754429f5cd"
   dependencies:
@@ -4210,6 +4767,10 @@
   version "4.17.4"
   resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.4.tgz#78203a4d1c328ae1d86dca6460e369b57f4055ae"

+lodash@^4.17.5:
+  version "4.17.10"
+  resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.10.tgz#1b7793cf7259ea38fb3661d4d38b3260af8ae4e7"
+
 log-symbols@^2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/log-symbols/-/log-symbols-2.1.0.tgz#f35fa60e278832b538dc4dddcbb478a45d3e3be6"
@@ -4220,9 +4781,9 @@
   version "1.0.1"
   resolved "https://registry.yarnpkg.com/loglevelnext/-/loglevelnext-1.0.1.tgz#8b17b5a43395338a96c67911a962c44af466d1c8"

-longest@^1.0.1:
-  version "1.0.1"
-  resolved "https://registry.yarnpkg.com/longest/-/longest-1.0.1.tgz#30a0b2da38f73770e8294a0d22e6625ed77d0097"
+long@^3.2.0:
+  version "3.2.0"
+  resolved "https://registry.yarnpkg.com/long/-/long-3.2.0.tgz#d821b7138ca1cb581c172990ef14db200b5c474b"

 loose-envify@^1.0.0, loose-envify@^1.3.1:
   version "1.3.1"
@@ -4252,6 +4813,13 @@
     pseudomap "^1.0.2"
     yallist "^2.1.2"

+lru-cache@^4.1.1:
+  version "4.1.2"
+  resolved "https://registry.yarnpkg.com/lru-cache/-/lru-cache-4.1.2.tgz#45234b2e6e2f2b33da125624c4664929a0224c3f"
+  dependencies:
+    pseudomap "^1.0.2"
+    yallist "^2.1.2"
+
 macaddress@^0.2.8:
   version "0.2.8"
   resolved "https://registry.yarnpkg.com/macaddress/-/macaddress-0.2.8.tgz#5904dc537c39ec6dbefeae902327135fa8511f12"
@@ -4331,41 +4899,23 @@
   version "1.1.2"
   resolved "https://registry.yarnpkg.com/methods/-/methods-1.1.2.tgz#5529a4d67654134edcc5266656835b0f851afcee"

-micromatch@^2.1.5:
-  version "2.3.11"
-  resolved "https://registry.yarnpkg.com/micromatch/-/micromatch-2.3.11.tgz#86677c97d1720b363431d04d0d15293bd38c1565"
-  dependencies:
-    arr-diff "^2.0.0"
-    array-unique "^0.2.1"
-    braces "^1.8.2"
-    expand-brackets "^0.1.4"
-    extglob "^0.3.1"
-    filename-regex "^2.0.0"
-    is-extglob "^1.0.0"
-    is-glob "^2.0.1"
-    kind-of "^3.0.2"
-    normalize-path "^2.0.1"
-    object.omit "^2.0.0"
-    parse-glob "^3.0.4"
-    regex-cache "^0.4.2"
-
-micromatch@^3.0.3:
-  version "3.1.4"
-  resolved "https://registry.yarnpkg.com/micromatch/-/micromatch-3.1.4.tgz#bb812e741a41f982c854e42b421a7eac458796f4"
+micromatch@^3.1.4, micromatch@^3.1.8, micromatch@^3.1.9:
+  version "3.1.10"
+  resolved "https://registry.yarnpkg.com/micromatch/-/micromatch-3.1.10.tgz#70859bc95c9840952f359a068a3fc49f9ecfac23"
   dependencies:
     arr-diff "^4.0.0"
     array-unique "^0.3.2"
-    braces "^2.3.0"
-    define-property "^1.0.0"
-    extend-shallow "^2.0.1"
-    extglob "^2.0.2"
+    braces "^2.3.1"
+    define-property "^2.0.2"
+    extend-shallow "^3.0.2"
+    extglob "^2.0.4"
     fragment-cache "^0.2.1"
-    kind-of "^6.0.0"
-    nanomatch "^1.2.5"
+    kind-of "^6.0.2"
+    nanomatch "^1.2.9"
     object.pick "^1.3.0"
     regex-not "^1.0.0"
     snapdragon "^0.8.1"
-    to-regex "^3.0.1"
+    to-regex "^3.0.2"

 miller-rabin@^4.0.0:
   version "4.0.1"
@@ -4378,12 +4928,22 @@
   version "1.30.0"
   resolved "https://registry.yarnpkg.com/mime-db/-/mime-db-1.30.0.tgz#74c643da2dd9d6a45399963465b26d5ca7d71f01"

+mime-db@~1.33.0:
+  version "1.33.0"
+  resolved "https://registry.yarnpkg.com/mime-db/-/mime-db-1.33.0.tgz#a3492050a5cb9b63450541e39d9788d2272783db"
+
 mime-types@^2.1.12, mime-types@~2.1.15, mime-types@~2.1.16, mime-types@~2.1.17, mime-types@~2.1.7:
   version "2.1.17"
   resolved "https://registry.yarnpkg.com/mime-types/-/mime-types-2.1.17.tgz#09d7a393f03e995a79f8af857b70a9e0ab16557a"
   dependencies:
     mime-db "~1.30.0"

+mime-types@~2.1.18:
+  version "2.1.18"
+  resolved "https://registry.yarnpkg.com/mime-types/-/mime-types-2.1.18.tgz#6f323f60a83d11146f831ff11fd66e2fe5503bb8"
+  dependencies:
+    mime-db "~1.33.0"
+
 mime@1.4.1:
   version "1.4.1"
   resolved "https://registry.yarnpkg.com/mime/-/mime-1.4.1.tgz#121f9ebc49e3766f311a76e1fa1c8003c4b03aa6"
@@ -4393,13 +4953,20 @@
   resolved "https://registry.yarnpkg.com/mime/-/mime-2.1.0.tgz#1022a5ada445aa30686e4059abaea83d0b4e8f9c"

 mime@^2.2.0:
-  version "2.2.0"
-  resolved "https://registry.yarnpkg.com/mime/-/mime-2.2.0.tgz#161e541965551d3b549fa1114391e3a3d55b923b"
+  version "2.2.2"
+  resolved "https://registry.yarnpkg.com/mime/-/mime-2.2.2.tgz#6b4c109d88031d7b5c23635f5b923da336d79121"

 mimic-fn@^1.0.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/mimic-fn/-/mimic-fn-1.1.0.tgz#e667783d92e89dbd342818b5230b9d62a672ad18"

+mini-css-extract-plugin@^0.4.0:
+  version "0.4.0"
+  resolved "https://registry.yarnpkg.com/mini-css-extract-plugin/-/mini-css-extract-plugin-0.4.0.tgz#ff3bf08bee96e618e177c16ca6131bfecef707f9"
+  dependencies:
+    loader-utils "^1.1.0"
+    webpack-sources "^1.1.0"
+
 minimalistic-assert@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/minimalistic-assert/-/minimalistic-assert-1.0.0.tgz#702be2dda6b37f4836bcb3f5db56641b64a1d3d3"
@@ -4426,6 +4993,34 @@
   version "0.0.10"
   resolved "https://registry.yarnpkg.com/minimist/-/minimist-0.0.10.tgz#de3f98543dbf96082be48ad1a0c7cda836301dcf"

+minipass@^2.2.1, minipass@^2.2.4:
+  version "2.2.4"
+  resolved "https://registry.yarnpkg.com/minipass/-/minipass-2.2.4.tgz#03c824d84551ec38a8d1bb5bc350a5a30a354a40"
+  dependencies:
+    safe-buffer "^5.1.1"
+    yallist "^3.0.0"
+
+minizlib@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/minizlib/-/minizlib-1.1.0.tgz#11e13658ce46bc3a70a267aac58359d1e0c29ceb"
+  dependencies:
+    minipass "^2.2.1"
+
+mississippi@^2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/mississippi/-/mississippi-2.0.0.tgz#3442a508fafc28500486feea99409676e4ee5a6f"
+  dependencies:
+    concat-stream "^1.5.0"
+    duplexify "^3.4.2"
+    end-of-stream "^1.1.0"
+    flush-write-stream "^1.0.0"
+    from2 "^2.1.0"
+    parallel-transform "^1.1.0"
+    pump "^2.0.1"
+    pumpify "^1.3.3"
+    stream-each "^1.1.0"
+    through2 "^2.0.0"
+
 mixin-deep@^1.2.0:
   version "1.2.0"
   resolved "https://registry.yarnpkg.com/mixin-deep/-/mixin-deep-1.2.0.tgz#d02b8c6f8b6d4b8f5982d3fd009c4919851c3fe2"
@@ -4465,8 +5060,8 @@
     request "^2.79.0"

 mocha@^5.0.1, mocha@^5.0.4:
-  version "5.0.4"
-  resolved "https://registry.yarnpkg.com/mocha/-/mocha-5.0.4.tgz#6b7aa328472da1088e69d47e75925fd3a3bb63c6"
+  version "5.0.5"
+  resolved "https://registry.yarnpkg.com/mocha/-/mocha-5.0.5.tgz#e228e3386b9387a4710007a641f127b00be44b52"
   dependencies:
     browser-stdout "1.3.1"
     commander "2.11.0"
@@ -4479,6 +5074,17 @@
     mkdirp "0.5.1"
     supports-color "4.4.0"

+move-concurrently@^1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/move-concurrently/-/move-concurrently-1.0.1.tgz#be2c005fda32e0b29af1f05d7c4b33214c701f92"
+  dependencies:
+    aproba "^1.1.1"
+    copy-concurrently "^1.0.0"
+    fs-write-stream-atomic "^1.0.8"
+    mkdirp "^0.5.1"
+    rimraf "^2.5.4"
+    run-queue "^1.0.3"
+
 ms@2.0.0:
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/ms/-/ms-2.0.0.tgz#5608aeadfc00be6c2901df5f9861788de0d597c8"
@@ -4495,21 +5101,26 @@
     object-assign "^4.0.1"
     thenify-all "^1.0.0"

-nan@^2.3.0, nan@^2.3.2:
+nan@^2.3.2:
   version "2.7.0"
   resolved "https://registry.yarnpkg.com/nan/-/nan-2.7.0.tgz#d95bf721ec877e08db276ed3fc6eb78f9083ad46"

-nanomatch@^1.2.5:
-  version "1.2.5"
-  resolved "https://registry.yarnpkg.com/nanomatch/-/nanomatch-1.2.5.tgz#5c9ab02475c76676275731b0bf0a7395c624a9c4"
+nan@^2.9.2:
+  version "2.10.0"
+  resolved "https://registry.yarnpkg.com/nan/-/nan-2.10.0.tgz#96d0cd610ebd58d4b4de9cc0c6828cda99c7548f"
+
+nanomatch@^1.2.9:
+  version "1.2.9"
+  resolved "https://registry.yarnpkg.com/nanomatch/-/nanomatch-1.2.9.tgz#879f7150cb2dab7a471259066c104eee6e0fa7c2"
   dependencies:
     arr-diff "^4.0.0"
     array-unique "^0.3.2"
-    define-property "^1.0.0"
-    extend-shallow "^2.0.1"
+    define-property "^2.0.2"
+    extend-shallow "^3.0.2"
     fragment-cache "^0.2.1"
-    is-odd "^1.0.0"
-    kind-of "^5.0.2"
+    is-odd "^2.0.0"
+    is-windows "^1.0.2"
+    kind-of "^6.0.2"
     object.pick "^1.3.0"
     regex-not "^1.0.0"
     snapdragon "^0.8.1"
@@ -4529,10 +5140,22 @@
   dependencies:
     xml-char-classes "^1.0.0"

+needle@^2.2.0:
+  version "2.2.1"
+  resolved "https://registry.yarnpkg.com/needle/-/needle-2.2.1.tgz#b5e325bd3aae8c2678902fa296f729455d1d3a7d"
+  dependencies:
+    debug "^2.1.2"
+    iconv-lite "^0.4.4"
+    sax "^1.2.4"
+
 negotiator@0.6.1:
   version "0.6.1"
   resolved "https://registry.yarnpkg.com/negotiator/-/negotiator-0.6.1.tgz#2b327184e8992101177b28563fb5e7102acd0ca9"

+neo-async@^2.5.0:
+  version "2.5.1"
+  resolved "https://registry.yarnpkg.com/neo-async/-/neo-async-2.5.1.tgz#acb909e327b1e87ec9ef15f41b8a269512ad41ee"
+
 no-case@^2.2.0:
   version "2.3.2"
   resolved "https://registry.yarnpkg.com/no-case/-/no-case-2.3.2.tgz#60b813396be39b3f1288a4c1ed5d1e7d28b464ac"
@@ -4600,26 +5223,20 @@
     util "^0.10.3"
     vm-browserify "0.0.4"

-node-native-loader@^1.1.1:
-  version "1.1.1"
-  resolved "https://registry.yarnpkg.com/node-native-loader/-/node-native-loader-1.1.1.tgz#ff1c2072f795947b3dde1da2f5412451ef564337"
-  dependencies:
-    loader-utils "^1.0.3"
-
-node-pre-gyp@^0.6.36:
-  version "0.6.38"
-  resolved "https://registry.yarnpkg.com/node-pre-gyp/-/node-pre-gyp-0.6.38.tgz#e92a20f83416415bb4086f6d1fb78b3da73d113d"
+node-pre-gyp@^0.9.0:
+  version "0.9.1"
+  resolved "https://registry.yarnpkg.com/node-pre-gyp/-/node-pre-gyp-0.9.1.tgz#f11c07516dd92f87199dbc7e1838eab7cd56c9e0"
   dependencies:
-    hawk "3.1.3"
+    detect-libc "^1.0.2"
     mkdirp "^0.5.1"
+    needle "^2.2.0"
     nopt "^4.0.1"
+    npm-packlist "^1.1.6"
     npmlog "^4.0.2"
     rc "^1.1.7"
-    request "2.81.0"
     rimraf "^2.6.1"
     semver "^5.3.0"
-    tar "^2.2.1"
-    tar-pack "^3.4.0"
+    tar "^4"

 node-sass@^4.7.2:
   version "4.7.2"
@@ -4688,7 +5305,7 @@
     semver "2 || 3 || 4 || 5"
     validate-npm-package-license "^3.0.1"

-normalize-path@^2.0.0, normalize-path@^2.0.1:
+normalize-path@^2.0.0, normalize-path@^2.1.1:
   version "2.1.1"
   resolved "https://registry.yarnpkg.com/normalize-path/-/normalize-path-2.1.1.tgz#1ab28b556e198363a8c1a6f7e6fa20137fe6aed9"
   dependencies:
@@ -4707,10 +5324,21 @@
     query-string "^4.1.0"
     sort-keys "^1.0.0"

+npm-bundled@^1.0.1:
+  version "1.0.3"
+  resolved "https://registry.yarnpkg.com/npm-bundled/-/npm-bundled-1.0.3.tgz#7e71703d973af3370a9591bafe3a63aca0be2308"
+
 npm-install-package@~2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/npm-install-package/-/npm-install-package-2.1.0.tgz#d7efe3cfcd7ab00614b896ea53119dc9ab259125"

+npm-packlist@^1.1.6:
+  version "1.1.10"
+  resolved "https://registry.yarnpkg.com/npm-packlist/-/npm-packlist-1.1.10.tgz#1039db9e985727e464df066f4cf0ab6ef85c398a"
+  dependencies:
+    ignore-walk "^3.0.1"
+    npm-bundled "^1.0.1"
+
 npm-run-path@^2.0.0:
   version "2.0.2"
   resolved "https://registry.yarnpkg.com/npm-run-path/-/npm-run-path-2.0.2.tgz#35a9232dfa35d7067b4cb2ddf2357b1871536c5f"
@@ -4789,13 +5417,6 @@
     define-properties "^1.1.2"
     es-abstract "^1.5.1"

-object.omit@^2.0.0:
-  version "2.0.1"
-  resolved "https://registry.yarnpkg.com/object.omit/-/object.omit-2.0.1.tgz#1a9c744829f39dbb858c76ca3579ae2a54ebd1fa"
-  dependencies:
-    for-own "^0.1.4"
-    is-extendable "^0.1.1"
-
 object.pick@^1.3.0:
   version "1.3.0"
   resolved "https://registry.yarnpkg.com/object.pick/-/object.pick-1.3.0.tgz#87a10ac4c1694bd2e1cbf53591a66141fb5dd747"
@@ -4814,7 +5435,7 @@
   dependencies:
     ee-first "1.1.1"

-once@^1.3.0, once@^1.3.3, once@^1.4.0:
+once@^1.3.0, once@^1.3.1, once@^1.4.0:
   version "1.4.0"
   resolved "https://registry.yarnpkg.com/once/-/once-1.4.0.tgz#583b1aa775961d4b113ac17d9c50baef9dd76bd1"
   dependencies:
@@ -4826,6 +5447,10 @@
   dependencies:
     mimic-fn "^1.0.0"

+opener@^1.4.3:
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/opener/-/opener-1.4.3.tgz#5c6da2c5d7e5831e8ffa3964950f8d6674ac90b8"
+
 optimist@~0.6.1:
   version "0.6.1"
   resolved "https://registry.yarnpkg.com/optimist/-/optimist-0.6.1.tgz#da3ea74686fa21a19a111c326e90eb15a0196686"
@@ -4904,9 +5529,17 @@
   version "0.2.9"
   resolved "https://registry.yarnpkg.com/pako/-/pako-0.2.9.tgz#f3f7522f4ef782348da8161bad9ecfd51bf83a75"

-parallel-webpack@^2.1.0:
-  version "2.2.0"
-  resolved "https://registry.yarnpkg.com/parallel-webpack/-/parallel-webpack-2.2.0.tgz#7171440b684444610ba890d32439a33666ab46cb"
+parallel-transform@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/parallel-transform/-/parallel-transform-1.1.0.tgz#d410f065b05da23081fcd10f28854c29bda33b06"
+  dependencies:
+    cyclist "~0.2.2"
+    inherits "^2.0.3"
+    readable-stream "^2.1.5"
+
+parallel-webpack@^2.3.0:
+  version "2.3.0"
+  resolved "https://registry.yarnpkg.com/parallel-webpack/-/parallel-webpack-2.3.0.tgz#a614625e25647cea9655918cb80cf829fa674ff8"
   dependencies:
     ajv "^4.9.2"
     bluebird "^3.0.6"
@@ -4949,15 +5582,6 @@
   dependencies:
     color-convert "~0.5.0"

-parse-glob@^3.0.4:
-  version "3.0.4"
-  resolved "https://registry.yarnpkg.com/parse-glob/-/parse-glob-3.0.4.tgz#b2c376cfb11f35513badd173ef0bb6e3a388391c"
-  dependencies:
-    glob-base "^0.3.0"
-    is-dotfile "^1.0.0"
-    is-extglob "^1.0.0"
-    is-glob "^2.0.0"
-
 parse-json@^2.2.0:
   version "2.2.0"
   resolved "https://registry.yarnpkg.com/parse-json/-/parse-json-2.2.0.tgz#f480f40434ef80741f8469099f8dea18f55a4dc9"
@@ -4976,6 +5600,10 @@
   version "0.0.0"
   resolved "https://registry.yarnpkg.com/path-browserify/-/path-browserify-0.0.0.tgz#a0b870729aae214005b7d5032ec2cbbb0fb4451a"

+path-dirname@^1.0.0:
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/path-dirname/-/path-dirname-1.0.2.tgz#cc33d24d525e099a5388c0336c6e32b9160609e0"
+
 path-exists@^2.0.0, path-exists@^2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/path-exists/-/path-exists-2.1.0.tgz#0feb6c64f0fc518d9a754dd5efb62c7022761f4b"
@@ -5064,6 +5692,12 @@
   version "2.0.4"
   resolved "https://registry.yarnpkg.com/pinkie/-/pinkie-2.0.4.tgz#72556b80cfa0d48a974e80e77248e80ed4f7f870"

+pkg-dir@^2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/pkg-dir/-/pkg-dir-2.0.0.tgz#f6d5d1109e19d63edf428e0bd57e12777615334b"
+  dependencies:
+    find-up "^2.1.0"
+
 plist@^2.0.0, plist@^2.1.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/plist/-/plist-2.1.0.tgz#57ccdb7a0821df21831217a3cad54e3e146a1025"
@@ -5206,27 +5840,27 @@
     postcss "^5.0.14"
     postcss-selector-parser "^2.0.0"

-postcss-modules-extract-imports@^1.0.0:
+postcss-modules-extract-imports@^1.2.0:
   version "1.2.0"
   resolved "https://registry.yarnpkg.com/postcss-modules-extract-imports/-/postcss-modules-extract-imports-1.2.0.tgz#66140ecece38ef06bf0d3e355d69bf59d141ea85"
   dependencies:
     postcss "^6.0.1"

-postcss-modules-local-by-default@^1.0.1:
+postcss-modules-local-by-default@^1.2.0:
   version "1.2.0"
   resolved "https://registry.yarnpkg.com/postcss-modules-local-by-default/-/postcss-modules-local-by-default-1.2.0.tgz#f7d80c398c5a393fa7964466bd19500a7d61c069"
   dependencies:
     css-selector-tokenizer "^0.7.0"
     postcss "^6.0.1"

-postcss-modules-scope@^1.0.0:
+postcss-modules-scope@^1.1.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/postcss-modules-scope/-/postcss-modules-scope-1.1.0.tgz#d6ea64994c79f97b62a72b426fbe6056a194bb90"
   dependencies:
     css-selector-tokenizer "^0.7.0"
     postcss "^6.0.1"

-postcss-modules-values@^1.1.0:
+postcss-modules-values@^1.3.0:
   version "1.3.0"
   resolved "https://registry.yarnpkg.com/postcss-modules-values/-/postcss-modules-values-1.3.0.tgz#ecffa9d7e192518389f42ad0e83f72aec456ea20"
   dependencies:
@@ -5338,13 +5972,9 @@
   version "1.0.4"
   resolved "https://registry.yarnpkg.com/prepend-http/-/prepend-http-1.0.4.tgz#d4f4562b0ce3696e41ac52d0e002e57a635dc6dc"

-preserve@^0.2.0:
-  version "0.2.0"
-  resolved "https://registry.yarnpkg.com/preserve/-/preserve-0.2.0.tgz#815ed1f6ebc65926f865b310c0713bcb3315ce4b"
-
-prettier@1.11.1:
-  version "1.11.1"
-  resolved "https://registry.yarnpkg.com/prettier/-/prettier-1.11.1.tgz#61e43fc4cd44e68f2b0dfc2c38cd4bb0fccdcc75"
+prettier@1.13.0:
+  version "1.13.0"
+  resolved "https://registry.yarnpkg.com/prettier/-/prettier-1.13.0.tgz#054de8d5fb1a4405c845d16183f58a2c301f6f16"

 pretty-bytes@^1.0.2:
   version "1.0.4"
@@ -5360,7 +5990,7 @@
     renderkid "^2.0.1"
     utila "~0.4"

-private@^0.1.7:
+private@^0.1.7, private@^0.1.8:
   version "0.1.8"
   resolved "https://registry.yarnpkg.com/private/-/private-0.1.8.tgz#2381edb3689f7a53d653190060fcf822d2f368ff"

@@ -5368,6 +5998,10 @@
   version "1.0.7"
   resolved "https://registry.yarnpkg.com/process-nextick-args/-/process-nextick-args-1.0.7.tgz#150e20b756590ad3f91093f25a4f2ad8bff30ba3"

+process-nextick-args@~2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/process-nextick-args/-/process-nextick-args-2.0.0.tgz#a37d732f4271b4ab1ad070d35508e8290788ffaa"
+
 process@^0.11.0:
   version "0.11.10"
   resolved "https://registry.yarnpkg.com/process/-/process-0.11.10.tgz#7332300e840161bda3e69a1d1d91a7d4bc16f182"
@@ -5383,6 +6017,10 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/progress/-/progress-2.0.0.tgz#8a1be366bf8fc23db2bd23f10c6fe920b4389d1f"

+promise-inflight@^1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/promise-inflight/-/promise-inflight-1.0.1.tgz#98472870bf228132fcbdd868129bad12c3c029e3"
+
 promise@^7.1.1:
   version "7.3.1"
   resolved "https://registry.yarnpkg.com/promise/-/promise-7.3.1.tgz#064b72602b18f90f29192b8b1bc418ffd1ebd3bf"
@@ -5410,10 +6048,21 @@
     forwarded "~0.1.2"
     ipaddr.js "1.5.2"

+proxy-addr@~2.0.3:
+  version "2.0.3"
+  resolved "https://registry.yarnpkg.com/proxy-addr/-/proxy-addr-2.0.3.tgz#355f262505a621646b3130a728eb647e22055341"
+  dependencies:
+    forwarded "~0.1.2"
+    ipaddr.js "1.6.0"
+
 prr@~0.0.0:
   version "0.0.0"
   resolved "https://registry.yarnpkg.com/prr/-/prr-0.0.0.tgz#1a84b85908325501411853d0081ee3fa86e2926a"

+prr@~1.0.1:
+  version "1.0.1"
+  resolved "https://registry.yarnpkg.com/prr/-/prr-1.0.1.tgz#d3fc114ba06995a45ec6893f484ceb1d78f5f476"
+
 pruner@^0.0.7:
   version "0.0.7"
   resolved "https://registry.yarnpkg.com/pruner/-/pruner-0.0.7.tgz#345fbcb3e80701163a1d7adf56bac229a5a1e4c1"
@@ -5434,6 +6083,21 @@
     parse-asn1 "^5.0.0"
     randombytes "^2.0.1"

+pump@^2.0.0, pump@^2.0.1:
+  version "2.0.1"
+  resolved "https://registry.yarnpkg.com/pump/-/pump-2.0.1.tgz#12399add6e4cf7526d973cbc8b5ce2e2908b3909"
+  dependencies:
+    end-of-stream "^1.1.0"
+    once "^1.3.1"
+
+pumpify@^1.3.3:
+  version "1.4.0"
+  resolved "https://registry.yarnpkg.com/pumpify/-/pumpify-1.4.0.tgz#80b7c5df7e24153d03f0e7ac8a05a5d068bd07fb"
+  dependencies:
+    duplexify "^3.5.3"
+    inherits "^2.0.3"
+    pump "^2.0.0"
+
 punycode@1.3.2:
   version "1.3.2"
   resolved "https://registry.yarnpkg.com/punycode/-/punycode-1.3.2.tgz#9653a036fb7c1ee42342f2325cceefea3926c48d"
@@ -5477,13 +6141,6 @@
   version "0.2.0"
   resolved "https://registry.yarnpkg.com/querystring/-/querystring-0.2.0.tgz#b209849203bb25df820da756e747005878521620"

-randomatic@^1.1.3:
-  version "1.1.7"
-  resolved "https://registry.yarnpkg.com/randomatic/-/randomatic-1.1.7.tgz#c7abe9cc8b87c0baa876b19fde83fd464797e38c"
-  dependencies:
-    is-number "^3.0.0"
-    kind-of "^4.0.0"
-
 randombytes@^2.0.0, randombytes@^2.0.1:
   version "2.0.5"
   resolved "https://registry.yarnpkg.com/randombytes/-/randombytes-2.0.5.tgz#dc009a246b8d09a177b4b7a0ae77bc570f4b1b79"
@@ -5512,9 +6169,9 @@
     minimist "^1.2.0"
     strip-json-comments "~2.0.1"

-rcedit@^0.9.0:
-  version "0.9.0"
-  resolved "https://registry.yarnpkg.com/rcedit/-/rcedit-0.9.0.tgz#3910df57345399e2b0325f4a519007f89e55ef1c"
+rcedit@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/rcedit/-/rcedit-1.0.0.tgz#43309ecbc8814f3582fca6b751748cfad66a16a2"

 read-config-file@3.0.0:
   version "3.0.0"
@@ -5583,6 +6240,18 @@
     normalize-package-data "^2.3.2"
     path-type "^2.0.0"

+"readable-stream@1 || 2", readable-stream@^2.0.4, readable-stream@^2.1.5:
+  version "2.3.6"
+  resolved "https://registry.yarnpkg.com/readable-stream/-/readable-stream-2.3.6.tgz#b11c27d88b8ff1fbe070643cf94b0c79ae1b0aaf"
+  dependencies:
+    core-util-is "~1.0.0"
+    inherits "~2.0.3"
+    isarray "~1.0.0"
+    process-nextick-args "~2.0.0"
+    safe-buffer "~5.1.1"
+    string_decoder "~1.1.1"
+    util-deprecate "~1.0.1"
+
 readable-stream@1.0:
   version "1.0.34"
   resolved "https://registry.yarnpkg.com/readable-stream/-/readable-stream-1.0.34.tgz#125820e34bc842d2f2aaafafe4c2916ee32c157c"
@@ -5610,7 +6279,7 @@
     isarray "0.0.1"
     string_decoder "~0.10.x"

-readable-stream@^2.0.0, readable-stream@^2.0.1, readable-stream@^2.0.2, readable-stream@^2.0.5, readable-stream@^2.0.6, readable-stream@^2.1.4, readable-stream@^2.2.2, readable-stream@^2.2.6:
+readable-stream@^2.0.0, readable-stream@^2.0.1, readable-stream@^2.0.2, readable-stream@^2.0.5, readable-stream@^2.0.6, readable-stream@^2.2.2, readable-stream@^2.2.6:
   version "2.3.3"
   resolved "https://registry.yarnpkg.com/readable-stream/-/readable-stream-2.3.3.tgz#368f2512d79f9d46fdfc71349ae7878bbc1eb95c"
   dependencies:
@@ -5673,21 +6342,22 @@
   version "0.11.0"
   resolved "https://registry.yarnpkg.com/regenerator-runtime/-/regenerator-runtime-0.11.0.tgz#7e54fe5b5ccd5d6624ea6255c3473be090b802e1"

-regex-cache@^0.4.2:
-  version "0.4.4"
-  resolved "https://registry.yarnpkg.com/regex-cache/-/regex-cache-0.4.4.tgz#75bdc58a2a1496cec48a12835bc54c8d562336dd"
-  dependencies:
-    is-equal-shallow "^0.1.3"
-
 regex-not@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/regex-not/-/regex-not-1.0.0.tgz#42f83e39771622df826b02af176525d6a5f157f9"
   dependencies:
     extend-shallow "^2.0.1"

+regex-not@^1.0.2:
+  version "1.0.2"
+  resolved "https://registry.yarnpkg.com/regex-not/-/regex-not-1.0.2.tgz#1f4ece27e00b0b65e0247a6810e6a85d83a5752c"
+  dependencies:
+    extend-shallow "^3.0.2"
+    safe-regex "^1.1.0"
+
 regexpp@^1.0.1:
-  version "1.0.1"
-  resolved "https://registry.yarnpkg.com/regexpp/-/regexpp-1.0.1.tgz#d857c3a741dce075c2848dcb019a0a975b190d43"
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/regexpp/-/regexpp-1.1.0.tgz#0e3516dd0b7904f413d2d4193dce4618c3a689ab"

 regexpu-core@^1.0.0:
   version "1.0.0"
@@ -5742,7 +6412,7 @@
   version "1.1.2"
   resolved "https://registry.yarnpkg.com/repeat-element/-/repeat-element-1.1.2.tgz#ef089a178d1483baae4d93eb98b4f9e4e11d990a"

-repeat-string@^1.5.2, repeat-string@^1.6.1:
+repeat-string@^1.6.1:
   version "1.6.1"
   resolved "https://registry.yarnpkg.com/repeat-string/-/repeat-string-1.6.1.tgz#8dcae470e1c88abc2d600fff4a776286da75e637"

@@ -5779,18 +6449,18 @@
     tunnel-agent "^0.6.0"
     uuid "^3.1.0"

-request@2.81.0, request@~2.81.0:
-  version "2.81.0"
-  resolved "https://registry.yarnpkg.com/request/-/request-2.81.0.tgz#c6928946a0e06c5f8d6f8a9333469ffda46298a0"
+request@~2.79.0:
+  version "2.79.0"
+  resolved "https://registry.yarnpkg.com/request/-/request-2.79.0.tgz#4dfe5bf6be8b8cdc37fcf93e04b65577722710de"
   dependencies:
     aws-sign2 "~0.6.0"
     aws4 "^1.2.1"
-    caseless "~0.12.0"
+    caseless "~0.11.0"
     combined-stream "~1.0.5"
     extend "~3.0.0"
     forever-agent "~0.6.1"
     form-data "~2.1.1"
-    har-validator "~4.2.1"
+    har-validator "~2.0.6"
     hawk "~3.1.3"
     http-signature "~1.1.0"
     is-typedarray "~1.0.0"
@@ -5798,26 +6468,24 @@
     json-stringify-safe "~5.0.1"
     mime-types "~2.1.7"
     oauth-sign "~0.8.1"
-    performance-now "^0.2.0"
-    qs "~6.4.0"
-    safe-buffer "^5.0.1"
+    qs "~6.3.0"
     stringstream "~0.0.4"
     tough-cookie "~2.3.0"
-    tunnel-agent "^0.6.0"
+    tunnel-agent "~0.4.1"
     uuid "^3.0.0"

-request@~2.79.0:
-  version "2.79.0"
-  resolved "https://registry.yarnpkg.com/request/-/request-2.79.0.tgz#4dfe5bf6be8b8cdc37fcf93e04b65577722710de"
+request@~2.81.0:
+  version "2.81.0"
+  resolved "https://registry.yarnpkg.com/request/-/request-2.81.0.tgz#c6928946a0e06c5f8d6f8a9333469ffda46298a0"
   dependencies:
     aws-sign2 "~0.6.0"
     aws4 "^1.2.1"
-    caseless "~0.11.0"
+    caseless "~0.12.0"
     combined-stream "~1.0.5"
     extend "~3.0.0"
     forever-agent "~0.6.1"
     form-data "~2.1.1"
-    har-validator "~2.0.6"
+    har-validator "~4.2.1"
     hawk "~3.1.3"
     http-signature "~1.1.0"
     is-typedarray "~1.0.0"
@@ -5825,10 +6493,12 @@
     json-stringify-safe "~5.0.1"
     mime-types "~2.1.7"
     oauth-sign "~0.8.1"
-    qs "~6.3.0"
+    performance-now "^0.2.0"
+    qs "~6.4.0"
+    safe-buffer "^5.0.1"
     stringstream "~0.0.4"
     tough-cookie "~2.3.0"
-    tunnel-agent "~0.4.1"
+    tunnel-agent "^0.6.0"
     uuid "^3.0.0"

 require-directory@^2.1.1:
@@ -5871,17 +6541,15 @@
     onetime "^2.0.0"
     signal-exit "^3.0.2"

+ret@~0.1.10:
+  version "0.1.15"
+  resolved "https://registry.yarnpkg.com/ret/-/ret-0.1.15.tgz#b8a4825d5bdb1fc3f6f53c2bc33f81388681c7bc"
+
 rgb2hex@~0.1.0:
   version "0.1.0"
   resolved "https://registry.yarnpkg.com/rgb2hex/-/rgb2hex-0.1.0.tgz#ccd55f860ae0c5c4ea37504b958e442d8d12325b"

-right-align@^0.1.1:
-  version "0.1.3"
-  resolved "https://registry.yarnpkg.com/right-align/-/right-align-0.1.3.tgz#61339b722fe6a3515689210d24e14c96148613ef"
-  dependencies:
-    align-text "^0.1.1"
-
-rimraf@2, rimraf@^2.2.8, rimraf@^2.5.1, rimraf@^2.5.2, rimraf@^2.6.1:
+rimraf@2, rimraf@^2.2.8, rimraf@^2.5.2, rimraf@^2.5.4, rimraf@^2.6.1, rimraf@^2.6.2:
   version "2.6.2"
   resolved "https://registry.yarnpkg.com/rimraf/-/rimraf-2.6.2.tgz#2ed8150d24a16ea8651e6d6ef0f47c4158ce7a36"
   dependencies:
@@ -5904,6 +6572,12 @@
   dependencies:
     is-promise "^2.1.0"

+run-queue@^1.0.0, run-queue@^1.0.3:
+  version "1.0.3"
+  resolved "https://registry.yarnpkg.com/run-queue/-/run-queue-1.0.3.tgz#e848396f057d223f24386924618e25694161ec47"
+  dependencies:
+    aproba "^1.1.1"
+
 rx-lite-aggregates@^4.0.8:
   version "4.0.8"
   resolved "https://registry.yarnpkg.com/rx-lite-aggregates/-/rx-lite-aggregates-4.0.8.tgz#753b87a89a11c95467c4ac1626c4efc4e05c67be"
@@ -5922,10 +6596,24 @@
   version "5.1.1"
   resolved "https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.1.1.tgz#893312af69b2123def71f57889001671eeb2c853"

+safe-buffer@^5.1.2:
+  version "5.1.2"
+  resolved "https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.1.2.tgz#991ec69d296e0313747d59bdfd2b745c35f8828d"
+
 safe-buffer@~5.0.1:
   version "5.0.1"
   resolved "https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.0.1.tgz#d263ca54696cd8a306b5ca6551e92de57918fbe7"

+safe-regex@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/safe-regex/-/safe-regex-1.1.0.tgz#40a3669f3b077d1e943d44629e157dd48023bf2e"
+  dependencies:
+    ret "~0.1.10"
+
+safer-buffer@^2.1.0:
+  version "2.1.2"
+  resolved "https://registry.yarnpkg.com/safer-buffer/-/safer-buffer-2.1.2.tgz#44fa161b0187b9549dd84bb91802f9bd8385cd6a"
+
 sanitize-filename@^1.6.0, sanitize-filename@^1.6.1:
   version "1.6.1"
   resolved "https://registry.yarnpkg.com/sanitize-filename/-/sanitize-filename-1.6.1.tgz#612da1c96473fa02dccda92dcd5b4ab164a6772a"
@@ -5941,14 +6629,14 @@
     scss-tokenizer "^0.2.3"
     yargs "^7.0.0"

-sass-loader@^6.0.6:
-  version "6.0.6"
-  resolved "https://registry.yarnpkg.com/sass-loader/-/sass-loader-6.0.6.tgz#e9d5e6c1f155faa32a4b26d7a9b7107c225e40f9"
+sass-loader@^7.0.1:
+  version "7.0.1"
+  resolved "https://registry.yarnpkg.com/sass-loader/-/sass-loader-7.0.1.tgz#fd937259ccba3a9cfe0d5f8a98746d48adfcc261"
   dependencies:
-    async "^2.1.5"
-    clone-deep "^0.3.0"
+    clone-deep "^2.0.1"
     loader-utils "^1.0.1"
     lodash.tail "^4.1.1"
+    neo-async "^2.5.0"
     pify "^3.0.0"

 sax@1.2.1:
@@ -5959,11 +6647,12 @@
   version "1.2.4"
   resolved "https://registry.yarnpkg.com/sax/-/sax-1.2.4.tgz#2816234e2378bddc4e5354fab5caa895df7100d9"

-schema-utils@^0.3.0:
-  version "0.3.0"
-  resolved "https://registry.yarnpkg.com/schema-utils/-/schema-utils-0.3.0.tgz#f5877222ce3e931edae039f17eb3716e7137f8cf"
+schema-utils@^0.4.4, schema-utils@^0.4.5:
+  version "0.4.5"
+  resolved "https://registry.yarnpkg.com/schema-utils/-/schema-utils-0.4.5.tgz#21836f0608aac17b78f9e3e24daff14a5ca13a3e"
   dependencies:
-    ajv "^5.0.0"
+    ajv "^6.1.0"
+    ajv-keywords "^3.1.0"

 scss-tokenizer@^0.2.3:
   version "0.2.3"
@@ -6012,6 +6701,28 @@
     range-parser "~1.2.0"
     statuses "~1.3.1"

+send@0.16.2:
+  version "0.16.2"
+  resolved "https://registry.yarnpkg.com/send/-/send-0.16.2.tgz#6ecca1e0f8c156d141597559848df64730a6bbc1"
+  dependencies:
+    debug "2.6.9"
+    depd "~1.1.2"
+    destroy "~1.0.4"
+    encodeurl "~1.0.2"
+    escape-html "~1.0.3"
+    etag "~1.8.1"
+    fresh "0.5.2"
+    http-errors "~1.6.2"
+    mime "1.4.1"
+    ms "2.0.0"
+    on-finished "~2.3.0"
+    range-parser "~1.2.0"
+    statuses "~1.4.0"
+
+serialize-javascript@^1.4.0:
+  version "1.5.0"
+  resolved "https://registry.yarnpkg.com/serialize-javascript/-/serialize-javascript-1.5.0.tgz#1aa336162c88a890ddad5384baebc93a655161fe"
+
 serve-static@1.13.1:
   version "1.13.1"
   resolved "https://registry.yarnpkg.com/serve-static/-/serve-static-1.13.1.tgz#4c57d53404a761d8f2e7c1e8a18a47dbf278a719"
@@ -6021,6 +6732,15 @@
     parseurl "~1.3.2"
     send "0.16.1"

+serve-static@1.13.2:
+  version "1.13.2"
+  resolved "https://registry.yarnpkg.com/serve-static/-/serve-static-1.13.2.tgz#095e8472fd5b46237db50ce486a43f4b86c6cec1"
+  dependencies:
+    encodeurl "~1.0.2"
+    escape-html "~1.0.3"
+    parseurl "~1.3.2"
+    send "0.16.2"
+
 set-blocking@^2.0.0, set-blocking@~2.0.0:
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/set-blocking/-/set-blocking-2.0.0.tgz#045f9782d011ae9a6803ddd382b24392b3d890f7"
@@ -6072,13 +6792,12 @@
     inherits "^2.0.1"
     safe-buffer "^5.0.1"

-shallow-clone@^0.1.2:
-  version "0.1.2"
-  resolved "https://registry.yarnpkg.com/shallow-clone/-/shallow-clone-0.1.2.tgz#5909e874ba77106d73ac414cfec1ffca87d97060"
+shallow-clone@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/shallow-clone/-/shallow-clone-1.0.0.tgz#4480cd06e882ef68b2ad88a3ea54832e2c48b571"
   dependencies:
     is-extendable "^0.1.1"
-    kind-of "^2.0.1"
-    lazy-cache "^0.2.3"
+    kind-of "^5.0.0"
     mixin-object "^2.0.1"

 shebang-command@^1.2.0:
@@ -6168,10 +6887,6 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/source-list-map/-/source-list-map-2.0.0.tgz#aaa47403f7b245a92fbc97ea08f250d6087ed085"

-source-list-map@~0.1.7:
-  version "0.1.8"
-  resolved "https://registry.yarnpkg.com/source-list-map/-/source-list-map-0.1.8.tgz#c550b2ab5427f6b3f21f5afead88c4f5587b2106"
-
 source-map-resolve@^0.3.0:
   version "0.3.1"
   resolved "https://registry.yarnpkg.com/source-map-resolve/-/source-map-resolve-0.3.1.tgz#610f6122a445b8dd51535a2a71b783dfc1248761"
@@ -6197,9 +6912,9 @@
   dependencies:
     source-map "^0.5.6"

-source-map-support@^0.5.3:
-  version "0.5.3"
-  resolved "https://registry.yarnpkg.com/source-map-support/-/source-map-support-0.5.3.tgz#2b3d5fff298cfa4d1afd7d4352d569e9a0158e76"
+source-map-support@^0.5.3, source-map-support@^0.5.4:
+  version "0.5.4"
+  resolved "https://registry.yarnpkg.com/source-map-support/-/source-map-support-0.5.4.tgz#54456efa89caa9270af7cd624cc2f123e51fbae8"
   dependencies:
     source-map "^0.6.0"

@@ -6211,7 +6926,7 @@
   version "0.3.0"
   resolved "https://registry.yarnpkg.com/source-map-url/-/source-map-url-0.3.0.tgz#7ecaf13b57bcd09da8a40c5d269db33799d4aaf9"

-source-map@0.5.x, source-map@^0.5.3, source-map@^0.5.6, source-map@~0.5.1, source-map@~0.5.3:
+source-map@0.5.x, source-map@^0.5.3, source-map@^0.5.6, source-map@^0.5.7, source-map@~0.5.3:
   version "0.5.7"
   resolved "https://registry.yarnpkg.com/source-map/-/source-map-0.5.7.tgz#8a039d2d1021d22d1ea14c80d8ea468ba2ef3fcc"

@@ -6289,6 +7004,12 @@
     jsbn "~0.1.0"
     tweetnacl "~0.14.0"

+ssri@^5.2.4:
+  version "5.3.0"
+  resolved "https://registry.yarnpkg.com/ssri/-/ssri-5.3.0.tgz#ba3872c9c6d33a0704a7d71ff045e5ec48999d06"
+  dependencies:
+    safe-buffer "^5.1.1"
+
 stat-mode@^0.2.2:
   version "0.2.2"
   resolved "https://registry.yarnpkg.com/stat-mode/-/stat-mode-0.2.2.tgz#e6c80b623123d7d80cf132ce538f346289072502"
@@ -6300,7 +7021,7 @@
     define-property "^0.2.5"
     object-copy "^0.1.0"

-"statuses@>= 1.3.1 < 2":
+"statuses@>= 1.3.1 < 2", statuses@~1.4.0:
   version "1.4.0"
   resolved "https://registry.yarnpkg.com/statuses/-/statuses-1.4.0.tgz#bb73d446da2796106efcc1b601a253d6c46bd087"

@@ -6321,6 +7042,13 @@
     inherits "~2.0.1"
     readable-stream "^2.0.2"

+stream-each@^1.1.0:
+  version "1.2.2"
+  resolved "https://registry.yarnpkg.com/stream-each/-/stream-each-1.2.2.tgz#8e8c463f91da8991778765873fe4d960d8f616bd"
+  dependencies:
+    end-of-stream "^1.1.0"
+    stream-shift "^1.0.0"
+
 stream-http@^2.3.1:
   version "2.7.2"
   resolved "https://registry.yarnpkg.com/stream-http/-/stream-http-2.7.2.tgz#40a050ec8dc3b53b33d9909415c02c0bf1abfbad"
@@ -6331,6 +7059,10 @@
     to-arraybuffer "^1.0.0"
     xtend "^4.0.0"

+stream-shift@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/stream-shift/-/stream-shift-1.0.0.tgz#d5c752825e5367e786f78e18e445ea223a155952"
+
 strict-uri-encode@^1.0.0:
   version "1.1.0"
   resolved "https://registry.yarnpkg.com/strict-uri-encode/-/strict-uri-encode-1.1.0.tgz#279b225df1d582b1f54e65addd4352e18faa0713"
@@ -6360,6 +7092,12 @@
   dependencies:
     safe-buffer "~5.1.0"

+string_decoder@~1.1.1:
+  version "1.1.1"
+  resolved "https://registry.yarnpkg.com/string_decoder/-/string_decoder-1.1.1.tgz#9cf1611ba62685d7030ae9e4ba34149c3af03fc8"
+  dependencies:
+    safe-buffer "~5.1.0"
+
 stringstream@~0.0.4, stringstream@~0.0.5:
   version "0.0.5"
   resolved "https://registry.yarnpkg.com/stringstream/-/stringstream-0.0.5.tgz#4e484cd4de5a0bbbee18e46307710a8a81621878"
@@ -6404,12 +7142,12 @@
   version "2.0.1"
   resolved "https://registry.yarnpkg.com/strip-json-comments/-/strip-json-comments-2.0.1.tgz#3c531942e908c2697c0ec344858c286c7ca0a60a"

-style-loader@^0.19.1:
-  version "0.19.1"
-  resolved "https://registry.yarnpkg.com/style-loader/-/style-loader-0.19.1.tgz#591ffc80bcefe268b77c5d9ebc0505d772619f85"
+style-loader@^0.21.0:
+  version "0.21.0"
+  resolved "https://registry.yarnpkg.com/style-loader/-/style-loader-0.21.0.tgz#68c52e5eb2afc9ca92b6274be277ee59aea3a852"
   dependencies:
-    loader-utils "^1.0.2"
-    schema-utils "^0.3.0"
+    loader-utils "^1.1.0"
+    schema-utils "^0.4.5"

 sumchecker@^1.2.0:
   version "1.3.1"
@@ -6434,18 +7172,24 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/supports-color/-/supports-color-2.0.0.tgz#535d045ce6b6363fa40117084629995e9df324c7"

-supports-color@^3.1.0, supports-color@^3.1.2, supports-color@^3.2.3, supports-color@~3.2.3:
+supports-color@^3.1.2, supports-color@^3.2.3, supports-color@~3.2.3:
   version "3.2.3"
   resolved "https://registry.yarnpkg.com/supports-color/-/supports-color-3.2.3.tgz#65ac0504b3954171d8a64946b2ae3cbb8a5f54f6"
   dependencies:
     has-flag "^1.0.0"

-supports-color@^4.0.0, supports-color@^4.2.1, supports-color@^4.4.0:
+supports-color@^4.0.0, supports-color@^4.4.0:
   version "4.5.0"
   resolved "https://registry.yarnpkg.com/supports-color/-/supports-color-4.5.0.tgz#be7a0de484dec5c5cddf8b3d59125044912f635b"
   dependencies:
     has-flag "^2.0.0"

+supports-color@^5.3.0:
+  version "5.4.0"
+  resolved "https://registry.yarnpkg.com/supports-color/-/supports-color-5.4.0.tgz#1c6b337402c2137605efe19f10fec390f6faab54"
+  dependencies:
+    has-flag "^3.0.0"
+
 svgo@^0.7.0:
   version "0.7.2"
   resolved "https://registry.yarnpkg.com/svgo/-/svgo-0.7.2.tgz#9f5772413952135c6fefbf40afe6a4faa88b4bb5"
@@ -6469,22 +7213,9 @@
     slice-ansi "1.0.0"
     string-width "^2.1.1"

-tapable@^0.2.5, tapable@^0.2.7, tapable@~0.2.5:
-  version "0.2.8"
-  resolved "https://registry.yarnpkg.com/tapable/-/tapable-0.2.8.tgz#99372a5c999bf2df160afc0d74bed4f47948cd22"
-
-tar-pack@^3.4.0:
-  version "3.4.1"
-  resolved "https://registry.yarnpkg.com/tar-pack/-/tar-pack-3.4.1.tgz#e1dbc03a9b9d3ba07e896ad027317eb679a10a1f"
-  dependencies:
-    debug "^2.2.0"
-    fstream "^1.0.10"
-    fstream-ignore "^1.0.5"
-    once "^1.3.3"
-    readable-stream "^2.1.4"
-    rimraf "^2.5.1"
-    tar "^2.2.1"
-    uid-number "^0.0.6"
+tapable@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/tapable/-/tapable-1.0.0.tgz#cbb639d9002eed9c6b5975eb20598d7936f1f9f2"

 tar-stream@^1.5.0:
   version "1.5.4"
@@ -6495,7 +7226,7 @@
     readable-stream "^2.0.0"
     xtend "^4.0.0"

-tar@^2.0.0, tar@^2.2.1:
+tar@^2.0.0:
   version "2.2.1"
   resolved "https://registry.yarnpkg.com/tar/-/tar-2.2.1.tgz#8e4d2a256c0e2185c6b18ad694aec968b83cb1d1"
   dependencies:
@@ -6503,6 +7234,18 @@
     fstream "^1.0.2"
     inherits "2"

+tar@^4:
+  version "4.4.2"
+  resolved "https://registry.yarnpkg.com/tar/-/tar-4.4.2.tgz#60685211ba46b38847b1ae7ee1a24d744a2cd462"
+  dependencies:
+    chownr "^1.0.1"
+    fs-minipass "^1.2.5"
+    minipass "^2.2.4"
+    minizlib "^1.1.0"
+    mkdirp "^0.5.0"
+    safe-buffer "^5.1.2"
+    yallist "^3.0.2"
+
 temp-file@^3.1.1:
   version "3.1.1"
   resolved "https://registry.yarnpkg.com/temp-file/-/temp-file-3.1.1.tgz#8823649aa4e8a6e419eb71b601a2e4d472b0f24f"
@@ -6545,6 +7288,13 @@
   version "0.0.2"
   resolved "https://registry.yarnpkg.com/throttleit/-/throttleit-0.0.2.tgz#cfedf88e60c00dd9697b61fdd2a8343a9b680eaf"

+through2@^2.0.0:
+  version "2.0.3"
+  resolved "https://registry.yarnpkg.com/through2/-/through2-2.0.3.tgz#0004569b37c7c74ba39c43f3ced78d1ad94140be"
+  dependencies:
+    readable-stream "^2.1.5"
+    xtend "~4.0.1"
+
 through2@~0.2.3:
   version "0.2.3"
   resolved "https://registry.yarnpkg.com/through2/-/through2-0.2.3.tgz#eb3284da4ea311b6cc8ace3653748a52abf25a3f"
@@ -6617,6 +7367,15 @@
     extend-shallow "^2.0.1"
     regex-not "^1.0.0"

+to-regex@^3.0.2:
+  version "3.0.2"
+  resolved "https://registry.yarnpkg.com/to-regex/-/to-regex-3.0.2.tgz#13cfdd9b336552f30b51f33a8ae1b42a7a7599ce"
+  dependencies:
+    define-property "^2.0.2"
+    extend-shallow "^3.0.2"
+    regex-not "^1.0.2"
+    safe-regex "^1.1.0"
+
 to-space-case@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/to-space-case/-/to-space-case-1.0.0.tgz#b052daafb1b2b29dc770cea0163e5ec0ebc9fc17"
@@ -6663,6 +7422,10 @@
   dependencies:
     utf8-byte-length "^1.0.1"

+tryer@^1.0.0:
+  version "1.0.0"
+  resolved "https://registry.yarnpkg.com/tryer/-/tryer-1.0.0.tgz#027b69fa823225e551cace3ef03b11f6ab37c1d7"
+
 tryit@^1.0.1:
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/tryit/-/tryit-1.0.3.tgz#393be730a9446fd1ead6da59a014308f36c289cb"
@@ -6728,8 +7491,8 @@
     tslib "^1.7.1"

 tsutils@^2.13.1:
-  version "2.22.2"
-  resolved "https://registry.yarnpkg.com/tsutils/-/tsutils-2.22.2.tgz#0b9f3d87aa3eb95bd32d26ce2b88aa329a657951"
+  version "2.25.1"
+  resolved "https://registry.yarnpkg.com/tsutils/-/tsutils-2.25.1.tgz#24a46342ab8b174a3fbde632e60dcd11b64982f9"
   dependencies:
     tslib "^1.8.1"

@@ -6768,25 +7531,39 @@
     media-typer "0.3.0"
     mime-types "~2.1.15"

+type-is@~1.6.16:
+  version "1.6.16"
+  resolved "https://registry.yarnpkg.com/type-is/-/type-is-1.6.16.tgz#f89ce341541c672b25ee7ae3c73dee3b2be50194"
+  dependencies:
+    media-typer "0.3.0"
+    mime-types "~2.1.18"
+
 typedarray@^0.0.6:
   version "0.0.6"
   resolved "https://registry.yarnpkg.com/typedarray/-/typedarray-0.0.6.tgz#867ac74e3864187b1d3d47d996a78ec5c8830777"

-typescript-eslint-parser@^14.0.0:
-  version "14.0.0"
-  resolved "https://registry.yarnpkg.com/typescript-eslint-parser/-/typescript-eslint-parser-14.0.0.tgz#c90a8f541c1d96e5c55e2807c61d154e788520f9"
+typescript-eslint-parser@^16.0.0:
+  version "16.0.0"
+  resolved "https://registry.yarnpkg.com/typescript-eslint-parser/-/typescript-eslint-parser-16.0.0.tgz#14a9ab75932b15af919602faef553c6f0487f352"
   dependencies:
     lodash.unescape "4.0.1"
     semver "5.5.0"

-typescript@^2.8.1:
-  version "2.8.1"
-  resolved "https://registry.yarnpkg.com/typescript/-/typescript-2.8.1.tgz#6160e4f8f195d5ba81d4876f9c0cc1fbc0820624"
+typescript@^2.9.1:
+  version "2.9.1"
+  resolved "https://registry.yarnpkg.com/typescript/-/typescript-2.9.1.tgz#fdb19d2c67a15d11995fd15640e373e09ab09961"

 ua-parser-js@^0.7.9:
   version "0.7.17"
   resolved "https://registry.yarnpkg.com/ua-parser-js/-/ua-parser-js-0.7.17.tgz#e9ec5f9498b9ec910e7ae3ac626a805c4d09ecac"

+uglify-es@^3.3.4:
+  version "3.3.9"
+  resolved "https://registry.yarnpkg.com/uglify-es/-/uglify-es-3.3.9.tgz#0c1c4f0700bed8dbc124cdb304d2592ca203e677"
+  dependencies:
+    commander "~2.13.0"
+    source-map "~0.6.1"
+
 uglify-js@3.1.x:
   version "3.1.6"
   resolved "https://registry.yarnpkg.com/uglify-js/-/uglify-js-3.1.6.tgz#918832602036e95d2318e11f27ee8461a8592c5d"
@@ -6794,30 +7571,18 @@
     commander "~2.11.0"
     source-map "~0.6.1"

-uglify-js@^2.8.27, uglify-js@^2.8.29:
-  version "2.8.29"
-  resolved "https://registry.yarnpkg.com/uglify-js/-/uglify-js-2.8.29.tgz#29c5733148057bb4e1f75df35b7a9cb72e6a59dd"
-  dependencies:
-    source-map "~0.5.1"
-    yargs "~3.10.0"
-  optionalDependencies:
-    uglify-to-browserify "~1.0.0"
-
-uglify-to-browserify@~1.0.0:
-  version "1.0.2"
-  resolved "https://registry.yarnpkg.com/uglify-to-browserify/-/uglify-to-browserify-1.0.2.tgz#6e0924d6bda6b5afe349e39a6d632850a0f882b7"
-
-uglifyjs-webpack-plugin@^0.4.6:
-  version "0.4.6"
-  resolved "https://registry.yarnpkg.com/uglifyjs-webpack-plugin/-/uglifyjs-webpack-plugin-0.4.6.tgz#b951f4abb6bd617e66f63eb891498e391763e309"
+uglifyjs-webpack-plugin@^1.2.4:
+  version "1.2.5"
+  resolved "https://registry.yarnpkg.com/uglifyjs-webpack-plugin/-/uglifyjs-webpack-plugin-1.2.5.tgz#2ef8387c8f1a903ec5e44fa36f9f3cbdcea67641"
   dependencies:
-    source-map "^0.5.6"
-    uglify-js "^2.8.29"
-    webpack-sources "^1.0.1"
-
-uid-number@^0.0.6:
-  version "0.0.6"
-  resolved "https://registry.yarnpkg.com/uid-number/-/uid-number-0.0.6.tgz#0ea10e8035e8eb5b8e4449f06da1c730663baa81"
+    cacache "^10.0.4"
+    find-cache-dir "^1.0.0"
+    schema-utils "^0.4.5"
+    serialize-javascript "^1.4.0"
+    source-map "^0.6.1"
+    uglify-es "^3.3.4"
+    webpack-sources "^1.1.0"
+    worker-farm "^1.5.2"

 underscore@~1.6.0:
   version "1.6.0"
@@ -6846,6 +7611,18 @@
   version "2.0.0"
   resolved "https://registry.yarnpkg.com/uniqs/-/uniqs-2.0.0.tgz#ffede4b36b25290696e6e165d4a59edb998e6b02"

+unique-filename@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/unique-filename/-/unique-filename-1.1.0.tgz#d05f2fe4032560871f30e93cbe735eea201514f3"
+  dependencies:
+    unique-slug "^2.0.0"
+
+unique-slug@^2.0.0:
+  version "2.0.0"
+  resolved "https://registry.yarnpkg.com/unique-slug/-/unique-slug-2.0.0.tgz#db6676e7c7cc0629878ff196097c78855ae9f4ab"
+  dependencies:
+    imurmurhash "^0.1.4"
+
 unique-string@^1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/unique-string/-/unique-string-1.0.0.tgz#9e1057cca851abb93398f8b33ae187b99caec11a"
@@ -6871,6 +7648,10 @@
   version "2.0.1"
   resolved "https://registry.yarnpkg.com/unzip-response/-/unzip-response-2.0.1.tgz#d2f0f737d16b0615e72a6935ed04214572d56f97"

+upath@^1.0.0:
+  version "1.0.5"
+  resolved "https://registry.yarnpkg.com/upath/-/upath-1.0.5.tgz#02cab9ecebe95bbec6d5fc2566325725ab6d1a73"
+
 update-notifier@^2.3.0:
   version "2.3.0"
   resolved "https://registry.yarnpkg.com/update-notifier/-/update-notifier-2.3.0.tgz#4e8827a6bb915140ab093559d7014e3ebb837451"
@@ -6895,13 +7676,19 @@
   dependencies:
     punycode "^2.1.0"

+uri-js@^4.2.1:
+  version "4.2.1"
+  resolved "https://registry.yarnpkg.com/uri-js/-/uri-js-4.2.1.tgz#4595a80a51f356164e22970df64c7abd6ade9850"
+  dependencies:
+    punycode "^2.1.0"
+
 urix@^0.1.0, urix@~0.1.0:
   version "0.1.0"
   resolved "https://registry.yarnpkg.com/urix/-/urix-0.1.0.tgz#da937f7a62e21fec1fd18d49b35c2935067a6c72"

-url-join@^2.0.2:
-  version "2.0.2"
-  resolved "https://registry.yarnpkg.com/url-join/-/url-join-2.0.2.tgz#c072756967ad24b8b59e5741551caac78f50b8b7"
+url-join@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/url-join/-/url-join-4.0.0.tgz#4d3340e807d3773bda9991f8305acdcc2a665d2a"

 url-parse-lax@^1.0.0:
   version "1.0.0"
@@ -6943,7 +7730,7 @@
   version "1.0.3"
   resolved "https://registry.yarnpkg.com/util-extend/-/util-extend-1.0.3.tgz#a7c216d267545169637b3b6edc6ca9119e2ff93f"

-util.promisify@^1.0.0:
+util.promisify@1.0.0:
   version "1.0.0"
   resolved "https://registry.yarnpkg.com/util.promisify/-/util.promisify-1.0.0.tgz#440f7165a459c9a16dc145eb8e72f35687097030"
   dependencies:
@@ -7009,18 +7796,28 @@
   version "0.0.11"
   resolved "https://registry.yarnpkg.com/walkdir/-/walkdir-0.0.11.tgz#a16d025eb931bd03b52f308caed0f40fcebe9532"

-watchpack@^1.3.1, watchpack@^1.4.0:
-  version "1.4.0"
-  resolved "https://registry.yarnpkg.com/watchpack/-/watchpack-1.4.0.tgz#4a1472bcbb952bd0a9bb4036801f954dfb39faac"
+watchpack@^1.5.0:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/watchpack/-/watchpack-1.6.0.tgz#4bc12c2ebe8aa277a71f1d3f14d685c7b446cd00"
   dependencies:
-    async "^2.1.2"
-    chokidar "^1.7.0"
+    chokidar "^2.0.2"
     graceful-fs "^4.1.2"
+    neo-async "^2.5.0"

 wdio-dot-reporter@~0.0.8:
   version "0.0.9"
   resolved "https://registry.yarnpkg.com/wdio-dot-reporter/-/wdio-dot-reporter-0.0.9.tgz#929b2adafd49d6b0534fda068e87319b47e38fe5"

+webassemblyjs@1.4.3:
+  version "1.4.3"
+  resolved "https://registry.yarnpkg.com/webassemblyjs/-/webassemblyjs-1.4.3.tgz#0591893efb8fbde74498251cbe4b2d83df9239cb"
+  dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/validation" "1.4.3"
+    "@webassemblyjs/wasm-parser" "1.4.3"
+    "@webassemblyjs/wast-parser" "1.4.3"
+    long "^3.2.0"
+
 webdriverio@^4.8.0:
   version "4.8.0"
   resolved "https://registry.yarnpkg.com/webdriverio/-/webdriverio-4.8.0.tgz#d52929b749080f89967f6e1614051cbc8172d132"
@@ -7048,21 +7845,38 @@
     wdio-dot-reporter "~0.0.8"
     wgxpath "~1.0.0"

-webpack-dev-middleware@^2.0.3:
-  version "2.0.3"
-  resolved "https://registry.yarnpkg.com/webpack-dev-middleware/-/webpack-dev-middleware-2.0.3.tgz#44e15480ec58d275417ac4d93a0126c7b72450bd"
+webpack-bundle-analyzer@^2.13.0:
+  version "2.13.0"
+  resolved "https://registry.yarnpkg.com/webpack-bundle-analyzer/-/webpack-bundle-analyzer-2.13.0.tgz#8d7db44c3d4844bc911890998e1110514cf12264"
+  dependencies:
+    acorn "^5.3.0"
+    bfj-node4 "^5.2.0"
+    chalk "^2.3.0"
+    commander "^2.13.0"
+    ejs "^2.5.7"
+    express "^4.16.2"
+    filesize "^3.5.11"
+    gzip-size "^4.1.0"
+    lodash "^4.17.4"
+    mkdirp "^0.5.1"
+    opener "^1.4.3"
+    ws "^4.0.0"
+
+webpack-dev-middleware@^3.1.3:
+  version "3.1.3"
+  resolved "https://registry.yarnpkg.com/webpack-dev-middleware/-/webpack-dev-middleware-3.1.3.tgz#8b32aa43da9ae79368c1bf1183f2b6cf5e1f39ed"
   dependencies:
     loud-rejection "^1.6.0"
     memory-fs "~0.4.1"
     mime "^2.1.0"
     path-is-absolute "^1.0.0"
     range-parser "^1.0.3"
-    url-join "^2.0.2"
+    url-join "^4.0.0"
     webpack-log "^1.0.1"

-webpack-hot-middleware@^2.21.0:
-  version "2.21.0"
-  resolved "https://registry.yarnpkg.com/webpack-hot-middleware/-/webpack-hot-middleware-2.21.0.tgz#7b3c113a7a4b301c91e0749573c7aab28b414b52"
+webpack-hot-middleware@^2.22.2:
+  version "2.22.2"
+  resolved "https://registry.yarnpkg.com/webpack-hot-middleware/-/webpack-hot-middleware-2.22.2.tgz#623b77ce591fcd4e1fb99f18167781443e50afac"
   dependencies:
     ansi-html "0.0.7"
     html-entities "^1.2.0"
@@ -7078,18 +7892,11 @@
     loglevelnext "^1.0.1"
     uuid "^3.1.0"

-webpack-merge@^4.1.0:
-  version "4.1.1"
-  resolved "https://registry.yarnpkg.com/webpack-merge/-/webpack-merge-4.1.1.tgz#f1197a0a973e69c6fbeeb6d658219aa8c0c13555"
-  dependencies:
-    lodash "^4.17.4"
-
-webpack-sources@^0.1.4:
-  version "0.1.5"
-  resolved "https://registry.yarnpkg.com/webpack-sources/-/webpack-sources-0.1.5.tgz#aa1f3abf0f0d74db7111c40e500b84f966640750"
+webpack-merge@^4.1.2:
+  version "4.1.2"
+  resolved "https://registry.yarnpkg.com/webpack-merge/-/webpack-merge-4.1.2.tgz#5d372dddd3e1e5f8874f5bf5a8e929db09feb216"
   dependencies:
-    source-list-map "~0.1.7"
-    source-map "~0.5.3"
+    lodash "^4.17.5"

 webpack-sources@^1.0.1:
   version "1.0.1"
@@ -7098,58 +7905,39 @@
     source-list-map "^2.0.0"
     source-map "~0.5.3"

-webpack@^2.2.0:
-  version "2.7.0"
-  resolved "https://registry.yarnpkg.com/webpack/-/webpack-2.7.0.tgz#b2a1226804373ffd3d03ea9c6bd525067034f6b1"
+webpack-sources@^1.1.0:
+  version "1.1.0"
+  resolved "https://registry.yarnpkg.com/webpack-sources/-/webpack-sources-1.1.0.tgz#a101ebae59d6507354d71d8013950a3a8b7a5a54"
   dependencies:
-    acorn "^5.0.0"
-    acorn-dynamic-import "^2.0.0"
-    ajv "^4.7.0"
-    ajv-keywords "^1.1.1"
-    async "^2.1.2"
-    enhanced-resolve "^3.3.0"
-    interpret "^1.0.0"
-    json-loader "^0.5.4"
-    json5 "^0.5.1"
-    loader-runner "^2.3.0"
-    loader-utils "^0.2.16"
-    memory-fs "~0.4.1"
-    mkdirp "~0.5.0"
-    node-libs-browser "^2.0.0"
-    source-map "^0.5.3"
-    supports-color "^3.1.0"
-    tapable "~0.2.5"
-    uglify-js "^2.8.27"
-    watchpack "^1.3.1"
-    webpack-sources "^1.0.1"
-    yargs "^6.0.0"
+    source-list-map "^2.0.0"
+    source-map "~0.6.1"

-webpack@^3.10.0:
-  version "3.10.0"
-  resolved "https://registry.yarnpkg.com/webpack/-/webpack-3.10.0.tgz#5291b875078cf2abf42bdd23afe3f8f96c17d725"
+webpack@^4.8.3:
+  version "4.8.3"
+  resolved "https://registry.yarnpkg.com/webpack/-/webpack-4.8.3.tgz#957c8e80000f9e5cc03d775e78b472d8954f4eeb"
   dependencies:
+    "@webassemblyjs/ast" "1.4.3"
+    "@webassemblyjs/wasm-edit" "1.4.3"
+    "@webassemblyjs/wasm-parser" "1.4.3"
     acorn "^5.0.0"
-    acorn-dynamic-import "^2.0.0"
-    ajv "^5.1.5"
-    ajv-keywords "^2.0.0"
-    async "^2.1.2"
-    enhanced-resolve "^3.4.0"
-    escope "^3.6.0"
-    interpret "^1.0.0"
-    json-loader "^0.5.4"
-    json5 "^0.5.1"
+    acorn-dynamic-import "^3.0.0"
+    ajv "^6.1.0"
+    ajv-keywords "^3.1.0"
+    chrome-trace-event "^0.1.1"
+    enhanced-resolve "^4.0.0"
+    eslint-scope "^3.7.1"
     loader-runner "^2.3.0"
     loader-utils "^1.1.0"
     memory-fs "~0.4.1"
+    micromatch "^3.1.8"
     mkdirp "~0.5.0"
+    neo-async "^2.5.0"
     node-libs-browser "^2.0.0"
-    source-map "^0.5.3"
-    supports-color "^4.2.1"
-    tapable "^0.2.7"
-    uglifyjs-webpack-plugin "^0.4.6"
-    watchpack "^1.4.0"
+    schema-utils "^0.4.4"
+    tapable "^1.0.0"
+    uglifyjs-webpack-plugin "^1.2.4"
+    watchpack "^1.5.0"
     webpack-sources "^1.0.1"
-    yargs "^8.0.2"

 wgxpath@~1.0.0:
   version "1.0.0"
@@ -7189,14 +7977,6 @@
   dependencies:
     string-width "^1.0.1"

-window-size@0.1.0:
-  version "0.1.0"
-  resolved "https://registry.yarnpkg.com/window-size/-/window-size-0.1.0.tgz#5438cd2ea93b202efa3a19fe8887aee7c94f9c9d"
-
-wordwrap@0.0.2:
-  version "0.0.2"
-  resolved "https://registry.yarnpkg.com/wordwrap/-/wordwrap-0.0.2.tgz#b79669bb42ecb409f83d583cad52ca17eaa1643f"
-
 wordwrap@~0.0.2:
   version "0.0.3"
   resolved "https://registry.yarnpkg.com/wordwrap/-/wordwrap-0.0.3.tgz#a3d5da6cd5c0bc0008d37234bbaf1bed63059107"
@@ -7212,6 +7992,12 @@
     errno "^0.1.4"
     xtend "^4.0.1"

+worker-farm@^1.5.2:
+  version "1.6.0"
+  resolved "https://registry.yarnpkg.com/worker-farm/-/worker-farm-1.6.0.tgz#aecc405976fab5a95526180846f0dba288f3a4a0"
+  dependencies:
+    errno "~0.1.7"
+
 wrap-ansi@^2.0.0:
   version "2.1.0"
   resolved "https://registry.yarnpkg.com/wrap-ansi/-/wrap-ansi-2.1.0.tgz#d8fc3d284dd05794fe84973caecdd1cf824fdd85"
@@ -7237,6 +8023,13 @@
   dependencies:
     mkdirp "^0.5.1"

+ws@^4.0.0:
+  version "4.1.0"
+  resolved "https://registry.yarnpkg.com/ws/-/ws-4.1.0.tgz#a979b5d7d4da68bf54efe0408967c324869a7289"
+  dependencies:
+    async-limiter "~1.0.0"
+    safe-buffer "~5.1.0"
+
 xdg-basedir@^3.0.0:
   version "3.0.0"
   resolved "https://registry.yarnpkg.com/xdg-basedir/-/xdg-basedir-3.0.0.tgz#496b2cc109eca8dbacfe2dc72b603c17c5870ad4"
@@ -7277,7 +8070,7 @@
   version "0.1.27"
   resolved "https://registry.yarnpkg.com/xmldom/-/xmldom-0.1.27.tgz#d501f97b3bdb403af8ef9ecc20573187aadac0e9"

-xtend@^4.0.0, xtend@^4.0.1:
+xtend@^4.0.0, xtend@^4.0.1, xtend@~4.0.1:
   version "4.0.1"
   resolved "https://registry.yarnpkg.com/xtend/-/xtend-4.0.1.tgz#a5c6d532be656e23db820efb943a1f04998d63af"

@@ -7298,15 +8091,17 @@
   version "3.2.1"
   resolved "https://registry.yarnpkg.com/y18n/-/y18n-3.2.1.tgz#6d15fba884c08679c0d77e88e7759e811e07fa41"

+y18n@^4.0.0:
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/y18n/-/y18n-4.0.0.tgz#95ef94f85ecc81d007c264e190a120f0a3c8566b"
+
 yallist@^2.1.2:
   version "2.1.2"
   resolved "https://registry.yarnpkg.com/yallist/-/yallist-2.1.2.tgz#1c11f9218f076089a47dd512f93c6699a6a81d52"

-yargs-parser@^4.2.0:
-  version "4.2.1"
-  resolved "https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-4.2.1.tgz#29cceac0dc4f03c6c87b4a9f217dd18c9f74871c"
-  dependencies:
-    camelcase "^3.0.0"
+yallist@^3.0.0, yallist@^3.0.2:
+  version "3.0.2"
+  resolved "https://registry.yarnpkg.com/yallist/-/yallist-3.0.2.tgz#8452b4bb7e83c7c188d8041c1a837c773d6d8bb9"

 yargs-parser@^5.0.0:
   version "5.0.0"
@@ -7314,18 +8109,6 @@
   dependencies:
     camelcase "^3.0.0"

-yargs-parser@^7.0.0:
-  version "7.0.0"
-  resolved "https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-7.0.0.tgz#8d0ac42f16ea55debd332caf4c4038b3e3f5dfd9"
-  dependencies:
-    camelcase "^4.1.0"
-
-yargs-parser@^8.0.0:
-  version "8.0.0"
-  resolved "https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-8.0.0.tgz#21d476330e5a82279a4b881345bf066102e219c6"
-  dependencies:
-    camelcase "^4.1.0"
-
 yargs-parser@^9.0.2:
   version "9.0.2"
   resolved "https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-9.0.2.tgz#9ccf6a43460fe4ed40a9bb68f48d43b8a68cc077"
@@ -7349,24 +8132,6 @@
     y18n "^3.2.1"
     yargs-parser "^9.0.2"

-yargs@^6.0.0:
-  version "6.6.0"
-  resolved "https://registry.yarnpkg.com/yargs/-/yargs-6.6.0.tgz#782ec21ef403345f830a808ca3d513af56065208"
-  dependencies:
-    camelcase "^3.0.0"
-    cliui "^3.2.0"
-    decamelize "^1.1.1"
-    get-caller-file "^1.0.1"
-    os-locale "^1.4.0"
-    read-pkg-up "^1.0.1"
-    require-directory "^2.1.1"
-    require-main-filename "^1.0.1"
-    set-blocking "^2.0.0"
-    string-width "^1.0.2"
-    which-module "^1.0.0"
-    y18n "^3.2.1"
-    yargs-parser "^4.2.0"
-
 yargs@^7.0.0:
   version "7.1.0"
   resolved "https://registry.yarnpkg.com/yargs/-/yargs-7.1.0.tgz#6ba318eb16961727f5d284f8ea003e8d6154d0c8"
@@ -7385,33 +8150,6 @@
     y18n "^3.2.1"
     yargs-parser "^5.0.0"

-yargs@^8.0.2:
-  version "8.0.2"
-  resolved "https://registry.yarnpkg.com/yargs/-/yargs-8.0.2.tgz#6299a9055b1cefc969ff7e79c1d918dceb22c360"
-  dependencies:
-    camelcase "^4.1.0"
-    cliui "^3.2.0"
-    decamelize "^1.1.1"
-    get-caller-file "^1.0.1"
-    os-locale "^2.0.0"
-    read-pkg-up "^2.0.0"
-    require-directory "^2.1.1"
-    require-main-filename "^1.0.1"
-    set-blocking "^2.0.0"
-    string-width "^2.0.0"
-    which-module "^2.0.0"
-    y18n "^3.2.1"
-    yargs-parser "^7.0.0"
-
-yargs@~3.10.0:
-  version "3.10.0"
-  resolved "https://registry.yarnpkg.com/yargs/-/yargs-3.10.0.tgz#f7ee7bd857dd7c1d2d38c0e74efbd681d1431fd1"
-  dependencies:
-    camelcase "^1.0.2"
-    cliui "^2.1.0"
-    decamelize "^1.0.0"
-    window-size "0.1.0"
-
 yauzl@2.4.1:
   version "2.4.1"
   resolved "https://registry.yarnpkg.com/yauzl/-/yauzl-2.4.1.tgz#9528f442dab1b2284e58b4379bb194e22e0c4005"
